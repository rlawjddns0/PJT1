{"remainingRequest":"C:\\Users\\multicampus\\Desktop\\pjt 1 back\\cowdog_fe\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\multicampus\\Desktop\\pjt 1 back\\cowdog_fe\\node_modules\\element-plus\\lib\\el-table\\index.js","dependencies":[{"path":"C:\\Users\\multicampus\\Desktop\\pjt 1 back\\cowdog_fe\\node_modules\\element-plus\\lib\\el-table\\index.js","mtime":1627609663368},{"path":"C:\\Users\\multicampus\\Desktop\\pjt 1 back\\cowdog_fe\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1627609653894},{"path":"C:\\Users\\multicampus\\Desktop\\pjt 1 back\\cowdog_fe\\node_modules\\babel-loader\\lib\\index.js","mtime":1627609652222}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:J3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIHZ1ZSA9IHJlcXVpcmUoJ3Z1ZScpOwoKdmFyIHV0aWwgPSByZXF1aXJlKCcuLi91dGlscy91dGlsJyk7Cgp2YXIgZG9tID0gcmVxdWlyZSgnLi4vdXRpbHMvZG9tJyk7Cgp2YXIgY29yZSA9IHJlcXVpcmUoJ0Bwb3BwZXJqcy9jb3JlJyk7Cgp2YXIgUG9wdXBNYW5hZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvcG9wdXAtbWFuYWdlcicpOwoKdmFyIGRlYm91bmNlID0gcmVxdWlyZSgnbG9kYXNoL2RlYm91bmNlJyk7Cgp2YXIgbG9jYWxlID0gcmVxdWlyZSgnLi4vbG9jYWxlJyk7Cgp2YXIgZGlyZWN0aXZlcyA9IHJlcXVpcmUoJy4uL2RpcmVjdGl2ZXMnKTsKCnZhciBzY3JvbGxiYXJXaWR0aCA9IHJlcXVpcmUoJy4uL3V0aWxzL3Njcm9sbGJhci13aWR0aCcpOwoKdmFyIGlzU2VydmVyID0gcmVxdWlyZSgnLi4vdXRpbHMvaXNTZXJ2ZXInKTsKCnZhciBFbENoZWNrYm94ID0gcmVxdWlyZSgnLi4vZWwtY2hlY2tib3gnKTsKCnZhciBFbFBvcHBlciA9IHJlcXVpcmUoJy4uL2VsLXBvcHBlcicpOwoKdmFyIEVsQ2hlY2tib3hHcm91cCA9IHJlcXVpcmUoJy4uL2VsLWNoZWNrYm94LWdyb3VwJyk7Cgp2YXIgRWxTY3JvbGxiYXIgPSByZXF1aXJlKCcuLi9lbC1zY3JvbGxiYXInKTsKCnZhciByZXNpemVFdmVudCA9IHJlcXVpcmUoJy4uL3V0aWxzL3Jlc2l6ZS1ldmVudCcpOwoKdmFyIHRocm90dGxlID0gcmVxdWlyZSgnbG9kYXNoL3Rocm90dGxlJyk7CgpmdW5jdGlvbiBfaW50ZXJvcERlZmF1bHRMZWdhY3koZSkgewogIHJldHVybiBlICYmIHR5cGVvZiBlID09PSAnb2JqZWN0JyAmJiAnZGVmYXVsdCcgaW4gZSA/IGUgOiB7CiAgICAnZGVmYXVsdCc6IGUKICB9Owp9Cgp2YXIgUG9wdXBNYW5hZ2VyX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19pbnRlcm9wRGVmYXVsdExlZ2FjeShQb3B1cE1hbmFnZXIpOwoKdmFyIGRlYm91bmNlX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19pbnRlcm9wRGVmYXVsdExlZ2FjeShkZWJvdW5jZSk7Cgp2YXIgc2Nyb2xsYmFyV2lkdGhfX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX2ludGVyb3BEZWZhdWx0TGVnYWN5KHNjcm9sbGJhcldpZHRoKTsKCnZhciBpc1NlcnZlcl9fZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9faW50ZXJvcERlZmF1bHRMZWdhY3koaXNTZXJ2ZXIpOwoKdmFyIEVsQ2hlY2tib3hfX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX2ludGVyb3BEZWZhdWx0TGVnYWN5KEVsQ2hlY2tib3gpOwoKdmFyIEVsUG9wcGVyX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19pbnRlcm9wRGVmYXVsdExlZ2FjeShFbFBvcHBlcik7Cgp2YXIgRWxDaGVja2JveEdyb3VwX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19pbnRlcm9wRGVmYXVsdExlZ2FjeShFbENoZWNrYm94R3JvdXApOwoKdmFyIEVsU2Nyb2xsYmFyX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19pbnRlcm9wRGVmYXVsdExlZ2FjeShFbFNjcm9sbGJhcik7Cgp2YXIgdGhyb3R0bGVfX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX2ludGVyb3BEZWZhdWx0TGVnYWN5KHRocm90dGxlKTsKLyoqDQogKiBNYWtlIGEgbWFwIGFuZCByZXR1cm4gYSBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYSBrZXkNCiAqIGlzIGluIHRoYXQgbWFwLg0KICogSU1QT1JUQU5UOiBhbGwgY2FsbHMgb2YgdGhpcyBmdW5jdGlvbiBtdXN0IGJlIHByZWZpeGVkIHdpdGgNCiAqIFwvXCojXF9cX1BVUkVcX1xfXCpcLw0KICogU28gdGhhdCByb2xsdXAgY2FuIHRyZWUtc2hha2UgdGhlbSBpZiBuZWNlc3NhcnkuDQogKi8KCgpjb25zdCBFTVBUWV9PQkogPSBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nID8gT2JqZWN0LmZyZWV6ZSh7fSkgOiB7fTsKY29uc3QgRU1QVFlfQVJSID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyA/IE9iamVjdC5mcmVlemUoW10pIDogW107CmNvbnN0IGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCmNvbnN0IGhhc093biA9ICh2YWwsIGtleSkgPT4gaGFzT3duUHJvcGVydHkuY2FsbCh2YWwsIGtleSk7Cgp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wU3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CnZhciBfX2hhc093blByb3AgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5Owp2YXIgX19wcm9wSXNFbnVtID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCnZhciBfX2RlZk5vcm1hbFByb3AgPSAob2JqLCBrZXksIHZhbHVlKSA9PiBrZXkgaW4gb2JqID8gX19kZWZQcm9wKG9iaiwga2V5LCB7CiAgZW51bWVyYWJsZTogdHJ1ZSwKICBjb25maWd1cmFibGU6IHRydWUsCiAgd3JpdGFibGU6IHRydWUsCiAgdmFsdWUKfSkgOiBvYmpba2V5XSA9IHZhbHVlOwoKdmFyIF9fc3ByZWFkVmFsdWVzID0gKGEsIGIpID0+IHsKICBmb3IgKHZhciBwcm9wIGluIGIgfHwgKGIgPSB7fSkpIGlmIChfX2hhc093blByb3AuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wKGEsIHByb3AsIGJbcHJvcF0pOwoKICBpZiAoX19nZXRPd25Qcm9wU3ltYm9scykgZm9yICh2YXIgcHJvcCBvZiBfX2dldE93blByb3BTeW1ib2xzKGIpKSB7CiAgICBpZiAoX19wcm9wSXNFbnVtLmNhbGwoYiwgcHJvcCkpIF9fZGVmTm9ybWFsUHJvcChhLCBwcm9wLCBiW3Byb3BdKTsKICB9CiAgcmV0dXJuIGE7Cn07Cgpjb25zdCBnZXRDZWxsID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgbGV0IGNlbGwgPSBldmVudC50YXJnZXQ7CgogIHdoaWxlIChjZWxsICYmIGNlbGwudGFnTmFtZS50b1VwcGVyQ2FzZSgpICE9PSAiSFRNTCIpIHsKICAgIGlmIChjZWxsLnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PT0gIlREIikgewogICAgICByZXR1cm4gY2VsbDsKICAgIH0KCiAgICBjZWxsID0gY2VsbC5wYXJlbnROb2RlOwogIH0KCiAgcmV0dXJuIG51bGw7Cn07Cgpjb25zdCBpc09iamVjdCA9IGZ1bmN0aW9uIChvYmopIHsKICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICJvYmplY3QiOwp9OwoKY29uc3Qgb3JkZXJCeSA9IGZ1bmN0aW9uIChhcnJheSwgc29ydEtleSwgcmV2ZXJzZSwgc29ydE1ldGhvZCwgc29ydEJ5KSB7CiAgaWYgKCFzb3J0S2V5ICYmICFzb3J0TWV0aG9kICYmICghc29ydEJ5IHx8IEFycmF5LmlzQXJyYXkoc29ydEJ5KSAmJiAhc29ydEJ5Lmxlbmd0aCkpIHsKICAgIHJldHVybiBhcnJheTsKICB9CgogIGlmICh0eXBlb2YgcmV2ZXJzZSA9PT0gInN0cmluZyIpIHsKICAgIHJldmVyc2UgPSByZXZlcnNlID09PSAiZGVzY2VuZGluZyIgPyAtMSA6IDE7CiAgfSBlbHNlIHsKICAgIHJldmVyc2UgPSByZXZlcnNlICYmIHJldmVyc2UgPCAwID8gLTEgOiAxOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gc29ydE1ldGhvZCA/IG51bGwgOiBmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICBpZiAoc29ydEJ5KSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShzb3J0QnkpKSB7CiAgICAgICAgc29ydEJ5ID0gW3NvcnRCeV07CiAgICAgIH0KCiAgICAgIHJldHVybiBzb3J0QnkubWFwKGZ1bmN0aW9uIChieSkgewogICAgICAgIGlmICh0eXBlb2YgYnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICByZXR1cm4gdXRpbC5nZXRWYWx1ZUJ5UGF0aCh2YWx1ZSwgYnkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gYnkodmFsdWUsIGluZGV4LCBhcnJheSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBpZiAoc29ydEtleSAhPT0gIiRrZXkiKSB7CiAgICAgIGlmIChpc09iamVjdCh2YWx1ZSkgJiYgIiR2YWx1ZSIgaW4gdmFsdWUpIHZhbHVlID0gdmFsdWUuJHZhbHVlOwogICAgfQoKICAgIHJldHVybiBbaXNPYmplY3QodmFsdWUpID8gdXRpbC5nZXRWYWx1ZUJ5UGF0aCh2YWx1ZSwgc29ydEtleSkgOiB2YWx1ZV07CiAgfTsKCiAgY29uc3QgY29tcGFyZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICBpZiAoc29ydE1ldGhvZCkgewogICAgICByZXR1cm4gc29ydE1ldGhvZChhLnZhbHVlLCBiLnZhbHVlKTsKICAgIH0KCiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYS5rZXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgaWYgKGEua2V5W2ldIDwgYi5rZXlbaV0pIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KCiAgICAgIGlmIChhLmtleVtpXSA+IGIua2V5W2ldKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMDsKICB9OwoKICByZXR1cm4gYXJyYXkubWFwKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbHVlLAogICAgICBpbmRleCwKICAgICAga2V5OiBnZXRLZXkgPyBnZXRLZXkodmFsdWUsIGluZGV4KSA6IG51bGwKICAgIH07CiAgfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgbGV0IG9yZGVyID0gY29tcGFyZShhLCBiKTsKCiAgICBpZiAoIW9yZGVyKSB7CiAgICAgIG9yZGVyID0gYS5pbmRleCAtIGIuaW5kZXg7CiAgICB9CgogICAgcmV0dXJuIG9yZGVyICogK3JldmVyc2U7CiAgfSkubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7Cn07Cgpjb25zdCBnZXRDb2x1bW5CeUlkID0gZnVuY3Rpb24gKHRhYmxlLCBjb2x1bW5JZCkgewogIGxldCBjb2x1bW4gPSBudWxsOwogIHRhYmxlLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgaWYgKGl0ZW0uaWQgPT09IGNvbHVtbklkKSB7CiAgICAgIGNvbHVtbiA9IGl0ZW07CiAgICB9CiAgfSk7CiAgcmV0dXJuIGNvbHVtbjsKfTsKCmNvbnN0IGdldENvbHVtbkJ5S2V5ID0gZnVuY3Rpb24gKHRhYmxlLCBjb2x1bW5LZXkpIHsKICBsZXQgY29sdW1uID0gbnVsbDsKCiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWJsZS5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBpdGVtID0gdGFibGUuY29sdW1uc1tpXTsKCiAgICBpZiAoaXRlbS5jb2x1bW5LZXkgPT09IGNvbHVtbktleSkgewogICAgICBjb2x1bW4gPSBpdGVtOwogICAgICBicmVhazsKICAgIH0KICB9CgogIHJldHVybiBjb2x1bW47Cn07Cgpjb25zdCBnZXRDb2x1bW5CeUNlbGwgPSBmdW5jdGlvbiAodGFibGUsIGNlbGwpIHsKICBjb25zdCBtYXRjaGVzID0gKGNlbGwuY2xhc3NOYW1lIHx8ICIiKS5tYXRjaCgvZWwtdGFibGVfW15cc10rL2dtKTsKCiAgaWYgKG1hdGNoZXMpIHsKICAgIHJldHVybiBnZXRDb2x1bW5CeUlkKHRhYmxlLCBtYXRjaGVzWzBdKTsKICB9CgogIHJldHVybiBudWxsOwp9OwoKY29uc3QgZ2V0Um93SWRlbnRpdHkgPSAocm93LCByb3dLZXkpID0+IHsKICBpZiAoIXJvdykgdGhyb3cgbmV3IEVycm9yKCJyb3cgaXMgcmVxdWlyZWQgd2hlbiBnZXQgcm93IGlkZW50aXR5Iik7CgogIGlmICh0eXBlb2Ygcm93S2V5ID09PSAic3RyaW5nIikgewogICAgaWYgKHJvd0tleS5pbmRleE9mKCIuIikgPCAwKSB7CiAgICAgIHJldHVybiByb3dbcm93S2V5XSArICIiOwogICAgfQoKICAgIGNvbnN0IGtleSA9IHJvd0tleS5zcGxpdCgiLiIpOwogICAgbGV0IGN1cnJlbnQgPSByb3c7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXkubGVuZ3RoOyBpKyspIHsKICAgICAgY3VycmVudCA9IGN1cnJlbnRba2V5W2ldXTsKICAgIH0KCiAgICByZXR1cm4gY3VycmVudCArICIiOwogIH0gZWxzZSBpZiAodHlwZW9mIHJvd0tleSA9PT0gImZ1bmN0aW9uIikgewogICAgcmV0dXJuIHJvd0tleS5jYWxsKG51bGwsIHJvdyk7CiAgfQp9OwoKY29uc3QgZ2V0S2V5c01hcCA9IGZ1bmN0aW9uIChhcnJheSwgcm93S2V5KSB7CiAgY29uc3QgYXJyYXlNYXAgPSB7fTsKICAoYXJyYXkgfHwgW10pLmZvckVhY2goKHJvdywgaW5kZXgpID0+IHsKICAgIGFycmF5TWFwW2dldFJvd0lkZW50aXR5KHJvdywgcm93S2V5KV0gPSB7CiAgICAgIHJvdywKICAgICAgaW5kZXgKICAgIH07CiAgfSk7CiAgcmV0dXJuIGFycmF5TWFwOwp9OwoKZnVuY3Rpb24gcGFyc2VIZWlnaHQoaGVpZ2h0KSB7CiAgaWYgKHR5cGVvZiBoZWlnaHQgPT09ICJudW1iZXIiKSB7CiAgICByZXR1cm4gaGVpZ2h0OwogIH0KCiAgaWYgKHR5cGVvZiBoZWlnaHQgPT09ICJzdHJpbmciKSB7CiAgICBpZiAoL15cZCsoPzpweCk/JC8udGVzdChoZWlnaHQpKSB7CiAgICAgIHJldHVybiBwYXJzZUludChoZWlnaHQsIDEwKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBoZWlnaHQ7CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gdG9nZ2xlUm93U3RhdHVzKHN0YXR1c0Fyciwgcm93LCBuZXdWYWwpIHsKICBsZXQgY2hhbmdlZCA9IGZhbHNlOwogIGNvbnN0IGluZGV4ID0gc3RhdHVzQXJyLmluZGV4T2Yocm93KTsKICBjb25zdCBpbmNsdWRlZCA9IGluZGV4ICE9PSAtMTsKCiAgY29uc3QgYWRkUm93ID0gKCkgPT4gewogICAgc3RhdHVzQXJyLnB1c2gocm93KTsKICAgIGNoYW5nZWQgPSB0cnVlOwogIH07CgogIGNvbnN0IHJlbW92ZVJvdyA9ICgpID0+IHsKICAgIHN0YXR1c0Fyci5zcGxpY2UoaW5kZXgsIDEpOwogICAgY2hhbmdlZCA9IHRydWU7CiAgfTsKCiAgaWYgKHR5cGVvZiBuZXdWYWwgPT09ICJib29sZWFuIikgewogICAgaWYgKG5ld1ZhbCAmJiAhaW5jbHVkZWQpIHsKICAgICAgYWRkUm93KCk7CiAgICB9IGVsc2UgaWYgKCFuZXdWYWwgJiYgaW5jbHVkZWQpIHsKICAgICAgcmVtb3ZlUm93KCk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmIChpbmNsdWRlZCkgewogICAgICByZW1vdmVSb3coKTsKICAgIH0gZWxzZSB7CiAgICAgIGFkZFJvdygpOwogICAgfQogIH0KCiAgcmV0dXJuIGNoYW5nZWQ7Cn0KCmZ1bmN0aW9uIHdhbGtUcmVlTm9kZShyb290LCBjYiwgY2hpbGRyZW5LZXkgPSAiY2hpbGRyZW4iLCBsYXp5S2V5ID0gImhhc0NoaWxkcmVuIikgewogIGNvbnN0IGlzTmlsID0gYXJyYXkgPT4gIShBcnJheS5pc0FycmF5KGFycmF5KSAmJiBhcnJheS5sZW5ndGgpOwoKICBmdW5jdGlvbiBfd2Fsa2VyKHBhcmVudCwgY2hpbGRyZW4sIGxldmVsKSB7CiAgICBjYihwYXJlbnQsIGNoaWxkcmVuLCBsZXZlbCk7CiAgICBjaGlsZHJlbi5mb3JFYWNoKGl0ZW0gPT4gewogICAgICBpZiAoaXRlbVtsYXp5S2V5XSkgewogICAgICAgIGNiKGl0ZW0sIG51bGwsIGxldmVsICsgMSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbjIgPSBpdGVtW2NoaWxkcmVuS2V5XTsKCiAgICAgIGlmICghaXNOaWwoY2hpbGRyZW4yKSkgewogICAgICAgIF93YWxrZXIoaXRlbSwgY2hpbGRyZW4yLCBsZXZlbCArIDEpOwogICAgICB9CiAgICB9KTsKICB9CgogIHJvb3QuZm9yRWFjaChpdGVtID0+IHsKICAgIGlmIChpdGVtW2xhenlLZXldKSB7CiAgICAgIGNiKGl0ZW0sIG51bGwsIDApOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgY2hpbGRyZW4gPSBpdGVtW2NoaWxkcmVuS2V5XTsKCiAgICBpZiAoIWlzTmlsKGNoaWxkcmVuKSkgewogICAgICBfd2Fsa2VyKGl0ZW0sIGNoaWxkcmVuLCAwKTsKICAgIH0KICB9KTsKfQoKbGV0IHJlbW92ZVBvcHBlcjsKCmZ1bmN0aW9uIGNyZWF0ZVRhYmxlUG9wcGVyKHRyaWdnZXIsIHBvcHBlckNvbnRlbnQsIHBvcHBlck9wdGlvbnMsIHRvb2x0aXBFZmZlY3QpIHsKICBmdW5jdGlvbiByZW5kZXJDb250ZW50KCkgewogICAgY29uc3QgaXNMaWdodCA9IHRvb2x0aXBFZmZlY3QgPT09ICJsaWdodCI7CiAgICBjb25zdCBjb250ZW50MiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgY29udGVudDIuY2xhc3NOYW1lID0gYGVsLXBvcHBlciAke2lzTGlnaHQgPyAiaXMtbGlnaHQiIDogImlzLWRhcmsifWA7CiAgICBjb250ZW50Mi5pbm5lckhUTUwgPSBwb3BwZXJDb250ZW50OwogICAgY29udGVudDIuc3R5bGUuekluZGV4ID0gU3RyaW5nKFBvcHVwTWFuYWdlcl9fZGVmYXVsdFsnZGVmYXVsdCddLm5leHRaSW5kZXgoKSk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRlbnQyKTsKICAgIHJldHVybiBjb250ZW50MjsKICB9CgogIGZ1bmN0aW9uIHJlbmRlckFycm93KCkgewogICAgY29uc3QgYXJyb3cyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBhcnJvdzIuY2xhc3NOYW1lID0gImVsLXBvcHBlcl9fYXJyb3ciOwogICAgYXJyb3cyLnN0eWxlLmJvdHRvbSA9ICItNHB4IjsKICAgIHJldHVybiBhcnJvdzI7CiAgfQoKICBmdW5jdGlvbiBzaG93UG9wcGVyKCkgewogICAgcG9wcGVySW5zdGFuY2UgJiYgcG9wcGVySW5zdGFuY2UudXBkYXRlKCk7CiAgfQoKICByZW1vdmVQb3BwZXIgPSBmdW5jdGlvbiByZW1vdmVQb3BwZXIyKCkgewogICAgdHJ5IHsKICAgICAgcG9wcGVySW5zdGFuY2UgJiYgcG9wcGVySW5zdGFuY2UuZGVzdHJveSgpOwogICAgICBjb250ZW50ICYmIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoY29udGVudCk7CiAgICAgIGRvbS5vZmYodHJpZ2dlciwgIm1vdXNlZW50ZXIiLCBzaG93UG9wcGVyKTsKICAgICAgZG9tLm9mZih0cmlnZ2VyLCAibW91c2VsZWF2ZSIsIHJlbW92ZVBvcHBlcjIpOwogICAgfSBjYXRjaCAoZSkge30KICB9OwoKICBsZXQgcG9wcGVySW5zdGFuY2UgPSBudWxsOwogIGNvbnN0IGNvbnRlbnQgPSByZW5kZXJDb250ZW50KCk7CiAgY29uc3QgYXJyb3cgPSByZW5kZXJBcnJvdygpOwogIGNvbnRlbnQuYXBwZW5kQ2hpbGQoYXJyb3cpOwogIHBvcHBlckluc3RhbmNlID0gY29yZS5jcmVhdGVQb3BwZXIodHJpZ2dlciwgY29udGVudCwgX19zcHJlYWRWYWx1ZXMoewogICAgbW9kaWZpZXJzOiBbewogICAgICBuYW1lOiAib2Zmc2V0IiwKICAgICAgb3B0aW9uczogewogICAgICAgIG9mZnNldDogWzAsIDhdCiAgICAgIH0KICAgIH0sIHsKICAgICAgbmFtZTogImFycm93IiwKICAgICAgb3B0aW9uczogewogICAgICAgIGVsZW1lbnQ6IGFycm93LAogICAgICAgIHBhZGRpbmc6IDEwCiAgICAgIH0KICAgIH1dCiAgfSwgcG9wcGVyT3B0aW9ucykpOwogIGRvbS5vbih0cmlnZ2VyLCAibW91c2VlbnRlciIsIHNob3dQb3BwZXIpOwogIGRvbS5vbih0cmlnZ2VyLCAibW91c2VsZWF2ZSIsIHJlbW92ZVBvcHBlcik7CiAgcmV0dXJuIHBvcHBlckluc3RhbmNlOwp9CgpmdW5jdGlvbiB1c2VFeHBhbmQod2F0Y2hlckRhdGEpIHsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBkZWZhdWx0RXhwYW5kQWxsID0gdnVlLnJlZihmYWxzZSk7CiAgY29uc3QgZXhwYW5kUm93cyA9IHZ1ZS5yZWYoW10pOwoKICBjb25zdCB1cGRhdGVFeHBhbmRSb3dzID0gKCkgPT4gewogICAgY29uc3QgZGF0YSA9IHdhdGNoZXJEYXRhLmRhdGEudmFsdWUgfHwgW107CiAgICBjb25zdCByb3dLZXkgPSB3YXRjaGVyRGF0YS5yb3dLZXkudmFsdWU7CgogICAgaWYgKGRlZmF1bHRFeHBhbmRBbGwudmFsdWUpIHsKICAgICAgZXhwYW5kUm93cy52YWx1ZSA9IGRhdGEuc2xpY2UoKTsKICAgIH0gZWxzZSBpZiAocm93S2V5KSB7CiAgICAgIGNvbnN0IGV4cGFuZFJvd3NNYXAgPSBnZXRLZXlzTWFwKGV4cGFuZFJvd3MudmFsdWUsIHJvd0tleSk7CiAgICAgIGV4cGFuZFJvd3MudmFsdWUgPSBkYXRhLnJlZHVjZSgocHJldiwgcm93KSA9PiB7CiAgICAgICAgY29uc3Qgcm93SWQgPSBnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleSk7CiAgICAgICAgY29uc3Qgcm93SW5mbyA9IGV4cGFuZFJvd3NNYXBbcm93SWRdOwoKICAgICAgICBpZiAocm93SW5mbykgewogICAgICAgICAgcHJldi5wdXNoKHJvdyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcHJldjsKICAgICAgfSwgW10pOwogICAgfSBlbHNlIHsKICAgICAgZXhwYW5kUm93cy52YWx1ZSA9IFtdOwogICAgfQogIH07CgogIGNvbnN0IHRvZ2dsZVJvd0V4cGFuc2lvbiA9IChyb3csIGV4cGFuZGVkKSA9PiB7CiAgICBjb25zdCBjaGFuZ2VkID0gdG9nZ2xlUm93U3RhdHVzKGV4cGFuZFJvd3MudmFsdWUsIHJvdywgZXhwYW5kZWQpOwoKICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgIGluc3RhbmNlLmVtaXQoImV4cGFuZC1jaGFuZ2UiLCByb3csIGV4cGFuZFJvd3MudmFsdWUuc2xpY2UoKSk7CiAgICAgIGluc3RhbmNlLnN0b3JlLnNjaGVkdWxlTGF5b3V0KCk7CiAgICB9CiAgfTsKCiAgY29uc3Qgc2V0RXhwYW5kUm93S2V5cyA9IHJvd0tleXMgPT4gewogICAgaW5zdGFuY2Uuc3RvcmUuYXNzZXJ0Um93S2V5KCk7CiAgICBjb25zdCBkYXRhID0gd2F0Y2hlckRhdGEuZGF0YS52YWx1ZSB8fCBbXTsKICAgIGNvbnN0IHJvd0tleSA9IHdhdGNoZXJEYXRhLnJvd0tleS52YWx1ZTsKICAgIGNvbnN0IGtleXNNYXAgPSBnZXRLZXlzTWFwKGRhdGEsIHJvd0tleSk7CiAgICBleHBhbmRSb3dzLnZhbHVlID0gcm93S2V5cy5yZWR1Y2UoKHByZXYsIGN1cikgPT4gewogICAgICBjb25zdCBpbmZvID0ga2V5c01hcFtjdXJdOwoKICAgICAgaWYgKGluZm8pIHsKICAgICAgICBwcmV2LnB1c2goaW5mby5yb3cpOwogICAgICB9CgogICAgICByZXR1cm4gcHJldjsKICAgIH0sIFtdKTsKICB9OwoKICBjb25zdCBpc1Jvd0V4cGFuZGVkID0gcm93ID0+IHsKICAgIGNvbnN0IHJvd0tleSA9IHdhdGNoZXJEYXRhLnJvd0tleS52YWx1ZTsKCiAgICBpZiAocm93S2V5KSB7CiAgICAgIGNvbnN0IGV4cGFuZE1hcCA9IGdldEtleXNNYXAoZXhwYW5kUm93cy52YWx1ZSwgcm93S2V5KTsKICAgICAgcmV0dXJuICEhZXhwYW5kTWFwW2dldFJvd0lkZW50aXR5KHJvdywgcm93S2V5KV07CiAgICB9CgogICAgcmV0dXJuIGV4cGFuZFJvd3MudmFsdWUuaW5kZXhPZihyb3cpICE9PSAtMTsKICB9OwoKICByZXR1cm4gewogICAgdXBkYXRlRXhwYW5kUm93cywKICAgIHRvZ2dsZVJvd0V4cGFuc2lvbiwKICAgIHNldEV4cGFuZFJvd0tleXMsCiAgICBpc1Jvd0V4cGFuZGVkLAogICAgc3RhdGVzOiB7CiAgICAgIGV4cGFuZFJvd3MsCiAgICAgIGRlZmF1bHRFeHBhbmRBbGwKICAgIH0KICB9Owp9CgpmdW5jdGlvbiB1c2VDdXJyZW50KHdhdGNoZXJEYXRhKSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CgogIGNvbnN0IF9jdXJyZW50Um93S2V5ID0gdnVlLnJlZihudWxsKTsKCiAgY29uc3QgY3VycmVudFJvdyA9IHZ1ZS5yZWYobnVsbCk7CgogIGNvbnN0IHNldEN1cnJlbnRSb3dLZXkgPSBrZXkgPT4gewogICAgaW5zdGFuY2Uuc3RvcmUuYXNzZXJ0Um93S2V5KCk7CiAgICBfY3VycmVudFJvd0tleS52YWx1ZSA9IGtleTsKICAgIHNldEN1cnJlbnRSb3dCeUtleShrZXkpOwogIH07CgogIGNvbnN0IHJlc3RvcmVDdXJyZW50Um93S2V5ID0gKCkgPT4gewogICAgX2N1cnJlbnRSb3dLZXkudmFsdWUgPSBudWxsOwogIH07CgogIGNvbnN0IHNldEN1cnJlbnRSb3dCeUtleSA9IGtleSA9PiB7CiAgICBjb25zdCB7CiAgICAgIGRhdGEgPSBbXSwKICAgICAgcm93S2V5CiAgICB9ID0gd2F0Y2hlckRhdGE7CiAgICBsZXQgX2N1cnJlbnRSb3cgPSBudWxsOwoKICAgIGlmIChyb3dLZXkudmFsdWUpIHsKICAgICAgX2N1cnJlbnRSb3cgPSB1dGlsLmFycmF5RmluZCh2dWUudW5yZWYoZGF0YSksIGl0ZW0gPT4gZ2V0Um93SWRlbnRpdHkoaXRlbSwgcm93S2V5LnZhbHVlKSA9PT0ga2V5KTsKICAgIH0KCiAgICBjdXJyZW50Um93LnZhbHVlID0gX2N1cnJlbnRSb3c7CiAgfTsKCiAgY29uc3QgdXBkYXRlQ3VycmVudFJvdyA9IF9jdXJyZW50Um93ID0+IHsKICAgIGNvbnN0IG9sZEN1cnJlbnRSb3cgPSBjdXJyZW50Um93LnZhbHVlOwoKICAgIGlmIChfY3VycmVudFJvdyAmJiBfY3VycmVudFJvdyAhPT0gb2xkQ3VycmVudFJvdykgewogICAgICBjdXJyZW50Um93LnZhbHVlID0gX2N1cnJlbnRSb3c7CiAgICAgIGluc3RhbmNlLmVtaXQoImN1cnJlbnQtY2hhbmdlIiwgY3VycmVudFJvdy52YWx1ZSwgb2xkQ3VycmVudFJvdyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIV9jdXJyZW50Um93ICYmIG9sZEN1cnJlbnRSb3cpIHsKICAgICAgY3VycmVudFJvdy52YWx1ZSA9IG51bGw7CiAgICAgIGluc3RhbmNlLmVtaXQoImN1cnJlbnQtY2hhbmdlIiwgbnVsbCwgb2xkQ3VycmVudFJvdyk7CiAgICB9CiAgfTsKCiAgY29uc3QgdXBkYXRlQ3VycmVudFJvd0RhdGEgPSAoKSA9PiB7CiAgICBjb25zdCByb3dLZXkgPSB3YXRjaGVyRGF0YS5yb3dLZXkudmFsdWU7CiAgICBjb25zdCBkYXRhID0gd2F0Y2hlckRhdGEuZGF0YS52YWx1ZSB8fCBbXTsKICAgIGNvbnN0IG9sZEN1cnJlbnRSb3cgPSBjdXJyZW50Um93LnZhbHVlOwoKICAgIGlmIChkYXRhLmluZGV4T2Yob2xkQ3VycmVudFJvdykgPT09IC0xICYmIG9sZEN1cnJlbnRSb3cpIHsKICAgICAgaWYgKHJvd0tleSkgewogICAgICAgIGNvbnN0IGN1cnJlbnRSb3dLZXkgPSBnZXRSb3dJZGVudGl0eShvbGRDdXJyZW50Um93LCByb3dLZXkpOwogICAgICAgIHNldEN1cnJlbnRSb3dCeUtleShjdXJyZW50Um93S2V5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50Um93LnZhbHVlID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGN1cnJlbnRSb3cudmFsdWUgPT09IG51bGwpIHsKICAgICAgICBpbnN0YW5jZS5lbWl0KCJjdXJyZW50LWNoYW5nZSIsIG51bGwsIG9sZEN1cnJlbnRSb3cpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKF9jdXJyZW50Um93S2V5LnZhbHVlKSB7CiAgICAgIHNldEN1cnJlbnRSb3dCeUtleShfY3VycmVudFJvd0tleS52YWx1ZSk7CiAgICAgIHJlc3RvcmVDdXJyZW50Um93S2V5KCk7CiAgICB9CiAgfTsKCiAgcmV0dXJuIHsKICAgIHNldEN1cnJlbnRSb3dLZXksCiAgICByZXN0b3JlQ3VycmVudFJvd0tleSwKICAgIHNldEN1cnJlbnRSb3dCeUtleSwKICAgIHVwZGF0ZUN1cnJlbnRSb3csCiAgICB1cGRhdGVDdXJyZW50Um93RGF0YSwKICAgIHN0YXRlczogewogICAgICBfY3VycmVudFJvd0tleSwKICAgICAgY3VycmVudFJvdwogICAgfQogIH07Cn0KCnZhciBfX2RlZlByb3AkMSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fZ2V0T3duUHJvcFN5bWJvbHMkMSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CnZhciBfX2hhc093blByb3AkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CnZhciBfX3Byb3BJc0VudW0kMSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7Cgp2YXIgX19kZWZOb3JtYWxQcm9wJDEgPSAob2JqLCBrZXksIHZhbHVlKSA9PiBrZXkgaW4gb2JqID8gX19kZWZQcm9wJDEob2JqLCBrZXksIHsKICBlbnVtZXJhYmxlOiB0cnVlLAogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICB3cml0YWJsZTogdHJ1ZSwKICB2YWx1ZQp9KSA6IG9ialtrZXldID0gdmFsdWU7Cgp2YXIgX19zcHJlYWRWYWx1ZXMkMSA9IChhLCBiKSA9PiB7CiAgZm9yICh2YXIgcHJvcCBpbiBiIHx8IChiID0ge30pKSBpZiAoX19oYXNPd25Qcm9wJDEuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDEoYSwgcHJvcCwgYltwcm9wXSk7CgogIGlmIChfX2dldE93blByb3BTeW1ib2xzJDEpIGZvciAodmFyIHByb3Agb2YgX19nZXRPd25Qcm9wU3ltYm9scyQxKGIpKSB7CiAgICBpZiAoX19wcm9wSXNFbnVtJDEuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDEoYSwgcHJvcCwgYltwcm9wXSk7CiAgfQogIHJldHVybiBhOwp9OwoKZnVuY3Rpb24gdXNlVHJlZSh3YXRjaGVyRGF0YSkgewogIGNvbnN0IGV4cGFuZFJvd0tleXMgPSB2dWUucmVmKFtdKTsKICBjb25zdCB0cmVlRGF0YSA9IHZ1ZS5yZWYoe30pOwogIGNvbnN0IGluZGVudCA9IHZ1ZS5yZWYoMTYpOwogIGNvbnN0IGxhenkgPSB2dWUucmVmKGZhbHNlKTsKICBjb25zdCBsYXp5VHJlZU5vZGVNYXAgPSB2dWUucmVmKHt9KTsKICBjb25zdCBsYXp5Q29sdW1uSWRlbnRpZmllciA9IHZ1ZS5yZWYoImhhc0NoaWxkcmVuIik7CiAgY29uc3QgY2hpbGRyZW5Db2x1bW5OYW1lID0gdnVlLnJlZigiY2hpbGRyZW4iKTsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBub3JtYWxpemVkRGF0YSA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICBpZiAoIXdhdGNoZXJEYXRhLnJvd0tleS52YWx1ZSkgcmV0dXJuIHt9OwogICAgY29uc3QgZGF0YSA9IHdhdGNoZXJEYXRhLmRhdGEudmFsdWUgfHwgW107CiAgICByZXR1cm4gbm9ybWFsaXplKGRhdGEpOwogIH0pOwogIGNvbnN0IG5vcm1hbGl6ZWRMYXp5Tm9kZSA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICBjb25zdCByb3dLZXkgPSB3YXRjaGVyRGF0YS5yb3dLZXkudmFsdWU7CiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobGF6eVRyZWVOb2RlTWFwLnZhbHVlKTsKICAgIGNvbnN0IHJlcyA9IHt9OwogICAgaWYgKCFrZXlzLmxlbmd0aCkgcmV0dXJuIHJlczsKICAgIGtleXMuZm9yRWFjaChrZXkgPT4gewogICAgICBpZiAobGF6eVRyZWVOb2RlTWFwLnZhbHVlW2tleV0ubGVuZ3RoKSB7CiAgICAgICAgY29uc3QgaXRlbSA9IHsKICAgICAgICAgIGNoaWxkcmVuOiBbXQogICAgICAgIH07CiAgICAgICAgbGF6eVRyZWVOb2RlTWFwLnZhbHVlW2tleV0uZm9yRWFjaChyb3cgPT4gewogICAgICAgICAgY29uc3QgY3VycmVudFJvd0tleSA9IGdldFJvd0lkZW50aXR5KHJvdywgcm93S2V5KTsKICAgICAgICAgIGl0ZW0uY2hpbGRyZW4ucHVzaChjdXJyZW50Um93S2V5KTsKCiAgICAgICAgICBpZiAocm93W2xhenlDb2x1bW5JZGVudGlmaWVyLnZhbHVlXSAmJiAhcmVzW2N1cnJlbnRSb3dLZXldKSB7CiAgICAgICAgICAgIHJlc1tjdXJyZW50Um93S2V5XSA9IHsKICAgICAgICAgICAgICBjaGlsZHJlbjogW10KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXNba2V5XSA9IGl0ZW07CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlczsKICB9KTsKCiAgY29uc3Qgbm9ybWFsaXplID0gZGF0YSA9PiB7CiAgICBjb25zdCByb3dLZXkgPSB3YXRjaGVyRGF0YS5yb3dLZXkudmFsdWU7CiAgICBjb25zdCByZXMgPSB7fTsKICAgIHdhbGtUcmVlTm9kZShkYXRhLCAocGFyZW50LCBjaGlsZHJlbiwgbGV2ZWwpID0+IHsKICAgICAgY29uc3QgcGFyZW50SWQgPSBnZXRSb3dJZGVudGl0eShwYXJlbnQsIHJvd0tleSk7CgogICAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHsKICAgICAgICByZXNbcGFyZW50SWRdID0gewogICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLm1hcChyb3cgPT4gZ2V0Um93SWRlbnRpdHkocm93LCByb3dLZXkpKSwKICAgICAgICAgIGxldmVsCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChsYXp5LnZhbHVlKSB7CiAgICAgICAgcmVzW3BhcmVudElkXSA9IHsKICAgICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICAgIGxhenk6IHRydWUsCiAgICAgICAgICBsZXZlbAogICAgICAgIH07CiAgICAgIH0KICAgIH0sIGNoaWxkcmVuQ29sdW1uTmFtZS52YWx1ZSwgbGF6eUNvbHVtbklkZW50aWZpZXIudmFsdWUpOwogICAgcmV0dXJuIHJlczsKICB9OwoKICBjb25zdCB1cGRhdGVUcmVlRGF0YSA9ICgpID0+IHsKICAgIHZhciBfYSwgX2I7CgogICAgY29uc3QgbmVzdGVkID0gbm9ybWFsaXplZERhdGEudmFsdWU7CiAgICBjb25zdCBub3JtYWxpemVkTGF6eU5vZGVfID0gbm9ybWFsaXplZExhenlOb2RlLnZhbHVlOwogICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG5lc3RlZCk7CiAgICBjb25zdCBuZXdUcmVlRGF0YSA9IHt9OwoKICAgIGlmIChrZXlzLmxlbmd0aCkgewogICAgICBjb25zdCBvbGRUcmVlRGF0YSA9IHZ1ZS51bnJlZih0cmVlRGF0YSk7CiAgICAgIGNvbnN0IGRlZmF1bHRFeHBhbmRBbGwgPSAoX2EgPSBpbnN0YW5jZS5zdG9yZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnN0YXRlcy5kZWZhdWx0RXhwYW5kQWxsLnZhbHVlOwogICAgICBjb25zdCByb290TGF6eVJvd0tleXMgPSBbXTsKCiAgICAgIGNvbnN0IGdldEV4cGFuZGVkID0gKG9sZFZhbHVlLCBrZXkpID0+IHsKICAgICAgICBjb25zdCBpbmNsdWRlZCA9IGRlZmF1bHRFeHBhbmRBbGwgfHwgZXhwYW5kUm93S2V5cy52YWx1ZSAmJiBleHBhbmRSb3dLZXlzLnZhbHVlLmluZGV4T2Yoa2V5KSAhPT0gLTE7CiAgICAgICAgcmV0dXJuICEhKG9sZFZhbHVlICYmIG9sZFZhbHVlLmV4cGFuZGVkIHx8IGluY2x1ZGVkKTsKICAgICAgfTsKCiAgICAgIGtleXMuZm9yRWFjaChrZXkgPT4gewogICAgICAgIGNvbnN0IG9sZFZhbHVlID0gb2xkVHJlZURhdGFba2V5XTsKCiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBfX3NwcmVhZFZhbHVlcyQxKHt9LCBuZXN0ZWRba2V5XSk7CgogICAgICAgIG5ld1ZhbHVlLmV4cGFuZGVkID0gZ2V0RXhwYW5kZWQob2xkVmFsdWUsIGtleSk7CgogICAgICAgIGlmIChuZXdWYWx1ZS5sYXp5KSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGxvYWRlZCA9IGZhbHNlLAogICAgICAgICAgICBsb2FkaW5nID0gZmFsc2UKICAgICAgICAgIH0gPSBvbGRWYWx1ZSB8fCB7fTsKICAgICAgICAgIG5ld1ZhbHVlLmxvYWRlZCA9ICEhbG9hZGVkOwogICAgICAgICAgbmV3VmFsdWUubG9hZGluZyA9ICEhbG9hZGluZzsKICAgICAgICAgIHJvb3RMYXp5Um93S2V5cy5wdXNoKGtleSk7CiAgICAgICAgfQoKICAgICAgICBuZXdUcmVlRGF0YVtrZXldID0gbmV3VmFsdWU7CiAgICAgIH0pOwogICAgICBjb25zdCBsYXp5S2V5cyA9IE9iamVjdC5rZXlzKG5vcm1hbGl6ZWRMYXp5Tm9kZV8pOwoKICAgICAgaWYgKGxhenkudmFsdWUgJiYgbGF6eUtleXMubGVuZ3RoICYmIHJvb3RMYXp5Um93S2V5cy5sZW5ndGgpIHsKICAgICAgICBsYXp5S2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IG9sZFRyZWVEYXRhW2tleV07CiAgICAgICAgICBjb25zdCBsYXp5Tm9kZUNoaWxkcmVuID0gbm9ybWFsaXplZExhenlOb2RlX1trZXldLmNoaWxkcmVuOwoKICAgICAgICAgIGlmIChyb290TGF6eVJvd0tleXMuaW5kZXhPZihrZXkpICE9PSAtMSkgewogICAgICAgICAgICBpZiAobmV3VHJlZURhdGFba2V5XS5jaGlsZHJlbi5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIltFbFRhYmxlXWNoaWxkcmVuIG11c3QgYmUgYW4gZW1wdHkgYXJyYXkuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5ld1RyZWVEYXRhW2tleV0uY2hpbGRyZW4gPSBsYXp5Tm9kZUNoaWxkcmVuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIGxvYWRlZCA9IGZhbHNlLAogICAgICAgICAgICAgIGxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICB9ID0gb2xkVmFsdWUgfHwge307CiAgICAgICAgICAgIG5ld1RyZWVEYXRhW2tleV0gPSB7CiAgICAgICAgICAgICAgbGF6eTogdHJ1ZSwKICAgICAgICAgICAgICBsb2FkZWQ6ICEhbG9hZGVkLAogICAgICAgICAgICAgIGxvYWRpbmc6ICEhbG9hZGluZywKICAgICAgICAgICAgICBleHBhbmRlZDogZ2V0RXhwYW5kZWQob2xkVmFsdWUsIGtleSksCiAgICAgICAgICAgICAgY2hpbGRyZW46IGxhenlOb2RlQ2hpbGRyZW4sCiAgICAgICAgICAgICAgbGV2ZWw6ICIiCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICB0cmVlRGF0YS52YWx1ZSA9IG5ld1RyZWVEYXRhOwogICAgKF9iID0gaW5zdGFuY2Uuc3RvcmUpID09IG51bGwgPyB2b2lkIDAgOiBfYi51cGRhdGVUYWJsZVNjcm9sbFkoKTsKICB9OwoKICB2dWUud2F0Y2goKCkgPT4gbm9ybWFsaXplZERhdGEudmFsdWUsIHVwZGF0ZVRyZWVEYXRhKTsKICB2dWUud2F0Y2goKCkgPT4gbm9ybWFsaXplZExhenlOb2RlLnZhbHVlLCB1cGRhdGVUcmVlRGF0YSk7CgogIGNvbnN0IHVwZGF0ZVRyZWVFeHBhbmRLZXlzID0gdmFsdWUgPT4gewogICAgZXhwYW5kUm93S2V5cy52YWx1ZSA9IHZhbHVlOwogICAgdXBkYXRlVHJlZURhdGEoKTsKICB9OwoKICBjb25zdCB0b2dnbGVUcmVlRXhwYW5zaW9uID0gKHJvdywgZXhwYW5kZWQpID0+IHsKICAgIGluc3RhbmNlLnN0b3JlLmFzc2VydFJvd0tleSgpOwogICAgY29uc3Qgcm93S2V5ID0gd2F0Y2hlckRhdGEucm93S2V5LnZhbHVlOwogICAgY29uc3QgaWQgPSBnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleSk7CiAgICBjb25zdCBkYXRhID0gaWQgJiYgdHJlZURhdGEudmFsdWVbaWRdOwoKICAgIGlmIChpZCAmJiBkYXRhICYmICJleHBhbmRlZCIgaW4gZGF0YSkgewogICAgICBjb25zdCBvbGRFeHBhbmRlZCA9IGRhdGEuZXhwYW5kZWQ7CiAgICAgIGV4cGFuZGVkID0gdHlwZW9mIGV4cGFuZGVkID09PSAidW5kZWZpbmVkIiA/ICFkYXRhLmV4cGFuZGVkIDogZXhwYW5kZWQ7CiAgICAgIHRyZWVEYXRhLnZhbHVlW2lkXS5leHBhbmRlZCA9IGV4cGFuZGVkOwoKICAgICAgaWYgKG9sZEV4cGFuZGVkICE9PSBleHBhbmRlZCkgewogICAgICAgIGluc3RhbmNlLmVtaXQoImV4cGFuZC1jaGFuZ2UiLCByb3csIGV4cGFuZGVkKTsKICAgICAgfQoKICAgICAgaW5zdGFuY2Uuc3RvcmUudXBkYXRlVGFibGVTY3JvbGxZKCk7CiAgICB9CiAgfTsKCiAgY29uc3QgbG9hZE9yVG9nZ2xlID0gcm93ID0+IHsKICAgIGluc3RhbmNlLnN0b3JlLmFzc2VydFJvd0tleSgpOwogICAgY29uc3Qgcm93S2V5ID0gd2F0Y2hlckRhdGEucm93S2V5LnZhbHVlOwogICAgY29uc3QgaWQgPSBnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleSk7CiAgICBjb25zdCBkYXRhID0gdHJlZURhdGEudmFsdWVbaWRdOwoKICAgIGlmIChsYXp5LnZhbHVlICYmIGRhdGEgJiYgImxvYWRlZCIgaW4gZGF0YSAmJiAhZGF0YS5sb2FkZWQpIHsKICAgICAgbG9hZERhdGEocm93LCBpZCwgZGF0YSk7CiAgICB9IGVsc2UgewogICAgICB0b2dnbGVUcmVlRXhwYW5zaW9uKHJvdywgdm9pZCAwKTsKICAgIH0KICB9OwoKICBjb25zdCBsb2FkRGF0YSA9IChyb3csIGtleSwgdHJlZU5vZGUpID0+IHsKICAgIGNvbnN0IHsKICAgICAgbG9hZAogICAgfSA9IGluc3RhbmNlLnByb3BzOwoKICAgIGlmIChsb2FkICYmICF0cmVlRGF0YS52YWx1ZVtrZXldLmxvYWRlZCkgewogICAgICB0cmVlRGF0YS52YWx1ZVtrZXldLmxvYWRpbmcgPSB0cnVlOwogICAgICBsb2FkKHJvdywgdHJlZU5vZGUsIGRhdGEgPT4gewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJbRWxUYWJsZV0gZGF0YSBtdXN0IGJlIGFuIGFycmF5Iik7CiAgICAgICAgfQoKICAgICAgICB0cmVlRGF0YS52YWx1ZVtrZXldLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0cmVlRGF0YS52YWx1ZVtrZXldLmxvYWRlZCA9IHRydWU7CiAgICAgICAgdHJlZURhdGEudmFsdWVba2V5XS5leHBhbmRlZCA9IHRydWU7CgogICAgICAgIGlmIChkYXRhLmxlbmd0aCkgewogICAgICAgICAgbGF6eVRyZWVOb2RlTWFwLnZhbHVlW2tleV0gPSBkYXRhOwogICAgICAgIH0KCiAgICAgICAgaW5zdGFuY2UuZW1pdCgiZXhwYW5kLWNoYW5nZSIsIHJvdywgdHJ1ZSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIHJldHVybiB7CiAgICBsb2FkRGF0YSwKICAgIGxvYWRPclRvZ2dsZSwKICAgIHRvZ2dsZVRyZWVFeHBhbnNpb24sCiAgICB1cGRhdGVUcmVlRXhwYW5kS2V5cywKICAgIHVwZGF0ZVRyZWVEYXRhLAogICAgbm9ybWFsaXplLAogICAgc3RhdGVzOiB7CiAgICAgIGV4cGFuZFJvd0tleXMsCiAgICAgIHRyZWVEYXRhLAogICAgICBpbmRlbnQsCiAgICAgIGxhenksCiAgICAgIGxhenlUcmVlTm9kZU1hcCwKICAgICAgbGF6eUNvbHVtbklkZW50aWZpZXIsCiAgICAgIGNoaWxkcmVuQ29sdW1uTmFtZQogICAgfQogIH07Cn0KCnZhciBfX2RlZlByb3AkMiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fZ2V0T3duUHJvcFN5bWJvbHMkMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CnZhciBfX2hhc093blByb3AkMiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CnZhciBfX3Byb3BJc0VudW0kMiA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7Cgp2YXIgX19kZWZOb3JtYWxQcm9wJDIgPSAob2JqLCBrZXksIHZhbHVlKSA9PiBrZXkgaW4gb2JqID8gX19kZWZQcm9wJDIob2JqLCBrZXksIHsKICBlbnVtZXJhYmxlOiB0cnVlLAogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICB3cml0YWJsZTogdHJ1ZSwKICB2YWx1ZQp9KSA6IG9ialtrZXldID0gdmFsdWU7Cgp2YXIgX19zcHJlYWRWYWx1ZXMkMiA9IChhLCBiKSA9PiB7CiAgZm9yICh2YXIgcHJvcCBpbiBiIHx8IChiID0ge30pKSBpZiAoX19oYXNPd25Qcm9wJDIuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDIoYSwgcHJvcCwgYltwcm9wXSk7CgogIGlmIChfX2dldE93blByb3BTeW1ib2xzJDIpIGZvciAodmFyIHByb3Agb2YgX19nZXRPd25Qcm9wU3ltYm9scyQyKGIpKSB7CiAgICBpZiAoX19wcm9wSXNFbnVtJDIuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDIoYSwgcHJvcCwgYltwcm9wXSk7CiAgfQogIHJldHVybiBhOwp9OwoKY29uc3Qgc29ydERhdGEgPSAoZGF0YSwgc3RhdGVzKSA9PiB7CiAgY29uc3Qgc29ydGluZ0NvbHVtbiA9IHN0YXRlcy5zb3J0aW5nQ29sdW1uOwoKICBpZiAoIXNvcnRpbmdDb2x1bW4gfHwgdHlwZW9mIHNvcnRpbmdDb2x1bW4uc29ydGFibGUgPT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gZGF0YTsKICB9CgogIHJldHVybiBvcmRlckJ5KGRhdGEsIHN0YXRlcy5zb3J0UHJvcCwgc3RhdGVzLnNvcnRPcmRlciwgc29ydGluZ0NvbHVtbi5zb3J0TWV0aG9kLCBzb3J0aW5nQ29sdW1uLnNvcnRCeSk7Cn07Cgpjb25zdCBkb0ZsYXR0ZW5Db2x1bW5zID0gY29sdW1ucyA9PiB7CiAgY29uc3QgcmVzdWx0ID0gW107CiAgY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7CiAgICBpZiAoY29sdW1uLmNoaWxkcmVuKSB7CiAgICAgIHJlc3VsdC5wdXNoLmFwcGx5KHJlc3VsdCwgZG9GbGF0dGVuQ29sdW1ucyhjb2x1bW4uY2hpbGRyZW4pKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc3VsdC5wdXNoKGNvbHVtbik7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlc3VsdDsKfTsKCmZ1bmN0aW9uIHVzZVdhdGNoZXIoKSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgY29uc3Qgcm93S2V5ID0gdnVlLnJlZihudWxsKTsKICBjb25zdCBkYXRhID0gdnVlLnJlZihbXSk7CgogIGNvbnN0IF9kYXRhID0gdnVlLnJlZihbXSk7CgogIGNvbnN0IGlzQ29tcGxleCA9IHZ1ZS5yZWYoZmFsc2UpOwoKICBjb25zdCBfY29sdW1ucyA9IHZ1ZS5yZWYoW10pOwoKICBjb25zdCBvcmlnaW5Db2x1bW5zID0gdnVlLnJlZihbXSk7CiAgY29uc3QgY29sdW1ucyA9IHZ1ZS5yZWYoW10pOwogIGNvbnN0IGZpeGVkQ29sdW1ucyA9IHZ1ZS5yZWYoW10pOwogIGNvbnN0IHJpZ2h0Rml4ZWRDb2x1bW5zID0gdnVlLnJlZihbXSk7CiAgY29uc3QgbGVhZkNvbHVtbnMgPSB2dWUucmVmKFtdKTsKICBjb25zdCBmaXhlZExlYWZDb2x1bW5zID0gdnVlLnJlZihbXSk7CiAgY29uc3QgcmlnaHRGaXhlZExlYWZDb2x1bW5zID0gdnVlLnJlZihbXSk7CiAgY29uc3QgbGVhZkNvbHVtbnNMZW5ndGggPSB2dWUucmVmKDApOwogIGNvbnN0IGZpeGVkTGVhZkNvbHVtbnNMZW5ndGggPSB2dWUucmVmKDApOwogIGNvbnN0IHJpZ2h0Rml4ZWRMZWFmQ29sdW1uc0xlbmd0aCA9IHZ1ZS5yZWYoMCk7CiAgY29uc3QgaXNBbGxTZWxlY3RlZCA9IHZ1ZS5yZWYoZmFsc2UpOwogIGNvbnN0IHNlbGVjdGlvbiA9IHZ1ZS5yZWYoW10pOwogIGNvbnN0IHJlc2VydmVTZWxlY3Rpb24gPSB2dWUucmVmKGZhbHNlKTsKICBjb25zdCBzZWxlY3RPbkluZGV0ZXJtaW5hdGUgPSB2dWUucmVmKGZhbHNlKTsKICBjb25zdCBzZWxlY3RhYmxlID0gdnVlLnJlZihudWxsKTsKICBjb25zdCBmaWx0ZXJzID0gdnVlLnJlZih7fSk7CiAgY29uc3QgZmlsdGVyZWREYXRhID0gdnVlLnJlZihudWxsKTsKICBjb25zdCBzb3J0aW5nQ29sdW1uID0gdnVlLnJlZihudWxsKTsKICBjb25zdCBzb3J0UHJvcCA9IHZ1ZS5yZWYobnVsbCk7CiAgY29uc3Qgc29ydE9yZGVyID0gdnVlLnJlZihudWxsKTsKICBjb25zdCBob3ZlclJvdyA9IHZ1ZS5yZWYobnVsbCk7CiAgdnVlLndhdGNoKGRhdGEsICgpID0+IGluc3RhbmNlLnN0YXRlICYmIHNjaGVkdWxlTGF5b3V0KGZhbHNlKSwgewogICAgZGVlcDogdHJ1ZQogIH0pOwoKICBjb25zdCBhc3NlcnRSb3dLZXkgPSAoKSA9PiB7CiAgICBpZiAoIXJvd0tleS52YWx1ZSkgdGhyb3cgbmV3IEVycm9yKCJbRWxUYWJsZV0gcHJvcCByb3cta2V5IGlzIHJlcXVpcmVkIik7CiAgfTsKCiAgY29uc3QgdXBkYXRlQ29sdW1ucyA9ICgpID0+IHsKICAgIGZpeGVkQ29sdW1ucy52YWx1ZSA9IF9jb2x1bW5zLnZhbHVlLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmZpeGVkID09PSB0cnVlIHx8IGNvbHVtbi5maXhlZCA9PT0gImxlZnQiKTsKICAgIHJpZ2h0Rml4ZWRDb2x1bW5zLnZhbHVlID0gX2NvbHVtbnMudmFsdWUuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uZml4ZWQgPT09ICJyaWdodCIpOwoKICAgIGlmIChmaXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMCAmJiBfY29sdW1ucy52YWx1ZVswXSAmJiBfY29sdW1ucy52YWx1ZVswXS50eXBlID09PSAic2VsZWN0aW9uIiAmJiAhX2NvbHVtbnMudmFsdWVbMF0uZml4ZWQpIHsKICAgICAgX2NvbHVtbnMudmFsdWVbMF0uZml4ZWQgPSB0cnVlOwogICAgICBmaXhlZENvbHVtbnMudmFsdWUudW5zaGlmdChfY29sdW1ucy52YWx1ZVswXSk7CiAgICB9CgogICAgY29uc3Qgbm90Rml4ZWRDb2x1bW5zID0gX2NvbHVtbnMudmFsdWUuZmlsdGVyKGNvbHVtbiA9PiAhY29sdW1uLmZpeGVkKTsKCiAgICBvcmlnaW5Db2x1bW5zLnZhbHVlID0gW10uY29uY2F0KGZpeGVkQ29sdW1ucy52YWx1ZSkuY29uY2F0KG5vdEZpeGVkQ29sdW1ucykuY29uY2F0KHJpZ2h0Rml4ZWRDb2x1bW5zLnZhbHVlKTsKICAgIGNvbnN0IGxlYWZDb2x1bW5zMiA9IGRvRmxhdHRlbkNvbHVtbnMobm90Rml4ZWRDb2x1bW5zKTsKICAgIGNvbnN0IGZpeGVkTGVhZkNvbHVtbnMyID0gZG9GbGF0dGVuQ29sdW1ucyhmaXhlZENvbHVtbnMudmFsdWUpOwogICAgY29uc3QgcmlnaHRGaXhlZExlYWZDb2x1bW5zMiA9IGRvRmxhdHRlbkNvbHVtbnMocmlnaHRGaXhlZENvbHVtbnMudmFsdWUpOwogICAgbGVhZkNvbHVtbnNMZW5ndGgudmFsdWUgPSBsZWFmQ29sdW1uczIubGVuZ3RoOwogICAgZml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZSA9IGZpeGVkTGVhZkNvbHVtbnMyLmxlbmd0aDsKICAgIHJpZ2h0Rml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZSA9IHJpZ2h0Rml4ZWRMZWFmQ29sdW1uczIubGVuZ3RoOwogICAgY29sdW1ucy52YWx1ZSA9IFtdLmNvbmNhdChmaXhlZExlYWZDb2x1bW5zMikuY29uY2F0KGxlYWZDb2x1bW5zMikuY29uY2F0KHJpZ2h0Rml4ZWRMZWFmQ29sdW1uczIpOwogICAgaXNDb21wbGV4LnZhbHVlID0gZml4ZWRDb2x1bW5zLnZhbHVlLmxlbmd0aCA+IDAgfHwgcmlnaHRGaXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMDsKICB9OwoKICBjb25zdCBzY2hlZHVsZUxheW91dCA9IChuZWVkVXBkYXRlQ29sdW1ucywgaW1tZWRpYXRlID0gZmFsc2UpID0+IHsKICAgIGlmIChuZWVkVXBkYXRlQ29sdW1ucykgewogICAgICB1cGRhdGVDb2x1bW5zKCk7CiAgICB9CgogICAgaWYgKGltbWVkaWF0ZSkgewogICAgICBpbnN0YW5jZS5zdGF0ZS5kb0xheW91dCgpOwogICAgfSBlbHNlIHsKICAgICAgaW5zdGFuY2Uuc3RhdGUuZGVib3VuY2VkVXBkYXRlTGF5b3V0KCk7CiAgICB9CiAgfTsKCiAgY29uc3QgaXNTZWxlY3RlZCA9IHJvdyA9PiB7CiAgICByZXR1cm4gc2VsZWN0aW9uLnZhbHVlLmluZGV4T2Yocm93KSA+IC0xOwogIH07CgogIGNvbnN0IGNsZWFyU2VsZWN0aW9uID0gKCkgPT4gewogICAgaXNBbGxTZWxlY3RlZC52YWx1ZSA9IGZhbHNlOwogICAgY29uc3Qgb2xkU2VsZWN0aW9uID0gc2VsZWN0aW9uLnZhbHVlOwoKICAgIGlmIChvbGRTZWxlY3Rpb24ubGVuZ3RoKSB7CiAgICAgIHNlbGVjdGlvbi52YWx1ZSA9IFtdOwogICAgICBpbnN0YW5jZS5lbWl0KCJzZWxlY3Rpb24tY2hhbmdlIiwgW10pOwogICAgfQogIH07CgogIGNvbnN0IGNsZWFuU2VsZWN0aW9uID0gKCkgPT4gewogICAgbGV0IGRlbGV0ZWQ7CgogICAgaWYgKHJvd0tleS52YWx1ZSkgewogICAgICBkZWxldGVkID0gW107CiAgICAgIGNvbnN0IHNlbGVjdGVkTWFwID0gZ2V0S2V5c01hcChzZWxlY3Rpb24udmFsdWUsIHJvd0tleS52YWx1ZSk7CiAgICAgIGNvbnN0IGRhdGFNYXAgPSBnZXRLZXlzTWFwKGRhdGEudmFsdWUsIHJvd0tleS52YWx1ZSk7CgogICAgICBmb3IgKGNvbnN0IGtleSBpbiBzZWxlY3RlZE1hcCkgewogICAgICAgIGlmIChoYXNPd24oc2VsZWN0ZWRNYXAsIGtleSkgJiYgIWRhdGFNYXBba2V5XSkgewogICAgICAgICAgZGVsZXRlZC5wdXNoKHNlbGVjdGVkTWFwW2tleV0ucm93KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGRlbGV0ZWQgPSBzZWxlY3Rpb24udmFsdWUuZmlsdGVyKGl0ZW0gPT4gZGF0YS52YWx1ZS5pbmRleE9mKGl0ZW0pID09PSAtMSk7CiAgICB9CgogICAgaWYgKGRlbGV0ZWQubGVuZ3RoKSB7CiAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9IHNlbGVjdGlvbi52YWx1ZS5maWx0ZXIoaXRlbSA9PiBkZWxldGVkLmluZGV4T2YoaXRlbSkgPT09IC0xKTsKICAgICAgc2VsZWN0aW9uLnZhbHVlID0gbmV3U2VsZWN0aW9uOwogICAgICBpbnN0YW5jZS5lbWl0KCJzZWxlY3Rpb24tY2hhbmdlIiwgbmV3U2VsZWN0aW9uLnNsaWNlKCkpOwogICAgfQogIH07CgogIGNvbnN0IHRvZ2dsZVJvd1NlbGVjdGlvbiA9IChyb3csIHNlbGVjdGVkID0gdm9pZCAwLCBlbWl0Q2hhbmdlID0gdHJ1ZSkgPT4gewogICAgY29uc3QgY2hhbmdlZCA9IHRvZ2dsZVJvd1N0YXR1cyhzZWxlY3Rpb24udmFsdWUsIHJvdywgc2VsZWN0ZWQpOwoKICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9IChzZWxlY3Rpb24udmFsdWUgfHwgW10pLnNsaWNlKCk7CgogICAgICBpZiAoZW1pdENoYW5nZSkgewogICAgICAgIGluc3RhbmNlLmVtaXQoInNlbGVjdCIsIG5ld1NlbGVjdGlvbiwgcm93KTsKICAgICAgfQoKICAgICAgaW5zdGFuY2UuZW1pdCgic2VsZWN0aW9uLWNoYW5nZSIsIG5ld1NlbGVjdGlvbik7CiAgICB9CiAgfTsKCiAgY29uc3QgX3RvZ2dsZUFsbFNlbGVjdGlvbiA9ICgpID0+IHsKICAgIHZhciBfYSwgX2I7CgogICAgY29uc3QgdmFsdWUgPSBzZWxlY3RPbkluZGV0ZXJtaW5hdGUudmFsdWUgPyAhaXNBbGxTZWxlY3RlZC52YWx1ZSA6ICEoaXNBbGxTZWxlY3RlZC52YWx1ZSB8fCBzZWxlY3Rpb24udmFsdWUubGVuZ3RoKTsKICAgIGlzQWxsU2VsZWN0ZWQudmFsdWUgPSB2YWx1ZTsKICAgIGxldCBzZWxlY3Rpb25DaGFuZ2VkID0gZmFsc2U7CiAgICBsZXQgY2hpbGRyZW5Db3VudCA9IDA7CiAgICBjb25zdCByb3dLZXkyID0gKF9iID0gKF9hID0gaW5zdGFuY2UgPT0gbnVsbCA/IHZvaWQgMCA6IGluc3RhbmNlLnN0b3JlKSA9PSBudWxsID8gdm9pZCAwIDogX2Euc3RhdGVzKSA9PSBudWxsID8gdm9pZCAwIDogX2Iucm93S2V5LnZhbHVlOwogICAgZGF0YS52YWx1ZS5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7CiAgICAgIGNvbnN0IHJvd0luZGV4ID0gaW5kZXggKyBjaGlsZHJlbkNvdW50OwoKICAgICAgaWYgKHNlbGVjdGFibGUudmFsdWUpIHsKICAgICAgICBpZiAoc2VsZWN0YWJsZS52YWx1ZS5jYWxsKG51bGwsIHJvdywgcm93SW5kZXgpICYmIHRvZ2dsZVJvd1N0YXR1cyhzZWxlY3Rpb24udmFsdWUsIHJvdywgdmFsdWUpKSB7CiAgICAgICAgICBzZWxlY3Rpb25DaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRvZ2dsZVJvd1N0YXR1cyhzZWxlY3Rpb24udmFsdWUsIHJvdywgdmFsdWUpKSB7CiAgICAgICAgICBzZWxlY3Rpb25DaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNoaWxkcmVuQ291bnQgKz0gZ2V0Q2hpbGRyZW5Db3VudChnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleTIpKTsKICAgIH0pOwoKICAgIGlmIChzZWxlY3Rpb25DaGFuZ2VkKSB7CiAgICAgIGluc3RhbmNlLmVtaXQoInNlbGVjdGlvbi1jaGFuZ2UiLCBzZWxlY3Rpb24udmFsdWUgPyBzZWxlY3Rpb24udmFsdWUuc2xpY2UoKSA6IFtdKTsKICAgIH0KCiAgICBpbnN0YW5jZS5lbWl0KCJzZWxlY3QtYWxsIiwgc2VsZWN0aW9uLnZhbHVlKTsKICB9OwoKICBjb25zdCB1cGRhdGVTZWxlY3Rpb25CeVJvd0tleSA9ICgpID0+IHsKICAgIGNvbnN0IHNlbGVjdGVkTWFwID0gZ2V0S2V5c01hcChzZWxlY3Rpb24udmFsdWUsIHJvd0tleS52YWx1ZSk7CiAgICBkYXRhLnZhbHVlLmZvckVhY2gocm93ID0+IHsKICAgICAgY29uc3Qgcm93SWQgPSBnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleS52YWx1ZSk7CiAgICAgIGNvbnN0IHJvd0luZm8gPSBzZWxlY3RlZE1hcFtyb3dJZF07CgogICAgICBpZiAocm93SW5mbykgewogICAgICAgIHNlbGVjdGlvbi52YWx1ZVtyb3dJbmZvLmluZGV4XSA9IHJvdzsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgY29uc3QgdXBkYXRlQWxsU2VsZWN0ZWQgPSAoKSA9PiB7CiAgICB2YXIgX2EsIF9iLCBfYzsKCiAgICBpZiAoKChfYSA9IGRhdGEudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID09PSAwKSB7CiAgICAgIGlzQWxsU2VsZWN0ZWQudmFsdWUgPSBmYWxzZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBzZWxlY3RlZE1hcDsKCiAgICBpZiAocm93S2V5LnZhbHVlKSB7CiAgICAgIHNlbGVjdGVkTWFwID0gZ2V0S2V5c01hcChzZWxlY3Rpb24udmFsdWUsIHJvd0tleS52YWx1ZSk7CiAgICB9CgogICAgY29uc3QgaXNTZWxlY3RlZDIgPSBmdW5jdGlvbiAocm93KSB7CiAgICAgIGlmIChzZWxlY3RlZE1hcCkgewogICAgICAgIHJldHVybiAhIXNlbGVjdGVkTWFwW2dldFJvd0lkZW50aXR5KHJvdywgcm93S2V5LnZhbHVlKV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbi52YWx1ZS5pbmRleE9mKHJvdykgIT09IC0xOwogICAgICB9CiAgICB9OwoKICAgIGxldCBpc0FsbFNlbGVjdGVkXyA9IHRydWU7CiAgICBsZXQgc2VsZWN0ZWRDb3VudCA9IDA7CiAgICBsZXQgY2hpbGRyZW5Db3VudCA9IDA7CgogICAgZm9yIChsZXQgaSA9IDAsIGogPSAoZGF0YS52YWx1ZSB8fCBbXSkubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgIGNvbnN0IGtleVByb3AgPSAoX2MgPSAoX2IgPSBpbnN0YW5jZSA9PSBudWxsID8gdm9pZCAwIDogaW5zdGFuY2Uuc3RvcmUpID09IG51bGwgPyB2b2lkIDAgOiBfYi5zdGF0ZXMpID09IG51bGwgPyB2b2lkIDAgOiBfYy5yb3dLZXkudmFsdWU7CiAgICAgIGNvbnN0IHJvd0luZGV4ID0gaSArIGNoaWxkcmVuQ291bnQ7CiAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhLnZhbHVlW2ldOwogICAgICBjb25zdCBpc1Jvd1NlbGVjdGFibGUgPSBzZWxlY3RhYmxlLnZhbHVlICYmIHNlbGVjdGFibGUudmFsdWUuY2FsbChudWxsLCBpdGVtLCByb3dJbmRleCk7CgogICAgICBpZiAoIWlzU2VsZWN0ZWQyKGl0ZW0pKSB7CiAgICAgICAgaWYgKCFzZWxlY3RhYmxlLnZhbHVlIHx8IGlzUm93U2VsZWN0YWJsZSkgewogICAgICAgICAgaXNBbGxTZWxlY3RlZF8gPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3RlZENvdW50Kys7CiAgICAgIH0KCiAgICAgIGNoaWxkcmVuQ291bnQgKz0gZ2V0Q2hpbGRyZW5Db3VudChnZXRSb3dJZGVudGl0eShpdGVtLCBrZXlQcm9wKSk7CiAgICB9CgogICAgaWYgKHNlbGVjdGVkQ291bnQgPT09IDApIGlzQWxsU2VsZWN0ZWRfID0gZmFsc2U7CiAgICBpc0FsbFNlbGVjdGVkLnZhbHVlID0gaXNBbGxTZWxlY3RlZF87CiAgfTsKCiAgY29uc3QgZ2V0Q2hpbGRyZW5Db3VudCA9IHJvd0tleTIgPT4gewogICAgdmFyIF9hOwoKICAgIGlmICghaW5zdGFuY2UgfHwgIWluc3RhbmNlLnN0b3JlKSByZXR1cm4gMDsKICAgIGNvbnN0IHsKICAgICAgdHJlZURhdGEKICAgIH0gPSBpbnN0YW5jZS5zdG9yZS5zdGF0ZXM7CiAgICBsZXQgY291bnQgPSAwOwogICAgY29uc3QgY2hpbGRyZW4gPSAoX2EgPSB0cmVlRGF0YS52YWx1ZVtyb3dLZXkyXSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLmNoaWxkcmVuOwoKICAgIGlmIChjaGlsZHJlbikgewogICAgICBjb3VudCArPSBjaGlsZHJlbi5sZW5ndGg7CiAgICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGRLZXkgPT4gewogICAgICAgIGNvdW50ICs9IGdldENoaWxkcmVuQ291bnQoY2hpbGRLZXkpOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gY291bnQ7CiAgfTsKCiAgY29uc3QgdXBkYXRlRmlsdGVycyA9IChjb2x1bW5zMiwgdmFsdWVzKSA9PiB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29sdW1uczIpKSB7CiAgICAgIGNvbHVtbnMyID0gW2NvbHVtbnMyXTsKICAgIH0KCiAgICBjb25zdCBmaWx0ZXJzXyA9IHt9OwogICAgY29sdW1uczIuZm9yRWFjaChjb2wgPT4gewogICAgICBmaWx0ZXJzLnZhbHVlW2NvbC5pZF0gPSB2YWx1ZXM7CiAgICAgIGZpbHRlcnNfW2NvbC5jb2x1bW5LZXkgfHwgY29sLmlkXSA9IHZhbHVlczsKICAgIH0pOwogICAgcmV0dXJuIGZpbHRlcnNfOwogIH07CgogIGNvbnN0IHVwZGF0ZVNvcnQgPSAoY29sdW1uLCBwcm9wLCBvcmRlcikgPT4gewogICAgaWYgKHNvcnRpbmdDb2x1bW4udmFsdWUgJiYgc29ydGluZ0NvbHVtbi52YWx1ZSAhPT0gY29sdW1uKSB7CiAgICAgIHNvcnRpbmdDb2x1bW4udmFsdWUub3JkZXIgPSBudWxsOwogICAgfQoKICAgIHNvcnRpbmdDb2x1bW4udmFsdWUgPSBjb2x1bW47CiAgICBzb3J0UHJvcC52YWx1ZSA9IHByb3A7CiAgICBzb3J0T3JkZXIudmFsdWUgPSBvcmRlcjsKICB9OwoKICBjb25zdCBleGVjRmlsdGVyID0gKCkgPT4gewogICAgbGV0IHNvdXJjZURhdGEgPSB2dWUudW5yZWYoX2RhdGEpOwogICAgT2JqZWN0LmtleXMoZmlsdGVycy52YWx1ZSkuZm9yRWFjaChjb2x1bW5JZCA9PiB7CiAgICAgIGNvbnN0IHZhbHVlcyA9IGZpbHRlcnMudmFsdWVbY29sdW1uSWRdOwogICAgICBpZiAoIXZhbHVlcyB8fCB2YWx1ZXMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgIGNvbnN0IGNvbHVtbiA9IGdldENvbHVtbkJ5SWQoewogICAgICAgIGNvbHVtbnM6IGNvbHVtbnMudmFsdWUKICAgICAgfSwgY29sdW1uSWQpOwoKICAgICAgaWYgKGNvbHVtbiAmJiBjb2x1bW4uZmlsdGVyTWV0aG9kKSB7CiAgICAgICAgc291cmNlRGF0YSA9IHNvdXJjZURhdGEuZmlsdGVyKHJvdyA9PiB7CiAgICAgICAgICByZXR1cm4gdmFsdWVzLnNvbWUodmFsdWUgPT4gY29sdW1uLmZpbHRlck1ldGhvZC5jYWxsKG51bGwsIHZhbHVlLCByb3csIGNvbHVtbikpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGZpbHRlcmVkRGF0YS52YWx1ZSA9IHNvdXJjZURhdGE7CiAgfTsKCiAgY29uc3QgZXhlY1NvcnQgPSAoKSA9PiB7CiAgICBkYXRhLnZhbHVlID0gc29ydERhdGEoZmlsdGVyZWREYXRhLnZhbHVlLCB7CiAgICAgIHNvcnRpbmdDb2x1bW46IHNvcnRpbmdDb2x1bW4udmFsdWUsCiAgICAgIHNvcnRQcm9wOiBzb3J0UHJvcC52YWx1ZSwKICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIudmFsdWUKICAgIH0pOwogIH07CgogIGNvbnN0IGV4ZWNRdWVyeSA9IChpZ25vcmUgPSB2b2lkIDApID0+IHsKICAgIGlmICghKGlnbm9yZSAmJiBpZ25vcmUuZmlsdGVyKSkgewogICAgICBleGVjRmlsdGVyKCk7CiAgICB9CgogICAgZXhlY1NvcnQoKTsKICB9OwoKICBjb25zdCBjbGVhckZpbHRlciA9IGNvbHVtbktleXMgPT4gewogICAgY29uc3QgewogICAgICB0YWJsZUhlYWRlciwKICAgICAgZml4ZWRUYWJsZUhlYWRlciwKICAgICAgcmlnaHRGaXhlZFRhYmxlSGVhZGVyCiAgICB9ID0gaW5zdGFuY2UucmVmczsKICAgIGxldCBwYW5lbHMgPSB7fTsKICAgIGlmICh0YWJsZUhlYWRlcikgcGFuZWxzID0gT2JqZWN0LmFzc2lnbihwYW5lbHMsIHRhYmxlSGVhZGVyLmZpbHRlclBhbmVscyk7CiAgICBpZiAoZml4ZWRUYWJsZUhlYWRlcikgcGFuZWxzID0gT2JqZWN0LmFzc2lnbihwYW5lbHMsIGZpeGVkVGFibGVIZWFkZXIuZmlsdGVyUGFuZWxzKTsKICAgIGlmIChyaWdodEZpeGVkVGFibGVIZWFkZXIpIHBhbmVscyA9IE9iamVjdC5hc3NpZ24ocGFuZWxzLCByaWdodEZpeGVkVGFibGVIZWFkZXIuZmlsdGVyUGFuZWxzKTsKICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwYW5lbHMpOwogICAgaWYgKCFrZXlzLmxlbmd0aCkgcmV0dXJuOwoKICAgIGlmICh0eXBlb2YgY29sdW1uS2V5cyA9PT0gInN0cmluZyIpIHsKICAgICAgY29sdW1uS2V5cyA9IFtjb2x1bW5LZXlzXTsKICAgIH0KCiAgICBpZiAoQXJyYXkuaXNBcnJheShjb2x1bW5LZXlzKSkgewogICAgICBjb25zdCBjb2x1bW5zXyA9IGNvbHVtbktleXMubWFwKGtleSA9PiBnZXRDb2x1bW5CeUtleSh7CiAgICAgICAgY29sdW1uczogY29sdW1ucy52YWx1ZQogICAgICB9LCBrZXkpKTsKICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgY29uc3QgY29sdW1uID0gY29sdW1uc18uZmluZChjb2wgPT4gY29sLmlkID09PSBrZXkpOwoKICAgICAgICBpZiAoY29sdW1uKSB7CiAgICAgICAgICBjb2x1bW4uZmlsdGVyZWRWYWx1ZSA9IFtdOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGluc3RhbmNlLnN0b3JlLmNvbW1pdCgiZmlsdGVyQ2hhbmdlIiwgewogICAgICAgIGNvbHVtbjogY29sdW1uc18sCiAgICAgICAgdmFsdWVzOiBbXSwKICAgICAgICBzaWxlbnQ6IHRydWUsCiAgICAgICAgbXVsdGk6IHRydWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgICBjb25zdCBjb2x1bW4gPSBjb2x1bW5zLnZhbHVlLmZpbmQoY29sID0+IGNvbC5pZCA9PT0ga2V5KTsKCiAgICAgICAgaWYgKGNvbHVtbikgewogICAgICAgICAgY29sdW1uLmZpbHRlcmVkVmFsdWUgPSBbXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBmaWx0ZXJzLnZhbHVlID0ge307CiAgICAgIGluc3RhbmNlLnN0b3JlLmNvbW1pdCgiZmlsdGVyQ2hhbmdlIiwgewogICAgICAgIGNvbHVtbjoge30sCiAgICAgICAgdmFsdWVzOiBbXSwKICAgICAgICBzaWxlbnQ6IHRydWUKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgY29uc3QgY2xlYXJTb3J0ID0gKCkgPT4gewogICAgaWYgKCFzb3J0aW5nQ29sdW1uLnZhbHVlKSByZXR1cm47CiAgICB1cGRhdGVTb3J0KG51bGwsIG51bGwsIG51bGwpOwogICAgaW5zdGFuY2Uuc3RvcmUuY29tbWl0KCJjaGFuZ2VTb3J0Q29uZGl0aW9uIiwgewogICAgICBzaWxlbnQ6IHRydWUKICAgIH0pOwogIH07CgogIGNvbnN0IHsKICAgIHNldEV4cGFuZFJvd0tleXMsCiAgICB0b2dnbGVSb3dFeHBhbnNpb24sCiAgICB1cGRhdGVFeHBhbmRSb3dzLAogICAgc3RhdGVzOiBleHBhbmRTdGF0ZXMsCiAgICBpc1Jvd0V4cGFuZGVkCiAgfSA9IHVzZUV4cGFuZCh7CiAgICBkYXRhLAogICAgcm93S2V5CiAgfSk7CiAgY29uc3QgewogICAgdXBkYXRlVHJlZUV4cGFuZEtleXMsCiAgICB0b2dnbGVUcmVlRXhwYW5zaW9uLAogICAgbG9hZE9yVG9nZ2xlLAogICAgc3RhdGVzOiB0cmVlU3RhdGVzCiAgfSA9IHVzZVRyZWUoewogICAgZGF0YSwKICAgIHJvd0tleQogIH0pOwogIGNvbnN0IHsKICAgIHVwZGF0ZUN1cnJlbnRSb3dEYXRhLAogICAgdXBkYXRlQ3VycmVudFJvdywKICAgIHNldEN1cnJlbnRSb3dLZXksCiAgICBzdGF0ZXM6IGN1cnJlbnREYXRhCiAgfSA9IHVzZUN1cnJlbnQoewogICAgZGF0YSwKICAgIHJvd0tleQogIH0pOwoKICBjb25zdCBzZXRFeHBhbmRSb3dLZXlzQWRhcHRlciA9IHZhbCA9PiB7CiAgICBzZXRFeHBhbmRSb3dLZXlzKHZhbCk7CiAgICB1cGRhdGVUcmVlRXhwYW5kS2V5cyh2YWwpOwogIH07CgogIGNvbnN0IHRvZ2dsZVJvd0V4cGFuc2lvbkFkYXB0ZXIgPSAocm93LCBleHBhbmRlZCkgPT4gewogICAgY29uc3QgaGFzRXhwYW5kQ29sdW1uID0gY29sdW1ucy52YWx1ZS5zb21lKCh7CiAgICAgIHR5cGUKICAgIH0pID0+IHR5cGUgPT09ICJleHBhbmQiKTsKCiAgICBpZiAoaGFzRXhwYW5kQ29sdW1uKSB7CiAgICAgIHRvZ2dsZVJvd0V4cGFuc2lvbihyb3csIGV4cGFuZGVkKTsKICAgIH0gZWxzZSB7CiAgICAgIHRvZ2dsZVRyZWVFeHBhbnNpb24ocm93LCBleHBhbmRlZCk7CiAgICB9CiAgfTsKCiAgcmV0dXJuIHsKICAgIGFzc2VydFJvd0tleSwKICAgIHVwZGF0ZUNvbHVtbnMsCiAgICBzY2hlZHVsZUxheW91dCwKICAgIGlzU2VsZWN0ZWQsCiAgICBjbGVhclNlbGVjdGlvbiwKICAgIGNsZWFuU2VsZWN0aW9uLAogICAgdG9nZ2xlUm93U2VsZWN0aW9uLAogICAgX3RvZ2dsZUFsbFNlbGVjdGlvbiwKICAgIHRvZ2dsZUFsbFNlbGVjdGlvbjogbnVsbCwKICAgIHVwZGF0ZVNlbGVjdGlvbkJ5Um93S2V5LAogICAgdXBkYXRlQWxsU2VsZWN0ZWQsCiAgICB1cGRhdGVGaWx0ZXJzLAogICAgdXBkYXRlQ3VycmVudFJvdywKICAgIHVwZGF0ZVNvcnQsCiAgICBleGVjRmlsdGVyLAogICAgZXhlY1NvcnQsCiAgICBleGVjUXVlcnksCiAgICBjbGVhckZpbHRlciwKICAgIGNsZWFyU29ydCwKICAgIHRvZ2dsZVJvd0V4cGFuc2lvbiwKICAgIHNldEV4cGFuZFJvd0tleXNBZGFwdGVyLAogICAgc2V0Q3VycmVudFJvd0tleSwKICAgIHRvZ2dsZVJvd0V4cGFuc2lvbkFkYXB0ZXIsCiAgICBpc1Jvd0V4cGFuZGVkLAogICAgdXBkYXRlRXhwYW5kUm93cywKICAgIHVwZGF0ZUN1cnJlbnRSb3dEYXRhLAogICAgbG9hZE9yVG9nZ2xlLAogICAgc3RhdGVzOiBfX3NwcmVhZFZhbHVlcyQyKF9fc3ByZWFkVmFsdWVzJDIoX19zcHJlYWRWYWx1ZXMkMih7CiAgICAgIHJvd0tleSwKICAgICAgZGF0YSwKICAgICAgX2RhdGEsCiAgICAgIGlzQ29tcGxleCwKICAgICAgX2NvbHVtbnMsCiAgICAgIG9yaWdpbkNvbHVtbnMsCiAgICAgIGNvbHVtbnMsCiAgICAgIGZpeGVkQ29sdW1ucywKICAgICAgcmlnaHRGaXhlZENvbHVtbnMsCiAgICAgIGxlYWZDb2x1bW5zLAogICAgICBmaXhlZExlYWZDb2x1bW5zLAogICAgICByaWdodEZpeGVkTGVhZkNvbHVtbnMsCiAgICAgIGxlYWZDb2x1bW5zTGVuZ3RoLAogICAgICBmaXhlZExlYWZDb2x1bW5zTGVuZ3RoLAogICAgICByaWdodEZpeGVkTGVhZkNvbHVtbnNMZW5ndGgsCiAgICAgIGlzQWxsU2VsZWN0ZWQsCiAgICAgIHNlbGVjdGlvbiwKICAgICAgcmVzZXJ2ZVNlbGVjdGlvbiwKICAgICAgc2VsZWN0T25JbmRldGVybWluYXRlLAogICAgICBzZWxlY3RhYmxlLAogICAgICBmaWx0ZXJzLAogICAgICBmaWx0ZXJlZERhdGEsCiAgICAgIHNvcnRpbmdDb2x1bW4sCiAgICAgIHNvcnRQcm9wLAogICAgICBzb3J0T3JkZXIsCiAgICAgIGhvdmVyUm93CiAgICB9LCBleHBhbmRTdGF0ZXMpLCB0cmVlU3RhdGVzKSwgY3VycmVudERhdGEpCiAgfTsKfQoKdmFyIF9fZGVmUHJvcCQzID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19kZWZQcm9wcyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOwp2YXIgX19nZXRPd25Qcm9wRGVzY3MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczsKdmFyIF9fZ2V0T3duUHJvcFN5bWJvbHMkMyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CnZhciBfX2hhc093blByb3AkMyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CnZhciBfX3Byb3BJc0VudW0kMyA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7Cgp2YXIgX19kZWZOb3JtYWxQcm9wJDMgPSAob2JqLCBrZXksIHZhbHVlKSA9PiBrZXkgaW4gb2JqID8gX19kZWZQcm9wJDMob2JqLCBrZXksIHsKICBlbnVtZXJhYmxlOiB0cnVlLAogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICB3cml0YWJsZTogdHJ1ZSwKICB2YWx1ZQp9KSA6IG9ialtrZXldID0gdmFsdWU7Cgp2YXIgX19zcHJlYWRWYWx1ZXMkMyA9IChhLCBiKSA9PiB7CiAgZm9yICh2YXIgcHJvcCBpbiBiIHx8IChiID0ge30pKSBpZiAoX19oYXNPd25Qcm9wJDMuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDMoYSwgcHJvcCwgYltwcm9wXSk7CgogIGlmIChfX2dldE93blByb3BTeW1ib2xzJDMpIGZvciAodmFyIHByb3Agb2YgX19nZXRPd25Qcm9wU3ltYm9scyQzKGIpKSB7CiAgICBpZiAoX19wcm9wSXNFbnVtJDMuY2FsbChiLCBwcm9wKSkgX19kZWZOb3JtYWxQcm9wJDMoYSwgcHJvcCwgYltwcm9wXSk7CiAgfQogIHJldHVybiBhOwp9OwoKdmFyIF9fc3ByZWFkUHJvcHMgPSAoYSwgYikgPT4gX19kZWZQcm9wcyhhLCBfX2dldE93blByb3BEZXNjcyhiKSk7CgpmdW5jdGlvbiByZXBsYWNlQ29sdW1uKGFycmF5LCBjb2x1bW4pIHsKICByZXR1cm4gYXJyYXkubWFwKGl0ZW0gPT4gewogICAgdmFyIF9hOwoKICAgIGlmIChpdGVtLmlkID09PSBjb2x1bW4uaWQpIHsKICAgICAgcmV0dXJuIGNvbHVtbjsKICAgIH0gZWxzZSBpZiAoKF9hID0gaXRlbS5jaGlsZHJlbikgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgewogICAgICBpdGVtLmNoaWxkcmVuID0gcmVwbGFjZUNvbHVtbihpdGVtLmNoaWxkcmVuLCBjb2x1bW4pOwogICAgfQoKICAgIHJldHVybiBpdGVtOwogIH0pOwp9CgpmdW5jdGlvbiBzb3J0Q29sdW1uKGFycmF5KSB7CiAgYXJyYXkuZm9yRWFjaChpdGVtID0+IHsKICAgIHZhciBfYSwgX2I7CgogICAgaXRlbS5ubyA9IChfYSA9IGl0ZW0uZ2V0Q29sdW1uSW5kZXgpID09IG51bGwgPyB2b2lkIDAgOiBfYS5jYWxsKGl0ZW0pOwoKICAgIGlmICgoX2IgPSBpdGVtLmNoaWxkcmVuKSA9PSBudWxsID8gdm9pZCAwIDogX2IubGVuZ3RoKSB7CiAgICAgIHNvcnRDb2x1bW4oaXRlbS5jaGlsZHJlbik7CiAgICB9CiAgfSk7CiAgYXJyYXkuc29ydCgoY3VyLCBwcmUpID0+IGN1ci5ubyAtIHByZS5ubyk7Cn0KCmZ1bmN0aW9uIHVzZVN0b3JlKCkgewogIGNvbnN0IGluc3RhbmNlID0gdnVlLmdldEN1cnJlbnRJbnN0YW5jZSgpOwogIGNvbnN0IHdhdGNoZXIgPSB1c2VXYXRjaGVyKCk7CiAgY29uc3QgbXV0YXRpb25zID0gewogICAgc2V0RGF0YShzdGF0ZXMsIGRhdGEpIHsKICAgICAgY29uc3QgZGF0YUluc3RhbmNlQ2hhbmdlZCA9IHZ1ZS51bnJlZihzdGF0ZXMuZGF0YSkgIT09IGRhdGE7CiAgICAgIHN0YXRlcy5kYXRhLnZhbHVlID0gZGF0YTsKICAgICAgc3RhdGVzLl9kYXRhLnZhbHVlID0gZGF0YTsKICAgICAgaW5zdGFuY2Uuc3RvcmUuZXhlY1F1ZXJ5KCk7CiAgICAgIGluc3RhbmNlLnN0b3JlLnVwZGF0ZUN1cnJlbnRSb3dEYXRhKCk7CiAgICAgIGluc3RhbmNlLnN0b3JlLnVwZGF0ZUV4cGFuZFJvd3MoKTsKCiAgICAgIGlmICh2dWUudW5yZWYoc3RhdGVzLnJlc2VydmVTZWxlY3Rpb24pKSB7CiAgICAgICAgaW5zdGFuY2Uuc3RvcmUuYXNzZXJ0Um93S2V5KCk7CiAgICAgICAgaW5zdGFuY2Uuc3RvcmUudXBkYXRlU2VsZWN0aW9uQnlSb3dLZXkoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZGF0YUluc3RhbmNlQ2hhbmdlZCkgewogICAgICAgICAgaW5zdGFuY2Uuc3RvcmUuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW5zdGFuY2Uuc3RvcmUuY2xlYW5TZWxlY3Rpb24oKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGluc3RhbmNlLnN0b3JlLnVwZGF0ZUFsbFNlbGVjdGVkKCk7CgogICAgICBpZiAoaW5zdGFuY2UuJHJlYWR5KSB7CiAgICAgICAgaW5zdGFuY2Uuc3RvcmUuc2NoZWR1bGVMYXlvdXQoKTsKICAgICAgfQogICAgfSwKCiAgICBpbnNlcnRDb2x1bW4oc3RhdGVzLCBjb2x1bW4sIHBhcmVudCkgewogICAgICBjb25zdCBhcnJheSA9IHZ1ZS51bnJlZihzdGF0ZXMuX2NvbHVtbnMpOwogICAgICBsZXQgbmV3Q29sdW1ucyA9IFtdOwoKICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICBhcnJheS5wdXNoKGNvbHVtbik7CiAgICAgICAgbmV3Q29sdW1ucyA9IGFycmF5OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwYXJlbnQgJiYgIXBhcmVudC5jaGlsZHJlbikgewogICAgICAgICAgcGFyZW50LmNoaWxkcmVuID0gW107CiAgICAgICAgfQoKICAgICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChjb2x1bW4pOwogICAgICAgIG5ld0NvbHVtbnMgPSByZXBsYWNlQ29sdW1uKGFycmF5LCBwYXJlbnQpOwogICAgICB9CgogICAgICBzb3J0Q29sdW1uKG5ld0NvbHVtbnMpOwogICAgICBzdGF0ZXMuX2NvbHVtbnMudmFsdWUgPSBuZXdDb2x1bW5zOwoKICAgICAgaWYgKGNvbHVtbi50eXBlID09PSAic2VsZWN0aW9uIikgewogICAgICAgIHN0YXRlcy5zZWxlY3RhYmxlLnZhbHVlID0gY29sdW1uLnNlbGVjdGFibGU7CiAgICAgICAgc3RhdGVzLnJlc2VydmVTZWxlY3Rpb24udmFsdWUgPSBjb2x1bW4ucmVzZXJ2ZVNlbGVjdGlvbjsKICAgICAgfQoKICAgICAgaWYgKGluc3RhbmNlLiRyZWFkeSkgewogICAgICAgIGluc3RhbmNlLnN0b3JlLnVwZGF0ZUNvbHVtbnMoKTsKICAgICAgICBpbnN0YW5jZS5zdG9yZS5zY2hlZHVsZUxheW91dCgpOwogICAgICB9CiAgICB9LAoKICAgIHJlbW92ZUNvbHVtbihzdGF0ZXMsIGNvbHVtbiwgcGFyZW50KSB7CiAgICAgIGNvbnN0IGFycmF5ID0gdnVlLnVucmVmKHN0YXRlcy5fY29sdW1ucykgfHwgW107CgogICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgcGFyZW50LmNoaWxkcmVuLnNwbGljZShwYXJlbnQuY2hpbGRyZW4uZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gY29sdW1uLmlkKSwgMSk7CgogICAgICAgIGlmIChwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBkZWxldGUgcGFyZW50LmNoaWxkcmVuOwogICAgICAgIH0KCiAgICAgICAgc3RhdGVzLl9jb2x1bW5zLnZhbHVlID0gcmVwbGFjZUNvbHVtbihhcnJheSwgcGFyZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBpbmRleCA9IGFycmF5LmluZGV4T2YoY29sdW1uKTsKCiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgIGFycmF5LnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICBzdGF0ZXMuX2NvbHVtbnMudmFsdWUgPSBhcnJheTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChpbnN0YW5jZS4kcmVhZHkpIHsKICAgICAgICBpbnN0YW5jZS5zdG9yZS51cGRhdGVDb2x1bW5zKCk7CiAgICAgICAgaW5zdGFuY2Uuc3RvcmUuc2NoZWR1bGVMYXlvdXQoKTsKICAgICAgfQogICAgfSwKCiAgICBzb3J0KHN0YXRlcywgb3B0aW9ucykgewogICAgICBjb25zdCB7CiAgICAgICAgcHJvcCwKICAgICAgICBvcmRlciwKICAgICAgICBpbml0CiAgICAgIH0gPSBvcHRpb25zOwoKICAgICAgaWYgKHByb3ApIHsKICAgICAgICBjb25zdCBjb2x1bW4gPSB1dGlsLmFycmF5RmluZCh2dWUudW5yZWYoc3RhdGVzLmNvbHVtbnMpLCBjb2x1bW4yID0+IGNvbHVtbjIucHJvcGVydHkgPT09IHByb3ApOwoKICAgICAgICBpZiAoY29sdW1uKSB7CiAgICAgICAgICBjb2x1bW4ub3JkZXIgPSBvcmRlcjsKICAgICAgICAgIGluc3RhbmNlLnN0b3JlLnVwZGF0ZVNvcnQoY29sdW1uLCBwcm9wLCBvcmRlcik7CiAgICAgICAgICBpbnN0YW5jZS5zdG9yZS5jb21taXQoImNoYW5nZVNvcnRDb25kaXRpb24iLCB7CiAgICAgICAgICAgIGluaXQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBjaGFuZ2VTb3J0Q29uZGl0aW9uKHN0YXRlcywgb3B0aW9ucykgewogICAgICBjb25zdCB7CiAgICAgICAgc29ydGluZ0NvbHVtbjogY29sdW1uLAogICAgICAgIHNvcnRQcm9wOiBwcm9wLAogICAgICAgIHNvcnRPcmRlcjogb3JkZXIKICAgICAgfSA9IHN0YXRlczsKCiAgICAgIGlmICh2dWUudW5yZWYob3JkZXIpID09PSBudWxsKSB7CiAgICAgICAgc3RhdGVzLnNvcnRpbmdDb2x1bW4udmFsdWUgPSBudWxsOwogICAgICAgIHN0YXRlcy5zb3J0UHJvcC52YWx1ZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZ29yZSA9IHsKICAgICAgICBmaWx0ZXI6IHRydWUKICAgICAgfTsKICAgICAgaW5zdGFuY2Uuc3RvcmUuZXhlY1F1ZXJ5KGluZ29yZSk7CgogICAgICBpZiAoIW9wdGlvbnMgfHwgIShvcHRpb25zLnNpbGVudCB8fCBvcHRpb25zLmluaXQpKSB7CiAgICAgICAgaW5zdGFuY2UuZW1pdCgic29ydC1jaGFuZ2UiLCB7CiAgICAgICAgICBjb2x1bW46IHZ1ZS51bnJlZihjb2x1bW4pLAogICAgICAgICAgcHJvcDogdnVlLnVucmVmKHByb3ApLAogICAgICAgICAgb3JkZXI6IHZ1ZS51bnJlZihvcmRlcikKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaW5zdGFuY2Uuc3RvcmUudXBkYXRlVGFibGVTY3JvbGxZKCk7CiAgICB9LAoKICAgIGZpbHRlckNoYW5nZShfc3RhdGVzLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBjb2x1bW4sCiAgICAgICAgdmFsdWVzLAogICAgICAgIHNpbGVudAogICAgICB9ID0gb3B0aW9uczsKICAgICAgY29uc3QgbmV3RmlsdGVycyA9IGluc3RhbmNlLnN0b3JlLnVwZGF0ZUZpbHRlcnMoY29sdW1uLCB2YWx1ZXMpOwogICAgICBpbnN0YW5jZS5zdG9yZS5leGVjUXVlcnkoKTsKCiAgICAgIGlmICghc2lsZW50KSB7CiAgICAgICAgaW5zdGFuY2UuZW1pdCgiZmlsdGVyLWNoYW5nZSIsIG5ld0ZpbHRlcnMpOwogICAgICB9CgogICAgICBpbnN0YW5jZS5zdG9yZS51cGRhdGVUYWJsZVNjcm9sbFkoKTsKICAgIH0sCgogICAgdG9nZ2xlQWxsU2VsZWN0aW9uKCkgewogICAgICBpbnN0YW5jZS5zdG9yZS50b2dnbGVBbGxTZWxlY3Rpb24oKTsKICAgIH0sCgogICAgcm93U2VsZWN0ZWRDaGFuZ2VkKF9zdGF0ZXMsIHJvdykgewogICAgICBpbnN0YW5jZS5zdG9yZS50b2dnbGVSb3dTZWxlY3Rpb24ocm93KTsKICAgICAgaW5zdGFuY2Uuc3RvcmUudXBkYXRlQWxsU2VsZWN0ZWQoKTsKICAgIH0sCgogICAgc2V0SG92ZXJSb3coc3RhdGVzLCByb3cpIHsKICAgICAgc3RhdGVzLmhvdmVyUm93LnZhbHVlID0gcm93OwogICAgfSwKCiAgICBzZXRDdXJyZW50Um93KF9zdGF0ZXMsIHJvdykgewogICAgICBpbnN0YW5jZS5zdG9yZS51cGRhdGVDdXJyZW50Um93KHJvdyk7CiAgICB9CgogIH07CgogIGNvbnN0IGNvbW1pdCA9IGZ1bmN0aW9uIChuYW1lLCAuLi5hcmdzKSB7CiAgICBjb25zdCBtdXRhdGlvbnMyID0gaW5zdGFuY2Uuc3RvcmUubXV0YXRpb25zOwoKICAgIGlmIChtdXRhdGlvbnMyW25hbWVdKSB7CiAgICAgIG11dGF0aW9uczJbbmFtZV0uYXBwbHkoaW5zdGFuY2UsIFtpbnN0YW5jZS5zdG9yZS5zdGF0ZXNdLmNvbmNhdChhcmdzKSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjdGlvbiBub3QgZm91bmQ6ICR7bmFtZX1gKTsKICAgIH0KICB9OwoKICBjb25zdCB1cGRhdGVUYWJsZVNjcm9sbFkgPSBmdW5jdGlvbiAoKSB7CiAgICB2dWUubmV4dFRpY2soKCkgPT4gaW5zdGFuY2UubGF5b3V0LnVwZGF0ZVNjcm9sbFkuYXBwbHkoaW5zdGFuY2UubGF5b3V0KSk7CiAgfTsKCiAgcmV0dXJuIF9fc3ByZWFkUHJvcHMoX19zcHJlYWRWYWx1ZXMkMyh7fSwgd2F0Y2hlciksIHsKICAgIG11dGF0aW9ucywKICAgIGNvbW1pdCwKICAgIHVwZGF0ZVRhYmxlU2Nyb2xsWQogIH0pOwp9Cgpjb25zdCBJbml0aWFsU3RhdGVNYXAgPSB7CiAgcm93S2V5OiAicm93S2V5IiwKICBkZWZhdWx0RXhwYW5kQWxsOiAiZGVmYXVsdEV4cGFuZEFsbCIsCiAgc2VsZWN0T25JbmRldGVybWluYXRlOiAic2VsZWN0T25JbmRldGVybWluYXRlIiwKICBpbmRlbnQ6ICJpbmRlbnQiLAogIGxhenk6ICJsYXp5IiwKICBkYXRhOiAiZGF0YSIsCiAgWyJ0cmVlUHJvcHMuaGFzQ2hpbGRyZW4iXTogewogICAga2V5OiAibGF6eUNvbHVtbklkZW50aWZpZXIiLAogICAgZGVmYXVsdDogImhhc0NoaWxkcmVuIgogIH0sCiAgWyJ0cmVlUHJvcHMuY2hpbGRyZW4iXTogewogICAga2V5OiAiY2hpbGRyZW5Db2x1bW5OYW1lIiwKICAgIGRlZmF1bHQ6ICJjaGlsZHJlbiIKICB9Cn07CgpmdW5jdGlvbiBjcmVhdGVTdG9yZSh0YWJsZSwgcHJvcHMpIHsKICBpZiAoIXRhYmxlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlRhYmxlIGlzIHJlcXVpcmVkLiIpOwogIH0KCiAgY29uc3Qgc3RvcmUgPSB1c2VTdG9yZSgpOwogIHN0b3JlLnRvZ2dsZUFsbFNlbGVjdGlvbiA9IGRlYm91bmNlX19kZWZhdWx0WydkZWZhdWx0J10oc3RvcmUuX3RvZ2dsZUFsbFNlbGVjdGlvbiwgMTApOwogIE9iamVjdC5rZXlzKEluaXRpYWxTdGF0ZU1hcCkuZm9yRWFjaChrZXkgPT4gewogICAgaGFuZGxlVmFsdWUoZ2V0QXJyS2V5c1ZhbHVlKHByb3BzLCBrZXkpLCBrZXksIHN0b3JlKTsKICB9KTsKICBwcm94eVRhYmxlUHJvcHMoc3RvcmUsIHByb3BzKTsKICByZXR1cm4gc3RvcmU7Cn0KCmZ1bmN0aW9uIHByb3h5VGFibGVQcm9wcyhzdG9yZSwgcHJvcHMpIHsKICBPYmplY3Qua2V5cyhJbml0aWFsU3RhdGVNYXApLmZvckVhY2goa2V5ID0+IHsKICAgIHZ1ZS53YXRjaCgoKSA9PiBnZXRBcnJLZXlzVmFsdWUocHJvcHMsIGtleSksIHZhbHVlID0+IHsKICAgICAgaGFuZGxlVmFsdWUodmFsdWUsIGtleSwgc3RvcmUpOwogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGhhbmRsZVZhbHVlKHZhbHVlLCBwcm9wc0tleSwgc3RvcmUpIHsKICBsZXQgbmV3VmFsID0gdmFsdWU7CiAgbGV0IHN0b3JlS2V5ID0gSW5pdGlhbFN0YXRlTWFwW3Byb3BzS2V5XTsKCiAgaWYgKHR5cGVvZiBJbml0aWFsU3RhdGVNYXBbcHJvcHNLZXldID09PSAib2JqZWN0IikgewogICAgc3RvcmVLZXkgPSBzdG9yZUtleS5rZXk7CiAgICBuZXdWYWwgPSBuZXdWYWwgfHwgSW5pdGlhbFN0YXRlTWFwW3Byb3BzS2V5XS5kZWZhdWx0OwogIH0KCiAgc3RvcmUuc3RhdGVzW3N0b3JlS2V5XS52YWx1ZSA9IG5ld1ZhbDsKfQoKZnVuY3Rpb24gZ2V0QXJyS2V5c1ZhbHVlKHByb3BzLCBrZXlzKSB7CiAgaWYgKGtleXMuaW5jbHVkZXMoIi4iKSkgewogICAgY29uc3Qga2V5TGlzdCA9IGtleXMuc3BsaXQoIi4iKTsKICAgIGxldCB2YWx1ZSA9IHByb3BzOwogICAga2V5TGlzdC5mb3JFYWNoKGtleSA9PiB7CiAgICAgIHZhbHVlID0gdmFsdWVba2V5XTsKICAgIH0pOwogICAgcmV0dXJuIHZhbHVlOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcHJvcHNba2V5c107CiAgfQp9CgpjbGFzcyBUYWJsZUxheW91dCB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgdGhpcy5vYnNlcnZlcnMgPSBbXTsKICAgIHRoaXMudGFibGUgPSBudWxsOwogICAgdGhpcy5zdG9yZSA9IG51bGw7CiAgICB0aGlzLmNvbHVtbnMgPSBbXTsKICAgIHRoaXMuZml0ID0gdHJ1ZTsKICAgIHRoaXMuc2hvd0hlYWRlciA9IHRydWU7CiAgICB0aGlzLmhlaWdodCA9IHZ1ZS5yZWYobnVsbCk7CiAgICB0aGlzLnNjcm9sbFggPSB2dWUucmVmKGZhbHNlKTsKICAgIHRoaXMuc2Nyb2xsWSA9IHZ1ZS5yZWYoZmFsc2UpOwogICAgdGhpcy5ib2R5V2lkdGggPSB2dWUucmVmKG51bGwpOwogICAgdGhpcy5maXhlZFdpZHRoID0gdnVlLnJlZihudWxsKTsKICAgIHRoaXMucmlnaHRGaXhlZFdpZHRoID0gdnVlLnJlZihudWxsKTsKICAgIHRoaXMudGFibGVIZWlnaHQgPSB2dWUucmVmKG51bGwpOwogICAgdGhpcy5oZWFkZXJIZWlnaHQgPSB2dWUucmVmKDQ0KTsKICAgIHRoaXMuYXBwZW5kSGVpZ2h0ID0gdnVlLnJlZigwKTsKICAgIHRoaXMuZm9vdGVySGVpZ2h0ID0gdnVlLnJlZig0NCk7CiAgICB0aGlzLnZpZXdwb3J0SGVpZ2h0ID0gdnVlLnJlZihudWxsKTsKICAgIHRoaXMuYm9keUhlaWdodCA9IHZ1ZS5yZWYobnVsbCk7CiAgICB0aGlzLmZpeGVkQm9keUhlaWdodCA9IHZ1ZS5yZWYobnVsbCk7CiAgICB0aGlzLmd1dHRlcldpZHRoID0gc2Nyb2xsYmFyV2lkdGhfX2RlZmF1bHRbJ2RlZmF1bHQnXSgpOwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBvcHRpb25zKSB7CiAgICAgIGlmIChoYXNPd24ob3B0aW9ucywgbmFtZSkpIHsKICAgICAgICBpZiAodnVlLmlzUmVmKHRoaXNbbmFtZV0pKSB7CiAgICAgICAgICB0aGlzW25hbWVdLnZhbHVlID0gb3B0aW9uc1tuYW1lXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpc1tuYW1lXSA9IG9wdGlvbnNbbmFtZV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKCF0aGlzLnRhYmxlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigidGFibGUgaXMgcmVxdWlyZWQgZm9yIFRhYmxlIExheW91dCIpOwogICAgfQoKICAgIGlmICghdGhpcy5zdG9yZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoInN0b3JlIGlzIHJlcXVpcmVkIGZvciBUYWJsZSBMYXlvdXQiKTsKICAgIH0KICB9CgogIHVwZGF0ZVNjcm9sbFkoKSB7CiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmhlaWdodC52YWx1ZTsKICAgIGlmIChoZWlnaHQgPT09IG51bGwpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IGJvZHlXcmFwcGVyID0gdGhpcy50YWJsZS5yZWZzLmJvZHlXcmFwcGVyOwoKICAgIGlmICh0aGlzLnRhYmxlLnZub2RlLmVsICYmIGJvZHlXcmFwcGVyKSB7CiAgICAgIGxldCBzY3JvbGxZID0gdHJ1ZTsKICAgICAgY29uc3QgcHJldlNjcm9sbFkgPSB0aGlzLnNjcm9sbFkudmFsdWU7CgogICAgICBpZiAodGhpcy5ib2R5SGVpZ2h0LnZhbHVlID09PSBudWxsKSB7CiAgICAgICAgc2Nyb2xsWSA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGJvZHkgPSBib2R5V3JhcHBlci5xdWVyeVNlbGVjdG9yKCIuZWwtdGFibGVfX2JvZHkiKTsKICAgICAgICBzY3JvbGxZID0gYm9keS5vZmZzZXRIZWlnaHQgPiB0aGlzLmJvZHlIZWlnaHQudmFsdWU7CiAgICAgIH0KCiAgICAgIHRoaXMuc2Nyb2xsWS52YWx1ZSA9IHNjcm9sbFk7CiAgICAgIHJldHVybiBwcmV2U2Nyb2xsWSAhPT0gc2Nyb2xsWTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBzZXRIZWlnaHQodmFsdWUsIHByb3AgPSAiaGVpZ2h0IikgewogICAgaWYgKGlzU2VydmVyX19kZWZhdWx0WydkZWZhdWx0J10pIHJldHVybjsKICAgIGNvbnN0IGVsID0gdGhpcy50YWJsZS52bm9kZS5lbDsKICAgIHZhbHVlID0gcGFyc2VIZWlnaHQodmFsdWUpOwogICAgdGhpcy5oZWlnaHQudmFsdWUgPSBOdW1iZXIodmFsdWUpOwogICAgaWYgKCFlbCAmJiAodmFsdWUgfHwgdmFsdWUgPT09IDApKSByZXR1cm4gdnVlLm5leHRUaWNrKCgpID0+IHRoaXMuc2V0SGVpZ2h0KHZhbHVlLCBwcm9wKSk7CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgICAgZWwuc3R5bGVbcHJvcF0gPSB2YWx1ZSArICJweCI7CiAgICAgIHRoaXMudXBkYXRlRWxzSGVpZ2h0KCk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgZWwuc3R5bGVbcHJvcF0gPSB2YWx1ZTsKICAgICAgdGhpcy51cGRhdGVFbHNIZWlnaHQoKTsKICAgIH0KICB9CgogIHNldE1heEhlaWdodCh2YWx1ZSkgewogICAgdGhpcy5zZXRIZWlnaHQodmFsdWUsICJtYXgtaGVpZ2h0Iik7CiAgfQoKICBnZXRGbGF0dGVuQ29sdW1ucygpIHsKICAgIGNvbnN0IGZsYXR0ZW5Db2x1bW5zID0gW107CiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy50YWJsZS5zdG9yZS5zdGF0ZXMuY29sdW1ucy52YWx1ZTsKICAgIGNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4gewogICAgICBpZiAoY29sdW1uLmlzQ29sdW1uR3JvdXApIHsKICAgICAgICBmbGF0dGVuQ29sdW1ucy5wdXNoLmFwcGx5KGZsYXR0ZW5Db2x1bW5zLCBjb2x1bW4uY29sdW1ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZmxhdHRlbkNvbHVtbnMucHVzaChjb2x1bW4pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBmbGF0dGVuQ29sdW1uczsKICB9CgogIHVwZGF0ZUVsc0hlaWdodCgpIHsKICAgIGlmICghdGhpcy50YWJsZS4kcmVhZHkpIHJldHVybiB2dWUubmV4dFRpY2soKCkgPT4gdGhpcy51cGRhdGVFbHNIZWlnaHQoKSk7CiAgICBjb25zdCB7CiAgICAgIGhlYWRlcldyYXBwZXIsCiAgICAgIGFwcGVuZFdyYXBwZXIsCiAgICAgIGZvb3RlcldyYXBwZXIKICAgIH0gPSB0aGlzLnRhYmxlLnJlZnM7CiAgICB0aGlzLmFwcGVuZEhlaWdodC52YWx1ZSA9IGFwcGVuZFdyYXBwZXIgPyBhcHBlbmRXcmFwcGVyLm9mZnNldEhlaWdodCA6IDA7CiAgICBpZiAodGhpcy5zaG93SGVhZGVyICYmICFoZWFkZXJXcmFwcGVyKSByZXR1cm47CiAgICBjb25zdCBoZWFkZXJUckVsbSA9IGhlYWRlcldyYXBwZXIgPyBoZWFkZXJXcmFwcGVyLnF1ZXJ5U2VsZWN0b3IoIi5lbC10YWJsZV9faGVhZGVyIHRyIikgOiBudWxsOwogICAgY29uc3Qgbm9uZUhlYWRlciA9IHRoaXMuaGVhZGVyRGlzcGxheU5vbmUoaGVhZGVyVHJFbG0pOwogICAgY29uc3QgaGVhZGVySGVpZ2h0ID0gdGhpcy5oZWFkZXJIZWlnaHQudmFsdWUgPSAhdGhpcy5zaG93SGVhZGVyID8gMCA6IGhlYWRlcldyYXBwZXIub2Zmc2V0SGVpZ2h0OwoKICAgIGlmICh0aGlzLnNob3dIZWFkZXIgJiYgIW5vbmVIZWFkZXIgJiYgaGVhZGVyV3JhcHBlci5vZmZzZXRXaWR0aCA+IDAgJiYgKHRoaXMudGFibGUuc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUgfHwgW10pLmxlbmd0aCA+IDAgJiYgaGVhZGVySGVpZ2h0IDwgMikgewogICAgICByZXR1cm4gdnVlLm5leHRUaWNrKCgpID0+IHRoaXMudXBkYXRlRWxzSGVpZ2h0KCkpOwogICAgfQoKICAgIGNvbnN0IHRhYmxlSGVpZ2h0ID0gdGhpcy50YWJsZUhlaWdodC52YWx1ZSA9IHRoaXMudGFibGUudm5vZGUuZWwuY2xpZW50SGVpZ2h0OwogICAgY29uc3QgZm9vdGVySGVpZ2h0ID0gdGhpcy5mb290ZXJIZWlnaHQudmFsdWUgPSBmb290ZXJXcmFwcGVyID8gZm9vdGVyV3JhcHBlci5vZmZzZXRIZWlnaHQgOiAwOwoKICAgIGlmICh0aGlzLmhlaWdodC52YWx1ZSAhPT0gbnVsbCkgewogICAgICB0aGlzLmJvZHlIZWlnaHQudmFsdWUgPSB0YWJsZUhlaWdodCAtIGhlYWRlckhlaWdodCAtIGZvb3RlckhlaWdodCArIChmb290ZXJXcmFwcGVyID8gMSA6IDApOwogICAgfQoKICAgIHRoaXMuZml4ZWRCb2R5SGVpZ2h0LnZhbHVlID0gdGhpcy5zY3JvbGxYLnZhbHVlID8gdGhpcy5ib2R5SGVpZ2h0LnZhbHVlIC0gdGhpcy5ndXR0ZXJXaWR0aCA6IHRoaXMuYm9keUhlaWdodC52YWx1ZTsKICAgIHRoaXMudmlld3BvcnRIZWlnaHQudmFsdWUgPSB0aGlzLnNjcm9sbFgudmFsdWUgPyB0YWJsZUhlaWdodCAtIHRoaXMuZ3V0dGVyV2lkdGggOiB0YWJsZUhlaWdodDsKICAgIHRoaXMudXBkYXRlU2Nyb2xsWSgpOwogICAgdGhpcy5ub3RpZnlPYnNlcnZlcnMoInNjcm9sbGFibGUiKTsKICB9CgogIGhlYWRlckRpc3BsYXlOb25lKGVsbSkgewogICAgaWYgKCFlbG0pIHJldHVybiB0cnVlOwogICAgbGV0IGhlYWRlckNoaWxkID0gZWxtOwoKICAgIHdoaWxlIChoZWFkZXJDaGlsZC50YWdOYW1lICE9PSAiRElWIikgewogICAgICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZShoZWFkZXJDaGlsZCkuZGlzcGxheSA9PT0gIm5vbmUiKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGhlYWRlckNoaWxkID0gaGVhZGVyQ2hpbGQucGFyZW50RWxlbWVudDsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB1cGRhdGVDb2x1bW5zV2lkdGgoKSB7CiAgICBpZiAoaXNTZXJ2ZXJfX2RlZmF1bHRbJ2RlZmF1bHQnXSkgcmV0dXJuOwogICAgY29uc3QgZml0ID0gdGhpcy5maXQ7CiAgICBjb25zdCBib2R5V2lkdGggPSB0aGlzLnRhYmxlLnZub2RlLmVsLmNsaWVudFdpZHRoOwogICAgbGV0IGJvZHlNaW5XaWR0aCA9IDA7CiAgICBjb25zdCBmbGF0dGVuQ29sdW1ucyA9IHRoaXMuZ2V0RmxhdHRlbkNvbHVtbnMoKTsKICAgIGNvbnN0IGZsZXhDb2x1bW5zID0gZmxhdHRlbkNvbHVtbnMuZmlsdGVyKGNvbHVtbiA9PiB0eXBlb2YgY29sdW1uLndpZHRoICE9PSAibnVtYmVyIik7CiAgICBmbGF0dGVuQ29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7CiAgICAgIGlmICh0eXBlb2YgY29sdW1uLndpZHRoID09PSAibnVtYmVyIiAmJiBjb2x1bW4ucmVhbFdpZHRoKSBjb2x1bW4ucmVhbFdpZHRoID0gbnVsbDsKICAgIH0pOwoKICAgIGlmIChmbGV4Q29sdW1ucy5sZW5ndGggPiAwICYmIGZpdCkgewogICAgICBmbGF0dGVuQ29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7CiAgICAgICAgYm9keU1pbldpZHRoICs9IE51bWJlcihjb2x1bW4ud2lkdGggfHwgY29sdW1uLm1pbldpZHRoIHx8IDgwKTsKICAgICAgfSk7CiAgICAgIGNvbnN0IHNjcm9sbFlXaWR0aCA9IHRoaXMuc2Nyb2xsWS52YWx1ZSA/IHRoaXMuZ3V0dGVyV2lkdGggOiAwOwoKICAgICAgaWYgKGJvZHlNaW5XaWR0aCA8PSBib2R5V2lkdGggLSBzY3JvbGxZV2lkdGgpIHsKICAgICAgICB0aGlzLnNjcm9sbFgudmFsdWUgPSBmYWxzZTsKICAgICAgICBjb25zdCB0b3RhbEZsZXhXaWR0aCA9IGJvZHlXaWR0aCAtIHNjcm9sbFlXaWR0aCAtIGJvZHlNaW5XaWR0aDsKCiAgICAgICAgaWYgKGZsZXhDb2x1bW5zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgZmxleENvbHVtbnNbMF0ucmVhbFdpZHRoID0gTnVtYmVyKGZsZXhDb2x1bW5zWzBdLm1pbldpZHRoIHx8IDgwKSArIHRvdGFsRmxleFdpZHRoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBhbGxDb2x1bW5zV2lkdGggPSBmbGV4Q29sdW1ucy5yZWR1Y2UoKHByZXYsIGNvbHVtbikgPT4gcHJldiArIE51bWJlcihjb2x1bW4ubWluV2lkdGggfHwgODApLCAwKTsKICAgICAgICAgIGNvbnN0IGZsZXhXaWR0aFBlclBpeGVsID0gdG90YWxGbGV4V2lkdGggLyBhbGxDb2x1bW5zV2lkdGg7CiAgICAgICAgICBsZXQgbm9uZUZpcnN0V2lkdGggPSAwOwogICAgICAgICAgZmxleENvbHVtbnMuZm9yRWFjaCgoY29sdW1uLCBpbmRleCkgPT4gewogICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZmxleFdpZHRoID0gTWF0aC5mbG9vcihOdW1iZXIoY29sdW1uLm1pbldpZHRoIHx8IDgwKSAqIGZsZXhXaWR0aFBlclBpeGVsKTsKICAgICAgICAgICAgbm9uZUZpcnN0V2lkdGggKz0gZmxleFdpZHRoOwogICAgICAgICAgICBjb2x1bW4ucmVhbFdpZHRoID0gTnVtYmVyKGNvbHVtbi5taW5XaWR0aCB8fCA4MCkgKyBmbGV4V2lkdGg7CiAgICAgICAgICB9KTsKICAgICAgICAgIGZsZXhDb2x1bW5zWzBdLnJlYWxXaWR0aCA9IE51bWJlcihmbGV4Q29sdW1uc1swXS5taW5XaWR0aCB8fCA4MCkgKyB0b3RhbEZsZXhXaWR0aCAtIG5vbmVGaXJzdFdpZHRoOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNjcm9sbFgudmFsdWUgPSB0cnVlOwogICAgICAgIGZsZXhDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikgewogICAgICAgICAgY29sdW1uLnJlYWxXaWR0aCA9IE51bWJlcihjb2x1bW4ubWluV2lkdGgpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmJvZHlXaWR0aC52YWx1ZSA9IE1hdGgubWF4KGJvZHlNaW5XaWR0aCwgYm9keVdpZHRoKTsKICAgICAgdGhpcy50YWJsZS5zdGF0ZS5yZXNpemVTdGF0ZS52YWx1ZS53aWR0aCA9IHRoaXMuYm9keVdpZHRoLnZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgZmxhdHRlbkNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4gewogICAgICAgIGlmICghY29sdW1uLndpZHRoICYmICFjb2x1bW4ubWluV2lkdGgpIHsKICAgICAgICAgIGNvbHVtbi5yZWFsV2lkdGggPSA4MDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29sdW1uLnJlYWxXaWR0aCA9IE51bWJlcihjb2x1bW4ud2lkdGggfHwgY29sdW1uLm1pbldpZHRoKTsKICAgICAgICB9CgogICAgICAgIGJvZHlNaW5XaWR0aCArPSBjb2x1bW4ucmVhbFdpZHRoOwogICAgICB9KTsKICAgICAgdGhpcy5zY3JvbGxYLnZhbHVlID0gYm9keU1pbldpZHRoID4gYm9keVdpZHRoOwogICAgICB0aGlzLmJvZHlXaWR0aC52YWx1ZSA9IGJvZHlNaW5XaWR0aDsKICAgIH0KCiAgICBjb25zdCBmaXhlZENvbHVtbnMgPSB0aGlzLnN0b3JlLnN0YXRlcy5maXhlZENvbHVtbnMudmFsdWU7CgogICAgaWYgKGZpeGVkQ29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgIGxldCBmaXhlZFdpZHRoID0gMDsKICAgICAgZml4ZWRDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikgewogICAgICAgIGZpeGVkV2lkdGggKz0gTnVtYmVyKGNvbHVtbi5yZWFsV2lkdGggfHwgY29sdW1uLndpZHRoKTsKICAgICAgfSk7CiAgICAgIHRoaXMuZml4ZWRXaWR0aC52YWx1ZSA9IGZpeGVkV2lkdGg7CiAgICB9CgogICAgY29uc3QgcmlnaHRGaXhlZENvbHVtbnMgPSB0aGlzLnN0b3JlLnN0YXRlcy5yaWdodEZpeGVkQ29sdW1ucy52YWx1ZTsKCiAgICBpZiAocmlnaHRGaXhlZENvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICBsZXQgcmlnaHRGaXhlZFdpZHRoID0gMDsKICAgICAgcmlnaHRGaXhlZENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgcmlnaHRGaXhlZFdpZHRoICs9IE51bWJlcihjb2x1bW4ucmVhbFdpZHRoIHx8IGNvbHVtbi53aWR0aCk7CiAgICAgIH0pOwogICAgICB0aGlzLnJpZ2h0Rml4ZWRXaWR0aC52YWx1ZSA9IHJpZ2h0Rml4ZWRXaWR0aDsKICAgIH0KCiAgICB0aGlzLm5vdGlmeU9ic2VydmVycygiY29sdW1ucyIpOwogIH0KCiAgYWRkT2JzZXJ2ZXIob2JzZXJ2ZXIpIHsKICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gob2JzZXJ2ZXIpOwogIH0KCiAgcmVtb3ZlT2JzZXJ2ZXIob2JzZXJ2ZXIpIHsKICAgIGNvbnN0IGluZGV4ID0gdGhpcy5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlcik7CgogICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICB0aGlzLm9ic2VydmVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgfQogIH0KCiAgbm90aWZ5T2JzZXJ2ZXJzKGV2ZW50KSB7CiAgICBjb25zdCBvYnNlcnZlcnMgPSB0aGlzLm9ic2VydmVyczsKICAgIG9ic2VydmVycy5mb3JFYWNoKG9ic2VydmVyID0+IHsKICAgICAgdmFyIF9hLCBfYjsKCiAgICAgIHN3aXRjaCAoZXZlbnQpIHsKICAgICAgICBjYXNlICJjb2x1bW5zIjoKICAgICAgICAgIChfYSA9IG9ic2VydmVyLnN0YXRlKSA9PSBudWxsID8gdm9pZCAwIDogX2Eub25Db2x1bW5zQ2hhbmdlKHRoaXMpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgInNjcm9sbGFibGUiOgogICAgICAgICAgKF9iID0gb2JzZXJ2ZXIuc3RhdGUpID09IG51bGwgPyB2b2lkIDAgOiBfYi5vblNjcm9sbGFibGVDaGFuZ2UodGhpcyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGFibGUgTGF5b3V0IGRvbid0IGhhdmUgZXZlbnQgJHtldmVudH0uYCk7CiAgICAgIH0KICAgIH0pOwogIH0KCn0KCnZhciBzY3JpcHQgPSB2dWUuZGVmaW5lQ29tcG9uZW50KHsKICBuYW1lOiAiRWxUYWJsZUZpbHRlclBhbmVsIiwKICBjb21wb25lbnRzOiB7CiAgICBFbENoZWNrYm94OiBFbENoZWNrYm94X19kZWZhdWx0WydkZWZhdWx0J10sCiAgICBFbENoZWNrYm94R3JvdXA6IEVsQ2hlY2tib3hHcm91cF9fZGVmYXVsdFsnZGVmYXVsdCddLAogICAgRWxTY3JvbGxiYXI6IEVsU2Nyb2xsYmFyX19kZWZhdWx0WydkZWZhdWx0J10sCiAgICBFbFBvcHBlcjogRWxQb3BwZXJfX2RlZmF1bHRbJ2RlZmF1bHQnXQogIH0sCiAgZGlyZWN0aXZlczogewogICAgQ2xpY2tPdXRzaWRlOiBkaXJlY3RpdmVzLkNsaWNrT3V0c2lkZQogIH0sCiAgcHJvcHM6IHsKICAgIHBsYWNlbWVudDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICJib3R0b20tc3RhcnQiCiAgICB9LAogICAgc3RvcmU6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgY29sdW1uOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIHVwRGF0YUNvbHVtbjogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfQogIH0sCgogIHNldHVwKHByb3BzKSB7CiAgICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICAgIGNvbnN0IHBhcmVudCA9IGluc3RhbmNlLnBhcmVudDsKCiAgICBpZiAoIXBhcmVudC5maWx0ZXJQYW5lbHMudmFsdWVbcHJvcHMuY29sdW1uLmlkXSkgewogICAgICBwYXJlbnQuZmlsdGVyUGFuZWxzLnZhbHVlW3Byb3BzLmNvbHVtbi5pZF0gPSBpbnN0YW5jZTsKICAgIH0KCiAgICBjb25zdCB0b29sdGlwVmlzaWJsZSA9IHZ1ZS5yZWYoZmFsc2UpOwogICAgY29uc3QgdG9vbHRpcCA9IHZ1ZS5yZWYobnVsbCk7CiAgICBjb25zdCBmaWx0ZXJzID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgICAgcmV0dXJuIHByb3BzLmNvbHVtbiAmJiBwcm9wcy5jb2x1bW4uZmlsdGVyczsKICAgIH0pOwogICAgY29uc3QgZmlsdGVyVmFsdWUgPSB2dWUuY29tcHV0ZWQoewogICAgICBnZXQ6ICgpID0+IChwcm9wcy5jb2x1bW4uZmlsdGVyZWRWYWx1ZSB8fCBbXSlbMF0sCiAgICAgIHNldDogdmFsdWUgPT4gewogICAgICAgIGlmIChmaWx0ZXJlZFZhbHVlLnZhbHVlKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAidW5kZWZpbmVkIiAmJiB2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgICAgICBmaWx0ZXJlZFZhbHVlLnZhbHVlLnNwbGljZSgwLCAxLCB2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWx0ZXJlZFZhbHVlLnZhbHVlLnNwbGljZSgwLCAxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgY29uc3QgZmlsdGVyZWRWYWx1ZSA9IHZ1ZS5jb21wdXRlZCh7CiAgICAgIGdldCgpIHsKICAgICAgICBpZiAocHJvcHMuY29sdW1uKSB7CiAgICAgICAgICByZXR1cm4gcHJvcHMuY29sdW1uLmZpbHRlcmVkVmFsdWUgfHwgW107CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gW107CiAgICAgIH0sCgogICAgICBzZXQodmFsdWUpIHsKICAgICAgICBpZiAocHJvcHMuY29sdW1uKSB7CiAgICAgICAgICBwcm9wcy51cERhdGFDb2x1bW4oImZpbHRlcmVkVmFsdWUiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgfSk7CiAgICBjb25zdCBtdWx0aXBsZSA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmIChwcm9wcy5jb2x1bW4pIHsKICAgICAgICByZXR1cm4gcHJvcHMuY29sdW1uLmZpbHRlck11bHRpcGxlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwoKICAgIGNvbnN0IGlzQWN0aXZlID0gZmlsdGVyID0+IHsKICAgICAgcmV0dXJuIGZpbHRlci52YWx1ZSA9PT0gZmlsdGVyVmFsdWUudmFsdWU7CiAgICB9OwoKICAgIGNvbnN0IGhpZGRlbiA9ICgpID0+IHsKICAgICAgdG9vbHRpcFZpc2libGUudmFsdWUgPSBmYWxzZTsKICAgIH07CgogICAgY29uc3Qgc2hvd0ZpbHRlclBhbmVsID0gZSA9PiB7CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIHRvb2x0aXBWaXNpYmxlLnZhbHVlID0gIXRvb2x0aXBWaXNpYmxlLnZhbHVlOwogICAgfTsKCiAgICBjb25zdCBoaWRlRmlsdGVyUGFuZWwgPSAoKSA9PiB7CiAgICAgIHRvb2x0aXBWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICB9OwoKICAgIGNvbnN0IGhhbmRsZUNvbmZpcm0gPSAoKSA9PiB7CiAgICAgIGNvbmZpcm1GaWx0ZXIoZmlsdGVyZWRWYWx1ZS52YWx1ZSk7CiAgICAgIGhpZGRlbigpOwogICAgfTsKCiAgICBjb25zdCBoYW5kbGVSZXNldCA9ICgpID0+IHsKICAgICAgZmlsdGVyZWRWYWx1ZS52YWx1ZSA9IFtdOwogICAgICBjb25maXJtRmlsdGVyKGZpbHRlcmVkVmFsdWUudmFsdWUpOwogICAgICBoaWRkZW4oKTsKICAgIH07CgogICAgY29uc3QgaGFuZGxlU2VsZWN0ID0gX2ZpbHRlclZhbHVlID0+IHsKICAgICAgZmlsdGVyVmFsdWUudmFsdWUgPSBfZmlsdGVyVmFsdWU7CgogICAgICBpZiAodHlwZW9mIF9maWx0ZXJWYWx1ZSAhPT0gInVuZGVmaW5lZCIgJiYgX2ZpbHRlclZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgY29uZmlybUZpbHRlcihmaWx0ZXJlZFZhbHVlLnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25maXJtRmlsdGVyKFtdKTsKICAgICAgfQoKICAgICAgaGlkZGVuKCk7CiAgICB9OwoKICAgIGNvbnN0IGNvbmZpcm1GaWx0ZXIgPSBmaWx0ZXJlZFZhbHVlMiA9PiB7CiAgICAgIHByb3BzLnN0b3JlLmNvbW1pdCgiZmlsdGVyQ2hhbmdlIiwgewogICAgICAgIGNvbHVtbjogcHJvcHMuY29sdW1uLAogICAgICAgIHZhbHVlczogZmlsdGVyZWRWYWx1ZTIKICAgICAgfSk7CiAgICAgIHByb3BzLnN0b3JlLnVwZGF0ZUFsbFNlbGVjdGVkKCk7CiAgICB9OwoKICAgIHZ1ZS53YXRjaCh0b29sdGlwVmlzaWJsZSwgdmFsdWUgPT4gewogICAgICBpZiAocHJvcHMuY29sdW1uKSB7CiAgICAgICAgcHJvcHMudXBEYXRhQ29sdW1uKCJmaWx0ZXJPcGVuZWQiLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IHBvcHBlclBhbmVSZWYgPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgICB2YXIgX2E7CgogICAgICByZXR1cm4gKF9hID0gdG9vbHRpcC52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnBvcHBlclJlZjsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgdG9vbHRpcFZpc2libGUsCiAgICAgIG11bHRpcGxlLAogICAgICBmaWx0ZXJlZFZhbHVlLAogICAgICBmaWx0ZXJWYWx1ZSwKICAgICAgZmlsdGVycywKICAgICAgaGFuZGxlQ29uZmlybSwKICAgICAgaGFuZGxlUmVzZXQsCiAgICAgIGhhbmRsZVNlbGVjdCwKICAgICAgaXNBY3RpdmUsCiAgICAgIHQ6IGxvY2FsZS50LAogICAgICBzaG93RmlsdGVyUGFuZWwsCiAgICAgIGhpZGVGaWx0ZXJQYW5lbCwKICAgICAgcG9wcGVyUGFuZVJlZiwKICAgICAgdG9vbHRpcAogICAgfTsKICB9Cgp9KTsKY29uc3QgX2hvaXN0ZWRfMSA9IHsKICBrZXk6IDAKfTsKY29uc3QgX2hvaXN0ZWRfMiA9IHsKICBjbGFzczogImVsLXRhYmxlLWZpbHRlcl9fY29udGVudCIKfTsKY29uc3QgX2hvaXN0ZWRfMyA9IHsKICBjbGFzczogImVsLXRhYmxlLWZpbHRlcl9fYm90dG9tIgp9Owpjb25zdCBfaG9pc3RlZF80ID0gewogIGtleTogMSwKICBjbGFzczogImVsLXRhYmxlLWZpbHRlcl9fbGlzdCIKfTsKCmZ1bmN0aW9uIHJlbmRlcihfY3R4LCBfY2FjaGUsICRwcm9wcywgJHNldHVwLCAkZGF0YSwgJG9wdGlvbnMpIHsKICBjb25zdCBfY29tcG9uZW50X2VsX2NoZWNrYm94ID0gdnVlLnJlc29sdmVDb21wb25lbnQoImVsLWNoZWNrYm94Iik7CgogIGNvbnN0IF9jb21wb25lbnRfZWxfY2hlY2tib3hfZ3JvdXAgPSB2dWUucmVzb2x2ZUNvbXBvbmVudCgiZWwtY2hlY2tib3gtZ3JvdXAiKTsKCiAgY29uc3QgX2NvbXBvbmVudF9lbF9zY3JvbGxiYXIgPSB2dWUucmVzb2x2ZUNvbXBvbmVudCgiZWwtc2Nyb2xsYmFyIik7CgogIGNvbnN0IF9jb21wb25lbnRfZWxfcG9wcGVyID0gdnVlLnJlc29sdmVDb21wb25lbnQoImVsLXBvcHBlciIpOwoKICBjb25zdCBfZGlyZWN0aXZlX2NsaWNrX291dHNpZGUgPSB2dWUucmVzb2x2ZURpcmVjdGl2ZSgiY2xpY2stb3V0c2lkZSIpOwoKICByZXR1cm4gdnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soX2NvbXBvbmVudF9lbF9wb3BwZXIsIHsKICAgIHJlZjogInRvb2x0aXAiLAogICAgdmlzaWJsZTogX2N0eC50b29sdGlwVmlzaWJsZSwKICAgICJvblVwZGF0ZTp2aXNpYmxlIjogX2NhY2hlWzZdIHx8IChfY2FjaGVbNl0gPSAkZXZlbnQgPT4gX2N0eC50b29sdGlwVmlzaWJsZSA9ICRldmVudCksCiAgICBvZmZzZXQ6IDAsCiAgICBwbGFjZW1lbnQ6IF9jdHgucGxhY2VtZW50LAogICAgInNob3ctYXJyb3ciOiBmYWxzZSwKICAgICJzdG9wLXBvcHBlci1tb3VzZS1ldmVudCI6IGZhbHNlLAogICAgZWZmZWN0OiAibGlnaHQiLAogICAgcHVyZTogIiIsCiAgICAibWFudWFsLW1vZGUiOiAiIiwKICAgICJwb3BwZXItY2xhc3MiOiAiZWwtdGFibGUtZmlsdGVyIiwKICAgICJhcHBlbmQtdG8tYm9keSI6ICIiCiAgfSwgewogICAgZGVmYXVsdDogdnVlLndpdGhDdHgoKCkgPT4gW19jdHgubXVsdGlwbGUgPyAodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIF9ob2lzdGVkXzEsIFt2dWUuY3JlYXRlVk5vZGUoImRpdiIsIF9ob2lzdGVkXzIsIFt2dWUuY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF9zY3JvbGxiYXIsIHsKICAgICAgIndyYXAtY2xhc3MiOiAiZWwtdGFibGUtZmlsdGVyX193cmFwIgogICAgfSwgewogICAgICBkZWZhdWx0OiB2dWUud2l0aEN0eCgoKSA9PiBbdnVlLmNyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfY2hlY2tib3hfZ3JvdXAsIHsKICAgICAgICBtb2RlbFZhbHVlOiBfY3R4LmZpbHRlcmVkVmFsdWUsCiAgICAgICAgIm9uVXBkYXRlOm1vZGVsVmFsdWUiOiBfY2FjaGVbMV0gfHwgKF9jYWNoZVsxXSA9ICRldmVudCA9PiBfY3R4LmZpbHRlcmVkVmFsdWUgPSAkZXZlbnQpLAogICAgICAgIGNsYXNzOiAiZWwtdGFibGUtZmlsdGVyX19jaGVja2JveC1ncm91cCIKICAgICAgfSwgewogICAgICAgIGRlZmF1bHQ6IHZ1ZS53aXRoQ3R4KCgpID0+IFsodnVlLm9wZW5CbG9jayh0cnVlKSwgdnVlLmNyZWF0ZUJsb2NrKHZ1ZS5GcmFnbWVudCwgbnVsbCwgdnVlLnJlbmRlckxpc3QoX2N0eC5maWx0ZXJzLCBmaWx0ZXIgPT4gewogICAgICAgICAgcmV0dXJuIHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKF9jb21wb25lbnRfZWxfY2hlY2tib3gsIHsKICAgICAgICAgICAga2V5OiBmaWx0ZXIudmFsdWUsCiAgICAgICAgICAgIGxhYmVsOiBmaWx0ZXIudmFsdWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgZGVmYXVsdDogdnVlLndpdGhDdHgoKCkgPT4gW3Z1ZS5jcmVhdGVUZXh0Vk5vZGUodnVlLnRvRGlzcGxheVN0cmluZyhmaWx0ZXIudGV4dCksIDEpXSksCiAgICAgICAgICAgIF86IDIKICAgICAgICAgIH0sIDEwMzIsIFsibGFiZWwiXSk7CiAgICAgICAgfSksIDEyOCkpXSksCiAgICAgICAgXzogMQogICAgICB9LCA4LCBbIm1vZGVsVmFsdWUiXSldKSwKICAgICAgXzogMQogICAgfSldKSwgdnVlLmNyZWF0ZVZOb2RlKCJkaXYiLCBfaG9pc3RlZF8zLCBbdnVlLmNyZWF0ZVZOb2RlKCJidXR0b24iLCB7CiAgICAgIGNsYXNzOiB7CiAgICAgICAgImlzLWRpc2FibGVkIjogX2N0eC5maWx0ZXJlZFZhbHVlLmxlbmd0aCA9PT0gMAogICAgICB9LAogICAgICBkaXNhYmxlZDogX2N0eC5maWx0ZXJlZFZhbHVlLmxlbmd0aCA9PT0gMCwKICAgICAgdHlwZTogIiIsCiAgICAgIG9uQ2xpY2s6IF9jYWNoZVsyXSB8fCAoX2NhY2hlWzJdID0gKC4uLmFyZ3MpID0+IF9jdHguaGFuZGxlQ29uZmlybSAmJiBfY3R4LmhhbmRsZUNvbmZpcm0oLi4uYXJncykpCiAgICB9LCB2dWUudG9EaXNwbGF5U3RyaW5nKF9jdHgudCgiZWwudGFibGUuY29uZmlybUZpbHRlciIpKSwgMTEsIFsiZGlzYWJsZWQiXSksIHZ1ZS5jcmVhdGVWTm9kZSgiYnV0dG9uIiwgewogICAgICB0eXBlOiAiIiwKICAgICAgb25DbGljazogX2NhY2hlWzNdIHx8IChfY2FjaGVbM10gPSAoLi4uYXJncykgPT4gX2N0eC5oYW5kbGVSZXNldCAmJiBfY3R4LmhhbmRsZVJlc2V0KC4uLmFyZ3MpKQogICAgfSwgdnVlLnRvRGlzcGxheVN0cmluZyhfY3R4LnQoImVsLnRhYmxlLnJlc2V0RmlsdGVyIikpLCAxKV0pXSkpIDogKHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKCJ1bCIsIF9ob2lzdGVkXzQsIFt2dWUuY3JlYXRlVk5vZGUoImxpIiwgewogICAgICBjbGFzczogW3sKICAgICAgICAiaXMtYWN0aXZlIjogX2N0eC5maWx0ZXJWYWx1ZSA9PT0gdm9pZCAwIHx8IF9jdHguZmlsdGVyVmFsdWUgPT09IG51bGwKICAgICAgfSwgImVsLXRhYmxlLWZpbHRlcl9fbGlzdC1pdGVtIl0sCiAgICAgIG9uQ2xpY2s6IF9jYWNoZVs0XSB8fCAoX2NhY2hlWzRdID0gJGV2ZW50ID0+IF9jdHguaGFuZGxlU2VsZWN0KG51bGwpKQogICAgfSwgdnVlLnRvRGlzcGxheVN0cmluZyhfY3R4LnQoImVsLnRhYmxlLmNsZWFyRmlsdGVyIikpLCAzKSwgKHZ1ZS5vcGVuQmxvY2sodHJ1ZSksIHZ1ZS5jcmVhdGVCbG9jayh2dWUuRnJhZ21lbnQsIG51bGwsIHZ1ZS5yZW5kZXJMaXN0KF9jdHguZmlsdGVycywgZmlsdGVyID0+IHsKICAgICAgcmV0dXJuIHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKCJsaSIsIHsKICAgICAgICBrZXk6IGZpbHRlci52YWx1ZSwKICAgICAgICBjbGFzczogW3sKICAgICAgICAgICJpcy1hY3RpdmUiOiBfY3R4LmlzQWN0aXZlKGZpbHRlcikKICAgICAgICB9LCAiZWwtdGFibGUtZmlsdGVyX19saXN0LWl0ZW0iXSwKICAgICAgICBsYWJlbDogZmlsdGVyLnZhbHVlLAogICAgICAgIG9uQ2xpY2s6ICRldmVudCA9PiBfY3R4LmhhbmRsZVNlbGVjdChmaWx0ZXIudmFsdWUpCiAgICAgIH0sIHZ1ZS50b0Rpc3BsYXlTdHJpbmcoZmlsdGVyLnRleHQpLCAxMSwgWyJsYWJlbCIsICJvbkNsaWNrIl0pOwogICAgfSksIDEyOCkpXSkpXSksCiAgICB0cmlnZ2VyOiB2dWUud2l0aEN0eCgoKSA9PiBbdnVlLndpdGhEaXJlY3RpdmVzKHZ1ZS5jcmVhdGVWTm9kZSgic3BhbiIsIHsKICAgICAgY2xhc3M6ICJlbC10YWJsZV9fY29sdW1uLWZpbHRlci10cmlnZ2VyIGVsLW5vbmUtb3V0bGluZSIsCiAgICAgIG9uQ2xpY2s6IF9jYWNoZVs1XSB8fCAoX2NhY2hlWzVdID0gKC4uLmFyZ3MpID0+IF9jdHguc2hvd0ZpbHRlclBhbmVsICYmIF9jdHguc2hvd0ZpbHRlclBhbmVsKC4uLmFyZ3MpKQogICAgfSwgW3Z1ZS5jcmVhdGVWTm9kZSgiaSIsIHsKICAgICAgY2xhc3M6IFsiZWwtaWNvbi1hcnJvdy1kb3duIiwgX2N0eC5jb2x1bW4uZmlsdGVyT3BlbmVkID8gImVsLWljb24tYXJyb3ctdXAiIDogIiJdCiAgICB9LCBudWxsLCAyKV0sIDUxMiksIFtbX2RpcmVjdGl2ZV9jbGlja19vdXRzaWRlLCBfY3R4LmhpZGVGaWx0ZXJQYW5lbCwgX2N0eC5wb3BwZXJQYW5lUmVmXV0pXSksCiAgICBfOiAxCiAgfSwgOCwgWyJ2aXNpYmxlIiwgInBsYWNlbWVudCJdKTsKfQoKc2NyaXB0LnJlbmRlciA9IHJlbmRlcjsKc2NyaXB0Ll9fZmlsZSA9ICJwYWNrYWdlcy90YWJsZS9zcmMvZmlsdGVyLXBhbmVsLnZ1ZSI7CgpmdW5jdGlvbiB1c2VMYXlvdXRPYnNlcnZlcihyb290KSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgdnVlLm9uQmVmb3JlTW91bnQoKCkgPT4gewogICAgdGFibGVMYXlvdXQudmFsdWUuYWRkT2JzZXJ2ZXIoaW5zdGFuY2UpOwogIH0pOwogIHZ1ZS5vbk1vdW50ZWQoKCkgPT4gewogICAgb25Db2x1bW5zQ2hhbmdlKHRhYmxlTGF5b3V0LnZhbHVlKTsKICAgIG9uU2Nyb2xsYWJsZUNoYW5nZSh0YWJsZUxheW91dC52YWx1ZSk7CiAgfSk7CiAgdnVlLm9uVXBkYXRlZCgoKSA9PiB7CiAgICBvbkNvbHVtbnNDaGFuZ2UodGFibGVMYXlvdXQudmFsdWUpOwogICAgb25TY3JvbGxhYmxlQ2hhbmdlKHRhYmxlTGF5b3V0LnZhbHVlKTsKICB9KTsKICB2dWUub25Vbm1vdW50ZWQoKCkgPT4gewogICAgdGFibGVMYXlvdXQudmFsdWUucmVtb3ZlT2JzZXJ2ZXIoaW5zdGFuY2UpOwogIH0pOwogIGNvbnN0IHRhYmxlTGF5b3V0ID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIGNvbnN0IGxheW91dCA9IHJvb3QubGF5b3V0OwoKICAgIGlmICghbGF5b3V0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuIG5vdCBmaW5kIHRhYmxlIGxheW91dC4iKTsKICAgIH0KCiAgICByZXR1cm4gbGF5b3V0OwogIH0pOwoKICBjb25zdCBvbkNvbHVtbnNDaGFuZ2UgPSBsYXlvdXQgPT4gewogICAgdmFyIF9hOwoKICAgIGNvbnN0IGNvbHMgPSAoKF9hID0gcm9vdC52bm9kZS5lbCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3JBbGwoImNvbGdyb3VwID4gY29sIikpIHx8IFtdOwogICAgaWYgKCFjb2xzLmxlbmd0aCkgcmV0dXJuOwogICAgY29uc3QgZmxhdHRlbkNvbHVtbnMgPSBsYXlvdXQuZ2V0RmxhdHRlbkNvbHVtbnMoKTsKICAgIGNvbnN0IGNvbHVtbnNNYXAgPSB7fTsKICAgIGZsYXR0ZW5Db2x1bW5zLmZvckVhY2goY29sdW1uID0+IHsKICAgICAgY29sdW1uc01hcFtjb2x1bW4uaWRdID0gY29sdW1uOwogICAgfSk7CgogICAgZm9yIChsZXQgaSA9IDAsIGogPSBjb2xzLmxlbmd0aDsgaSA8IGo7IGkrKykgewogICAgICBjb25zdCBjb2wgPSBjb2xzW2ldOwogICAgICBjb25zdCBuYW1lID0gY29sLmdldEF0dHJpYnV0ZSgibmFtZSIpOwogICAgICBjb25zdCBjb2x1bW4gPSBjb2x1bW5zTWFwW25hbWVdOwoKICAgICAgaWYgKGNvbHVtbikgewogICAgICAgIGNvbC5zZXRBdHRyaWJ1dGUoIndpZHRoIiwgY29sdW1uLnJlYWxXaWR0aCB8fCBjb2x1bW4ud2lkdGgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgY29uc3Qgb25TY3JvbGxhYmxlQ2hhbmdlID0gbGF5b3V0ID0+IHsKICAgIGNvbnN0IGNvbHMgPSByb290LnZub2RlLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoImNvbGdyb3VwID4gY29sW25hbWU9Z3V0dGVyXSIpOwoKICAgIGZvciAobGV0IGkgPSAwLCBqID0gY29scy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgY29uc3QgY29sID0gY29sc1tpXTsKICAgICAgY29sLnNldEF0dHJpYnV0ZSgid2lkdGgiLCBsYXlvdXQuc2Nyb2xsWS52YWx1ZSA/IGxheW91dC5ndXR0ZXJXaWR0aCA6ICIwIik7CiAgICB9CgogICAgY29uc3QgdGhzID0gcm9vdC52bm9kZS5lbC5xdWVyeVNlbGVjdG9yQWxsKCJ0aC5ndXR0ZXIiKTsKCiAgICBmb3IgKGxldCBpID0gMCwgaiA9IHRocy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgY29uc3QgdGggPSB0aHNbaV07CiAgICAgIHRoLnN0eWxlLndpZHRoID0gbGF5b3V0LnNjcm9sbFkudmFsdWUgPyBsYXlvdXQuZ3V0dGVyV2lkdGggKyAicHgiIDogIjAiOwogICAgICB0aC5zdHlsZS5kaXNwbGF5ID0gbGF5b3V0LnNjcm9sbFkudmFsdWUgPyAiIiA6ICJub25lIjsKICAgIH0KICB9OwoKICByZXR1cm4gewogICAgdGFibGVMYXlvdXQ6IHRhYmxlTGF5b3V0LnZhbHVlLAogICAgb25Db2x1bW5zQ2hhbmdlLAogICAgb25TY3JvbGxhYmxlQ2hhbmdlCiAgfTsKfQoKZnVuY3Rpb24gdXNlRXZlbnQocHJvcHMsIGVtaXQpIHsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBwYXJlbnQgPSBpbnN0YW5jZS5wYXJlbnQ7CgogIGNvbnN0IGhhbmRsZUZpbHRlckNsaWNrID0gZXZlbnQgPT4gewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICByZXR1cm47CiAgfTsKCiAgY29uc3QgaGFuZGxlSGVhZGVyQ2xpY2sgPSAoZXZlbnQsIGNvbHVtbikgPT4gewogICAgaWYgKCFjb2x1bW4uZmlsdGVycyAmJiBjb2x1bW4uc29ydGFibGUpIHsKICAgICAgaGFuZGxlU29ydENsaWNrKGV2ZW50LCBjb2x1bW4sIGZhbHNlKTsKICAgIH0gZWxzZSBpZiAoY29sdW1uLmZpbHRlcmFibGUgJiYgIWNvbHVtbi5zb3J0YWJsZSkgewogICAgICBoYW5kbGVGaWx0ZXJDbGljayhldmVudCk7CiAgICB9CgogICAgcGFyZW50LmVtaXQoImhlYWRlci1jbGljayIsIGNvbHVtbiwgZXZlbnQpOwogIH07CgogIGNvbnN0IGhhbmRsZUhlYWRlckNvbnRleHRNZW51ID0gKGV2ZW50LCBjb2x1bW4pID0+IHsKICAgIHBhcmVudC5lbWl0KCJoZWFkZXItY29udGV4dG1lbnUiLCBjb2x1bW4sIGV2ZW50KTsKICB9OwoKICBjb25zdCBkcmFnZ2luZ0NvbHVtbiA9IHZ1ZS5yZWYobnVsbCk7CiAgY29uc3QgZHJhZ2dpbmcgPSB2dWUucmVmKGZhbHNlKTsKICBjb25zdCBkcmFnU3RhdGUgPSB2dWUucmVmKHt9KTsKCiAgY29uc3QgaGFuZGxlTW91c2VEb3duID0gKGV2ZW50LCBjb2x1bW4pID0+IHsKICAgIGlmIChpc1NlcnZlcl9fZGVmYXVsdFsnZGVmYXVsdCddKSByZXR1cm47CiAgICBpZiAoY29sdW1uLmNoaWxkcmVuICYmIGNvbHVtbi5jaGlsZHJlbi5sZW5ndGggPiAwKSByZXR1cm47CgogICAgaWYgKGRyYWdnaW5nQ29sdW1uLnZhbHVlICYmIHByb3BzLmJvcmRlcikgewogICAgICBkcmFnZ2luZy52YWx1ZSA9IHRydWU7CiAgICAgIGNvbnN0IHRhYmxlID0gcGFyZW50OwogICAgICBlbWl0KCJzZXQtZHJhZy12aXNpYmxlIiwgdHJ1ZSk7CiAgICAgIGNvbnN0IHRhYmxlRWwgPSB0YWJsZS52bm9kZS5lbDsKICAgICAgY29uc3QgdGFibGVMZWZ0ID0gdGFibGVFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0OwogICAgICBjb25zdCBjb2x1bW5FbCA9IGluc3RhbmNlLnZub2RlLmVsLnF1ZXJ5U2VsZWN0b3IoYHRoLiR7Y29sdW1uLmlkfWApOwogICAgICBjb25zdCBjb2x1bW5SZWN0ID0gY29sdW1uRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIGNvbnN0IG1pbkxlZnQgPSBjb2x1bW5SZWN0LmxlZnQgLSB0YWJsZUxlZnQgKyAzMDsKICAgICAgZG9tLmFkZENsYXNzKGNvbHVtbkVsLCAibm9jbGljayIpOwogICAgICBkcmFnU3RhdGUudmFsdWUgPSB7CiAgICAgICAgc3RhcnRNb3VzZUxlZnQ6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgc3RhcnRMZWZ0OiBjb2x1bW5SZWN0LnJpZ2h0IC0gdGFibGVMZWZ0LAogICAgICAgIHN0YXJ0Q29sdW1uTGVmdDogY29sdW1uUmVjdC5sZWZ0IC0gdGFibGVMZWZ0LAogICAgICAgIHRhYmxlTGVmdAogICAgICB9OwogICAgICBjb25zdCByZXNpemVQcm94eSA9IHRhYmxlLnJlZnMucmVzaXplUHJveHk7CiAgICAgIHJlc2l6ZVByb3h5LnN0eWxlLmxlZnQgPSBkcmFnU3RhdGUudmFsdWUuc3RhcnRMZWZ0ICsgInB4IjsKCiAgICAgIGRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwoKICAgICAgZG9jdW1lbnQub25kcmFnc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwoKICAgICAgY29uc3QgaGFuZGxlTW91c2VNb3ZlMiA9IGV2ZW50MiA9PiB7CiAgICAgICAgY29uc3QgZGVsdGFMZWZ0ID0gZXZlbnQyLmNsaWVudFggLSBkcmFnU3RhdGUudmFsdWUuc3RhcnRNb3VzZUxlZnQ7CiAgICAgICAgY29uc3QgcHJveHlMZWZ0ID0gZHJhZ1N0YXRlLnZhbHVlLnN0YXJ0TGVmdCArIGRlbHRhTGVmdDsKICAgICAgICByZXNpemVQcm94eS5zdHlsZS5sZWZ0ID0gTWF0aC5tYXgobWluTGVmdCwgcHJveHlMZWZ0KSArICJweCI7CiAgICAgIH07CgogICAgICBjb25zdCBoYW5kbGVNb3VzZVVwID0gKCkgPT4gewogICAgICAgIGlmIChkcmFnZ2luZy52YWx1ZSkgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBzdGFydENvbHVtbkxlZnQsCiAgICAgICAgICAgIHN0YXJ0TGVmdAogICAgICAgICAgfSA9IGRyYWdTdGF0ZS52YWx1ZTsKICAgICAgICAgIGNvbnN0IGZpbmFsTGVmdCA9IHBhcnNlSW50KHJlc2l6ZVByb3h5LnN0eWxlLmxlZnQsIDEwKTsKICAgICAgICAgIGNvbnN0IGNvbHVtbldpZHRoID0gZmluYWxMZWZ0IC0gc3RhcnRDb2x1bW5MZWZ0OwogICAgICAgICAgY29sdW1uLndpZHRoID0gY29sdW1uLnJlYWxXaWR0aCA9IGNvbHVtbldpZHRoOwogICAgICAgICAgdGFibGUuZW1pdCgiaGVhZGVyLWRyYWdlbmQiLCBjb2x1bW4ud2lkdGgsIHN0YXJ0TGVmdCAtIHN0YXJ0Q29sdW1uTGVmdCwgY29sdW1uLCBldmVudCk7CiAgICAgICAgICBwcm9wcy5zdG9yZS5zY2hlZHVsZUxheW91dChmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICIiOwogICAgICAgICAgZHJhZ2dpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIGRyYWdnaW5nQ29sdW1uLnZhbHVlID0gbnVsbDsKICAgICAgICAgIGRyYWdTdGF0ZS52YWx1ZSA9IHt9OwogICAgICAgICAgZW1pdCgic2V0LWRyYWctdmlzaWJsZSIsIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGhhbmRsZU1vdXNlTW92ZTIpOwogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBoYW5kbGVNb3VzZVVwKTsKICAgICAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gbnVsbDsKICAgICAgICBkb2N1bWVudC5vbmRyYWdzdGFydCA9IG51bGw7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkb20ucmVtb3ZlQ2xhc3MoY29sdW1uRWwsICJub2NsaWNrIik7CiAgICAgICAgfSwgMCk7CiAgICAgIH07CgogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBoYW5kbGVNb3VzZU1vdmUyKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIGhhbmRsZU1vdXNlVXApOwogICAgfQogIH07CgogIGNvbnN0IGhhbmRsZU1vdXNlTW92ZSA9IChldmVudCwgY29sdW1uKSA9PiB7CiAgICBpZiAoY29sdW1uLmNoaWxkcmVuICYmIGNvbHVtbi5jaGlsZHJlbi5sZW5ndGggPiAwKSByZXR1cm47CiAgICBsZXQgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKICAgIHdoaWxlICh0YXJnZXQgJiYgdGFyZ2V0LnRhZ05hbWUgIT09ICJUSCIpIHsKICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7CiAgICB9CgogICAgaWYgKCFjb2x1bW4gfHwgIWNvbHVtbi5yZXNpemFibGUpIHJldHVybjsKCiAgICBpZiAoIWRyYWdnaW5nLnZhbHVlICYmIHByb3BzLmJvcmRlcikgewogICAgICBjb25zdCByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBjb25zdCBib2R5U3R5bGUgPSBkb2N1bWVudC5ib2R5LnN0eWxlOwoKICAgICAgaWYgKHJlY3Qud2lkdGggPiAxMiAmJiByZWN0LnJpZ2h0IC0gZXZlbnQucGFnZVggPCA4KSB7CiAgICAgICAgYm9keVN0eWxlLmN1cnNvciA9ICJjb2wtcmVzaXplIjsKCiAgICAgICAgaWYgKGRvbS5oYXNDbGFzcyh0YXJnZXQsICJpcy1zb3J0YWJsZSIpKSB7CiAgICAgICAgICB0YXJnZXQuc3R5bGUuY3Vyc29yID0gImNvbC1yZXNpemUiOwogICAgICAgIH0KCiAgICAgICAgZHJhZ2dpbmdDb2x1bW4udmFsdWUgPSBjb2x1bW47CiAgICAgIH0gZWxzZSBpZiAoIWRyYWdnaW5nLnZhbHVlKSB7CiAgICAgICAgYm9keVN0eWxlLmN1cnNvciA9ICIiOwoKICAgICAgICBpZiAoZG9tLmhhc0NsYXNzKHRhcmdldCwgImlzLXNvcnRhYmxlIikpIHsKICAgICAgICAgIHRhcmdldC5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7CiAgICAgICAgfQoKICAgICAgICBkcmFnZ2luZ0NvbHVtbi52YWx1ZSA9IG51bGw7CiAgICAgIH0KICAgIH0KICB9OwoKICBjb25zdCBoYW5kbGVNb3VzZU91dCA9ICgpID0+IHsKICAgIGlmIChpc1NlcnZlcl9fZGVmYXVsdFsnZGVmYXVsdCddKSByZXR1cm47CiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICIiOwogIH07CgogIGNvbnN0IHRvZ2dsZU9yZGVyID0gKHsKICAgIG9yZGVyLAogICAgc29ydE9yZGVycwogIH0pID0+IHsKICAgIGlmIChvcmRlciA9PT0gIiIpIHJldHVybiBzb3J0T3JkZXJzWzBdOwogICAgY29uc3QgaW5kZXggPSBzb3J0T3JkZXJzLmluZGV4T2Yob3JkZXIgfHwgbnVsbCk7CiAgICByZXR1cm4gc29ydE9yZGVyc1tpbmRleCA+IHNvcnRPcmRlcnMubGVuZ3RoIC0gMiA/IDAgOiBpbmRleCArIDFdOwogIH07CgogIGNvbnN0IGhhbmRsZVNvcnRDbGljayA9IChldmVudCwgY29sdW1uLCBnaXZlbk9yZGVyKSA9PiB7CiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIGNvbnN0IG9yZGVyID0gY29sdW1uLm9yZGVyID09PSBnaXZlbk9yZGVyID8gbnVsbCA6IGdpdmVuT3JkZXIgfHwgdG9nZ2xlT3JkZXIoY29sdW1uKTsKICAgIGxldCB0YXJnZXQgPSBldmVudC50YXJnZXQ7CgogICAgd2hpbGUgKHRhcmdldCAmJiB0YXJnZXQudGFnTmFtZSAhPT0gIlRIIikgewogICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTsKICAgIH0KCiAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC50YWdOYW1lID09PSAiVEgiKSB7CiAgICAgIGlmIChkb20uaGFzQ2xhc3ModGFyZ2V0LCAibm9jbGljayIpKSB7CiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKHRhcmdldCwgIm5vY2xpY2siKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIWNvbHVtbi5zb3J0YWJsZSkgcmV0dXJuOwogICAgY29uc3Qgc3RhdGVzID0gcHJvcHMuc3RvcmUuc3RhdGVzOwogICAgbGV0IHNvcnRQcm9wID0gc3RhdGVzLnNvcnRQcm9wLnZhbHVlOwogICAgbGV0IHNvcnRPcmRlcjsKICAgIGNvbnN0IHNvcnRpbmdDb2x1bW4gPSBzdGF0ZXMuc29ydGluZ0NvbHVtbi52YWx1ZTsKCiAgICBpZiAoc29ydGluZ0NvbHVtbiAhPT0gY29sdW1uIHx8IHNvcnRpbmdDb2x1bW4gPT09IGNvbHVtbiAmJiBzb3J0aW5nQ29sdW1uLm9yZGVyID09PSBudWxsKSB7CiAgICAgIGlmIChzb3J0aW5nQ29sdW1uKSB7CiAgICAgICAgc29ydGluZ0NvbHVtbi5vcmRlciA9IG51bGw7CiAgICAgIH0KCiAgICAgIHN0YXRlcy5zb3J0aW5nQ29sdW1uLnZhbHVlID0gY29sdW1uOwogICAgICBzb3J0UHJvcCA9IGNvbHVtbi5wcm9wZXJ0eTsKICAgIH0KCiAgICBpZiAoIW9yZGVyKSB7CiAgICAgIHNvcnRPcmRlciA9IGNvbHVtbi5vcmRlciA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBzb3J0T3JkZXIgPSBjb2x1bW4ub3JkZXIgPSBvcmRlcjsKICAgIH0KCiAgICBzdGF0ZXMuc29ydFByb3AudmFsdWUgPSBzb3J0UHJvcDsKICAgIHN0YXRlcy5zb3J0T3JkZXIudmFsdWUgPSBzb3J0T3JkZXI7CiAgICBwYXJlbnQuc3RvcmUuY29tbWl0KCJjaGFuZ2VTb3J0Q29uZGl0aW9uIik7CiAgfTsKCiAgcmV0dXJuIHsKICAgIGhhbmRsZUhlYWRlckNsaWNrLAogICAgaGFuZGxlSGVhZGVyQ29udGV4dE1lbnUsCiAgICBoYW5kbGVNb3VzZURvd24sCiAgICBoYW5kbGVNb3VzZU1vdmUsCiAgICBoYW5kbGVNb3VzZU91dCwKICAgIGhhbmRsZVNvcnRDbGljaywKICAgIGhhbmRsZUZpbHRlckNsaWNrCiAgfTsKfQoKZnVuY3Rpb24gdXNlU3R5bGUocHJvcHMpIHsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBwYXJlbnQgPSBpbnN0YW5jZS5wYXJlbnQ7CiAgY29uc3Qgc3RvcmVEYXRhID0gcGFyZW50LnN0b3JlLnN0YXRlczsKCiAgY29uc3QgaXNDZWxsSGlkZGVuID0gKGluZGV4LCBjb2x1bW5zKSA9PiB7CiAgICBsZXQgc3RhcnQgPSAwOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXg7IGkrKykgewogICAgICBzdGFydCArPSBjb2x1bW5zW2ldLmNvbFNwYW47CiAgICB9CgogICAgY29uc3QgYWZ0ZXIgPSBzdGFydCArIGNvbHVtbnNbaW5kZXhdLmNvbFNwYW4gLSAxOwoKICAgIGlmIChwcm9wcy5maXhlZCA9PT0gImxlZnQiKSB7CiAgICAgIHJldHVybiBhZnRlciA+PSBzdG9yZURhdGEuZml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZTsKICAgIH0gZWxzZSBpZiAocHJvcHMuZml4ZWQgPT09ICJyaWdodCIpIHsKICAgICAgcmV0dXJuIHN0YXJ0IDwgc3RvcmVEYXRhLmNvbHVtbnMudmFsdWUubGVuZ3RoIC0gc3RvcmVEYXRhLnJpZ2h0Rml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBhZnRlciA8IHN0b3JlRGF0YS5maXhlZExlYWZDb2x1bW5zTGVuZ3RoLnZhbHVlIHx8IHN0YXJ0ID49IHN0b3JlRGF0YS5jb2x1bW5zLnZhbHVlLmxlbmd0aCAtIHN0b3JlRGF0YS5yaWdodEZpeGVkTGVhZkNvbHVtbnNMZW5ndGgudmFsdWU7CiAgICB9CiAgfTsKCiAgY29uc3QgZ2V0SGVhZGVyUm93U3R5bGUgPSByb3dJbmRleCA9PiB7CiAgICBjb25zdCBoZWFkZXJSb3dTdHlsZSA9IHBhcmVudC5wcm9wcy5oZWFkZXJSb3dTdHlsZTsKCiAgICBpZiAodHlwZW9mIGhlYWRlclJvd1N0eWxlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHJldHVybiBoZWFkZXJSb3dTdHlsZS5jYWxsKG51bGwsIHsKICAgICAgICByb3dJbmRleAogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gaGVhZGVyUm93U3R5bGU7CiAgfTsKCiAgY29uc3QgZ2V0SGVhZGVyUm93Q2xhc3MgPSByb3dJbmRleCA9PiB7CiAgICBjb25zdCBjbGFzc2VzID0gW107CiAgICBjb25zdCBoZWFkZXJSb3dDbGFzc05hbWUgPSBwYXJlbnQucHJvcHMuaGVhZGVyUm93Q2xhc3NOYW1lOwoKICAgIGlmICh0eXBlb2YgaGVhZGVyUm93Q2xhc3NOYW1lID09PSAic3RyaW5nIikgewogICAgICBjbGFzc2VzLnB1c2goaGVhZGVyUm93Q2xhc3NOYW1lKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGhlYWRlclJvd0NsYXNzTmFtZSA9PT0gImZ1bmN0aW9uIikgewogICAgICBjbGFzc2VzLnB1c2goaGVhZGVyUm93Q2xhc3NOYW1lLmNhbGwobnVsbCwgewogICAgICAgIHJvd0luZGV4CiAgICAgIH0pKTsKICAgIH0KCiAgICByZXR1cm4gY2xhc3Nlcy5qb2luKCIgIik7CiAgfTsKCiAgY29uc3QgZ2V0SGVhZGVyQ2VsbFN0eWxlID0gKHJvd0luZGV4LCBjb2x1bW5JbmRleCwgcm93LCBjb2x1bW4pID0+IHsKICAgIGNvbnN0IGhlYWRlckNlbGxTdHlsZSA9IHBhcmVudC5wcm9wcy5oZWFkZXJDZWxsU3R5bGU7CgogICAgaWYgKHR5cGVvZiBoZWFkZXJDZWxsU3R5bGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIGhlYWRlckNlbGxTdHlsZS5jYWxsKG51bGwsIHsKICAgICAgICByb3dJbmRleCwKICAgICAgICBjb2x1bW5JbmRleCwKICAgICAgICByb3csCiAgICAgICAgY29sdW1uCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBoZWFkZXJDZWxsU3R5bGU7CiAgfTsKCiAgY29uc3QgZ2V0SGVhZGVyQ2VsbENsYXNzID0gKHJvd0luZGV4LCBjb2x1bW5JbmRleCwgcm93LCBjb2x1bW4pID0+IHsKICAgIGNvbnN0IGNsYXNzZXMgPSBbY29sdW1uLmlkLCBjb2x1bW4ub3JkZXIsIGNvbHVtbi5oZWFkZXJBbGlnbiwgY29sdW1uLmNsYXNzTmFtZSwgY29sdW1uLmxhYmVsQ2xhc3NOYW1lXTsKCiAgICBpZiAocm93SW5kZXggPT09IDAgJiYgaXNDZWxsSGlkZGVuKGNvbHVtbkluZGV4LCByb3cpKSB7CiAgICAgIGNsYXNzZXMucHVzaCgiaXMtaGlkZGVuIik7CiAgICB9CgogICAgaWYgKCFjb2x1bW4uY2hpbGRyZW4pIHsKICAgICAgY2xhc3Nlcy5wdXNoKCJpcy1sZWFmIik7CiAgICB9CgogICAgaWYgKGNvbHVtbi5zb3J0YWJsZSkgewogICAgICBjbGFzc2VzLnB1c2goImlzLXNvcnRhYmxlIik7CiAgICB9CgogICAgY29uc3QgaGVhZGVyQ2VsbENsYXNzTmFtZSA9IHBhcmVudC5wcm9wcy5oZWFkZXJDZWxsQ2xhc3NOYW1lOwoKICAgIGlmICh0eXBlb2YgaGVhZGVyQ2VsbENsYXNzTmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgY2xhc3Nlcy5wdXNoKGhlYWRlckNlbGxDbGFzc05hbWUpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgaGVhZGVyQ2VsbENsYXNzTmFtZSA9PT0gImZ1bmN0aW9uIikgewogICAgICBjbGFzc2VzLnB1c2goaGVhZGVyQ2VsbENsYXNzTmFtZS5jYWxsKG51bGwsIHsKICAgICAgICByb3dJbmRleCwKICAgICAgICBjb2x1bW5JbmRleCwKICAgICAgICByb3csCiAgICAgICAgY29sdW1uCiAgICAgIH0pKTsKICAgIH0KCiAgICByZXR1cm4gY2xhc3Nlcy5qb2luKCIgIik7CiAgfTsKCiAgcmV0dXJuIHsKICAgIGdldEhlYWRlclJvd1N0eWxlLAogICAgZ2V0SGVhZGVyUm93Q2xhc3MsCiAgICBnZXRIZWFkZXJDZWxsU3R5bGUsCiAgICBnZXRIZWFkZXJDZWxsQ2xhc3MKICB9Owp9Cgpjb25zdCBnZXRBbGxDb2x1bW5zID0gY29sdW1ucyA9PiB7CiAgY29uc3QgcmVzdWx0ID0gW107CiAgY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7CiAgICBpZiAoY29sdW1uLmNoaWxkcmVuKSB7CiAgICAgIHJlc3VsdC5wdXNoKGNvbHVtbik7CiAgICAgIHJlc3VsdC5wdXNoLmFwcGx5KHJlc3VsdCwgZ2V0QWxsQ29sdW1ucyhjb2x1bW4uY2hpbGRyZW4pKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc3VsdC5wdXNoKGNvbHVtbik7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlc3VsdDsKfTsKCmNvbnN0IGNvbnZlcnRUb1Jvd3MgPSBvcmlnaW5Db2x1bW5zID0+IHsKICBsZXQgbWF4TGV2ZWwgPSAxOwoKICBjb25zdCB0cmF2ZXJzZSA9IChjb2x1bW4sIHBhcmVudCkgPT4gewogICAgaWYgKHBhcmVudCkgewogICAgICBjb2x1bW4ubGV2ZWwgPSBwYXJlbnQubGV2ZWwgKyAxOwoKICAgICAgaWYgKG1heExldmVsIDwgY29sdW1uLmxldmVsKSB7CiAgICAgICAgbWF4TGV2ZWwgPSBjb2x1bW4ubGV2ZWw7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoY29sdW1uLmNoaWxkcmVuKSB7CiAgICAgIGxldCBjb2xTcGFuID0gMDsKICAgICAgY29sdW1uLmNoaWxkcmVuLmZvckVhY2goc3ViQ29sdW1uID0+IHsKICAgICAgICB0cmF2ZXJzZShzdWJDb2x1bW4sIGNvbHVtbik7CiAgICAgICAgY29sU3BhbiArPSBzdWJDb2x1bW4uY29sU3BhbjsKICAgICAgfSk7CiAgICAgIGNvbHVtbi5jb2xTcGFuID0gY29sU3BhbjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbHVtbi5jb2xTcGFuID0gMTsKICAgIH0KICB9OwoKICBvcmlnaW5Db2x1bW5zLmZvckVhY2goY29sdW1uID0+IHsKICAgIGNvbHVtbi5sZXZlbCA9IDE7CiAgICB0cmF2ZXJzZShjb2x1bW4sIHZvaWQgMCk7CiAgfSk7CiAgY29uc3Qgcm93cyA9IFtdOwoKICBmb3IgKGxldCBpID0gMDsgaSA8IG1heExldmVsOyBpKyspIHsKICAgIHJvd3MucHVzaChbXSk7CiAgfQoKICBjb25zdCBhbGxDb2x1bW5zID0gZ2V0QWxsQ29sdW1ucyhvcmlnaW5Db2x1bW5zKTsKICBhbGxDb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHsKICAgIGlmICghY29sdW1uLmNoaWxkcmVuKSB7CiAgICAgIGNvbHVtbi5yb3dTcGFuID0gbWF4TGV2ZWwgLSBjb2x1bW4ubGV2ZWwgKyAxOwogICAgfSBlbHNlIHsKICAgICAgY29sdW1uLnJvd1NwYW4gPSAxOwogICAgfQoKICAgIHJvd3NbY29sdW1uLmxldmVsIC0gMV0ucHVzaChjb2x1bW4pOwogIH0pOwogIHJldHVybiByb3dzOwp9OwoKZnVuY3Rpb24gdXNlVXRpbHMocHJvcHMpIHsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBwYXJlbnQgPSBpbnN0YW5jZS5wYXJlbnQ7CiAgY29uc3QgY29sdW1uUm93cyA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICByZXR1cm4gY29udmVydFRvUm93cyhwcm9wcy5zdG9yZS5zdGF0ZXMub3JpZ2luQ29sdW1ucy52YWx1ZSk7CiAgfSk7CiAgY29uc3QgaXNHcm91cCA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICBjb25zdCByZXN1bHQgPSBjb2x1bW5Sb3dzLnZhbHVlLmxlbmd0aCA+IDE7CiAgICBpZiAocmVzdWx0KSBwYXJlbnQuc3RhdGUuaXNHcm91cC52YWx1ZSA9IHRydWU7CiAgICByZXR1cm4gcmVzdWx0OwogIH0pOwoKICBjb25zdCB0b2dnbGVBbGxTZWxlY3Rpb24gPSBldmVudCA9PiB7CiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIHBhcmVudC5zdG9yZS5jb21taXQoInRvZ2dsZUFsbFNlbGVjdGlvbiIpOwogIH07CgogIHJldHVybiB7CiAgICBpc0dyb3VwLAogICAgdG9nZ2xlQWxsU2VsZWN0aW9uLAogICAgY29sdW1uUm93cwogIH07Cn0KCmZ1bmN0aW9uIGhHdXR0ZXIoKSB7CiAgcmV0dXJuIHZ1ZS5oKCJjb2wiLCB7CiAgICBuYW1lOiAiZ3V0dGVyIgogIH0pOwp9CgpmdW5jdGlvbiBoQ29sZ3JvdXAoY29sdW1ucywgaGFzR3V0dGVyID0gZmFsc2UpIHsKICByZXR1cm4gdnVlLmgoImNvbGdyb3VwIiwge30sIFsuLi5jb2x1bW5zLm1hcChjb2x1bW4gPT4gdnVlLmgoImNvbCIsIHsKICAgIG5hbWU6IGNvbHVtbi5pZCwKICAgIGtleTogY29sdW1uLmlkCiAgfSkpLCBoYXNHdXR0ZXIgJiYgaEd1dHRlcigpXSk7Cn0KCnZhciBUYWJsZUhlYWRlciA9IHZ1ZS5kZWZpbmVDb21wb25lbnQoewogIG5hbWU6ICJFbFRhYmxlSGVhZGVyIiwKICBjb21wb25lbnRzOiB7CiAgICBFbENoZWNrYm94OiBFbENoZWNrYm94X19kZWZhdWx0WydkZWZhdWx0J10KICB9LAogIHByb3BzOiB7CiAgICBmaXhlZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiCiAgICB9LAogICAgc3RvcmU6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIGJvcmRlcjogQm9vbGVhbiwKICAgIGRlZmF1bHRTb3J0OiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4gewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwcm9wOiAiIiwKICAgICAgICAgIG9yZGVyOiAiIgogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9LAoKICBzZXR1cChwcm9wcywgewogICAgZW1pdAogIH0pIHsKICAgIGNvbnN0IGluc3RhbmNlID0gdnVlLmdldEN1cnJlbnRJbnN0YW5jZSgpOwogICAgY29uc3QgcGFyZW50ID0gaW5zdGFuY2UucGFyZW50OwogICAgY29uc3Qgc3RvcmVEYXRhID0gcGFyZW50LnN0b3JlLnN0YXRlczsKICAgIGNvbnN0IGZpbHRlclBhbmVscyA9IHZ1ZS5yZWYoe30pOwogICAgY29uc3QgewogICAgICB0YWJsZUxheW91dCwKICAgICAgb25Db2x1bW5zQ2hhbmdlLAogICAgICBvblNjcm9sbGFibGVDaGFuZ2UKICAgIH0gPSB1c2VMYXlvdXRPYnNlcnZlcihwYXJlbnQpOwogICAgY29uc3QgaGFzR3V0dGVyID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgICAgcmV0dXJuICFwcm9wcy5maXhlZCAmJiB0YWJsZUxheW91dC5ndXR0ZXJXaWR0aDsKICAgIH0pOwogICAgdnVlLm9uTW91bnRlZCgoKSA9PiB7CiAgICAgIHZ1ZS5uZXh0VGljaygoKSA9PiB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgcHJvcCwKICAgICAgICAgIG9yZGVyCiAgICAgICAgfSA9IHByb3BzLmRlZmF1bHRTb3J0OwogICAgICAgIGNvbnN0IGluaXQgPSB0cnVlOwogICAgICAgIHBhcmVudC5zdG9yZS5jb21taXQoInNvcnQiLCB7CiAgICAgICAgICBwcm9wLAogICAgICAgICAgb3JkZXIsCiAgICAgICAgICBpbml0CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICBjb25zdCB7CiAgICAgIGhhbmRsZUhlYWRlckNsaWNrLAogICAgICBoYW5kbGVIZWFkZXJDb250ZXh0TWVudSwKICAgICAgaGFuZGxlTW91c2VEb3duLAogICAgICBoYW5kbGVNb3VzZU1vdmUsCiAgICAgIGhhbmRsZU1vdXNlT3V0LAogICAgICBoYW5kbGVTb3J0Q2xpY2ssCiAgICAgIGhhbmRsZUZpbHRlckNsaWNrCiAgICB9ID0gdXNlRXZlbnQocHJvcHMsIGVtaXQpOwogICAgY29uc3QgewogICAgICBnZXRIZWFkZXJSb3dTdHlsZSwKICAgICAgZ2V0SGVhZGVyUm93Q2xhc3MsCiAgICAgIGdldEhlYWRlckNlbGxTdHlsZSwKICAgICAgZ2V0SGVhZGVyQ2VsbENsYXNzCiAgICB9ID0gdXNlU3R5bGUocHJvcHMpOwogICAgY29uc3QgewogICAgICBpc0dyb3VwLAogICAgICB0b2dnbGVBbGxTZWxlY3Rpb24sCiAgICAgIGNvbHVtblJvd3MKICAgIH0gPSB1c2VVdGlscyhwcm9wcyk7CiAgICBpbnN0YW5jZS5zdGF0ZSA9IHsKICAgICAgb25Db2x1bW5zQ2hhbmdlLAogICAgICBvblNjcm9sbGFibGVDaGFuZ2UKICAgIH07CiAgICBpbnN0YW5jZS5maWx0ZXJQYW5lbHMgPSBmaWx0ZXJQYW5lbHM7CiAgICByZXR1cm4gewogICAgICBjb2x1bW5zOiBzdG9yZURhdGEuY29sdW1ucywKICAgICAgZmlsdGVyUGFuZWxzLAogICAgICBoYXNHdXR0ZXIsCiAgICAgIG9uQ29sdW1uc0NoYW5nZSwKICAgICAgb25TY3JvbGxhYmxlQ2hhbmdlLAogICAgICBjb2x1bW5Sb3dzLAogICAgICBnZXRIZWFkZXJSb3dDbGFzcywKICAgICAgZ2V0SGVhZGVyUm93U3R5bGUsCiAgICAgIGdldEhlYWRlckNlbGxDbGFzcywKICAgICAgZ2V0SGVhZGVyQ2VsbFN0eWxlLAogICAgICBoYW5kbGVIZWFkZXJDbGljaywKICAgICAgaGFuZGxlSGVhZGVyQ29udGV4dE1lbnUsCiAgICAgIGhhbmRsZU1vdXNlRG93biwKICAgICAgaGFuZGxlTW91c2VNb3ZlLAogICAgICBoYW5kbGVNb3VzZU91dCwKICAgICAgaGFuZGxlU29ydENsaWNrLAogICAgICBoYW5kbGVGaWx0ZXJDbGljaywKICAgICAgaXNHcm91cCwKICAgICAgdG9nZ2xlQWxsU2VsZWN0aW9uCiAgICB9OwogIH0sCgogIHJlbmRlcigpIHsKICAgIHJldHVybiB2dWUuaCgidGFibGUiLCB7CiAgICAgIGJvcmRlcjogIjAiLAogICAgICBjZWxscGFkZGluZzogIjAiLAogICAgICBjZWxsc3BhY2luZzogIjAiLAogICAgICBjbGFzczogImVsLXRhYmxlX19oZWFkZXIiCiAgICB9LCBbaENvbGdyb3VwKHRoaXMuY29sdW1ucywgdGhpcy5oYXNHdXR0ZXIpLCB2dWUuaCgidGhlYWQiLCB7CiAgICAgIGNsYXNzOiB7CiAgICAgICAgImlzLWdyb3VwIjogdGhpcy5pc0dyb3VwLAogICAgICAgICJoYXMtZ3V0dGVyIjogdGhpcy5oYXNHdXR0ZXIKICAgICAgfQogICAgfSwgdGhpcy5jb2x1bW5Sb3dzLm1hcCgoc3ViQ29sdW1ucywgcm93SW5kZXgpID0+IHZ1ZS5oKCJ0ciIsIHsKICAgICAgY2xhc3M6IHRoaXMuZ2V0SGVhZGVyUm93Q2xhc3Mocm93SW5kZXgpLAogICAgICBrZXk6IHJvd0luZGV4LAogICAgICBzdHlsZTogdGhpcy5nZXRIZWFkZXJSb3dTdHlsZShyb3dJbmRleCkKICAgIH0sIHN1YkNvbHVtbnMubWFwKChjb2x1bW4sIGNlbGxJbmRleCkgPT4gdnVlLmgoInRoIiwgewogICAgICBjbGFzczogdGhpcy5nZXRIZWFkZXJDZWxsQ2xhc3Mocm93SW5kZXgsIGNlbGxJbmRleCwgc3ViQ29sdW1ucywgY29sdW1uKSwKICAgICAgY29sc3BhbjogY29sdW1uLmNvbFNwYW4sCiAgICAgIGtleTogYCR7Y29sdW1uLmlkfS10aGVhZGAsCiAgICAgIHJvd1NwYW46IGNvbHVtbi5yb3dTcGFuLAogICAgICBzdHlsZTogdGhpcy5nZXRIZWFkZXJDZWxsU3R5bGUocm93SW5kZXgsIGNlbGxJbmRleCwgc3ViQ29sdW1ucywgY29sdW1uKSwKICAgICAgb25DbGljazogJGV2ZW50ID0+IHRoaXMuaGFuZGxlSGVhZGVyQ2xpY2soJGV2ZW50LCBjb2x1bW4pLAogICAgICBvbkNvbnRleHRtZW51OiAkZXZlbnQgPT4gdGhpcy5oYW5kbGVIZWFkZXJDb250ZXh0TWVudSgkZXZlbnQsIGNvbHVtbiksCiAgICAgIG9uTW91c2Vkb3duOiAkZXZlbnQgPT4gdGhpcy5oYW5kbGVNb3VzZURvd24oJGV2ZW50LCBjb2x1bW4pLAogICAgICBvbk1vdXNlbW92ZTogJGV2ZW50ID0+IHRoaXMuaGFuZGxlTW91c2VNb3ZlKCRldmVudCwgY29sdW1uKSwKICAgICAgb25Nb3VzZW91dDogdGhpcy5oYW5kbGVNb3VzZU91dAogICAgfSwgW3Z1ZS5oKCJkaXYiLCB7CiAgICAgIGNsYXNzOiBbImNlbGwiLCBjb2x1bW4uZmlsdGVyZWRWYWx1ZSAmJiBjb2x1bW4uZmlsdGVyZWRWYWx1ZS5sZW5ndGggPiAwID8gImhpZ2hsaWdodCIgOiAiIiwgY29sdW1uLmxhYmVsQ2xhc3NOYW1lXQogICAgfSwgW2NvbHVtbi5yZW5kZXJIZWFkZXIgPyBjb2x1bW4ucmVuZGVySGVhZGVyKHsKICAgICAgY29sdW1uLAogICAgICAkaW5kZXg6IGNlbGxJbmRleCwKICAgICAgc3RvcmU6IHRoaXMuc3RvcmUsCiAgICAgIF9zZWxmOiB0aGlzLiRwYXJlbnQKICAgIH0pIDogY29sdW1uLmxhYmVsLCBjb2x1bW4uc29ydGFibGUgJiYgdnVlLmgoInNwYW4iLCB7CiAgICAgIG9uQ2xpY2s6ICRldmVudCA9PiB0aGlzLmhhbmRsZVNvcnRDbGljaygkZXZlbnQsIGNvbHVtbiksCiAgICAgIGNsYXNzOiAiY2FyZXQtd3JhcHBlciIKICAgIH0sIFt2dWUuaCgiaSIsIHsKICAgICAgb25DbGljazogJGV2ZW50ID0+IHRoaXMuaGFuZGxlU29ydENsaWNrKCRldmVudCwgY29sdW1uLCAiYXNjZW5kaW5nIiksCiAgICAgIGNsYXNzOiAic29ydC1jYXJldCBhc2NlbmRpbmciCiAgICB9KSwgdnVlLmgoImkiLCB7CiAgICAgIG9uQ2xpY2s6ICRldmVudCA9PiB0aGlzLmhhbmRsZVNvcnRDbGljaygkZXZlbnQsIGNvbHVtbiwgImRlc2NlbmRpbmciKSwKICAgICAgY2xhc3M6ICJzb3J0LWNhcmV0IGRlc2NlbmRpbmciCiAgICB9KV0pLCBjb2x1bW4uZmlsdGVyYWJsZSAmJiB2dWUuaChzY3JpcHQsIHsKICAgICAgc3RvcmU6IHRoaXMuJHBhcmVudC5zdG9yZSwKICAgICAgcGxhY2VtZW50OiBjb2x1bW4uZmlsdGVyUGxhY2VtZW50IHx8ICJib3R0b20tc3RhcnQiLAogICAgICBjb2x1bW4sCiAgICAgIHVwRGF0YUNvbHVtbjogKGtleSwgdmFsdWUpID0+IHsKICAgICAgICBjb2x1bW5ba2V5XSA9IHZhbHVlOwogICAgICB9CiAgICB9KV0pXSkpKSkpXSk7CiAgfQoKfSk7CgpmdW5jdGlvbiB1c2VFdmVudHMocHJvcHMpIHsKICBjb25zdCBpbnN0YW5jZSA9IHZ1ZS5nZXRDdXJyZW50SW5zdGFuY2UoKTsKICBjb25zdCBwYXJlbnQgPSBpbnN0YW5jZS5wYXJlbnQ7CiAgY29uc3QgdG9vbHRpcENvbnRlbnQgPSB2dWUucmVmKCIiKTsKICBjb25zdCB0b29sdGlwVHJpZ2dlciA9IHZ1ZS5yZWYodnVlLmgoImRpdiIpKTsKCiAgY29uc3QgaGFuZGxlRXZlbnQgPSAoZXZlbnQsIHJvdywgbmFtZSkgPT4gewogICAgY29uc3QgdGFibGUgPSBwYXJlbnQ7CiAgICBjb25zdCBjZWxsID0gZ2V0Q2VsbChldmVudCk7CiAgICBsZXQgY29sdW1uOwoKICAgIGlmIChjZWxsKSB7CiAgICAgIGNvbHVtbiA9IGdldENvbHVtbkJ5Q2VsbCh7CiAgICAgICAgY29sdW1uczogcHJvcHMuc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUKICAgICAgfSwgY2VsbCk7CgogICAgICBpZiAoY29sdW1uKSB7CiAgICAgICAgdGFibGUuZW1pdChgY2VsbC0ke25hbWV9YCwgcm93LCBjb2x1bW4sIGNlbGwsIGV2ZW50KTsKICAgICAgfQogICAgfQoKICAgIHRhYmxlLmVtaXQoYHJvdy0ke25hbWV9YCwgcm93LCBjb2x1bW4sIGV2ZW50KTsKICB9OwoKICBjb25zdCBoYW5kbGVEb3VibGVDbGljayA9IChldmVudCwgcm93KSA9PiB7CiAgICBoYW5kbGVFdmVudChldmVudCwgcm93LCAiZGJsY2xpY2siKTsKICB9OwoKICBjb25zdCBoYW5kbGVDbGljayA9IChldmVudCwgcm93KSA9PiB7CiAgICBwcm9wcy5zdG9yZS5jb21taXQoInNldEN1cnJlbnRSb3ciLCByb3cpOwogICAgaGFuZGxlRXZlbnQoZXZlbnQsIHJvdywgImNsaWNrIik7CiAgfTsKCiAgY29uc3QgaGFuZGxlQ29udGV4dE1lbnUgPSAoZXZlbnQsIHJvdykgPT4gewogICAgaGFuZGxlRXZlbnQoZXZlbnQsIHJvdywgImNvbnRleHRtZW51Iik7CiAgfTsKCiAgY29uc3QgaGFuZGxlTW91c2VFbnRlciA9IGRlYm91bmNlX19kZWZhdWx0WydkZWZhdWx0J10oZnVuY3Rpb24gKGluZGV4KSB7CiAgICBwcm9wcy5zdG9yZS5jb21taXQoInNldEhvdmVyUm93IiwgaW5kZXgpOwogIH0sIDMwKTsKICBjb25zdCBoYW5kbGVNb3VzZUxlYXZlID0gZGVib3VuY2VfX2RlZmF1bHRbJ2RlZmF1bHQnXShmdW5jdGlvbiAoKSB7CiAgICBwcm9wcy5zdG9yZS5jb21taXQoInNldEhvdmVyUm93IiwgbnVsbCk7CiAgfSwgMzApOwoKICBjb25zdCBoYW5kbGVDZWxsTW91c2VFbnRlciA9IChldmVudCwgcm93KSA9PiB7CiAgICBjb25zdCB0YWJsZSA9IHBhcmVudDsKICAgIGNvbnN0IGNlbGwgPSBnZXRDZWxsKGV2ZW50KTsKCiAgICBpZiAoY2VsbCkgewogICAgICBjb25zdCBjb2x1bW4gPSBnZXRDb2x1bW5CeUNlbGwoewogICAgICAgIGNvbHVtbnM6IHByb3BzLnN0b3JlLnN0YXRlcy5jb2x1bW5zLnZhbHVlCiAgICAgIH0sIGNlbGwpOwogICAgICBjb25zdCBob3ZlclN0YXRlID0gdGFibGUuaG92ZXJTdGF0ZSA9IHsKICAgICAgICBjZWxsLAogICAgICAgIGNvbHVtbiwKICAgICAgICByb3cKICAgICAgfTsKICAgICAgdGFibGUuZW1pdCgiY2VsbC1tb3VzZS1lbnRlciIsIGhvdmVyU3RhdGUucm93LCBob3ZlclN0YXRlLmNvbHVtbiwgaG92ZXJTdGF0ZS5jZWxsLCBldmVudCk7CiAgICB9CgogICAgY29uc3QgY2VsbENoaWxkID0gZXZlbnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoIi5jZWxsIik7CgogICAgaWYgKCEoZG9tLmhhc0NsYXNzKGNlbGxDaGlsZCwgImVsLXRvb2x0aXAiKSAmJiBjZWxsQ2hpbGQuY2hpbGROb2Rlcy5sZW5ndGgpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICByYW5nZS5zZXRTdGFydChjZWxsQ2hpbGQsIDApOwogICAgcmFuZ2Uuc2V0RW5kKGNlbGxDaGlsZCwgY2VsbENoaWxkLmNoaWxkTm9kZXMubGVuZ3RoKTsKICAgIGNvbnN0IHJhbmdlV2lkdGggPSByYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDsKICAgIGNvbnN0IHBhZGRpbmcgPSAocGFyc2VJbnQoZG9tLmdldFN0eWxlKGNlbGxDaGlsZCwgInBhZGRpbmdMZWZ0IiksIDEwKSB8fCAwKSArIChwYXJzZUludChkb20uZ2V0U3R5bGUoY2VsbENoaWxkLCAicGFkZGluZ1JpZ2h0IiksIDEwKSB8fCAwKTsKCiAgICBpZiAocmFuZ2VXaWR0aCArIHBhZGRpbmcgPiBjZWxsQ2hpbGQub2Zmc2V0V2lkdGggfHwgY2VsbENoaWxkLnNjcm9sbFdpZHRoID4gY2VsbENoaWxkLm9mZnNldFdpZHRoKSB7CiAgICAgIGNyZWF0ZVRhYmxlUG9wcGVyKGNlbGwsIGNlbGwuaW5uZXJUZXh0IHx8IGNlbGwudGV4dENvbnRlbnQsIHsKICAgICAgICBwbGFjZW1lbnQ6ICJ0b3AiLAogICAgICAgIHN0cmF0ZWd5OiAiZml4ZWQiCiAgICAgIH0sIHJvdy50b29sdGlwRWZmZWN0KTsKICAgIH0KICB9OwoKICBjb25zdCBoYW5kbGVDZWxsTW91c2VMZWF2ZSA9IGV2ZW50ID0+IHsKICAgIGNvbnN0IGNlbGwgPSBnZXRDZWxsKGV2ZW50KTsKICAgIGlmICghY2VsbCkgcmV0dXJuOwogICAgY29uc3Qgb2xkSG92ZXJTdGF0ZSA9IHBhcmVudC5ob3ZlclN0YXRlOwogICAgcGFyZW50LmVtaXQoImNlbGwtbW91c2UtbGVhdmUiLCBvbGRIb3ZlclN0YXRlID09IG51bGwgPyB2b2lkIDAgOiBvbGRIb3ZlclN0YXRlLnJvdywgb2xkSG92ZXJTdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogb2xkSG92ZXJTdGF0ZS5jb2x1bW4sIG9sZEhvdmVyU3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IG9sZEhvdmVyU3RhdGUuY2VsbCwgZXZlbnQpOwogIH07CgogIHJldHVybiB7CiAgICBoYW5kbGVEb3VibGVDbGljaywKICAgIGhhbmRsZUNsaWNrLAogICAgaGFuZGxlQ29udGV4dE1lbnUsCiAgICBoYW5kbGVNb3VzZUVudGVyLAogICAgaGFuZGxlTW91c2VMZWF2ZSwKICAgIGhhbmRsZUNlbGxNb3VzZUVudGVyLAogICAgaGFuZGxlQ2VsbE1vdXNlTGVhdmUsCiAgICB0b29sdGlwQ29udGVudCwKICAgIHRvb2x0aXBUcmlnZ2VyCiAgfTsKfQoKZnVuY3Rpb24gdXNlU3R5bGVzKHByb3BzKSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgY29uc3QgcGFyZW50ID0gaW5zdGFuY2UucGFyZW50OwoKICBjb25zdCBpc0NvbHVtbkhpZGRlbiA9IGluZGV4ID0+IHsKICAgIGlmIChwcm9wcy5maXhlZCA9PT0gImxlZnQiKSB7CiAgICAgIHJldHVybiBpbmRleCA+PSBwcm9wcy5zdG9yZS5zdGF0ZXMuZml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZTsKICAgIH0gZWxzZSBpZiAocHJvcHMuZml4ZWQgPT09ICJyaWdodCIpIHsKICAgICAgcmV0dXJuIGluZGV4IDwgcHJvcHMuc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUubGVuZ3RoIC0gcHJvcHMuc3RvcmUuc3RhdGVzLnJpZ2h0Rml4ZWRMZWFmQ29sdW1uc0xlbmd0aC52YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpbmRleCA8IHByb3BzLnN0b3JlLnN0YXRlcy5maXhlZExlYWZDb2x1bW5zTGVuZ3RoLnZhbHVlIHx8IGluZGV4ID49IHByb3BzLnN0b3JlLnN0YXRlcy5jb2x1bW5zLnZhbHVlLmxlbmd0aCAtIHByb3BzLnN0b3JlLnN0YXRlcy5yaWdodEZpeGVkTGVhZkNvbHVtbnNMZW5ndGgudmFsdWU7CiAgICB9CiAgfTsKCiAgY29uc3QgZ2V0Um93U3R5bGUgPSAocm93LCByb3dJbmRleCkgPT4gewogICAgY29uc3Qgcm93U3R5bGUgPSBwYXJlbnQucHJvcHMucm93U3R5bGU7CgogICAgaWYgKHR5cGVvZiByb3dTdHlsZSA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gcm93U3R5bGUuY2FsbChudWxsLCB7CiAgICAgICAgcm93LAogICAgICAgIHJvd0luZGV4CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiByb3dTdHlsZSB8fCBudWxsOwogIH07CgogIGNvbnN0IGdldFJvd0NsYXNzID0gKHJvdywgcm93SW5kZXgpID0+IHsKICAgIGNvbnN0IGNsYXNzZXMgPSBbImVsLXRhYmxlX19yb3ciXTsKCiAgICBpZiAocGFyZW50LnByb3BzLmhpZ2hsaWdodEN1cnJlbnRSb3cgJiYgcm93ID09PSBwcm9wcy5zdG9yZS5zdGF0ZXMuY3VycmVudFJvdy52YWx1ZSkgewogICAgICBjbGFzc2VzLnB1c2goImN1cnJlbnQtcm93Iik7CiAgICB9CgogICAgaWYgKHByb3BzLnN0cmlwZSAmJiByb3dJbmRleCAlIDIgPT09IDEpIHsKICAgICAgY2xhc3Nlcy5wdXNoKCJlbC10YWJsZV9fcm93LS1zdHJpcGVkIik7CiAgICB9CgogICAgY29uc3Qgcm93Q2xhc3NOYW1lID0gcGFyZW50LnByb3BzLnJvd0NsYXNzTmFtZTsKCiAgICBpZiAodHlwZW9mIHJvd0NsYXNzTmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgY2xhc3Nlcy5wdXNoKHJvd0NsYXNzTmFtZSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiByb3dDbGFzc05hbWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgY2xhc3Nlcy5wdXNoKHJvd0NsYXNzTmFtZS5jYWxsKG51bGwsIHsKICAgICAgICByb3csCiAgICAgICAgcm93SW5kZXgKICAgICAgfSkpOwogICAgfQoKICAgIGlmIChwcm9wcy5zdG9yZS5zdGF0ZXMuZXhwYW5kUm93cy52YWx1ZS5pbmRleE9mKHJvdykgPiAtMSkgewogICAgICBjbGFzc2VzLnB1c2goImV4cGFuZGVkIik7CiAgICB9CgogICAgcmV0dXJuIGNsYXNzZXM7CiAgfTsKCiAgY29uc3QgZ2V0Q2VsbFN0eWxlID0gKHJvd0luZGV4LCBjb2x1bW5JbmRleCwgcm93LCBjb2x1bW4pID0+IHsKICAgIGNvbnN0IGNlbGxTdHlsZSA9IHBhcmVudC5wcm9wcy5jZWxsU3R5bGU7CgogICAgaWYgKHR5cGVvZiBjZWxsU3R5bGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIGNlbGxTdHlsZS5jYWxsKG51bGwsIHsKICAgICAgICByb3dJbmRleCwKICAgICAgICBjb2x1bW5JbmRleCwKICAgICAgICByb3csCiAgICAgICAgY29sdW1uCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBjZWxsU3R5bGU7CiAgfTsKCiAgY29uc3QgZ2V0Q2VsbENsYXNzID0gKHJvd0luZGV4LCBjb2x1bW5JbmRleCwgcm93LCBjb2x1bW4pID0+IHsKICAgIGNvbnN0IGNsYXNzZXMgPSBbY29sdW1uLmlkLCBjb2x1bW4uYWxpZ24sIGNvbHVtbi5jbGFzc05hbWVdOwoKICAgIGlmIChpc0NvbHVtbkhpZGRlbihjb2x1bW5JbmRleCkpIHsKICAgICAgY2xhc3Nlcy5wdXNoKCJpcy1oaWRkZW4iKTsKICAgIH0KCiAgICBjb25zdCBjZWxsQ2xhc3NOYW1lID0gcGFyZW50LnByb3BzLmNlbGxDbGFzc05hbWU7CgogICAgaWYgKHR5cGVvZiBjZWxsQ2xhc3NOYW1lID09PSAic3RyaW5nIikgewogICAgICBjbGFzc2VzLnB1c2goY2VsbENsYXNzTmFtZSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjZWxsQ2xhc3NOYW1lID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIGNsYXNzZXMucHVzaChjZWxsQ2xhc3NOYW1lLmNhbGwobnVsbCwgewogICAgICAgIHJvd0luZGV4LAogICAgICAgIGNvbHVtbkluZGV4LAogICAgICAgIHJvdywKICAgICAgICBjb2x1bW4KICAgICAgfSkpOwogICAgfQoKICAgIHJldHVybiBjbGFzc2VzLmpvaW4oIiAiKTsKICB9OwoKICBjb25zdCBnZXRTcGFuID0gKHJvdywgY29sdW1uLCByb3dJbmRleCwgY29sdW1uSW5kZXgpID0+IHsKICAgIGxldCByb3dzcGFuID0gMTsKICAgIGxldCBjb2xzcGFuID0gMTsKICAgIGNvbnN0IGZuID0gcGFyZW50LnByb3BzLnNwYW5NZXRob2Q7CgogICAgaWYgKHR5cGVvZiBmbiA9PT0gImZ1bmN0aW9uIikgewogICAgICBjb25zdCByZXN1bHQgPSBmbih7CiAgICAgICAgcm93LAogICAgICAgIGNvbHVtbiwKICAgICAgICByb3dJbmRleCwKICAgICAgICBjb2x1bW5JbmRleAogICAgICB9KTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdCkpIHsKICAgICAgICByb3dzcGFuID0gcmVzdWx0WzBdOwogICAgICAgIGNvbHNwYW4gPSByZXN1bHRbMV07CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3VsdCA9PT0gIm9iamVjdCIpIHsKICAgICAgICByb3dzcGFuID0gcmVzdWx0LnJvd3NwYW47CiAgICAgICAgY29sc3BhbiA9IHJlc3VsdC5jb2xzcGFuOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgcm93c3BhbiwKICAgICAgY29sc3BhbgogICAgfTsKICB9OwoKICBjb25zdCBnZXRDb2xzcGFuUmVhbFdpZHRoID0gKGNvbHVtbnMsIGNvbHNwYW4sIGluZGV4KSA9PiB7CiAgICBpZiAoY29sc3BhbiA8IDEpIHsKICAgICAgcmV0dXJuIGNvbHVtbnNbaW5kZXhdLnJlYWxXaWR0aDsKICAgIH0KCiAgICBjb25zdCB3aWR0aEFyciA9IGNvbHVtbnMubWFwKCh7CiAgICAgIHJlYWxXaWR0aCwKICAgICAgd2lkdGgKICAgIH0pID0+IHJlYWxXaWR0aCB8fCB3aWR0aCkuc2xpY2UoaW5kZXgsIGluZGV4ICsgY29sc3Bhbik7CiAgICByZXR1cm4gTnVtYmVyKHdpZHRoQXJyLnJlZHVjZSgoYWNjLCB3aWR0aCkgPT4gTnVtYmVyKGFjYykgKyBOdW1iZXIod2lkdGgpLCAtMSkpOwogIH07CgogIHJldHVybiB7CiAgICBnZXRSb3dTdHlsZSwKICAgIGdldFJvd0NsYXNzLAogICAgZ2V0Q2VsbFN0eWxlLAogICAgZ2V0Q2VsbENsYXNzLAogICAgZ2V0U3BhbiwKICAgIGdldENvbHNwYW5SZWFsV2lkdGgsCiAgICBpc0NvbHVtbkhpZGRlbgogIH07Cn0KCnZhciBfX2RlZlByb3AkNCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fZGVmUHJvcHMkMSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOwp2YXIgX19nZXRPd25Qcm9wRGVzY3MkMSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOwp2YXIgX19nZXRPd25Qcm9wU3ltYm9scyQ0ID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKdmFyIF9faGFzT3duUHJvcCQ0ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fcHJvcElzRW51bSQ0ID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCnZhciBfX2RlZk5vcm1hbFByb3AkNCA9IChvYmosIGtleSwgdmFsdWUpID0+IGtleSBpbiBvYmogPyBfX2RlZlByb3AkNChvYmosIGtleSwgewogIGVudW1lcmFibGU6IHRydWUsCiAgY29uZmlndXJhYmxlOiB0cnVlLAogIHdyaXRhYmxlOiB0cnVlLAogIHZhbHVlCn0pIDogb2JqW2tleV0gPSB2YWx1ZTsKCnZhciBfX3NwcmVhZFZhbHVlcyQ0ID0gKGEsIGIpID0+IHsKICBmb3IgKHZhciBwcm9wIGluIGIgfHwgKGIgPSB7fSkpIGlmIChfX2hhc093blByb3AkNC5jYWxsKGIsIHByb3ApKSBfX2RlZk5vcm1hbFByb3AkNChhLCBwcm9wLCBiW3Byb3BdKTsKCiAgaWYgKF9fZ2V0T3duUHJvcFN5bWJvbHMkNCkgZm9yICh2YXIgcHJvcCBvZiBfX2dldE93blByb3BTeW1ib2xzJDQoYikpIHsKICAgIGlmIChfX3Byb3BJc0VudW0kNC5jYWxsKGIsIHByb3ApKSBfX2RlZk5vcm1hbFByb3AkNChhLCBwcm9wLCBiW3Byb3BdKTsKICB9CiAgcmV0dXJuIGE7Cn07Cgp2YXIgX19zcHJlYWRQcm9wcyQxID0gKGEsIGIpID0+IF9fZGVmUHJvcHMkMShhLCBfX2dldE93blByb3BEZXNjcyQxKGIpKTsKCmZ1bmN0aW9uIHVzZVJlbmRlcihwcm9wcykgewogIGNvbnN0IGluc3RhbmNlID0gdnVlLmdldEN1cnJlbnRJbnN0YW5jZSgpOwogIGNvbnN0IHBhcmVudCA9IGluc3RhbmNlLnBhcmVudDsKICBjb25zdCB7CiAgICBoYW5kbGVEb3VibGVDbGljaywKICAgIGhhbmRsZUNsaWNrLAogICAgaGFuZGxlQ29udGV4dE1lbnUsCiAgICBoYW5kbGVNb3VzZUVudGVyLAogICAgaGFuZGxlTW91c2VMZWF2ZSwKICAgIGhhbmRsZUNlbGxNb3VzZUVudGVyLAogICAgaGFuZGxlQ2VsbE1vdXNlTGVhdmUsCiAgICB0b29sdGlwQ29udGVudCwKICAgIHRvb2x0aXBUcmlnZ2VyCiAgfSA9IHVzZUV2ZW50cyhwcm9wcyk7CiAgY29uc3QgewogICAgZ2V0Um93U3R5bGUsCiAgICBnZXRSb3dDbGFzcywKICAgIGdldENlbGxTdHlsZSwKICAgIGdldENlbGxDbGFzcywKICAgIGdldFNwYW4sCiAgICBnZXRDb2xzcGFuUmVhbFdpZHRoCiAgfSA9IHVzZVN0eWxlcyhwcm9wcyk7CiAgY29uc3QgZmlyc3REZWZhdWx0Q29sdW1uSW5kZXggPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgcmV0dXJuIHV0aWwuYXJyYXlGaW5kSW5kZXgocHJvcHMuc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUsICh7CiAgICAgIHR5cGUKICAgIH0pID0+IHR5cGUgPT09ICJkZWZhdWx0Iik7CiAgfSk7CgogIGNvbnN0IGdldEtleU9mUm93ID0gKHJvdywgaW5kZXgpID0+IHsKICAgIGNvbnN0IHJvd0tleSA9IHBhcmVudC5wcm9wcy5yb3dLZXk7CgogICAgaWYgKHJvd0tleSkgewogICAgICByZXR1cm4gZ2V0Um93SWRlbnRpdHkocm93LCByb3dLZXkpOwogICAgfQoKICAgIHJldHVybiBpbmRleDsKICB9OwoKICBjb25zdCByb3dSZW5kZXIgPSAocm93LCAkaW5kZXgsIHRyZWVSb3dEYXRhKSA9PiB7CiAgICBjb25zdCB7CiAgICAgIHRvb2x0aXBFZmZlY3QsCiAgICAgIHN0b3JlCiAgICB9ID0gcHJvcHM7CiAgICBjb25zdCB7CiAgICAgIGluZGVudCwKICAgICAgY29sdW1ucwogICAgfSA9IHN0b3JlLnN0YXRlczsKICAgIGNvbnN0IHJvd0NsYXNzZXMgPSBnZXRSb3dDbGFzcyhyb3csICRpbmRleCk7CiAgICBsZXQgZGlzcGxheSA9IHRydWU7CgogICAgaWYgKHRyZWVSb3dEYXRhKSB7CiAgICAgIHJvd0NsYXNzZXMucHVzaCgiZWwtdGFibGVfX3Jvdy0tbGV2ZWwtIiArIHRyZWVSb3dEYXRhLmxldmVsKTsKICAgICAgZGlzcGxheSA9IHRyZWVSb3dEYXRhLmRpc3BsYXk7CiAgICB9CgogICAgY29uc3QgZGlzcGxheVN0eWxlID0gZGlzcGxheSA/IG51bGwgOiB7CiAgICAgIGRpc3BsYXk6ICJub25lIgogICAgfTsKICAgIHJldHVybiB2dWUuaCgidHIiLCB7CiAgICAgIHN0eWxlOiBbZGlzcGxheVN0eWxlLCBnZXRSb3dTdHlsZShyb3csICRpbmRleCldLAogICAgICBjbGFzczogcm93Q2xhc3NlcywKICAgICAga2V5OiBnZXRLZXlPZlJvdyhyb3csICRpbmRleCksCiAgICAgIG9uRGJsY2xpY2s6ICRldmVudCA9PiBoYW5kbGVEb3VibGVDbGljaygkZXZlbnQsIHJvdyksCiAgICAgIG9uQ2xpY2s6ICRldmVudCA9PiBoYW5kbGVDbGljaygkZXZlbnQsIHJvdyksCiAgICAgIG9uQ29udGV4dG1lbnU6ICRldmVudCA9PiBoYW5kbGVDb250ZXh0TWVudSgkZXZlbnQsIHJvdyksCiAgICAgIG9uTW91c2VlbnRlcjogKCkgPT4gaGFuZGxlTW91c2VFbnRlcigkaW5kZXgpLAogICAgICBvbk1vdXNlbGVhdmU6IGhhbmRsZU1vdXNlTGVhdmUKICAgIH0sIGNvbHVtbnMudmFsdWUubWFwKChjb2x1bW4sIGNlbGxJbmRleCkgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgcm93c3BhbiwKICAgICAgICBjb2xzcGFuCiAgICAgIH0gPSBnZXRTcGFuKHJvdywgY29sdW1uLCAkaW5kZXgsIGNlbGxJbmRleCk7CgogICAgICBpZiAoIXJvd3NwYW4gfHwgIWNvbHNwYW4pIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgY29uc3QgY29sdW1uRGF0YSA9IF9fc3ByZWFkVmFsdWVzJDQoe30sIGNvbHVtbik7CgogICAgICBjb2x1bW5EYXRhLnJlYWxXaWR0aCA9IGdldENvbHNwYW5SZWFsV2lkdGgoY29sdW1ucy52YWx1ZSwgY29sc3BhbiwgY2VsbEluZGV4KTsKICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICBzdG9yZTogcHJvcHMuc3RvcmUsCiAgICAgICAgX3NlbGY6IHByb3BzLmNvbnRleHQgfHwgcGFyZW50LAogICAgICAgIGNvbHVtbjogY29sdW1uRGF0YSwKICAgICAgICByb3csCiAgICAgICAgJGluZGV4CiAgICAgIH07CgogICAgICBpZiAoY2VsbEluZGV4ID09PSBmaXJzdERlZmF1bHRDb2x1bW5JbmRleC52YWx1ZSAmJiB0cmVlUm93RGF0YSkgewogICAgICAgIGRhdGEudHJlZU5vZGUgPSB7CiAgICAgICAgICBpbmRlbnQ6IHRyZWVSb3dEYXRhLmxldmVsICogaW5kZW50LnZhbHVlLAogICAgICAgICAgbGV2ZWw6IHRyZWVSb3dEYXRhLmxldmVsCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHR5cGVvZiB0cmVlUm93RGF0YS5leHBhbmRlZCA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICBkYXRhLnRyZWVOb2RlLmV4cGFuZGVkID0gdHJlZVJvd0RhdGEuZXhwYW5kZWQ7CgogICAgICAgICAgaWYgKCJsb2FkaW5nIiBpbiB0cmVlUm93RGF0YSkgewogICAgICAgICAgICBkYXRhLnRyZWVOb2RlLmxvYWRpbmcgPSB0cmVlUm93RGF0YS5sb2FkaW5nOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgibm9MYXp5Q2hpbGRyZW4iIGluIHRyZWVSb3dEYXRhKSB7CiAgICAgICAgICAgIGRhdGEudHJlZU5vZGUubm9MYXp5Q2hpbGRyZW4gPSB0cmVlUm93RGF0YS5ub0xhenlDaGlsZHJlbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGJhc2VLZXkgPSBgJHskaW5kZXh9LCR7Y2VsbEluZGV4fWA7CiAgICAgIGNvbnN0IHBhdGNoS2V5ID0gY29sdW1uRGF0YS5jb2x1bW5LZXkgfHwgY29sdW1uRGF0YS5yYXdDb2x1bW5LZXkgfHwgIiI7CiAgICAgIHJldHVybiB2dWUuaCgidGQiLCB7CiAgICAgICAgc3R5bGU6IGdldENlbGxTdHlsZSgkaW5kZXgsIGNlbGxJbmRleCwgcm93LCBjb2x1bW4pLAogICAgICAgIGNsYXNzOiBnZXRDZWxsQ2xhc3MoJGluZGV4LCBjZWxsSW5kZXgsIHJvdywgY29sdW1uKSwKICAgICAgICBrZXk6IGAke3BhdGNoS2V5fSR7YmFzZUtleX1gLAogICAgICAgIHJvd3NwYW4sCiAgICAgICAgY29sc3BhbiwKICAgICAgICBvbk1vdXNlZW50ZXI6ICRldmVudCA9PiBoYW5kbGVDZWxsTW91c2VFbnRlcigkZXZlbnQsIF9fc3ByZWFkUHJvcHMkMShfX3NwcmVhZFZhbHVlcyQ0KHt9LCByb3cpLCB7CiAgICAgICAgICB0b29sdGlwRWZmZWN0CiAgICAgICAgfSkpLAogICAgICAgIG9uTW91c2VsZWF2ZTogaGFuZGxlQ2VsbE1vdXNlTGVhdmUKICAgICAgfSwgW2NvbHVtbi5yZW5kZXJDZWxsKGRhdGEpXSk7CiAgICB9KSk7CiAgfTsKCiAgY29uc3Qgd3JhcHBlZFJvd1JlbmRlciA9IChyb3csICRpbmRleCkgPT4gewogICAgY29uc3Qgc3RvcmUgPSBwcm9wcy5zdG9yZTsKICAgIGNvbnN0IHsKICAgICAgaXNSb3dFeHBhbmRlZCwKICAgICAgYXNzZXJ0Um93S2V5CiAgICB9ID0gc3RvcmU7CiAgICBjb25zdCB7CiAgICAgIHRyZWVEYXRhLAogICAgICBsYXp5VHJlZU5vZGVNYXAsCiAgICAgIGNoaWxkcmVuQ29sdW1uTmFtZSwKICAgICAgcm93S2V5CiAgICB9ID0gc3RvcmUuc3RhdGVzOwogICAgY29uc3QgaGFzRXhwYW5kQ29sdW1uID0gc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUuc29tZSgoewogICAgICB0eXBlCiAgICB9KSA9PiB0eXBlID09PSAiZXhwYW5kIik7CgogICAgaWYgKGhhc0V4cGFuZENvbHVtbiAmJiBpc1Jvd0V4cGFuZGVkKHJvdykpIHsKICAgICAgY29uc3QgcmVuZGVyRXhwYW5kZWQgPSBwYXJlbnQucmVuZGVyRXhwYW5kZWQ7CiAgICAgIGNvbnN0IHRyID0gcm93UmVuZGVyKHJvdywgJGluZGV4LCB2b2lkIDApOwoKICAgICAgaWYgKCFyZW5kZXJFeHBhbmRlZCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIltFbGVtZW50IEVycm9yXXJlbmRlckV4cGFuZGVkIGlzIHJlcXVpcmVkLiIpOwogICAgICAgIHJldHVybiB0cjsKICAgICAgfQoKICAgICAgcmV0dXJuIFtbdHIsIHZ1ZS5oKCJ0ciIsIHsKICAgICAgICBrZXk6ICJleHBhbmRlZC1yb3dfXyIgKyB0ci5rZXkKICAgICAgfSwgW3Z1ZS5oKCJ0ZCIsIHsKICAgICAgICBjb2xzcGFuOiBzdG9yZS5zdGF0ZXMuY29sdW1ucy52YWx1ZS5sZW5ndGgsCiAgICAgICAgY2xhc3M6ICJlbC10YWJsZV9fZXhwYW5kZWQtY2VsbCIKICAgICAgfSwgW3JlbmRlckV4cGFuZGVkKHsKICAgICAgICByb3csCiAgICAgICAgJGluZGV4LAogICAgICAgIHN0b3JlCiAgICAgIH0pXSldKV1dOwogICAgfSBlbHNlIGlmIChPYmplY3Qua2V5cyh0cmVlRGF0YS52YWx1ZSkubGVuZ3RoKSB7CiAgICAgIGFzc2VydFJvd0tleSgpOwogICAgICBjb25zdCBrZXkgPSBnZXRSb3dJZGVudGl0eShyb3csIHJvd0tleS52YWx1ZSk7CiAgICAgIGxldCBjdXIgPSB0cmVlRGF0YS52YWx1ZVtrZXldOwogICAgICBsZXQgdHJlZVJvd0RhdGEgPSBudWxsOwoKICAgICAgaWYgKGN1cikgewogICAgICAgIHRyZWVSb3dEYXRhID0gewogICAgICAgICAgZXhwYW5kZWQ6IGN1ci5leHBhbmRlZCwKICAgICAgICAgIGxldmVsOiBjdXIubGV2ZWwsCiAgICAgICAgICBkaXNwbGF5OiB0cnVlCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHR5cGVvZiBjdXIubGF6eSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGN1ci5sb2FkZWQgPT09ICJib29sZWFuIiAmJiBjdXIubG9hZGVkKSB7CiAgICAgICAgICAgIHRyZWVSb3dEYXRhLm5vTGF6eUNoaWxkcmVuID0gIShjdXIuY2hpbGRyZW4gJiYgY3VyLmNoaWxkcmVuLmxlbmd0aCk7CiAgICAgICAgICB9CgogICAgICAgICAgdHJlZVJvd0RhdGEubG9hZGluZyA9IGN1ci5sb2FkaW5nOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdG1wID0gW3Jvd1JlbmRlcihyb3csICRpbmRleCwgdHJlZVJvd0RhdGEpXTsKCiAgICAgIGlmIChjdXIpIHsKICAgICAgICBsZXQgaSA9IDA7CgogICAgICAgIGNvbnN0IHRyYXZlcnNlID0gKGNoaWxkcmVuLCBwYXJlbnQyKSA9PiB7CiAgICAgICAgICBpZiAoIShjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGggJiYgcGFyZW50MikpIHJldHVybjsKICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2gobm9kZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGlubmVyVHJlZVJvd0RhdGEgPSB7CiAgICAgICAgICAgICAgZGlzcGxheTogcGFyZW50Mi5kaXNwbGF5ICYmIHBhcmVudDIuZXhwYW5kZWQsCiAgICAgICAgICAgICAgbGV2ZWw6IHBhcmVudDIubGV2ZWwgKyAxLAogICAgICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZSwKICAgICAgICAgICAgICBub0xhenlDaGlsZHJlbjogZmFsc2UsCiAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBnZXRSb3dJZGVudGl0eShub2RlLCByb3dLZXkudmFsdWUpOwoKICAgICAgICAgICAgaWYgKGNoaWxkS2V5ID09PSB2b2lkIDAgfHwgY2hpbGRLZXkgPT09IG51bGwpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImZvciBuZXN0ZWQgZGF0YSBpdGVtLCByb3cta2V5IGlzIHJlcXVpcmVkLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdXIgPSBfX3NwcmVhZFZhbHVlcyQ0KHt9LCB0cmVlRGF0YS52YWx1ZVtjaGlsZEtleV0pOwoKICAgICAgICAgICAgaWYgKGN1cikgewogICAgICAgICAgICAgIGlubmVyVHJlZVJvd0RhdGEuZXhwYW5kZWQgPSBjdXIuZXhwYW5kZWQ7CiAgICAgICAgICAgICAgY3VyLmxldmVsID0gY3VyLmxldmVsIHx8IGlubmVyVHJlZVJvd0RhdGEubGV2ZWw7CiAgICAgICAgICAgICAgY3VyLmRpc3BsYXkgPSAhIShjdXIuZXhwYW5kZWQgJiYgaW5uZXJUcmVlUm93RGF0YS5kaXNwbGF5KTsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXIubGF6eSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1ci5sb2FkZWQgPT09ICJib29sZWFuIiAmJiBjdXIubG9hZGVkKSB7CiAgICAgICAgICAgICAgICAgIGlubmVyVHJlZVJvd0RhdGEubm9MYXp5Q2hpbGRyZW4gPSAhKGN1ci5jaGlsZHJlbiAmJiBjdXIuY2hpbGRyZW4ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbm5lclRyZWVSb3dEYXRhLmxvYWRpbmcgPSBjdXIubG9hZGluZzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgdG1wLnB1c2gocm93UmVuZGVyKG5vZGUsICRpbmRleCArIGksIGlubmVyVHJlZVJvd0RhdGEpKTsKCiAgICAgICAgICAgIGlmIChjdXIpIHsKICAgICAgICAgICAgICBjb25zdCBub2RlczIgPSBsYXp5VHJlZU5vZGVNYXAudmFsdWVbY2hpbGRLZXldIHx8IG5vZGVbY2hpbGRyZW5Db2x1bW5OYW1lLnZhbHVlXTsKICAgICAgICAgICAgICB0cmF2ZXJzZShub2RlczIsIGN1cik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGN1ci5kaXNwbGF5ID0gdHJ1ZTsKICAgICAgICBjb25zdCBub2RlcyA9IGxhenlUcmVlTm9kZU1hcC52YWx1ZVtrZXldIHx8IHJvd1tjaGlsZHJlbkNvbHVtbk5hbWUudmFsdWVdOwogICAgICAgIHRyYXZlcnNlKG5vZGVzLCBjdXIpOwogICAgICB9CgogICAgICByZXR1cm4gdG1wOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHJvd1JlbmRlcihyb3csICRpbmRleCwgdm9pZCAwKTsKICAgIH0KICB9OwoKICByZXR1cm4gewogICAgd3JhcHBlZFJvd1JlbmRlciwKICAgIHRvb2x0aXBDb250ZW50LAogICAgdG9vbHRpcFRyaWdnZXIKICB9Owp9Cgpjb25zdCBkZWZhdWx0UHJvcHMgPSB7CiAgc3RvcmU6IHsKICAgIHJlcXVpcmVkOiB0cnVlLAogICAgdHlwZTogT2JqZWN0CiAgfSwKICBzdHJpcGU6IEJvb2xlYW4sCiAgdG9vbHRpcEVmZmVjdDogU3RyaW5nLAogIGNvbnRleHQ6IHsKICAgIGRlZmF1bHQ6ICgpID0+ICh7fSksCiAgICB0eXBlOiBPYmplY3QKICB9LAogIHJvd0NsYXNzTmFtZTogW1N0cmluZywgRnVuY3Rpb25dLAogIHJvd1N0eWxlOiBbT2JqZWN0LCBGdW5jdGlvbl0sCiAgZml4ZWQ6IHsKICAgIHR5cGU6IFN0cmluZywKICAgIGRlZmF1bHQ6ICIiCiAgfSwKICBoaWdobGlnaHQ6IEJvb2xlYW4KfTsKdmFyIFRhYmxlQm9keSA9IHZ1ZS5kZWZpbmVDb21wb25lbnQoewogIG5hbWU6ICJFbFRhYmxlQm9keSIsCiAgcHJvcHM6IGRlZmF1bHRQcm9wcywKCiAgc2V0dXAocHJvcHMpIHsKICAgIGNvbnN0IGluc3RhbmNlID0gdnVlLmdldEN1cnJlbnRJbnN0YW5jZSgpOwogICAgY29uc3QgcGFyZW50ID0gaW5zdGFuY2UucGFyZW50OwogICAgY29uc3QgewogICAgICB3cmFwcGVkUm93UmVuZGVyLAogICAgICB0b29sdGlwQ29udGVudCwKICAgICAgdG9vbHRpcFRyaWdnZXIKICAgIH0gPSB1c2VSZW5kZXIocHJvcHMpOwogICAgY29uc3QgewogICAgICBvbkNvbHVtbnNDaGFuZ2UsCiAgICAgIG9uU2Nyb2xsYWJsZUNoYW5nZQogICAgfSA9IHVzZUxheW91dE9ic2VydmVyKHBhcmVudCk7CiAgICB2dWUud2F0Y2gocHJvcHMuc3RvcmUuc3RhdGVzLmhvdmVyUm93LCAobmV3VmFsLCBvbGRWYWwpID0+IHsKICAgICAgaWYgKCFwcm9wcy5zdG9yZS5zdGF0ZXMuaXNDb21wbGV4LnZhbHVlIHx8IGlzU2VydmVyX19kZWZhdWx0WydkZWZhdWx0J10pIHJldHVybjsKICAgICAgbGV0IHJhZiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7CgogICAgICBpZiAoIXJhZikgewogICAgICAgIHJhZiA9IGZuID0+IHdpbmRvdy5zZXRUaW1lb3V0KGZuLCAxNik7CiAgICAgIH0KCiAgICAgIHJhZigoKSA9PiB7CiAgICAgICAgY29uc3Qgcm93cyA9IGluc3RhbmNlLnZub2RlLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoIi5lbC10YWJsZV9fcm93Iik7CiAgICAgICAgY29uc3Qgb2xkUm93ID0gcm93c1tvbGRWYWxdOwogICAgICAgIGNvbnN0IG5ld1JvdyA9IHJvd3NbbmV3VmFsXTsKCiAgICAgICAgaWYgKG9sZFJvdykgewogICAgICAgICAgZG9tLnJlbW92ZUNsYXNzKG9sZFJvdywgImhvdmVyLXJvdyIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5ld1JvdykgewogICAgICAgICAgZG9tLmFkZENsYXNzKG5ld1JvdywgImhvdmVyLXJvdyIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHZ1ZS5vblVubW91bnRlZCgoKSA9PiB7CiAgICAgIHZhciBfYTsKCiAgICAgIChfYSA9IHJlbW92ZVBvcHBlcikgPT0gbnVsbCA/IHZvaWQgMCA6IF9hKCk7CiAgICB9KTsKICAgIHZ1ZS5vblVwZGF0ZWQoKCkgPT4gewogICAgICB2YXIgX2E7CgogICAgICAoX2EgPSByZW1vdmVQb3BwZXIpID09IG51bGwgPyB2b2lkIDAgOiBfYSgpOwogICAgfSk7CiAgICByZXR1cm4gewogICAgICBvbkNvbHVtbnNDaGFuZ2UsCiAgICAgIG9uU2Nyb2xsYWJsZUNoYW5nZSwKICAgICAgd3JhcHBlZFJvd1JlbmRlciwKICAgICAgdG9vbHRpcENvbnRlbnQsCiAgICAgIHRvb2x0aXBUcmlnZ2VyCiAgICB9OwogIH0sCgogIHJlbmRlcigpIHsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLnN0b3JlLnN0YXRlcy5kYXRhLnZhbHVlIHx8IFtdOwogICAgcmV0dXJuIHZ1ZS5oKCJ0YWJsZSIsIHsKICAgICAgY2xhc3M6ICJlbC10YWJsZV9fYm9keSIsCiAgICAgIGNlbGxzcGFjaW5nOiAiMCIsCiAgICAgIGNlbGxwYWRkaW5nOiAiMCIsCiAgICAgIGJvcmRlcjogIjAiCiAgICB9LCBbaENvbGdyb3VwKHRoaXMuc3RvcmUuc3RhdGVzLmNvbHVtbnMudmFsdWUpLCB2dWUuaCgidGJvZHkiLCB7fSwgW2RhdGEucmVkdWNlKChhY2MsIHJvdykgPT4gewogICAgICByZXR1cm4gYWNjLmNvbmNhdCh0aGlzLndyYXBwZWRSb3dSZW5kZXIocm93LCBhY2MubGVuZ3RoKSk7CiAgICB9LCBbXSldKV0pOwogIH0KCn0pOwoKZnVuY3Rpb24gdXNlTWFwU3RhdGUoKSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgY29uc3QgdGFibGUgPSBpbnN0YW5jZS5wYXJlbnQ7CiAgY29uc3Qgc3RvcmUgPSB0YWJsZS5zdG9yZTsKICBjb25zdCBsZWZ0Rml4ZWRMZWFmQ291bnQgPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgcmV0dXJuIHN0b3JlLnN0YXRlcy5maXhlZExlYWZDb2x1bW5zTGVuZ3RoLnZhbHVlOwogIH0pOwogIGNvbnN0IHJpZ2h0Rml4ZWRMZWFmQ291bnQgPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgcmV0dXJuIHN0b3JlLnN0YXRlcy5yaWdodEZpeGVkQ29sdW1ucy52YWx1ZS5sZW5ndGg7CiAgfSk7CiAgY29uc3QgY29sdW1uc0NvdW50ID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIHJldHVybiBzdG9yZS5zdGF0ZXMuY29sdW1ucy52YWx1ZS5sZW5ndGg7CiAgfSk7CiAgY29uc3QgbGVmdEZpeGVkQ291bnQgPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgcmV0dXJuIHN0b3JlLnN0YXRlcy5maXhlZENvbHVtbnMudmFsdWUubGVuZ3RoOwogIH0pOwogIGNvbnN0IHJpZ2h0Rml4ZWRDb3VudCA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICByZXR1cm4gc3RvcmUuc3RhdGVzLnJpZ2h0Rml4ZWRDb2x1bW5zLnZhbHVlLmxlbmd0aDsKICB9KTsKICByZXR1cm4gewogICAgbGVmdEZpeGVkTGVhZkNvdW50LAogICAgcmlnaHRGaXhlZExlYWZDb3VudCwKICAgIGNvbHVtbnNDb3VudCwKICAgIGxlZnRGaXhlZENvdW50LAogICAgcmlnaHRGaXhlZENvdW50LAogICAgY29sdW1uczogc3RvcmUuc3RhdGVzLmNvbHVtbnMKICB9Owp9CgpmdW5jdGlvbiB1c2VTdHlsZSQxKHByb3BzKSB7CiAgY29uc3QgaW5zdGFuY2UgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgY29uc3QgdGFibGUgPSBpbnN0YW5jZS5wYXJlbnQ7CiAgY29uc3Qgc3RvcmUgPSB0YWJsZS5zdG9yZTsKICBjb25zdCB7CiAgICBsZWZ0Rml4ZWRMZWFmQ291bnQsCiAgICByaWdodEZpeGVkTGVhZkNvdW50LAogICAgY29sdW1uc0NvdW50LAogICAgbGVmdEZpeGVkQ291bnQsCiAgICByaWdodEZpeGVkQ291bnQsCiAgICBjb2x1bW5zCiAgfSA9IHVzZU1hcFN0YXRlKCk7CiAgY29uc3QgaGFzR3V0dGVyID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIHJldHVybiAhcHJvcHMuZml4ZWQgJiYgdGFibGUubGF5b3V0Lmd1dHRlcldpZHRoOwogIH0pOwoKICBjb25zdCBpc0NlbGxIaWRkZW4gPSAoaW5kZXgsIGNvbHVtbnMyLCBjb2x1bW4pID0+IHsKICAgIGlmIChwcm9wcy5maXhlZCB8fCBwcm9wcy5maXhlZCA9PT0gImxlZnQiKSB7CiAgICAgIHJldHVybiBpbmRleCA+PSBsZWZ0Rml4ZWRMZWFmQ291bnQudmFsdWU7CiAgICB9IGVsc2UgaWYgKHByb3BzLmZpeGVkID09PSAicmlnaHQiKSB7CiAgICAgIGxldCBiZWZvcmUgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleDsgaSsrKSB7CiAgICAgICAgYmVmb3JlICs9IGNvbHVtbnMyW2ldLmNvbFNwYW47CiAgICAgIH0KCiAgICAgIHJldHVybiBiZWZvcmUgPCBjb2x1bW5zQ291bnQudmFsdWUgLSByaWdodEZpeGVkTGVhZkNvdW50LnZhbHVlOwogICAgfSBlbHNlIGlmICghcHJvcHMuZml4ZWQgJiYgY29sdW1uLmZpeGVkKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGluZGV4IDwgbGVmdEZpeGVkQ291bnQudmFsdWUgfHwgaW5kZXggPj0gY29sdW1uc0NvdW50LnZhbHVlIC0gcmlnaHRGaXhlZENvdW50LnZhbHVlOwogICAgfQogIH07CgogIGNvbnN0IGdldFJvd0NsYXNzZXMgPSAoY29sdW1uLCBjZWxsSW5kZXgpID0+IHsKICAgIGNvbnN0IGNsYXNzZXMgPSBbY29sdW1uLmlkLCBjb2x1bW4uYWxpZ24sIGNvbHVtbi5sYWJlbENsYXNzTmFtZV07CgogICAgaWYgKGNvbHVtbi5jbGFzc05hbWUpIHsKICAgICAgY2xhc3Nlcy5wdXNoKGNvbHVtbi5jbGFzc05hbWUpOwogICAgfQoKICAgIGlmIChpc0NlbGxIaWRkZW4oY2VsbEluZGV4LCBzdG9yZS5zdGF0ZXMuY29sdW1ucy52YWx1ZSwgY29sdW1uKSkgewogICAgICBjbGFzc2VzLnB1c2goImlzLWhpZGRlbiIpOwogICAgfQoKICAgIGlmICghY29sdW1uLmNoaWxkcmVuKSB7CiAgICAgIGNsYXNzZXMucHVzaCgiaXMtbGVhZiIpOwogICAgfQoKICAgIHJldHVybiBjbGFzc2VzOwogIH07CgogIHJldHVybiB7CiAgICBoYXNHdXR0ZXIsCiAgICBnZXRSb3dDbGFzc2VzLAogICAgY29sdW1ucwogIH07Cn0KCnZhciBUYWJsZUZvb3RlciA9IHZ1ZS5kZWZpbmVDb21wb25lbnQoewogIG5hbWU6ICJFbFRhYmxlRm9vdGVyIiwKICBwcm9wczogewogICAgZml4ZWQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKICAgIHN0b3JlOiB7CiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICB0eXBlOiBPYmplY3QKICAgIH0sCiAgICBzdW1tYXJ5TWV0aG9kOiBGdW5jdGlvbiwKICAgIHN1bVRleHQ6IFN0cmluZywKICAgIGJvcmRlcjogQm9vbGVhbiwKICAgIGRlZmF1bHRTb3J0OiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4gewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwcm9wOiAiIiwKICAgICAgICAgIG9yZGVyOiAiIgogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9LAoKICBzZXR1cChwcm9wcykgewogICAgY29uc3QgewogICAgICBoYXNHdXR0ZXIsCiAgICAgIGdldFJvd0NsYXNzZXMsCiAgICAgIGNvbHVtbnMKICAgIH0gPSB1c2VTdHlsZSQxKHByb3BzKTsKICAgIHJldHVybiB7CiAgICAgIGdldFJvd0NsYXNzZXMsCiAgICAgIGhhc0d1dHRlciwKICAgICAgY29sdW1ucwogICAgfTsKICB9LAoKICByZW5kZXIoKSB7CiAgICBsZXQgc3VtcyA9IFtdOwoKICAgIGlmICh0aGlzLnN1bW1hcnlNZXRob2QpIHsKICAgICAgc3VtcyA9IHRoaXMuc3VtbWFyeU1ldGhvZCh7CiAgICAgICAgY29sdW1uczogdGhpcy5jb2x1bW5zLAogICAgICAgIGRhdGE6IHRoaXMuc3RvcmUuc3RhdGVzLmRhdGEudmFsdWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uLCBpbmRleCkgPT4gewogICAgICAgIGlmIChpbmRleCA9PT0gMCkgewogICAgICAgICAgc3Vtc1tpbmRleF0gPSB0aGlzLnN1bVRleHQ7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCB2YWx1ZXMgPSB0aGlzLnN0b3JlLnN0YXRlcy5kYXRhLnZhbHVlLm1hcChpdGVtID0+IE51bWJlcihpdGVtW2NvbHVtbi5wcm9wZXJ0eV0pKTsKICAgICAgICBjb25zdCBwcmVjaXNpb25zID0gW107CiAgICAgICAgbGV0IG5vdE51bWJlciA9IHRydWU7CiAgICAgICAgdmFsdWVzLmZvckVhY2godmFsdWUgPT4gewogICAgICAgICAgaWYgKCFpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgbm90TnVtYmVyID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGRlY2ltYWwgPSAoIiIgKyB2YWx1ZSkuc3BsaXQoIi4iKVsxXTsKICAgICAgICAgICAgcHJlY2lzaW9ucy5wdXNoKGRlY2ltYWwgPyBkZWNpbWFsLmxlbmd0aCA6IDApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IE1hdGgubWF4LmFwcGx5KG51bGwsIHByZWNpc2lvbnMpOwoKICAgICAgICBpZiAoIW5vdE51bWJlcikgewogICAgICAgICAgc3Vtc1tpbmRleF0gPSB2YWx1ZXMucmVkdWNlKChwcmV2LCBjdXJyKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyKGN1cnIpOwoKICAgICAgICAgICAgaWYgKCFpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCgocHJldiArIGN1cnIpLnRvRml4ZWQoTWF0aC5taW4ocHJlY2lzaW9uLCAyMCkpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gcHJldjsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1bXNbaW5kZXhdID0gIiI7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gdnVlLmgoInRhYmxlIiwgewogICAgICBjbGFzczogImVsLXRhYmxlX19mb290ZXIiLAogICAgICBjZWxsc3BhY2luZzogIjAiLAogICAgICBjZWxscGFkZGluZzogIjAiLAogICAgICBib3JkZXI6ICIwIgogICAgfSwgW2hDb2xncm91cCh0aGlzLmNvbHVtbnMsIHRoaXMuaGFzR3V0dGVyKSwgdnVlLmgoInRib2R5IiwgewogICAgICBjbGFzczogW3sKICAgICAgICAiaGFzLWd1dHRlciI6IHRoaXMuaGFzR3V0dGVyCiAgICAgIH1dCiAgICB9LCBbdnVlLmgoInRyIiwge30sIFsuLi50aGlzLmNvbHVtbnMubWFwKChjb2x1bW4sIGNlbGxJbmRleCkgPT4gdnVlLmgoInRkIiwgewogICAgICBrZXk6IGNlbGxJbmRleCwKICAgICAgY29sc3BhbjogY29sdW1uLmNvbFNwYW4sCiAgICAgIHJvd3NwYW46IGNvbHVtbi5yb3dTcGFuLAogICAgICBjbGFzczogdGhpcy5nZXRSb3dDbGFzc2VzKGNvbHVtbiwgY2VsbEluZGV4KQogICAgfSwgW3Z1ZS5oKCJkaXYiLCB7CiAgICAgIGNsYXNzOiBbImNlbGwiLCBjb2x1bW4ubGFiZWxDbGFzc05hbWVdCiAgICB9LCBbc3Vtc1tjZWxsSW5kZXhdXSldKSksIHRoaXMuaGFzR3V0dGVyICYmIGhHdXR0ZXIoKV0pXSldKTsKICB9Cgp9KTsKCmZ1bmN0aW9uIHVzZVV0aWxzJDEoc3RvcmUpIHsKICBjb25zdCBzZXRDdXJyZW50Um93ID0gcm93ID0+IHsKICAgIHN0b3JlLmNvbW1pdCgic2V0Q3VycmVudFJvdyIsIHJvdyk7CiAgfTsKCiAgY29uc3QgdG9nZ2xlUm93U2VsZWN0aW9uID0gKHJvdywgc2VsZWN0ZWQpID0+IHsKICAgIHN0b3JlLnRvZ2dsZVJvd1NlbGVjdGlvbihyb3csIHNlbGVjdGVkLCBmYWxzZSk7CiAgICBzdG9yZS51cGRhdGVBbGxTZWxlY3RlZCgpOwogIH07CgogIGNvbnN0IGNsZWFyU2VsZWN0aW9uID0gKCkgPT4gewogICAgc3RvcmUuY2xlYXJTZWxlY3Rpb24oKTsKICB9OwoKICBjb25zdCBjbGVhckZpbHRlciA9IGNvbHVtbktleXMgPT4gewogICAgc3RvcmUuY2xlYXJGaWx0ZXIoY29sdW1uS2V5cyk7CiAgfTsKCiAgY29uc3QgdG9nZ2xlQWxsU2VsZWN0aW9uID0gKCkgPT4gewogICAgc3RvcmUuY29tbWl0KCJ0b2dnbGVBbGxTZWxlY3Rpb24iKTsKICB9OwoKICBjb25zdCB0b2dnbGVSb3dFeHBhbnNpb24gPSAocm93LCBleHBhbmRlZCkgPT4gewogICAgc3RvcmUudG9nZ2xlUm93RXhwYW5zaW9uQWRhcHRlcihyb3csIGV4cGFuZGVkKTsKICB9OwoKICBjb25zdCBjbGVhclNvcnQgPSAoKSA9PiB7CiAgICBzdG9yZS5jbGVhclNvcnQoKTsKICB9OwoKICBjb25zdCBzb3J0ID0gKHByb3AsIG9yZGVyKSA9PiB7CiAgICBzdG9yZS5jb21taXQoInNvcnQiLCB7CiAgICAgIHByb3AsCiAgICAgIG9yZGVyCiAgICB9KTsKICB9OwoKICByZXR1cm4gewogICAgc2V0Q3VycmVudFJvdywKICAgIHRvZ2dsZVJvd1NlbGVjdGlvbiwKICAgIGNsZWFyU2VsZWN0aW9uLAogICAgY2xlYXJGaWx0ZXIsCiAgICB0b2dnbGVBbGxTZWxlY3Rpb24sCiAgICB0b2dnbGVSb3dFeHBhbnNpb24sCiAgICBjbGVhclNvcnQsCiAgICBzb3J0CiAgfTsKfQoKZnVuY3Rpb24gdXNlU3R5bGUkMihwcm9wcywgbGF5b3V0LCBzdG9yZSwgdGFibGUpIHsKICBjb25zdCAkRUxFTUVOVCA9IHV0aWwudXNlR2xvYmFsQ29uZmlnKCk7CiAgY29uc3QgaXNIaWRkZW4gPSB2dWUucmVmKGZhbHNlKTsKICBjb25zdCByZW5kZXJFeHBhbmRlZCA9IHZ1ZS5yZWYobnVsbCk7CiAgY29uc3QgcmVzaXplUHJveHlWaXNpYmxlID0gdnVlLnJlZihmYWxzZSk7CgogIGNvbnN0IHNldERyYWdWaXNpYmxlID0gdmlzaWJsZSA9PiB7CiAgICByZXNpemVQcm94eVZpc2libGUudmFsdWUgPSB2aXNpYmxlOwogIH07CgogIGNvbnN0IHJlc2l6ZVN0YXRlID0gdnVlLnJlZih7CiAgICB3aWR0aDogbnVsbCwKICAgIGhlaWdodDogbnVsbAogIH0pOwogIGNvbnN0IGlzR3JvdXAgPSB2dWUucmVmKGZhbHNlKTsKICB2dWUud2F0Y2hFZmZlY3QoKCkgPT4gewogICAgbGF5b3V0LnNldEhlaWdodChwcm9wcy5oZWlnaHQpOwogIH0pOwogIHZ1ZS53YXRjaEVmZmVjdCgoKSA9PiB7CiAgICBsYXlvdXQuc2V0TWF4SGVpZ2h0KHByb3BzLm1heEhlaWdodCk7CiAgfSk7CiAgdnVlLndhdGNoKCgpID0+IFtwcm9wcy5jdXJyZW50Um93S2V5LCBzdG9yZS5zdGF0ZXMucm93S2V5XSwgKFtjdXJyZW50Um93S2V5LCByb3dLZXldKSA9PiB7CiAgICBpZiAoIXZ1ZS51bnJlZihyb3dLZXkpKSByZXR1cm47CiAgICBzdG9yZS5zZXRDdXJyZW50Um93S2V5KGN1cnJlbnRSb3dLZXkgKyAiIik7CiAgfSwgewogICAgaW1tZWRpYXRlOiB0cnVlCiAgfSk7CiAgdnVlLndhdGNoKCgpID0+IHByb3BzLmRhdGEsIGRhdGEgPT4gewogICAgdGFibGUuc3RvcmUuY29tbWl0KCJzZXREYXRhIiwgZGF0YSk7CiAgfSwgewogICAgaW1tZWRpYXRlOiB0cnVlLAogICAgZGVlcDogdHJ1ZQogIH0pOwogIHZ1ZS53YXRjaEVmZmVjdCgoKSA9PiB7CiAgICBpZiAocHJvcHMuZXhwYW5kUm93S2V5cykgewogICAgICBzdG9yZS5zZXRFeHBhbmRSb3dLZXlzQWRhcHRlcihwcm9wcy5leHBhbmRSb3dLZXlzKTsKICAgIH0KICB9KTsKCiAgY29uc3QgaGFuZGxlTW91c2VMZWF2ZSA9ICgpID0+IHsKICAgIHRhYmxlLnN0b3JlLmNvbW1pdCgic2V0SG92ZXJSb3ciLCBudWxsKTsKICAgIGlmICh0YWJsZS5ob3ZlclN0YXRlKSB0YWJsZS5ob3ZlclN0YXRlID0gbnVsbDsKICB9OwoKICBjb25zdCBoYW5kbGVIZWFkZXJGb290ZXJNb3VzZXdoZWVsID0gKGV2ZW50LCBkYXRhKSA9PiB7CiAgICBjb25zdCB7CiAgICAgIHBpeGVsWCwKICAgICAgcGl4ZWxZCiAgICB9ID0gZGF0YTsKCiAgICBpZiAoTWF0aC5hYnMocGl4ZWxYKSA+PSBNYXRoLmFicyhwaXhlbFkpKSB7CiAgICAgIHRhYmxlLnJlZnMuYm9keVdyYXBwZXIuc2Nyb2xsTGVmdCArPSBkYXRhLnBpeGVsWCAvIDU7CiAgICB9CiAgfTsKCiAgY29uc3Qgc2hvdWxkVXBkYXRlSGVpZ2h0ID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIHJldHVybiBwcm9wcy5oZWlnaHQgfHwgcHJvcHMubWF4SGVpZ2h0IHx8IHN0b3JlLnN0YXRlcy5maXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMCB8fCBzdG9yZS5zdGF0ZXMucmlnaHRGaXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMDsKICB9KTsKCiAgY29uc3QgZG9MYXlvdXQgPSAoKSA9PiB7CiAgICBpZiAoc2hvdWxkVXBkYXRlSGVpZ2h0LnZhbHVlKSB7CiAgICAgIGxheW91dC51cGRhdGVFbHNIZWlnaHQoKTsKICAgIH0KCiAgICBsYXlvdXQudXBkYXRlQ29sdW1uc1dpZHRoKCk7CiAgICBzeW5jUG9zdGlvbigpOwogIH07CgogIHZ1ZS5vbk1vdW50ZWQoKCkgPT4gewogICAgc2V0U2Nyb2xsQ2xhc3MoImlzLXNjcm9sbGluZy1sZWZ0Iik7CiAgICBiaW5kRXZlbnRzKCk7CiAgICBzdG9yZS51cGRhdGVDb2x1bW5zKCk7CiAgICBkb0xheW91dCgpOwogICAgcmVzaXplU3RhdGUudmFsdWUgPSB7CiAgICAgIHdpZHRoOiB0YWJsZS52bm9kZS5lbC5vZmZzZXRXaWR0aCwKICAgICAgaGVpZ2h0OiB0YWJsZS52bm9kZS5lbC5vZmZzZXRIZWlnaHQKICAgIH07CiAgICBzdG9yZS5zdGF0ZXMuY29sdW1ucy52YWx1ZS5mb3JFYWNoKGNvbHVtbiA9PiB7CiAgICAgIGlmIChjb2x1bW4uZmlsdGVyZWRWYWx1ZSAmJiBjb2x1bW4uZmlsdGVyZWRWYWx1ZS5sZW5ndGgpIHsKICAgICAgICB0YWJsZS5zdG9yZS5jb21taXQoImZpbHRlckNoYW5nZSIsIHsKICAgICAgICAgIGNvbHVtbiwKICAgICAgICAgIHZhbHVlczogY29sdW1uLmZpbHRlcmVkVmFsdWUsCiAgICAgICAgICBzaWxlbnQ6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICB0YWJsZS4kcmVhZHkgPSB0cnVlOwogIH0pOwoKICBjb25zdCBzZXRTY3JvbGxDbGFzc0J5RWwgPSAoZWwsIGNsYXNzTmFtZSkgPT4gewogICAgaWYgKCFlbCkgcmV0dXJuOwogICAgY29uc3QgY2xhc3NMaXN0ID0gQXJyYXkuZnJvbShlbC5jbGFzc0xpc3QpLmZpbHRlcihpdGVtID0+ICFpdGVtLnN0YXJ0c1dpdGgoImlzLXNjcm9sbGluZy0iKSk7CiAgICBjbGFzc0xpc3QucHVzaChsYXlvdXQuc2Nyb2xsWC52YWx1ZSA/IGNsYXNzTmFtZSA6ICJpcy1zY3JvbGxpbmctbm9uZSIpOwogICAgZWwuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oIiAiKTsKICB9OwoKICBjb25zdCBzZXRTY3JvbGxDbGFzcyA9IGNsYXNzTmFtZSA9PiB7CiAgICBjb25zdCB7CiAgICAgIGJvZHlXcmFwcGVyCiAgICB9ID0gdGFibGUucmVmczsKICAgIHNldFNjcm9sbENsYXNzQnlFbChib2R5V3JhcHBlciwgY2xhc3NOYW1lKTsKICB9OwoKICBjb25zdCBzeW5jUG9zdGlvbiA9IHRocm90dGxlX19kZWZhdWx0WydkZWZhdWx0J10oZnVuY3Rpb24gKCkgewogICAgaWYgKCF0YWJsZS5yZWZzLmJvZHlXcmFwcGVyKSByZXR1cm47CiAgICBjb25zdCB7CiAgICAgIHNjcm9sbExlZnQsCiAgICAgIHNjcm9sbFRvcCwKICAgICAgb2Zmc2V0V2lkdGgsCiAgICAgIHNjcm9sbFdpZHRoCiAgICB9ID0gdGFibGUucmVmcy5ib2R5V3JhcHBlcjsKICAgIGNvbnN0IHsKICAgICAgaGVhZGVyV3JhcHBlciwKICAgICAgZm9vdGVyV3JhcHBlciwKICAgICAgZml4ZWRCb2R5V3JhcHBlciwKICAgICAgcmlnaHRGaXhlZEJvZHlXcmFwcGVyCiAgICB9ID0gdGFibGUucmVmczsKICAgIGlmIChoZWFkZXJXcmFwcGVyKSBoZWFkZXJXcmFwcGVyLnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0OwogICAgaWYgKGZvb3RlcldyYXBwZXIpIGZvb3RlcldyYXBwZXIuc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7CiAgICBpZiAoZml4ZWRCb2R5V3JhcHBlcikgZml4ZWRCb2R5V3JhcHBlci5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7CiAgICBpZiAocmlnaHRGaXhlZEJvZHlXcmFwcGVyKSByaWdodEZpeGVkQm9keVdyYXBwZXIuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wOwogICAgY29uc3QgbWF4U2Nyb2xsTGVmdFBvc2l0aW9uID0gc2Nyb2xsV2lkdGggLSBvZmZzZXRXaWR0aCAtIDE7CgogICAgaWYgKHNjcm9sbExlZnQgPj0gbWF4U2Nyb2xsTGVmdFBvc2l0aW9uKSB7CiAgICAgIHNldFNjcm9sbENsYXNzKCJpcy1zY3JvbGxpbmctcmlnaHQiKTsKICAgIH0gZWxzZSBpZiAoc2Nyb2xsTGVmdCA9PT0gMCkgewogICAgICBzZXRTY3JvbGxDbGFzcygiaXMtc2Nyb2xsaW5nLWxlZnQiKTsKICAgIH0gZWxzZSB7CiAgICAgIHNldFNjcm9sbENsYXNzKCJpcy1zY3JvbGxpbmctbWlkZGxlIik7CiAgICB9CiAgfSwgMTApOwoKICBjb25zdCBiaW5kRXZlbnRzID0gKCkgPT4gewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIGRvTGF5b3V0KTsKICAgIHRhYmxlLnJlZnMuYm9keVdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgc3luY1Bvc3Rpb24sIHsKICAgICAgcGFzc2l2ZTogdHJ1ZQogICAgfSk7CgogICAgaWYgKHByb3BzLmZpdCkgewogICAgICByZXNpemVFdmVudC5hZGRSZXNpemVMaXN0ZW5lcih0YWJsZS52bm9kZS5lbCwgcmVzaXplTGlzdGVuZXIpOwogICAgfQogIH07CgogIHZ1ZS5vblVubW91bnRlZCgoKSA9PiB7CiAgICB1bmJpbmRFdmVudHMoKTsKICB9KTsKCiAgY29uc3QgdW5iaW5kRXZlbnRzID0gKCkgPT4gewogICAgdmFyIF9hOwoKICAgIChfYSA9IHRhYmxlLnJlZnMuYm9keVdyYXBwZXIpID09IG51bGwgPyB2b2lkIDAgOiBfYS5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBzeW5jUG9zdGlvbiwgdHJ1ZSk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgZG9MYXlvdXQpOwoKICAgIGlmIChwcm9wcy5maXQpIHsKICAgICAgcmVzaXplRXZlbnQucmVtb3ZlUmVzaXplTGlzdGVuZXIodGFibGUudm5vZGUuZWwsIHJlc2l6ZUxpc3RlbmVyKTsKICAgIH0KICB9OwoKICBjb25zdCByZXNpemVMaXN0ZW5lciA9ICgpID0+IHsKICAgIGlmICghdGFibGUuJHJlYWR5KSByZXR1cm47CiAgICBsZXQgc2hvdWxkVXBkYXRlTGF5b3V0ID0gZmFsc2U7CiAgICBjb25zdCBlbCA9IHRhYmxlLnZub2RlLmVsOwogICAgY29uc3QgewogICAgICB3aWR0aDogb2xkV2lkdGgsCiAgICAgIGhlaWdodDogb2xkSGVpZ2h0CiAgICB9ID0gcmVzaXplU3RhdGUudmFsdWU7CiAgICBjb25zdCB3aWR0aCA9IGVsLm9mZnNldFdpZHRoOwoKICAgIGlmIChvbGRXaWR0aCAhPT0gd2lkdGgpIHsKICAgICAgc2hvdWxkVXBkYXRlTGF5b3V0ID0gdHJ1ZTsKICAgIH0KCiAgICBjb25zdCBoZWlnaHQgPSBlbC5vZmZzZXRIZWlnaHQ7CgogICAgaWYgKChwcm9wcy5oZWlnaHQgfHwgc2hvdWxkVXBkYXRlSGVpZ2h0LnZhbHVlKSAmJiBvbGRIZWlnaHQgIT09IGhlaWdodCkgewogICAgICBzaG91bGRVcGRhdGVMYXlvdXQgPSB0cnVlOwogICAgfQoKICAgIGlmIChzaG91bGRVcGRhdGVMYXlvdXQpIHsKICAgICAgcmVzaXplU3RhdGUudmFsdWUgPSB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH07CiAgICAgIGRvTGF5b3V0KCk7CiAgICB9CiAgfTsKCiAgY29uc3QgdGFibGVTaXplID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIHJldHVybiBwcm9wcy5zaXplIHx8ICRFTEVNRU5ULnNpemU7CiAgfSk7CiAgY29uc3QgYm9keVdpZHRoID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIGNvbnN0IHsKICAgICAgYm9keVdpZHRoOiBib2R5V2lkdGhfLAogICAgICBzY3JvbGxZLAogICAgICBndXR0ZXJXaWR0aAogICAgfSA9IGxheW91dDsKICAgIHJldHVybiBib2R5V2lkdGhfLnZhbHVlID8gYm9keVdpZHRoXy52YWx1ZSAtIChzY3JvbGxZLnZhbHVlID8gZ3V0dGVyV2lkdGggOiAwKSArICJweCIgOiAiIjsKICB9KTsKICBjb25zdCBib2R5SGVpZ2h0ID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIGNvbnN0IGhlYWRlckhlaWdodCA9IGxheW91dC5oZWFkZXJIZWlnaHQudmFsdWUgfHwgMDsKICAgIGNvbnN0IGJvZHlIZWlnaHQyID0gbGF5b3V0LmJvZHlIZWlnaHQudmFsdWU7CiAgICBjb25zdCBmb290ZXJIZWlnaHQgPSBsYXlvdXQuZm9vdGVySGVpZ2h0LnZhbHVlIHx8IDA7CgogICAgaWYgKHByb3BzLmhlaWdodCkgewogICAgICByZXR1cm4gewogICAgICAgIGhlaWdodDogYm9keUhlaWdodDIgPyBib2R5SGVpZ2h0MiArICJweCIgOiAiIgogICAgICB9OwogICAgfSBlbHNlIGlmIChwcm9wcy5tYXhIZWlnaHQpIHsKICAgICAgY29uc3QgbWF4SGVpZ2h0ID0gcGFyc2VIZWlnaHQocHJvcHMubWF4SGVpZ2h0KTsKCiAgICAgIGlmICh0eXBlb2YgbWF4SGVpZ2h0ID09PSAibnVtYmVyIikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAibWF4LWhlaWdodCI6IG1heEhlaWdodCAtIGZvb3RlckhlaWdodCAtIChwcm9wcy5zaG93SGVhZGVyID8gaGVhZGVySGVpZ2h0IDogMCkgKyAicHgiCiAgICAgICAgfTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7fTsKICB9KTsKICBjb25zdCBlbXB0eUJsb2NrU3R5bGUgPSB2dWUuY29tcHV0ZWQoKCkgPT4gewogICAgaWYgKHByb3BzLmRhdGEgJiYgcHJvcHMuZGF0YS5sZW5ndGgpIHJldHVybiBudWxsOwogICAgbGV0IGhlaWdodCA9ICIxMDAlIjsKCiAgICBpZiAobGF5b3V0LmFwcGVuZEhlaWdodC52YWx1ZSkgewogICAgICBoZWlnaHQgPSBgY2FsYygxMDAlIC0gJHtsYXlvdXQuYXBwZW5kSGVpZ2h0LnZhbHVlfXB4KWA7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgd2lkdGg6IGJvZHlXaWR0aC52YWx1ZSwKICAgICAgaGVpZ2h0CiAgICB9OwogIH0pOwoKICBjb25zdCBoYW5kbGVGaXhlZE1vdXNld2hlZWwgPSAoZXZlbnQsIGRhdGEpID0+IHsKICAgIGNvbnN0IGJvZHlXcmFwcGVyID0gdGFibGUucmVmcy5ib2R5V3JhcHBlcjsKCiAgICBpZiAoTWF0aC5hYnMoZGF0YS5zcGluWSkgPiAwKSB7CiAgICAgIGNvbnN0IGN1cnJlbnRTY3JvbGxUb3AgPSBib2R5V3JhcHBlci5zY3JvbGxUb3A7CgogICAgICBpZiAoZGF0YS5waXhlbFkgPCAwICYmIGN1cnJlbnRTY3JvbGxUb3AgIT09IDApIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CgogICAgICBpZiAoZGF0YS5waXhlbFkgPiAwICYmIGJvZHlXcmFwcGVyLnNjcm9sbEhlaWdodCAtIGJvZHlXcmFwcGVyLmNsaWVudEhlaWdodCA+IGN1cnJlbnRTY3JvbGxUb3ApIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CgogICAgICBib2R5V3JhcHBlci5zY3JvbGxUb3AgKz0gTWF0aC5jZWlsKGRhdGEucGl4ZWxZIC8gNSk7CiAgICB9IGVsc2UgewogICAgICBib2R5V3JhcHBlci5zY3JvbGxMZWZ0ICs9IE1hdGguY2VpbChkYXRhLnBpeGVsWCAvIDUpOwogICAgfQogIH07CgogIGNvbnN0IGZpeGVkSGVpZ2h0ID0gdnVlLmNvbXB1dGVkKCgpID0+IHsKICAgIGlmIChwcm9wcy5tYXhIZWlnaHQpIHsKICAgICAgaWYgKHByb3BzLnNob3dTdW1tYXJ5KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGJvdHRvbTogMAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgYm90dG9tOiBsYXlvdXQuc2Nyb2xsWC52YWx1ZSAmJiBwcm9wcy5kYXRhLmxlbmd0aCA/IGxheW91dC5ndXR0ZXJXaWR0aCArICJweCIgOiAiIgogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgaWYgKHByb3BzLnNob3dTdW1tYXJ5KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGhlaWdodDogbGF5b3V0LnRhYmxlSGVpZ2h0LnZhbHVlID8gbGF5b3V0LnRhYmxlSGVpZ2h0LnZhbHVlICsgInB4IiA6ICIiCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBoZWlnaHQ6IGxheW91dC52aWV3cG9ydEhlaWdodC52YWx1ZSA/IGxheW91dC52aWV3cG9ydEhlaWdodC52YWx1ZSArICJweCIgOiAiIgogICAgICB9OwogICAgfQogIH0pOwogIGNvbnN0IGZpeGVkQm9keUhlaWdodCA9IHZ1ZS5jb21wdXRlZCgoKSA9PiB7CiAgICBpZiAocHJvcHMuaGVpZ2h0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaGVpZ2h0OiBsYXlvdXQuZml4ZWRCb2R5SGVpZ2h0LnZhbHVlID8gbGF5b3V0LmZpeGVkQm9keUhlaWdodC52YWx1ZSArICJweCIgOiAiIgogICAgICB9OwogICAgfSBlbHNlIGlmIChwcm9wcy5tYXhIZWlnaHQpIHsKICAgICAgbGV0IG1heEhlaWdodCA9IHBhcnNlSGVpZ2h0KHByb3BzLm1heEhlaWdodCk7CgogICAgICBpZiAodHlwZW9mIG1heEhlaWdodCA9PT0gIm51bWJlciIpIHsKICAgICAgICBtYXhIZWlnaHQgPSBsYXlvdXQuc2Nyb2xsWC52YWx1ZSA/IG1heEhlaWdodCAtIGxheW91dC5ndXR0ZXJXaWR0aCA6IG1heEhlaWdodDsKCiAgICAgICAgaWYgKHByb3BzLnNob3dIZWFkZXIpIHsKICAgICAgICAgIG1heEhlaWdodCAtPSBsYXlvdXQuaGVhZGVySGVpZ2h0LnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgbWF4SGVpZ2h0IC09IGxheW91dC5mb290ZXJIZWlnaHQudmFsdWU7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICJtYXgtaGVpZ2h0IjogbWF4SGVpZ2h0ICsgInB4IgogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4ge307CiAgfSk7CiAgcmV0dXJuIHsKICAgIGlzSGlkZGVuLAogICAgcmVuZGVyRXhwYW5kZWQsCiAgICBzZXREcmFnVmlzaWJsZSwKICAgIGlzR3JvdXAsCiAgICBoYW5kbGVNb3VzZUxlYXZlLAogICAgaGFuZGxlSGVhZGVyRm9vdGVyTW91c2V3aGVlbCwKICAgIHRhYmxlU2l6ZSwKICAgIGJvZHlIZWlnaHQsCiAgICBlbXB0eUJsb2NrU3R5bGUsCiAgICBoYW5kbGVGaXhlZE1vdXNld2hlZWwsCiAgICBmaXhlZEhlaWdodCwKICAgIGZpeGVkQm9keUhlaWdodCwKICAgIHJlc2l6ZVByb3h5VmlzaWJsZSwKICAgIGJvZHlXaWR0aCwKICAgIHJlc2l6ZVN0YXRlLAogICAgZG9MYXlvdXQKICB9Owp9Cgp2YXIgZGVmYXVsdFByb3BzJDEgPSB7CiAgZGF0YTogewogICAgdHlwZTogQXJyYXksCiAgICBkZWZhdWx0OiAoKSA9PiB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICB9LAogIHNpemU6IFN0cmluZywKICB3aWR0aDogW1N0cmluZywgTnVtYmVyXSwKICBoZWlnaHQ6IFtTdHJpbmcsIE51bWJlcl0sCiAgbWF4SGVpZ2h0OiBbU3RyaW5nLCBOdW1iZXJdLAogIGZpdDogewogICAgdHlwZTogQm9vbGVhbiwKICAgIGRlZmF1bHQ6IHRydWUKICB9LAogIHN0cmlwZTogQm9vbGVhbiwKICBib3JkZXI6IEJvb2xlYW4sCiAgcm93S2V5OiBbU3RyaW5nLCBGdW5jdGlvbl0sCiAgc2hvd0hlYWRlcjogewogICAgdHlwZTogQm9vbGVhbiwKICAgIGRlZmF1bHQ6IHRydWUKICB9LAogIHNob3dTdW1tYXJ5OiBCb29sZWFuLAogIHN1bVRleHQ6IFN0cmluZywKICBzdW1tYXJ5TWV0aG9kOiBGdW5jdGlvbiwKICByb3dDbGFzc05hbWU6IFtTdHJpbmcsIEZ1bmN0aW9uXSwKICByb3dTdHlsZTogW09iamVjdCwgRnVuY3Rpb25dLAogIGNlbGxDbGFzc05hbWU6IFtTdHJpbmcsIEZ1bmN0aW9uXSwKICBjZWxsU3R5bGU6IFtPYmplY3QsIEZ1bmN0aW9uXSwKICBoZWFkZXJSb3dDbGFzc05hbWU6IFtTdHJpbmcsIEZ1bmN0aW9uXSwKICBoZWFkZXJSb3dTdHlsZTogW09iamVjdCwgRnVuY3Rpb25dLAogIGhlYWRlckNlbGxDbGFzc05hbWU6IFtTdHJpbmcsIEZ1bmN0aW9uXSwKICBoZWFkZXJDZWxsU3R5bGU6IFtPYmplY3QsIEZ1bmN0aW9uXSwKICBoaWdobGlnaHRDdXJyZW50Um93OiBCb29sZWFuLAogIGN1cnJlbnRSb3dLZXk6IFtTdHJpbmcsIE51bWJlcl0sCiAgZW1wdHlUZXh0OiBTdHJpbmcsCiAgZXhwYW5kUm93S2V5czogQXJyYXksCiAgZGVmYXVsdEV4cGFuZEFsbDogQm9vbGVhbiwKICBkZWZhdWx0U29ydDogT2JqZWN0LAogIHRvb2x0aXBFZmZlY3Q6IFN0cmluZywKICBzcGFuTWV0aG9kOiBGdW5jdGlvbiwKICBzZWxlY3RPbkluZGV0ZXJtaW5hdGU6IHsKICAgIHR5cGU6IEJvb2xlYW4sCiAgICBkZWZhdWx0OiB0cnVlCiAgfSwKICBpbmRlbnQ6IHsKICAgIHR5cGU6IE51bWJlciwKICAgIGRlZmF1bHQ6IDE2CiAgfSwKICB0cmVlUHJvcHM6IHsKICAgIHR5cGU6IE9iamVjdCwKICAgIGRlZmF1bHQ6ICgpID0+IHsKICAgICAgcmV0dXJuIHsKICAgICAgICBoYXNDaGlsZHJlbjogImhhc0NoaWxkcmVuIiwKICAgICAgICBjaGlsZHJlbjogImNoaWxkcmVuIgogICAgICB9OwogICAgfQogIH0sCiAgbGF6eTogQm9vbGVhbiwKICBsb2FkOiBGdW5jdGlvbiwKICBzdHlsZTogewogICAgdHlwZTogT2JqZWN0LAogICAgZGVmYXVsdDogKCkgPT4gKHt9KQogIH0sCiAgY2xhc3NOYW1lOiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICBkZWZhdWx0OiAiIgogIH0KfTsKbGV0IHRhYmxlSWRTZWVkID0gMTsKdmFyIHNjcmlwdCQxID0gdnVlLmRlZmluZUNvbXBvbmVudCh7CiAgbmFtZTogIkVsVGFibGUiLAogIGRpcmVjdGl2ZXM6IHsKICAgIE1vdXNld2hlZWw6IGRpcmVjdGl2ZXMuTW91c2V3aGVlbAogIH0sCiAgY29tcG9uZW50czogewogICAgVGFibGVIZWFkZXIsCiAgICBUYWJsZUJvZHksCiAgICBUYWJsZUZvb3RlcgogIH0sCiAgcHJvcHM6IGRlZmF1bHRQcm9wcyQxLAogIGVtaXRzOiBbInNlbGVjdCIsICJzZWxlY3QtYWxsIiwgInNlbGVjdGlvbi1jaGFuZ2UiLCAiY2VsbC1tb3VzZS1lbnRlciIsICJjZWxsLW1vdXNlLWxlYXZlIiwgImNlbGwtY29udGV4dG1lbnUiLCAiY2VsbC1jbGljayIsICJjZWxsLWRibGNsaWNrIiwgInJvdy1jbGljayIsICJyb3ctY29udGV4dG1lbnUiLCAicm93LWRibGNsaWNrIiwgImhlYWRlci1jbGljayIsICJoZWFkZXItY29udGV4dG1lbnUiLCAic29ydC1jaGFuZ2UiLCAiZmlsdGVyLWNoYW5nZSIsICJjdXJyZW50LWNoYW5nZSIsICJoZWFkZXItZHJhZ2VuZCIsICJleHBhbmQtY2hhbmdlIl0sCgogIHNldHVwKHByb3BzKSB7CiAgICBsZXQgdGFibGUgPSB2dWUuZ2V0Q3VycmVudEluc3RhbmNlKCk7CiAgICBjb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKHRhYmxlLCBwcm9wcyk7CiAgICB0YWJsZS5zdG9yZSA9IHN0b3JlOwogICAgY29uc3QgbGF5b3V0ID0gbmV3IFRhYmxlTGF5b3V0KHsKICAgICAgc3RvcmU6IHRhYmxlLnN0b3JlLAogICAgICB0YWJsZSwKICAgICAgZml0OiBwcm9wcy5maXQsCiAgICAgIHNob3dIZWFkZXI6IHByb3BzLnNob3dIZWFkZXIKICAgIH0pOwogICAgdGFibGUubGF5b3V0ID0gbGF5b3V0OwogICAgY29uc3QgaXNFbXB0eSA9IHZ1ZS5jb21wdXRlZCgoKSA9PiAoc3RvcmUuc3RhdGVzLmRhdGEudmFsdWUgfHwgW10pLmxlbmd0aCA9PT0gMCk7CiAgICBjb25zdCB7CiAgICAgIHNldEN1cnJlbnRSb3csCiAgICAgIHRvZ2dsZVJvd1NlbGVjdGlvbiwKICAgICAgY2xlYXJTZWxlY3Rpb24sCiAgICAgIGNsZWFyRmlsdGVyLAogICAgICB0b2dnbGVBbGxTZWxlY3Rpb24sCiAgICAgIHRvZ2dsZVJvd0V4cGFuc2lvbiwKICAgICAgY2xlYXJTb3J0LAogICAgICBzb3J0CiAgICB9ID0gdXNlVXRpbHMkMShzdG9yZSk7CiAgICBjb25zdCB7CiAgICAgIGlzSGlkZGVuLAogICAgICByZW5kZXJFeHBhbmRlZCwKICAgICAgc2V0RHJhZ1Zpc2libGUsCiAgICAgIGlzR3JvdXAsCiAgICAgIGhhbmRsZU1vdXNlTGVhdmUsCiAgICAgIGhhbmRsZUhlYWRlckZvb3Rlck1vdXNld2hlZWwsCiAgICAgIHRhYmxlU2l6ZSwKICAgICAgYm9keUhlaWdodCwKICAgICAgZW1wdHlCbG9ja1N0eWxlLAogICAgICBoYW5kbGVGaXhlZE1vdXNld2hlZWwsCiAgICAgIGZpeGVkSGVpZ2h0LAogICAgICBmaXhlZEJvZHlIZWlnaHQsCiAgICAgIHJlc2l6ZVByb3h5VmlzaWJsZSwKICAgICAgYm9keVdpZHRoLAogICAgICByZXNpemVTdGF0ZSwKICAgICAgZG9MYXlvdXQKICAgIH0gPSB1c2VTdHlsZSQyKHByb3BzLCBsYXlvdXQsIHN0b3JlLCB0YWJsZSk7CiAgICBjb25zdCBkZWJvdW5jZWRVcGRhdGVMYXlvdXQgPSBkZWJvdW5jZV9fZGVmYXVsdFsnZGVmYXVsdCddKGRvTGF5b3V0LCA1MCk7CiAgICBjb25zdCB0YWJsZUlkID0gImVsLXRhYmxlXyIgKyB0YWJsZUlkU2VlZCsrOwogICAgdGFibGUudGFibGVJZCA9IHRhYmxlSWQ7CiAgICB0YWJsZS5zdGF0ZSA9IHsKICAgICAgaXNHcm91cCwKICAgICAgcmVzaXplU3RhdGUsCiAgICAgIGRvTGF5b3V0LAogICAgICBkZWJvdW5jZWRVcGRhdGVMYXlvdXQKICAgIH07CiAgICByZXR1cm4gewogICAgICBsYXlvdXQsCiAgICAgIHN0b3JlLAogICAgICBoYW5kbGVIZWFkZXJGb290ZXJNb3VzZXdoZWVsLAogICAgICBoYW5kbGVNb3VzZUxlYXZlLAogICAgICB0YWJsZUlkLAogICAgICB0YWJsZVNpemUsCiAgICAgIGlzSGlkZGVuLAogICAgICBpc0VtcHR5LAogICAgICByZW5kZXJFeHBhbmRlZCwKICAgICAgcmVzaXplUHJveHlWaXNpYmxlLAogICAgICByZXNpemVTdGF0ZSwKICAgICAgaXNHcm91cCwKICAgICAgYm9keVdpZHRoLAogICAgICBib2R5SGVpZ2h0LAogICAgICBlbXB0eUJsb2NrU3R5bGUsCiAgICAgIGRlYm91bmNlZFVwZGF0ZUxheW91dCwKICAgICAgaGFuZGxlRml4ZWRNb3VzZXdoZWVsLAogICAgICBmaXhlZEhlaWdodCwKICAgICAgZml4ZWRCb2R5SGVpZ2h0LAogICAgICBzZXRDdXJyZW50Um93LAogICAgICB0b2dnbGVSb3dTZWxlY3Rpb24sCiAgICAgIGNsZWFyU2VsZWN0aW9uLAogICAgICBjbGVhckZpbHRlciwKICAgICAgdG9nZ2xlQWxsU2VsZWN0aW9uLAogICAgICB0b2dnbGVSb3dFeHBhbnNpb24sCiAgICAgIGNsZWFyU29ydCwKICAgICAgZG9MYXlvdXQsCiAgICAgIHNvcnQsCiAgICAgIHQ6IGxvY2FsZS50LAogICAgICBzZXREcmFnVmlzaWJsZSwKICAgICAgY29udGV4dDogdGFibGUKICAgIH07CiAgfQoKfSk7CmNvbnN0IF9ob2lzdGVkXzEkMSA9IHsKICByZWY6ICJoaWRkZW5Db2x1bW5zIiwKICBjbGFzczogImhpZGRlbi1jb2x1bW5zIgp9Owpjb25zdCBfaG9pc3RlZF8yJDEgPSB7CiAga2V5OiAwLAogIHJlZjogImhlYWRlcldyYXBwZXIiLAogIGNsYXNzOiAiZWwtdGFibGVfX2hlYWRlci13cmFwcGVyIgp9Owpjb25zdCBfaG9pc3RlZF8zJDEgPSB7CiAgY2xhc3M6ICJlbC10YWJsZV9fZW1wdHktdGV4dCIKfTsKY29uc3QgX2hvaXN0ZWRfNCQxID0gewogIGtleTogMSwKICByZWY6ICJhcHBlbmRXcmFwcGVyIiwKICBjbGFzczogImVsLXRhYmxlX19hcHBlbmQtd3JhcHBlciIKfTsKY29uc3QgX2hvaXN0ZWRfNSA9IHsKICBrZXk6IDEsCiAgcmVmOiAiZm9vdGVyV3JhcHBlciIsCiAgY2xhc3M6ICJlbC10YWJsZV9fZm9vdGVyLXdyYXBwZXIiCn07CmNvbnN0IF9ob2lzdGVkXzYgPSB7CiAga2V5OiAwLAogIHJlZjogImZpeGVkSGVhZGVyV3JhcHBlciIsCiAgY2xhc3M6ICJlbC10YWJsZV9fZml4ZWQtaGVhZGVyLXdyYXBwZXIiCn07CmNvbnN0IF9ob2lzdGVkXzcgPSB7CiAga2V5OiAxLAogIHJlZjogImZpeGVkRm9vdGVyV3JhcHBlciIsCiAgY2xhc3M6ICJlbC10YWJsZV9fZml4ZWQtZm9vdGVyLXdyYXBwZXIiCn07CmNvbnN0IF9ob2lzdGVkXzggPSB7CiAga2V5OiAwLAogIHJlZjogInJpZ2h0Rml4ZWRIZWFkZXJXcmFwcGVyIiwKICBjbGFzczogImVsLXRhYmxlX19maXhlZC1oZWFkZXItd3JhcHBlciIKfTsKY29uc3QgX2hvaXN0ZWRfOSA9IHsKICBrZXk6IDEsCiAgcmVmOiAicmlnaHRGaXhlZEZvb3RlcldyYXBwZXIiLAogIGNsYXNzOiAiZWwtdGFibGVfX2ZpeGVkLWZvb3Rlci13cmFwcGVyIgp9Owpjb25zdCBfaG9pc3RlZF8xMCA9IHsKICByZWY6ICJyZXNpemVQcm94eSIsCiAgY2xhc3M6ICJlbC10YWJsZV9fY29sdW1uLXJlc2l6ZS1wcm94eSIKfTsKCmZ1bmN0aW9uIHJlbmRlciQxKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIGNvbnN0IF9jb21wb25lbnRfdGFibGVfaGVhZGVyID0gdnVlLnJlc29sdmVDb21wb25lbnQoInRhYmxlLWhlYWRlciIpOwoKICBjb25zdCBfY29tcG9uZW50X3RhYmxlX2JvZHkgPSB2dWUucmVzb2x2ZUNvbXBvbmVudCgidGFibGUtYm9keSIpOwoKICBjb25zdCBfY29tcG9uZW50X3RhYmxlX2Zvb3RlciA9IHZ1ZS5yZXNvbHZlQ29tcG9uZW50KCJ0YWJsZS1mb290ZXIiKTsKCiAgY29uc3QgX2RpcmVjdGl2ZV9tb3VzZXdoZWVsID0gdnVlLnJlc29sdmVEaXJlY3RpdmUoIm1vdXNld2hlZWwiKTsKCiAgcmV0dXJuIHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKCJkaXYiLCB7CiAgICBjbGFzczogW3sKICAgICAgImVsLXRhYmxlLS1maXQiOiBfY3R4LmZpdCwKICAgICAgImVsLXRhYmxlLS1zdHJpcGVkIjogX2N0eC5zdHJpcGUsCiAgICAgICJlbC10YWJsZS0tYm9yZGVyIjogX2N0eC5ib3JkZXIgfHwgX2N0eC5pc0dyb3VwLAogICAgICAiZWwtdGFibGUtLWhpZGRlbiI6IF9jdHguaXNIaWRkZW4sCiAgICAgICJlbC10YWJsZS0tZ3JvdXAiOiBfY3R4LmlzR3JvdXAsCiAgICAgICJlbC10YWJsZS0tZmx1aWQtaGVpZ2h0IjogX2N0eC5tYXhIZWlnaHQsCiAgICAgICJlbC10YWJsZS0tc2Nyb2xsYWJsZS14IjogX2N0eC5sYXlvdXQuc2Nyb2xsWC52YWx1ZSwKICAgICAgImVsLXRhYmxlLS1zY3JvbGxhYmxlLXkiOiBfY3R4LmxheW91dC5zY3JvbGxZLnZhbHVlLAogICAgICAiZWwtdGFibGUtLWVuYWJsZS1yb3ctaG92ZXIiOiAhX2N0eC5zdG9yZS5zdGF0ZXMuaXNDb21wbGV4LnZhbHVlLAogICAgICAiZWwtdGFibGUtLWVuYWJsZS1yb3ctdHJhbnNpdGlvbiI6IChfY3R4LnN0b3JlLnN0YXRlcy5kYXRhLnZhbHVlIHx8IFtdKS5sZW5ndGggIT09IDAgJiYgKF9jdHguc3RvcmUuc3RhdGVzLmRhdGEudmFsdWUgfHwgW10pLmxlbmd0aCA8IDEwMAogICAgfSwgX2N0eC50YWJsZVNpemUgPyBgZWwtdGFibGUtLSR7X2N0eC50YWJsZVNpemV9YCA6ICIiLCBfY3R4LmNsYXNzTmFtZSwgImVsLXRhYmxlIl0sCiAgICBzdHlsZTogX2N0eC5zdHlsZSwKICAgIG9uTW91c2VsZWF2ZTogX2NhY2hlWzFdIHx8IChfY2FjaGVbMV0gPSAkZXZlbnQgPT4gX2N0eC5oYW5kbGVNb3VzZUxlYXZlKCkpCiAgfSwgW3Z1ZS5jcmVhdGVWTm9kZSgiZGl2IiwgX2hvaXN0ZWRfMSQxLCBbdnVlLnJlbmRlclNsb3QoX2N0eC4kc2xvdHMsICJkZWZhdWx0IildLCA1MTIpLCBfY3R4LnNob3dIZWFkZXIgPyB2dWUud2l0aERpcmVjdGl2ZXMoKHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKCJkaXYiLCBfaG9pc3RlZF8yJDEsIFt2dWUuY3JlYXRlVk5vZGUoX2NvbXBvbmVudF90YWJsZV9oZWFkZXIsIHsKICAgIHJlZjogInRhYmxlSGVhZGVyIiwKICAgIGJvcmRlcjogX2N0eC5ib3JkZXIsCiAgICAiZGVmYXVsdC1zb3J0IjogX2N0eC5kZWZhdWx0U29ydCwKICAgIHN0b3JlOiBfY3R4LnN0b3JlLAogICAgc3R5bGU6IHsKICAgICAgd2lkdGg6IF9jdHgubGF5b3V0LmJvZHlXaWR0aC52YWx1ZSA/IF9jdHgubGF5b3V0LmJvZHlXaWR0aC52YWx1ZSArICJweCIgOiAiIgogICAgfSwKICAgIG9uU2V0RHJhZ1Zpc2libGU6IF9jdHguc2V0RHJhZ1Zpc2libGUKICB9LCBudWxsLCA4LCBbImJvcmRlciIsICJkZWZhdWx0LXNvcnQiLCAic3RvcmUiLCAic3R5bGUiLCAib25TZXREcmFnVmlzaWJsZSJdKV0sIDUxMikpLCBbW19kaXJlY3RpdmVfbW91c2V3aGVlbCwgX2N0eC5oYW5kbGVIZWFkZXJGb290ZXJNb3VzZXdoZWVsXV0pIDogdnVlLmNyZWF0ZUNvbW1lbnRWTm9kZSgidi1pZiIsIHRydWUpLCB2dWUuY3JlYXRlVk5vZGUoImRpdiIsIHsKICAgIHJlZjogImJvZHlXcmFwcGVyIiwKICAgIHN0eWxlOiBbX2N0eC5ib2R5SGVpZ2h0XSwKICAgIGNsYXNzOiAiZWwtdGFibGVfX2JvZHktd3JhcHBlciIKICB9LCBbdnVlLmNyZWF0ZVZOb2RlKF9jb21wb25lbnRfdGFibGVfYm9keSwgewogICAgY29udGV4dDogX2N0eC5jb250ZXh0LAogICAgaGlnaGxpZ2h0OiBfY3R4LmhpZ2hsaWdodEN1cnJlbnRSb3csCiAgICAicm93LWNsYXNzLW5hbWUiOiBfY3R4LnJvd0NsYXNzTmFtZSwKICAgICJ0b29sdGlwLWVmZmVjdCI6IF9jdHgudG9vbHRpcEVmZmVjdCwKICAgICJyb3ctc3R5bGUiOiBfY3R4LnJvd1N0eWxlLAogICAgc3RvcmU6IF9jdHguc3RvcmUsCiAgICBzdHJpcGU6IF9jdHguc3RyaXBlLAogICAgc3R5bGU6IHsKICAgICAgd2lkdGg6IF9jdHguYm9keVdpZHRoCiAgICB9CiAgfSwgbnVsbCwgOCwgWyJjb250ZXh0IiwgImhpZ2hsaWdodCIsICJyb3ctY2xhc3MtbmFtZSIsICJ0b29sdGlwLWVmZmVjdCIsICJyb3ctc3R5bGUiLCAic3RvcmUiLCAic3RyaXBlIiwgInN0eWxlIl0pLCBfY3R4LmlzRW1wdHkgPyAodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIHsKICAgIGtleTogMCwKICAgIHJlZjogImVtcHR5QmxvY2siLAogICAgc3R5bGU6IF9jdHguZW1wdHlCbG9ja1N0eWxlLAogICAgY2xhc3M6ICJlbC10YWJsZV9fZW1wdHktYmxvY2siCiAgfSwgW3Z1ZS5jcmVhdGVWTm9kZSgic3BhbiIsIF9ob2lzdGVkXzMkMSwgW3Z1ZS5yZW5kZXJTbG90KF9jdHguJHNsb3RzLCAiZW1wdHkiLCB7fSwgKCkgPT4gW3Z1ZS5jcmVhdGVUZXh0Vk5vZGUodnVlLnRvRGlzcGxheVN0cmluZyhfY3R4LmVtcHR5VGV4dCB8fCBfY3R4LnQoImVsLnRhYmxlLmVtcHR5VGV4dCIpKSwgMSldKV0pXSwgNCkpIDogdnVlLmNyZWF0ZUNvbW1lbnRWTm9kZSgidi1pZiIsIHRydWUpLCBfY3R4LiRzbG90cy5hcHBlbmQgPyAodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIF9ob2lzdGVkXzQkMSwgW3Z1ZS5yZW5kZXJTbG90KF9jdHguJHNsb3RzLCAiYXBwZW5kIildLCA1MTIpKSA6IHZ1ZS5jcmVhdGVDb21tZW50Vk5vZGUoInYtaWYiLCB0cnVlKV0sIDQpLCBfY3R4LnNob3dTdW1tYXJ5ID8gdnVlLndpdGhEaXJlY3RpdmVzKCh2dWUub3BlbkJsb2NrKCksIHZ1ZS5jcmVhdGVCbG9jaygiZGl2IiwgX2hvaXN0ZWRfNSwgW3Z1ZS5jcmVhdGVWTm9kZShfY29tcG9uZW50X3RhYmxlX2Zvb3RlciwgewogICAgYm9yZGVyOiBfY3R4LmJvcmRlciwKICAgICJkZWZhdWx0LXNvcnQiOiBfY3R4LmRlZmF1bHRTb3J0LAogICAgc3RvcmU6IF9jdHguc3RvcmUsCiAgICBzdHlsZTogewogICAgICB3aWR0aDogX2N0eC5sYXlvdXQuYm9keVdpZHRoLnZhbHVlID8gX2N0eC5sYXlvdXQuYm9keVdpZHRoLnZhbHVlICsgInB4IiA6ICIiCiAgICB9LAogICAgInN1bS10ZXh0IjogX2N0eC5zdW1UZXh0IHx8IF9jdHgudCgiZWwudGFibGUuc3VtVGV4dCIpLAogICAgInN1bW1hcnktbWV0aG9kIjogX2N0eC5zdW1tYXJ5TWV0aG9kCiAgfSwgbnVsbCwgOCwgWyJib3JkZXIiLCAiZGVmYXVsdC1zb3J0IiwgInN0b3JlIiwgInN0eWxlIiwgInN1bS10ZXh0IiwgInN1bW1hcnktbWV0aG9kIl0pXSwgNTEyKSksIFtbdnVlLnZTaG93LCAhX2N0eC5pc0VtcHR5XSwgW19kaXJlY3RpdmVfbW91c2V3aGVlbCwgX2N0eC5oYW5kbGVIZWFkZXJGb290ZXJNb3VzZXdoZWVsXV0pIDogdnVlLmNyZWF0ZUNvbW1lbnRWTm9kZSgidi1pZiIsIHRydWUpLCBfY3R4LnN0b3JlLnN0YXRlcy5maXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMCA/IHZ1ZS53aXRoRGlyZWN0aXZlcygodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIHsKICAgIGtleTogMiwKICAgIHJlZjogImZpeGVkV3JhcHBlciIsCiAgICBzdHlsZTogW3sKICAgICAgd2lkdGg6IF9jdHgubGF5b3V0LmZpeGVkV2lkdGgudmFsdWUgPyBfY3R4LmxheW91dC5maXhlZFdpZHRoLnZhbHVlICsgInB4IiA6ICIiCiAgICB9LCBfY3R4LmZpeGVkSGVpZ2h0XSwKICAgIGNsYXNzOiAiZWwtdGFibGVfX2ZpeGVkIgogIH0sIFtfY3R4LnNob3dIZWFkZXIgPyAodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIF9ob2lzdGVkXzYsIFt2dWUuY3JlYXRlVk5vZGUoX2NvbXBvbmVudF90YWJsZV9oZWFkZXIsIHsKICAgIHJlZjogImZpeGVkVGFibGVIZWFkZXIiLAogICAgYm9yZGVyOiBfY3R4LmJvcmRlciwKICAgIHN0b3JlOiBfY3R4LnN0b3JlLAogICAgc3R5bGU6IHsKICAgICAgd2lkdGg6IF9jdHguYm9keVdpZHRoCiAgICB9LAogICAgZml4ZWQ6ICJsZWZ0IiwKICAgIG9uU2V0RHJhZ1Zpc2libGU6IF9jdHguc2V0RHJhZ1Zpc2libGUKICB9LCBudWxsLCA4LCBbImJvcmRlciIsICJzdG9yZSIsICJzdHlsZSIsICJvblNldERyYWdWaXNpYmxlIl0pXSwgNTEyKSkgOiB2dWUuY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSksIHZ1ZS5jcmVhdGVWTm9kZSgiZGl2IiwgewogICAgcmVmOiAiZml4ZWRCb2R5V3JhcHBlciIsCiAgICBzdHlsZTogW3sKICAgICAgdG9wOiBfY3R4LmxheW91dC5oZWFkZXJIZWlnaHQudmFsdWUgKyAicHgiCiAgICB9LCBfY3R4LmZpeGVkQm9keUhlaWdodF0sCiAgICBjbGFzczogImVsLXRhYmxlX19maXhlZC1ib2R5LXdyYXBwZXIiCiAgfSwgW3Z1ZS5jcmVhdGVWTm9kZShfY29tcG9uZW50X3RhYmxlX2JvZHksIHsKICAgIGhpZ2hsaWdodDogX2N0eC5oaWdobGlnaHRDdXJyZW50Um93LAogICAgInJvdy1jbGFzcy1uYW1lIjogX2N0eC5yb3dDbGFzc05hbWUsCiAgICAidG9vbHRpcC1lZmZlY3QiOiBfY3R4LnRvb2x0aXBFZmZlY3QsCiAgICAicm93LXN0eWxlIjogX2N0eC5yb3dTdHlsZSwKICAgIHN0b3JlOiBfY3R4LnN0b3JlLAogICAgc3RyaXBlOiBfY3R4LnN0cmlwZSwKICAgIHN0eWxlOiB7CiAgICAgIHdpZHRoOiBfY3R4LmJvZHlXaWR0aAogICAgfSwKICAgIGZpeGVkOiAibGVmdCIKICB9LCBudWxsLCA4LCBbImhpZ2hsaWdodCIsICJyb3ctY2xhc3MtbmFtZSIsICJ0b29sdGlwLWVmZmVjdCIsICJyb3ctc3R5bGUiLCAic3RvcmUiLCAic3RyaXBlIiwgInN0eWxlIl0pLCBfY3R4LiRzbG90cy5hcHBlbmQgPyAodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIHsKICAgIGtleTogMCwKICAgIHN0eWxlOiB7CiAgICAgIGhlaWdodDogX2N0eC5sYXlvdXQuYXBwZW5kSGVpZ2h0LnZhbHVlICsgInB4IgogICAgfSwKICAgIGNsYXNzOiAiZWwtdGFibGVfX2FwcGVuZC1ndXR0ZXIiCiAgfSwgbnVsbCwgNCkpIDogdnVlLmNyZWF0ZUNvbW1lbnRWTm9kZSgidi1pZiIsIHRydWUpXSwgNCksIF9jdHguc2hvd1N1bW1hcnkgPyB2dWUud2l0aERpcmVjdGl2ZXMoKHZ1ZS5vcGVuQmxvY2soKSwgdnVlLmNyZWF0ZUJsb2NrKCJkaXYiLCBfaG9pc3RlZF83LCBbdnVlLmNyZWF0ZVZOb2RlKF9jb21wb25lbnRfdGFibGVfZm9vdGVyLCB7CiAgICBib3JkZXI6IF9jdHguYm9yZGVyLAogICAgc3RvcmU6IF9jdHguc3RvcmUsCiAgICBzdHlsZTogewogICAgICB3aWR0aDogX2N0eC5ib2R5V2lkdGgKICAgIH0sCiAgICAic3VtLXRleHQiOiBfY3R4LnN1bVRleHQgfHwgX2N0eC50KCJlbC50YWJsZS5zdW1UZXh0IiksCiAgICAic3VtbWFyeS1tZXRob2QiOiBfY3R4LnN1bW1hcnlNZXRob2QsCiAgICBmaXhlZDogImxlZnQiCiAgfSwgbnVsbCwgOCwgWyJib3JkZXIiLCAic3RvcmUiLCAic3R5bGUiLCAic3VtLXRleHQiLCAic3VtbWFyeS1tZXRob2QiXSldLCA1MTIpKSwgW1t2dWUudlNob3csICFfY3R4LmlzRW1wdHldXSkgOiB2dWUuY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSldLCA0KSksIFtbX2RpcmVjdGl2ZV9tb3VzZXdoZWVsLCBfY3R4LmhhbmRsZUZpeGVkTW91c2V3aGVlbF1dKSA6IHZ1ZS5jcmVhdGVDb21tZW50Vk5vZGUoInYtaWYiLCB0cnVlKSwgX2N0eC5zdG9yZS5zdGF0ZXMucmlnaHRGaXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMCA/IHZ1ZS53aXRoRGlyZWN0aXZlcygodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIHsKICAgIGtleTogMywKICAgIHJlZjogInJpZ2h0Rml4ZWRXcmFwcGVyIiwKICAgIHN0eWxlOiBbewogICAgICB3aWR0aDogX2N0eC5sYXlvdXQucmlnaHRGaXhlZFdpZHRoLnZhbHVlID8gX2N0eC5sYXlvdXQucmlnaHRGaXhlZFdpZHRoLnZhbHVlICsgInB4IiA6ICIiLAogICAgICByaWdodDogX2N0eC5sYXlvdXQuc2Nyb2xsWS52YWx1ZSA/IChfY3R4LmJvcmRlciA/IF9jdHgubGF5b3V0Lmd1dHRlcldpZHRoIDogX2N0eC5sYXlvdXQuZ3V0dGVyV2lkdGggfHwgMCkgKyAicHgiIDogIiIKICAgIH0sIF9jdHguZml4ZWRIZWlnaHRdLAogICAgY2xhc3M6ICJlbC10YWJsZV9fZml4ZWQtcmlnaHQiCiAgfSwgW19jdHguc2hvd0hlYWRlciA/ICh2dWUub3BlbkJsb2NrKCksIHZ1ZS5jcmVhdGVCbG9jaygiZGl2IiwgX2hvaXN0ZWRfOCwgW3Z1ZS5jcmVhdGVWTm9kZShfY29tcG9uZW50X3RhYmxlX2hlYWRlciwgewogICAgcmVmOiAicmlnaHRGaXhlZFRhYmxlSGVhZGVyIiwKICAgIGJvcmRlcjogX2N0eC5ib3JkZXIsCiAgICBzdG9yZTogX2N0eC5zdG9yZSwKICAgIHN0eWxlOiB7CiAgICAgIHdpZHRoOiBfY3R4LmJvZHlXaWR0aAogICAgfSwKICAgIGZpeGVkOiAicmlnaHQiLAogICAgb25TZXREcmFnVmlzaWJsZTogX2N0eC5zZXREcmFnVmlzaWJsZQogIH0sIG51bGwsIDgsIFsiYm9yZGVyIiwgInN0b3JlIiwgInN0eWxlIiwgIm9uU2V0RHJhZ1Zpc2libGUiXSldLCA1MTIpKSA6IHZ1ZS5jcmVhdGVDb21tZW50Vk5vZGUoInYtaWYiLCB0cnVlKSwgdnVlLmNyZWF0ZVZOb2RlKCJkaXYiLCB7CiAgICByZWY6ICJyaWdodEZpeGVkQm9keVdyYXBwZXIiLAogICAgc3R5bGU6IFt7CiAgICAgIHRvcDogX2N0eC5sYXlvdXQuaGVhZGVySGVpZ2h0LnZhbHVlICsgInB4IgogICAgfSwgX2N0eC5maXhlZEJvZHlIZWlnaHRdLAogICAgY2xhc3M6ICJlbC10YWJsZV9fZml4ZWQtYm9keS13cmFwcGVyIgogIH0sIFt2dWUuY3JlYXRlVk5vZGUoX2NvbXBvbmVudF90YWJsZV9ib2R5LCB7CiAgICBoaWdobGlnaHQ6IF9jdHguaGlnaGxpZ2h0Q3VycmVudFJvdywKICAgICJyb3ctY2xhc3MtbmFtZSI6IF9jdHgucm93Q2xhc3NOYW1lLAogICAgInRvb2x0aXAtZWZmZWN0IjogX2N0eC50b29sdGlwRWZmZWN0LAogICAgInJvdy1zdHlsZSI6IF9jdHgucm93U3R5bGUsCiAgICBzdG9yZTogX2N0eC5zdG9yZSwKICAgIHN0cmlwZTogX2N0eC5zdHJpcGUsCiAgICBzdHlsZTogewogICAgICB3aWR0aDogX2N0eC5ib2R5V2lkdGgKICAgIH0sCiAgICBmaXhlZDogInJpZ2h0IgogIH0sIG51bGwsIDgsIFsiaGlnaGxpZ2h0IiwgInJvdy1jbGFzcy1uYW1lIiwgInRvb2x0aXAtZWZmZWN0IiwgInJvdy1zdHlsZSIsICJzdG9yZSIsICJzdHJpcGUiLCAic3R5bGUiXSksIF9jdHguJHNsb3RzLmFwcGVuZCA/ICh2dWUub3BlbkJsb2NrKCksIHZ1ZS5jcmVhdGVCbG9jaygiZGl2IiwgewogICAga2V5OiAwLAogICAgc3R5bGU6IHsKICAgICAgaGVpZ2h0OiBfY3R4LmxheW91dC5hcHBlbmRIZWlnaHQudmFsdWUgKyAicHgiCiAgICB9LAogICAgY2xhc3M6ICJlbC10YWJsZV9fYXBwZW5kLWd1dHRlciIKICB9LCBudWxsLCA0KSkgOiB2dWUuY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSldLCA0KSwgX2N0eC5zaG93U3VtbWFyeSA/IHZ1ZS53aXRoRGlyZWN0aXZlcygodnVlLm9wZW5CbG9jaygpLCB2dWUuY3JlYXRlQmxvY2soImRpdiIsIF9ob2lzdGVkXzksIFt2dWUuY3JlYXRlVk5vZGUoX2NvbXBvbmVudF90YWJsZV9mb290ZXIsIHsKICAgIGJvcmRlcjogX2N0eC5ib3JkZXIsCiAgICBzdG9yZTogX2N0eC5zdG9yZSwKICAgIHN0eWxlOiB7CiAgICAgIHdpZHRoOiBfY3R4LmJvZHlXaWR0aAogICAgfSwKICAgICJzdW0tdGV4dCI6IF9jdHguc3VtVGV4dCB8fCBfY3R4LnQoImVsLnRhYmxlLnN1bVRleHQiKSwKICAgICJzdW1tYXJ5LW1ldGhvZCI6IF9jdHguc3VtbWFyeU1ldGhvZCwKICAgIGZpeGVkOiAicmlnaHQiCiAgfSwgbnVsbCwgOCwgWyJib3JkZXIiLCAic3RvcmUiLCAic3R5bGUiLCAic3VtLXRleHQiLCAic3VtbWFyeS1tZXRob2QiXSldLCA1MTIpKSwgW1t2dWUudlNob3csICFfY3R4LmlzRW1wdHldXSkgOiB2dWUuY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSldLCA0KSksIFtbX2RpcmVjdGl2ZV9tb3VzZXdoZWVsLCBfY3R4LmhhbmRsZUZpeGVkTW91c2V3aGVlbF1dKSA6IHZ1ZS5jcmVhdGVDb21tZW50Vk5vZGUoInYtaWYiLCB0cnVlKSwgX2N0eC5zdG9yZS5zdGF0ZXMucmlnaHRGaXhlZENvbHVtbnMudmFsdWUubGVuZ3RoID4gMCA/ICh2dWUub3BlbkJsb2NrKCksIHZ1ZS5jcmVhdGVCbG9jaygiZGl2IiwgewogICAga2V5OiA0LAogICAgcmVmOiAicmlnaHRGaXhlZFBhdGNoIiwKICAgIHN0eWxlOiB7CiAgICAgIHdpZHRoOiBfY3R4LmxheW91dC5zY3JvbGxZLnZhbHVlID8gX2N0eC5sYXlvdXQuZ3V0dGVyV2lkdGggKyAicHgiIDogIjAiLAogICAgICBoZWlnaHQ6IF9jdHgubGF5b3V0LmhlYWRlckhlaWdodC52YWx1ZSArICJweCIKICAgIH0sCiAgICBjbGFzczogImVsLXRhYmxlX19maXhlZC1yaWdodC1wYXRjaCIKICB9LCBudWxsLCA0KSkgOiB2dWUuY3JlYXRlQ29tbWVudFZOb2RlKCJ2LWlmIiwgdHJ1ZSksIHZ1ZS53aXRoRGlyZWN0aXZlcyh2dWUuY3JlYXRlVk5vZGUoImRpdiIsIF9ob2lzdGVkXzEwLCBudWxsLCA1MTIpLCBbW3Z1ZS52U2hvdywgX2N0eC5yZXNpemVQcm94eVZpc2libGVdXSldLCAzOCk7Cn0KCnNjcmlwdCQxLnJlbmRlciA9IHJlbmRlciQxOwpzY3JpcHQkMS5fX2ZpbGUgPSAicGFja2FnZXMvdGFibGUvc3JjL3RhYmxlLnZ1ZSI7CgpzY3JpcHQkMS5pbnN0YWxsID0gYXBwID0+IHsKICBhcHAuY29tcG9uZW50KHNjcmlwdCQxLm5hbWUsIHNjcmlwdCQxKTsKfTsKCmNvbnN0IF9UYWJsZSA9IHNjcmlwdCQxOwpleHBvcnRzLmRlZmF1bHQgPSBfVGFibGU7"},{"version":3,"sources":["C:/Users/multicampus/Desktop/pjt 1 back/cowdog_fe/node_modules/element-plus/lib/el-table/index.js"],"names":["Object","defineProperty","exports","value","vue","require","util","dom","core","PopupManager","debounce","locale","directives","scrollbarWidth","isServer","ElCheckbox","ElPopper","ElCheckboxGroup","ElScrollbar","resizeEvent","throttle","_interopDefaultLegacy","e","PopupManager__default","debounce__default","scrollbarWidth__default","isServer__default","ElCheckbox__default","ElPopper__default","ElCheckboxGroup__default","ElScrollbar__default","throttle__default","EMPTY_OBJ","process","env","NODE_ENV","freeze","EMPTY_ARR","hasOwnProperty","prototype","hasOwn","val","key","call","__defProp","__getOwnPropSymbols","getOwnPropertySymbols","__hasOwnProp","__propIsEnum","propertyIsEnumerable","__defNormalProp","obj","enumerable","configurable","writable","__spreadValues","a","b","prop","getCell","event","cell","target","tagName","toUpperCase","parentNode","isObject","orderBy","array","sortKey","reverse","sortMethod","sortBy","Array","isArray","length","getKey","index","map","by","getValueByPath","$value","compare","i","len","sort","order","item","getColumnById","table","columnId","column","columns","forEach","id","getColumnByKey","columnKey","getColumnByCell","matches","className","match","getRowIdentity","row","rowKey","Error","indexOf","split","current","getKeysMap","arrayMap","parseHeight","height","test","parseInt","toggleRowStatus","statusArr","newVal","changed","included","addRow","push","removeRow","splice","walkTreeNode","root","cb","childrenKey","lazyKey","isNil","_walker","parent","children","level","children2","removePopper","createTablePopper","trigger","popperContent","popperOptions","tooltipEffect","renderContent","isLight","content2","document","createElement","innerHTML","style","zIndex","String","nextZIndex","body","appendChild","renderArrow","arrow2","bottom","showPopper","popperInstance","update","removePopper2","destroy","content","removeChild","off","arrow","createPopper","modifiers","name","options","offset","element","padding","on","useExpand","watcherData","instance","getCurrentInstance","defaultExpandAll","ref","expandRows","updateExpandRows","data","slice","expandRowsMap","reduce","prev","rowId","rowInfo","toggleRowExpansion","expanded","emit","store","scheduleLayout","setExpandRowKeys","rowKeys","assertRowKey","keysMap","cur","info","isRowExpanded","expandMap","states","useCurrent","_currentRowKey","currentRow","setCurrentRowKey","setCurrentRowByKey","restoreCurrentRowKey","_currentRow","arrayFind","unref","updateCurrentRow","oldCurrentRow","updateCurrentRowData","currentRowKey","__defProp$1","__getOwnPropSymbols$1","__hasOwnProp$1","__propIsEnum$1","__defNormalProp$1","__spreadValues$1","useTree","expandRowKeys","treeData","indent","lazy","lazyTreeNodeMap","lazyColumnIdentifier","childrenColumnName","normalizedData","computed","normalize","normalizedLazyNode","keys","res","parentId","updateTreeData","_a","_b","nested","normalizedLazyNode_","newTreeData","oldTreeData","rootLazyRowKeys","getExpanded","oldValue","newValue","loaded","loading","lazyKeys","lazyNodeChildren","updateTableScrollY","watch","updateTreeExpandKeys","toggleTreeExpansion","oldExpanded","loadOrToggle","loadData","treeNode","load","props","__defProp$2","__getOwnPropSymbols$2","__hasOwnProp$2","__propIsEnum$2","__defNormalProp$2","__spreadValues$2","sortData","sortingColumn","sortable","sortProp","sortOrder","doFlattenColumns","result","apply","useWatcher","_data","isComplex","_columns","originColumns","fixedColumns","rightFixedColumns","leafColumns","fixedLeafColumns","rightFixedLeafColumns","leafColumnsLength","fixedLeafColumnsLength","rightFixedLeafColumnsLength","isAllSelected","selection","reserveSelection","selectOnIndeterminate","selectable","filters","filteredData","hoverRow","state","deep","updateColumns","filter","fixed","type","unshift","notFixedColumns","concat","leafColumns2","fixedLeafColumns2","rightFixedLeafColumns2","needUpdateColumns","immediate","doLayout","debouncedUpdateLayout","isSelected","clearSelection","oldSelection","cleanSelection","deleted","selectedMap","dataMap","newSelection","toggleRowSelection","selected","emitChange","_toggleAllSelection","selectionChanged","childrenCount","rowKey2","rowIndex","getChildrenCount","updateSelectionByRowKey","updateAllSelected","_c","isSelected2","isAllSelected_","selectedCount","j","keyProp","isRowSelectable","count","childKey","updateFilters","columns2","values","filters_","col","updateSort","execFilter","sourceData","filterMethod","some","execSort","execQuery","ignore","clearFilter","columnKeys","tableHeader","fixedTableHeader","rightFixedTableHeader","refs","panels","assign","filterPanels","columns_","find","filteredValue","commit","silent","multi","clearSort","expandStates","treeStates","currentData","setExpandRowKeysAdapter","toggleRowExpansionAdapter","hasExpandColumn","toggleAllSelection","__defProp$3","__defProps","defineProperties","__getOwnPropDescs","getOwnPropertyDescriptors","__getOwnPropSymbols$3","__hasOwnProp$3","__propIsEnum$3","__defNormalProp$3","__spreadValues$3","__spreadProps","replaceColumn","sortColumn","no","getColumnIndex","pre","useStore","watcher","mutations","setData","dataInstanceChanged","$ready","insertColumn","newColumns","removeColumn","findIndex","init","column2","property","changeSortCondition","ingore","filterChange","_states","newFilters","rowSelectedChanged","setHoverRow","setCurrentRow","args","mutations2","nextTick","layout","updateScrollY","InitialStateMap","default","createStore","handleValue","getArrKeysValue","proxyTableProps","propsKey","storeKey","includes","keyList","TableLayout","constructor","observers","fit","showHeader","scrollX","scrollY","bodyWidth","fixedWidth","rightFixedWidth","tableHeight","headerHeight","appendHeight","footerHeight","viewportHeight","bodyHeight","fixedBodyHeight","gutterWidth","isRef","bodyWrapper","vnode","el","prevScrollY","querySelector","offsetHeight","setHeight","Number","updateElsHeight","setMaxHeight","getFlattenColumns","flattenColumns","isColumnGroup","headerWrapper","appendWrapper","footerWrapper","headerTrElm","noneHeader","headerDisplayNone","offsetWidth","clientHeight","notifyObservers","elm","headerChild","getComputedStyle","display","parentElement","updateColumnsWidth","clientWidth","bodyMinWidth","flexColumns","width","realWidth","minWidth","scrollYWidth","totalFlexWidth","allColumnsWidth","flexWidthPerPixel","noneFirstWidth","flexWidth","Math","floor","max","resizeState","addObserver","observer","removeObserver","onColumnsChange","onScrollableChange","script","defineComponent","components","ClickOutside","placement","upDataColumn","Function","setup","tooltipVisible","tooltip","filterValue","get","set","multiple","filterMultiple","isActive","hidden","showFilterPanel","stopPropagation","hideFilterPanel","handleConfirm","confirmFilter","handleReset","handleSelect","_filterValue","filteredValue2","popperPaneRef","popperRef","t","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_4","render","_ctx","_cache","$props","$setup","$data","$options","_component_el_checkbox","resolveComponent","_component_el_checkbox_group","_component_el_scrollbar","_component_el_popper","_directive_click_outside","resolveDirective","openBlock","createBlock","visible","$event","effect","pure","withCtx","createVNode","modelValue","Fragment","renderList","label","createTextVNode","toDisplayString","text","_","disabled","onClick","withDirectives","filterOpened","__file","useLayoutObserver","onBeforeMount","tableLayout","onMounted","onUpdated","onUnmounted","cols","querySelectorAll","columnsMap","getAttribute","setAttribute","ths","th","useEvent","handleFilterClick","handleHeaderClick","handleSortClick","filterable","handleHeaderContextMenu","draggingColumn","dragging","dragState","handleMouseDown","border","tableEl","tableLeft","getBoundingClientRect","left","columnEl","columnRect","minLeft","addClass","startMouseLeft","clientX","startLeft","right","startColumnLeft","resizeProxy","onselectstart","ondragstart","handleMouseMove2","event2","deltaLeft","proxyLeft","handleMouseUp","finalLeft","columnWidth","cursor","removeEventListener","setTimeout","removeClass","addEventListener","handleMouseMove","resizable","rect","bodyStyle","pageX","hasClass","handleMouseOut","toggleOrder","sortOrders","givenOrder","useStyle","storeData","isCellHidden","start","colSpan","after","getHeaderRowStyle","headerRowStyle","getHeaderRowClass","classes","headerRowClassName","join","getHeaderCellStyle","columnIndex","headerCellStyle","getHeaderCellClass","headerAlign","labelClassName","headerCellClassName","getAllColumns","convertToRows","maxLevel","traverse","subColumn","rows","allColumns","rowSpan","useUtils","columnRows","isGroup","hGutter","h","hColgroup","hasGutter","TableHeader","required","Boolean","defaultSort","cellpadding","cellspacing","subColumns","cellIndex","colspan","onContextmenu","onMousedown","onMousemove","onMouseout","renderHeader","$index","_self","$parent","filterPlacement","useEvents","tooltipContent","tooltipTrigger","handleEvent","handleDoubleClick","handleClick","handleContextMenu","handleMouseEnter","handleMouseLeave","handleCellMouseEnter","hoverState","cellChild","childNodes","range","createRange","setStart","setEnd","rangeWidth","getStyle","scrollWidth","innerText","textContent","strategy","handleCellMouseLeave","oldHoverState","useStyles","isColumnHidden","getRowStyle","rowStyle","getRowClass","highlightCurrentRow","stripe","rowClassName","getCellStyle","cellStyle","getCellClass","align","cellClassName","getSpan","rowspan","fn","spanMethod","getColspanRealWidth","widthArr","acc","__defProp$4","__defProps$1","__getOwnPropDescs$1","__getOwnPropSymbols$4","__hasOwnProp$4","__propIsEnum$4","__defNormalProp$4","__spreadValues$4","__spreadProps$1","useRender","firstDefaultColumnIndex","arrayFindIndex","getKeyOfRow","rowRender","treeRowData","rowClasses","displayStyle","onDblclick","onMouseenter","onMouseleave","columnData","context","noLazyChildren","baseKey","patchKey","rawColumnKey","renderCell","wrappedRowRender","renderExpanded","tr","console","error","tmp","parent2","node","innerTreeRowData","nodes2","nodes","defaultProps","highlight","TableBody","oldVal","raf","window","requestAnimationFrame","oldRow","newRow","useMapState","leftFixedLeafCount","rightFixedLeafCount","columnsCount","leftFixedCount","rightFixedCount","useStyle$1","before","getRowClasses","TableFooter","summaryMethod","sumText","sums","precisions","notNumber","isNaN","decimal","precision","curr","parseFloat","toFixed","min","useUtils$1","useStyle$2","$ELEMENT","useGlobalConfig","isHidden","resizeProxyVisible","setDragVisible","watchEffect","maxHeight","handleHeaderFooterMousewheel","pixelX","pixelY","abs","scrollLeft","shouldUpdateHeight","syncPostion","setScrollClass","bindEvents","setScrollClassByEl","classList","from","startsWith","scrollTop","fixedBodyWrapper","rightFixedBodyWrapper","maxScrollLeftPosition","passive","addResizeListener","resizeListener","unbindEvents","removeResizeListener","shouldUpdateLayout","oldWidth","oldHeight","tableSize","size","bodyWidth_","bodyHeight2","emptyBlockStyle","handleFixedMousewheel","spinY","currentScrollTop","preventDefault","scrollHeight","ceil","fixedHeight","showSummary","defaultProps$1","emptyText","treeProps","hasChildren","tableIdSeed","script$1","Mousewheel","emits","isEmpty","tableId","_hoisted_1$1","_hoisted_2$1","_hoisted_3$1","_hoisted_4$1","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","render$1","_component_table_header","_component_table_body","_component_table_footer","_directive_mousewheel","renderSlot","$slots","onSetDragVisible","createCommentVNode","append","vShow","top","install","app","component","_Table"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nObject.defineProperty(exports, '__esModule', { value: true });\r\n\r\nvar vue = require('vue');\r\nvar util = require('../utils/util');\r\nvar dom = require('../utils/dom');\r\nvar core = require('@popperjs/core');\r\nvar PopupManager = require('../utils/popup-manager');\r\nvar debounce = require('lodash/debounce');\r\nvar locale = require('../locale');\r\nvar directives = require('../directives');\r\nvar scrollbarWidth = require('../utils/scrollbar-width');\r\nvar isServer = require('../utils/isServer');\r\nvar ElCheckbox = require('../el-checkbox');\r\nvar ElPopper = require('../el-popper');\r\nvar ElCheckboxGroup = require('../el-checkbox-group');\r\nvar ElScrollbar = require('../el-scrollbar');\r\nvar resizeEvent = require('../utils/resize-event');\r\nvar throttle = require('lodash/throttle');\r\n\r\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\r\n\r\nvar PopupManager__default = /*#__PURE__*/_interopDefaultLegacy(PopupManager);\r\nvar debounce__default = /*#__PURE__*/_interopDefaultLegacy(debounce);\r\nvar scrollbarWidth__default = /*#__PURE__*/_interopDefaultLegacy(scrollbarWidth);\r\nvar isServer__default = /*#__PURE__*/_interopDefaultLegacy(isServer);\r\nvar ElCheckbox__default = /*#__PURE__*/_interopDefaultLegacy(ElCheckbox);\r\nvar ElPopper__default = /*#__PURE__*/_interopDefaultLegacy(ElPopper);\r\nvar ElCheckboxGroup__default = /*#__PURE__*/_interopDefaultLegacy(ElCheckboxGroup);\r\nvar ElScrollbar__default = /*#__PURE__*/_interopDefaultLegacy(ElScrollbar);\r\nvar throttle__default = /*#__PURE__*/_interopDefaultLegacy(throttle);\r\n\r\n/**\r\n * Make a map and return a function for checking if a key\r\n * is in that map.\r\n * IMPORTANT: all calls of this function must be prefixed with\r\n * \\/\\*#\\_\\_PURE\\_\\_\\*\\/\r\n * So that rollup can tree-shake them if necessary.\r\n */\r\nconst EMPTY_OBJ = (process.env.NODE_ENV !== 'production')\r\n    ? Object.freeze({})\r\n    : {};\r\nconst EMPTY_ARR = (process.env.NODE_ENV !== 'production') ? Object.freeze([]) : [];\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\nconst hasOwn = (val, key) => hasOwnProperty.call(val, key);\r\n\r\nvar __defProp = Object.defineProperty;\r\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\r\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\r\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\r\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\r\nvar __spreadValues = (a, b) => {\r\n  for (var prop in b || (b = {}))\r\n    if (__hasOwnProp.call(b, prop))\r\n      __defNormalProp(a, prop, b[prop]);\r\n  if (__getOwnPropSymbols)\r\n    for (var prop of __getOwnPropSymbols(b)) {\r\n      if (__propIsEnum.call(b, prop))\r\n        __defNormalProp(a, prop, b[prop]);\r\n    }\r\n  return a;\r\n};\r\nconst getCell = function(event) {\r\n  let cell = event.target;\r\n  while (cell && cell.tagName.toUpperCase() !== \"HTML\") {\r\n    if (cell.tagName.toUpperCase() === \"TD\") {\r\n      return cell;\r\n    }\r\n    cell = cell.parentNode;\r\n  }\r\n  return null;\r\n};\r\nconst isObject = function(obj) {\r\n  return obj !== null && typeof obj === \"object\";\r\n};\r\nconst orderBy = function(array, sortKey, reverse, sortMethod, sortBy) {\r\n  if (!sortKey && !sortMethod && (!sortBy || Array.isArray(sortBy) && !sortBy.length)) {\r\n    return array;\r\n  }\r\n  if (typeof reverse === \"string\") {\r\n    reverse = reverse === \"descending\" ? -1 : 1;\r\n  } else {\r\n    reverse = reverse && reverse < 0 ? -1 : 1;\r\n  }\r\n  const getKey = sortMethod ? null : function(value, index) {\r\n    if (sortBy) {\r\n      if (!Array.isArray(sortBy)) {\r\n        sortBy = [sortBy];\r\n      }\r\n      return sortBy.map(function(by) {\r\n        if (typeof by === \"string\") {\r\n          return util.getValueByPath(value, by);\r\n        } else {\r\n          return by(value, index, array);\r\n        }\r\n      });\r\n    }\r\n    if (sortKey !== \"$key\") {\r\n      if (isObject(value) && \"$value\" in value)\r\n        value = value.$value;\r\n    }\r\n    return [isObject(value) ? util.getValueByPath(value, sortKey) : value];\r\n  };\r\n  const compare = function(a, b) {\r\n    if (sortMethod) {\r\n      return sortMethod(a.value, b.value);\r\n    }\r\n    for (let i = 0, len = a.key.length; i < len; i++) {\r\n      if (a.key[i] < b.key[i]) {\r\n        return -1;\r\n      }\r\n      if (a.key[i] > b.key[i]) {\r\n        return 1;\r\n      }\r\n    }\r\n    return 0;\r\n  };\r\n  return array.map(function(value, index) {\r\n    return {\r\n      value,\r\n      index,\r\n      key: getKey ? getKey(value, index) : null\r\n    };\r\n  }).sort(function(a, b) {\r\n    let order = compare(a, b);\r\n    if (!order) {\r\n      order = a.index - b.index;\r\n    }\r\n    return order * +reverse;\r\n  }).map((item) => item.value);\r\n};\r\nconst getColumnById = function(table, columnId) {\r\n  let column = null;\r\n  table.columns.forEach(function(item) {\r\n    if (item.id === columnId) {\r\n      column = item;\r\n    }\r\n  });\r\n  return column;\r\n};\r\nconst getColumnByKey = function(table, columnKey) {\r\n  let column = null;\r\n  for (let i = 0; i < table.columns.length; i++) {\r\n    const item = table.columns[i];\r\n    if (item.columnKey === columnKey) {\r\n      column = item;\r\n      break;\r\n    }\r\n  }\r\n  return column;\r\n};\r\nconst getColumnByCell = function(table, cell) {\r\n  const matches = (cell.className || \"\").match(/el-table_[^\\s]+/gm);\r\n  if (matches) {\r\n    return getColumnById(table, matches[0]);\r\n  }\r\n  return null;\r\n};\r\nconst getRowIdentity = (row, rowKey) => {\r\n  if (!row)\r\n    throw new Error(\"row is required when get row identity\");\r\n  if (typeof rowKey === \"string\") {\r\n    if (rowKey.indexOf(\".\") < 0) {\r\n      return row[rowKey] + \"\";\r\n    }\r\n    const key = rowKey.split(\".\");\r\n    let current = row;\r\n    for (let i = 0; i < key.length; i++) {\r\n      current = current[key[i]];\r\n    }\r\n    return current + \"\";\r\n  } else if (typeof rowKey === \"function\") {\r\n    return rowKey.call(null, row);\r\n  }\r\n};\r\nconst getKeysMap = function(array, rowKey) {\r\n  const arrayMap = {};\r\n  (array || []).forEach((row, index) => {\r\n    arrayMap[getRowIdentity(row, rowKey)] = { row, index };\r\n  });\r\n  return arrayMap;\r\n};\r\nfunction parseHeight(height) {\r\n  if (typeof height === \"number\") {\r\n    return height;\r\n  }\r\n  if (typeof height === \"string\") {\r\n    if (/^\\d+(?:px)?$/.test(height)) {\r\n      return parseInt(height, 10);\r\n    } else {\r\n      return height;\r\n    }\r\n  }\r\n  return null;\r\n}\r\nfunction toggleRowStatus(statusArr, row, newVal) {\r\n  let changed = false;\r\n  const index = statusArr.indexOf(row);\r\n  const included = index !== -1;\r\n  const addRow = () => {\r\n    statusArr.push(row);\r\n    changed = true;\r\n  };\r\n  const removeRow = () => {\r\n    statusArr.splice(index, 1);\r\n    changed = true;\r\n  };\r\n  if (typeof newVal === \"boolean\") {\r\n    if (newVal && !included) {\r\n      addRow();\r\n    } else if (!newVal && included) {\r\n      removeRow();\r\n    }\r\n  } else {\r\n    if (included) {\r\n      removeRow();\r\n    } else {\r\n      addRow();\r\n    }\r\n  }\r\n  return changed;\r\n}\r\nfunction walkTreeNode(root, cb, childrenKey = \"children\", lazyKey = \"hasChildren\") {\r\n  const isNil = (array) => !(Array.isArray(array) && array.length);\r\n  function _walker(parent, children, level) {\r\n    cb(parent, children, level);\r\n    children.forEach((item) => {\r\n      if (item[lazyKey]) {\r\n        cb(item, null, level + 1);\r\n        return;\r\n      }\r\n      const children2 = item[childrenKey];\r\n      if (!isNil(children2)) {\r\n        _walker(item, children2, level + 1);\r\n      }\r\n    });\r\n  }\r\n  root.forEach((item) => {\r\n    if (item[lazyKey]) {\r\n      cb(item, null, 0);\r\n      return;\r\n    }\r\n    const children = item[childrenKey];\r\n    if (!isNil(children)) {\r\n      _walker(item, children, 0);\r\n    }\r\n  });\r\n}\r\nlet removePopper;\r\nfunction createTablePopper(trigger, popperContent, popperOptions, tooltipEffect) {\r\n  function renderContent() {\r\n    const isLight = tooltipEffect === \"light\";\r\n    const content2 = document.createElement(\"div\");\r\n    content2.className = `el-popper ${isLight ? \"is-light\" : \"is-dark\"}`;\r\n    content2.innerHTML = popperContent;\r\n    content2.style.zIndex = String(PopupManager__default['default'].nextZIndex());\r\n    document.body.appendChild(content2);\r\n    return content2;\r\n  }\r\n  function renderArrow() {\r\n    const arrow2 = document.createElement(\"div\");\r\n    arrow2.className = \"el-popper__arrow\";\r\n    arrow2.style.bottom = \"-4px\";\r\n    return arrow2;\r\n  }\r\n  function showPopper() {\r\n    popperInstance && popperInstance.update();\r\n  }\r\n  removePopper = function removePopper2() {\r\n    try {\r\n      popperInstance && popperInstance.destroy();\r\n      content && document.body.removeChild(content);\r\n      dom.off(trigger, \"mouseenter\", showPopper);\r\n      dom.off(trigger, \"mouseleave\", removePopper2);\r\n    } catch (e) {\r\n    }\r\n  };\r\n  let popperInstance = null;\r\n  const content = renderContent();\r\n  const arrow = renderArrow();\r\n  content.appendChild(arrow);\r\n  popperInstance = core.createPopper(trigger, content, __spreadValues({\r\n    modifiers: [\r\n      {\r\n        name: \"offset\",\r\n        options: {\r\n          offset: [0, 8]\r\n        }\r\n      },\r\n      {\r\n        name: \"arrow\",\r\n        options: {\r\n          element: arrow,\r\n          padding: 10\r\n        }\r\n      }\r\n    ]\r\n  }, popperOptions));\r\n  dom.on(trigger, \"mouseenter\", showPopper);\r\n  dom.on(trigger, \"mouseleave\", removePopper);\r\n  return popperInstance;\r\n}\r\n\r\nfunction useExpand(watcherData) {\r\n  const instance = vue.getCurrentInstance();\r\n  const defaultExpandAll = vue.ref(false);\r\n  const expandRows = vue.ref([]);\r\n  const updateExpandRows = () => {\r\n    const data = watcherData.data.value || [];\r\n    const rowKey = watcherData.rowKey.value;\r\n    if (defaultExpandAll.value) {\r\n      expandRows.value = data.slice();\r\n    } else if (rowKey) {\r\n      const expandRowsMap = getKeysMap(expandRows.value, rowKey);\r\n      expandRows.value = data.reduce((prev, row) => {\r\n        const rowId = getRowIdentity(row, rowKey);\r\n        const rowInfo = expandRowsMap[rowId];\r\n        if (rowInfo) {\r\n          prev.push(row);\r\n        }\r\n        return prev;\r\n      }, []);\r\n    } else {\r\n      expandRows.value = [];\r\n    }\r\n  };\r\n  const toggleRowExpansion = (row, expanded) => {\r\n    const changed = toggleRowStatus(expandRows.value, row, expanded);\r\n    if (changed) {\r\n      instance.emit(\"expand-change\", row, expandRows.value.slice());\r\n      instance.store.scheduleLayout();\r\n    }\r\n  };\r\n  const setExpandRowKeys = (rowKeys) => {\r\n    instance.store.assertRowKey();\r\n    const data = watcherData.data.value || [];\r\n    const rowKey = watcherData.rowKey.value;\r\n    const keysMap = getKeysMap(data, rowKey);\r\n    expandRows.value = rowKeys.reduce((prev, cur) => {\r\n      const info = keysMap[cur];\r\n      if (info) {\r\n        prev.push(info.row);\r\n      }\r\n      return prev;\r\n    }, []);\r\n  };\r\n  const isRowExpanded = (row) => {\r\n    const rowKey = watcherData.rowKey.value;\r\n    if (rowKey) {\r\n      const expandMap = getKeysMap(expandRows.value, rowKey);\r\n      return !!expandMap[getRowIdentity(row, rowKey)];\r\n    }\r\n    return expandRows.value.indexOf(row) !== -1;\r\n  };\r\n  return {\r\n    updateExpandRows,\r\n    toggleRowExpansion,\r\n    setExpandRowKeys,\r\n    isRowExpanded,\r\n    states: {\r\n      expandRows,\r\n      defaultExpandAll\r\n    }\r\n  };\r\n}\r\n\r\nfunction useCurrent(watcherData) {\r\n  const instance = vue.getCurrentInstance();\r\n  const _currentRowKey = vue.ref(null);\r\n  const currentRow = vue.ref(null);\r\n  const setCurrentRowKey = (key) => {\r\n    instance.store.assertRowKey();\r\n    _currentRowKey.value = key;\r\n    setCurrentRowByKey(key);\r\n  };\r\n  const restoreCurrentRowKey = () => {\r\n    _currentRowKey.value = null;\r\n  };\r\n  const setCurrentRowByKey = (key) => {\r\n    const { data = [], rowKey } = watcherData;\r\n    let _currentRow = null;\r\n    if (rowKey.value) {\r\n      _currentRow = util.arrayFind(vue.unref(data), (item) => getRowIdentity(item, rowKey.value) === key);\r\n    }\r\n    currentRow.value = _currentRow;\r\n  };\r\n  const updateCurrentRow = (_currentRow) => {\r\n    const oldCurrentRow = currentRow.value;\r\n    if (_currentRow && _currentRow !== oldCurrentRow) {\r\n      currentRow.value = _currentRow;\r\n      instance.emit(\"current-change\", currentRow.value, oldCurrentRow);\r\n      return;\r\n    }\r\n    if (!_currentRow && oldCurrentRow) {\r\n      currentRow.value = null;\r\n      instance.emit(\"current-change\", null, oldCurrentRow);\r\n    }\r\n  };\r\n  const updateCurrentRowData = () => {\r\n    const rowKey = watcherData.rowKey.value;\r\n    const data = watcherData.data.value || [];\r\n    const oldCurrentRow = currentRow.value;\r\n    if (data.indexOf(oldCurrentRow) === -1 && oldCurrentRow) {\r\n      if (rowKey) {\r\n        const currentRowKey = getRowIdentity(oldCurrentRow, rowKey);\r\n        setCurrentRowByKey(currentRowKey);\r\n      } else {\r\n        currentRow.value = null;\r\n      }\r\n      if (currentRow.value === null) {\r\n        instance.emit(\"current-change\", null, oldCurrentRow);\r\n      }\r\n    } else if (_currentRowKey.value) {\r\n      setCurrentRowByKey(_currentRowKey.value);\r\n      restoreCurrentRowKey();\r\n    }\r\n  };\r\n  return {\r\n    setCurrentRowKey,\r\n    restoreCurrentRowKey,\r\n    setCurrentRowByKey,\r\n    updateCurrentRow,\r\n    updateCurrentRowData,\r\n    states: {\r\n      _currentRowKey,\r\n      currentRow\r\n    }\r\n  };\r\n}\r\n\r\nvar __defProp$1 = Object.defineProperty;\r\nvar __getOwnPropSymbols$1 = Object.getOwnPropertySymbols;\r\nvar __hasOwnProp$1 = Object.prototype.hasOwnProperty;\r\nvar __propIsEnum$1 = Object.prototype.propertyIsEnumerable;\r\nvar __defNormalProp$1 = (obj, key, value) => key in obj ? __defProp$1(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\r\nvar __spreadValues$1 = (a, b) => {\r\n  for (var prop in b || (b = {}))\r\n    if (__hasOwnProp$1.call(b, prop))\r\n      __defNormalProp$1(a, prop, b[prop]);\r\n  if (__getOwnPropSymbols$1)\r\n    for (var prop of __getOwnPropSymbols$1(b)) {\r\n      if (__propIsEnum$1.call(b, prop))\r\n        __defNormalProp$1(a, prop, b[prop]);\r\n    }\r\n  return a;\r\n};\r\nfunction useTree(watcherData) {\r\n  const expandRowKeys = vue.ref([]);\r\n  const treeData = vue.ref({});\r\n  const indent = vue.ref(16);\r\n  const lazy = vue.ref(false);\r\n  const lazyTreeNodeMap = vue.ref({});\r\n  const lazyColumnIdentifier = vue.ref(\"hasChildren\");\r\n  const childrenColumnName = vue.ref(\"children\");\r\n  const instance = vue.getCurrentInstance();\r\n  const normalizedData = vue.computed(() => {\r\n    if (!watcherData.rowKey.value)\r\n      return {};\r\n    const data = watcherData.data.value || [];\r\n    return normalize(data);\r\n  });\r\n  const normalizedLazyNode = vue.computed(() => {\r\n    const rowKey = watcherData.rowKey.value;\r\n    const keys = Object.keys(lazyTreeNodeMap.value);\r\n    const res = {};\r\n    if (!keys.length)\r\n      return res;\r\n    keys.forEach((key) => {\r\n      if (lazyTreeNodeMap.value[key].length) {\r\n        const item = { children: [] };\r\n        lazyTreeNodeMap.value[key].forEach((row) => {\r\n          const currentRowKey = getRowIdentity(row, rowKey);\r\n          item.children.push(currentRowKey);\r\n          if (row[lazyColumnIdentifier.value] && !res[currentRowKey]) {\r\n            res[currentRowKey] = { children: [] };\r\n          }\r\n        });\r\n        res[key] = item;\r\n      }\r\n    });\r\n    return res;\r\n  });\r\n  const normalize = (data) => {\r\n    const rowKey = watcherData.rowKey.value;\r\n    const res = {};\r\n    walkTreeNode(data, (parent, children, level) => {\r\n      const parentId = getRowIdentity(parent, rowKey);\r\n      if (Array.isArray(children)) {\r\n        res[parentId] = {\r\n          children: children.map((row) => getRowIdentity(row, rowKey)),\r\n          level\r\n        };\r\n      } else if (lazy.value) {\r\n        res[parentId] = {\r\n          children: [],\r\n          lazy: true,\r\n          level\r\n        };\r\n      }\r\n    }, childrenColumnName.value, lazyColumnIdentifier.value);\r\n    return res;\r\n  };\r\n  const updateTreeData = () => {\r\n    var _a, _b;\r\n    const nested = normalizedData.value;\r\n    const normalizedLazyNode_ = normalizedLazyNode.value;\r\n    const keys = Object.keys(nested);\r\n    const newTreeData = {};\r\n    if (keys.length) {\r\n      const oldTreeData = vue.unref(treeData);\r\n      const defaultExpandAll = (_a = instance.store) == null ? void 0 : _a.states.defaultExpandAll.value;\r\n      const rootLazyRowKeys = [];\r\n      const getExpanded = (oldValue, key) => {\r\n        const included = defaultExpandAll || expandRowKeys.value && expandRowKeys.value.indexOf(key) !== -1;\r\n        return !!(oldValue && oldValue.expanded || included);\r\n      };\r\n      keys.forEach((key) => {\r\n        const oldValue = oldTreeData[key];\r\n        const newValue = __spreadValues$1({}, nested[key]);\r\n        newValue.expanded = getExpanded(oldValue, key);\r\n        if (newValue.lazy) {\r\n          const { loaded = false, loading = false } = oldValue || {};\r\n          newValue.loaded = !!loaded;\r\n          newValue.loading = !!loading;\r\n          rootLazyRowKeys.push(key);\r\n        }\r\n        newTreeData[key] = newValue;\r\n      });\r\n      const lazyKeys = Object.keys(normalizedLazyNode_);\r\n      if (lazy.value && lazyKeys.length && rootLazyRowKeys.length) {\r\n        lazyKeys.forEach((key) => {\r\n          const oldValue = oldTreeData[key];\r\n          const lazyNodeChildren = normalizedLazyNode_[key].children;\r\n          if (rootLazyRowKeys.indexOf(key) !== -1) {\r\n            if (newTreeData[key].children.length !== 0) {\r\n              throw new Error(\"[ElTable]children must be an empty array.\");\r\n            }\r\n            newTreeData[key].children = lazyNodeChildren;\r\n          } else {\r\n            const { loaded = false, loading = false } = oldValue || {};\r\n            newTreeData[key] = {\r\n              lazy: true,\r\n              loaded: !!loaded,\r\n              loading: !!loading,\r\n              expanded: getExpanded(oldValue, key),\r\n              children: lazyNodeChildren,\r\n              level: \"\"\r\n            };\r\n          }\r\n        });\r\n      }\r\n    }\r\n    treeData.value = newTreeData;\r\n    (_b = instance.store) == null ? void 0 : _b.updateTableScrollY();\r\n  };\r\n  vue.watch(() => normalizedData.value, updateTreeData);\r\n  vue.watch(() => normalizedLazyNode.value, updateTreeData);\r\n  const updateTreeExpandKeys = (value) => {\r\n    expandRowKeys.value = value;\r\n    updateTreeData();\r\n  };\r\n  const toggleTreeExpansion = (row, expanded) => {\r\n    instance.store.assertRowKey();\r\n    const rowKey = watcherData.rowKey.value;\r\n    const id = getRowIdentity(row, rowKey);\r\n    const data = id && treeData.value[id];\r\n    if (id && data && \"expanded\" in data) {\r\n      const oldExpanded = data.expanded;\r\n      expanded = typeof expanded === \"undefined\" ? !data.expanded : expanded;\r\n      treeData.value[id].expanded = expanded;\r\n      if (oldExpanded !== expanded) {\r\n        instance.emit(\"expand-change\", row, expanded);\r\n      }\r\n      instance.store.updateTableScrollY();\r\n    }\r\n  };\r\n  const loadOrToggle = (row) => {\r\n    instance.store.assertRowKey();\r\n    const rowKey = watcherData.rowKey.value;\r\n    const id = getRowIdentity(row, rowKey);\r\n    const data = treeData.value[id];\r\n    if (lazy.value && data && \"loaded\" in data && !data.loaded) {\r\n      loadData(row, id, data);\r\n    } else {\r\n      toggleTreeExpansion(row, void 0);\r\n    }\r\n  };\r\n  const loadData = (row, key, treeNode) => {\r\n    const { load } = instance.props;\r\n    if (load && !treeData.value[key].loaded) {\r\n      treeData.value[key].loading = true;\r\n      load(row, treeNode, (data) => {\r\n        if (!Array.isArray(data)) {\r\n          throw new Error(\"[ElTable] data must be an array\");\r\n        }\r\n        treeData.value[key].loading = false;\r\n        treeData.value[key].loaded = true;\r\n        treeData.value[key].expanded = true;\r\n        if (data.length) {\r\n          lazyTreeNodeMap.value[key] = data;\r\n        }\r\n        instance.emit(\"expand-change\", row, true);\r\n      });\r\n    }\r\n  };\r\n  return {\r\n    loadData,\r\n    loadOrToggle,\r\n    toggleTreeExpansion,\r\n    updateTreeExpandKeys,\r\n    updateTreeData,\r\n    normalize,\r\n    states: {\r\n      expandRowKeys,\r\n      treeData,\r\n      indent,\r\n      lazy,\r\n      lazyTreeNodeMap,\r\n      lazyColumnIdentifier,\r\n      childrenColumnName\r\n    }\r\n  };\r\n}\r\n\r\nvar __defProp$2 = Object.defineProperty;\r\nvar __getOwnPropSymbols$2 = Object.getOwnPropertySymbols;\r\nvar __hasOwnProp$2 = Object.prototype.hasOwnProperty;\r\nvar __propIsEnum$2 = Object.prototype.propertyIsEnumerable;\r\nvar __defNormalProp$2 = (obj, key, value) => key in obj ? __defProp$2(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\r\nvar __spreadValues$2 = (a, b) => {\r\n  for (var prop in b || (b = {}))\r\n    if (__hasOwnProp$2.call(b, prop))\r\n      __defNormalProp$2(a, prop, b[prop]);\r\n  if (__getOwnPropSymbols$2)\r\n    for (var prop of __getOwnPropSymbols$2(b)) {\r\n      if (__propIsEnum$2.call(b, prop))\r\n        __defNormalProp$2(a, prop, b[prop]);\r\n    }\r\n  return a;\r\n};\r\nconst sortData = (data, states) => {\r\n  const sortingColumn = states.sortingColumn;\r\n  if (!sortingColumn || typeof sortingColumn.sortable === \"string\") {\r\n    return data;\r\n  }\r\n  return orderBy(data, states.sortProp, states.sortOrder, sortingColumn.sortMethod, sortingColumn.sortBy);\r\n};\r\nconst doFlattenColumns = (columns) => {\r\n  const result = [];\r\n  columns.forEach((column) => {\r\n    if (column.children) {\r\n      result.push.apply(result, doFlattenColumns(column.children));\r\n    } else {\r\n      result.push(column);\r\n    }\r\n  });\r\n  return result;\r\n};\r\nfunction useWatcher() {\r\n  const instance = vue.getCurrentInstance();\r\n  const rowKey = vue.ref(null);\r\n  const data = vue.ref([]);\r\n  const _data = vue.ref([]);\r\n  const isComplex = vue.ref(false);\r\n  const _columns = vue.ref([]);\r\n  const originColumns = vue.ref([]);\r\n  const columns = vue.ref([]);\r\n  const fixedColumns = vue.ref([]);\r\n  const rightFixedColumns = vue.ref([]);\r\n  const leafColumns = vue.ref([]);\r\n  const fixedLeafColumns = vue.ref([]);\r\n  const rightFixedLeafColumns = vue.ref([]);\r\n  const leafColumnsLength = vue.ref(0);\r\n  const fixedLeafColumnsLength = vue.ref(0);\r\n  const rightFixedLeafColumnsLength = vue.ref(0);\r\n  const isAllSelected = vue.ref(false);\r\n  const selection = vue.ref([]);\r\n  const reserveSelection = vue.ref(false);\r\n  const selectOnIndeterminate = vue.ref(false);\r\n  const selectable = vue.ref(null);\r\n  const filters = vue.ref({});\r\n  const filteredData = vue.ref(null);\r\n  const sortingColumn = vue.ref(null);\r\n  const sortProp = vue.ref(null);\r\n  const sortOrder = vue.ref(null);\r\n  const hoverRow = vue.ref(null);\r\n  vue.watch(data, () => instance.state && scheduleLayout(false), {\r\n    deep: true\r\n  });\r\n  const assertRowKey = () => {\r\n    if (!rowKey.value)\r\n      throw new Error(\"[ElTable] prop row-key is required\");\r\n  };\r\n  const updateColumns = () => {\r\n    fixedColumns.value = _columns.value.filter((column) => column.fixed === true || column.fixed === \"left\");\r\n    rightFixedColumns.value = _columns.value.filter((column) => column.fixed === \"right\");\r\n    if (fixedColumns.value.length > 0 && _columns.value[0] && _columns.value[0].type === \"selection\" && !_columns.value[0].fixed) {\r\n      _columns.value[0].fixed = true;\r\n      fixedColumns.value.unshift(_columns.value[0]);\r\n    }\r\n    const notFixedColumns = _columns.value.filter((column) => !column.fixed);\r\n    originColumns.value = [].concat(fixedColumns.value).concat(notFixedColumns).concat(rightFixedColumns.value);\r\n    const leafColumns2 = doFlattenColumns(notFixedColumns);\r\n    const fixedLeafColumns2 = doFlattenColumns(fixedColumns.value);\r\n    const rightFixedLeafColumns2 = doFlattenColumns(rightFixedColumns.value);\r\n    leafColumnsLength.value = leafColumns2.length;\r\n    fixedLeafColumnsLength.value = fixedLeafColumns2.length;\r\n    rightFixedLeafColumnsLength.value = rightFixedLeafColumns2.length;\r\n    columns.value = [].concat(fixedLeafColumns2).concat(leafColumns2).concat(rightFixedLeafColumns2);\r\n    isComplex.value = fixedColumns.value.length > 0 || rightFixedColumns.value.length > 0;\r\n  };\r\n  const scheduleLayout = (needUpdateColumns, immediate = false) => {\r\n    if (needUpdateColumns) {\r\n      updateColumns();\r\n    }\r\n    if (immediate) {\r\n      instance.state.doLayout();\r\n    } else {\r\n      instance.state.debouncedUpdateLayout();\r\n    }\r\n  };\r\n  const isSelected = (row) => {\r\n    return selection.value.indexOf(row) > -1;\r\n  };\r\n  const clearSelection = () => {\r\n    isAllSelected.value = false;\r\n    const oldSelection = selection.value;\r\n    if (oldSelection.length) {\r\n      selection.value = [];\r\n      instance.emit(\"selection-change\", []);\r\n    }\r\n  };\r\n  const cleanSelection = () => {\r\n    let deleted;\r\n    if (rowKey.value) {\r\n      deleted = [];\r\n      const selectedMap = getKeysMap(selection.value, rowKey.value);\r\n      const dataMap = getKeysMap(data.value, rowKey.value);\r\n      for (const key in selectedMap) {\r\n        if (hasOwn(selectedMap, key) && !dataMap[key]) {\r\n          deleted.push(selectedMap[key].row);\r\n        }\r\n      }\r\n    } else {\r\n      deleted = selection.value.filter((item) => data.value.indexOf(item) === -1);\r\n    }\r\n    if (deleted.length) {\r\n      const newSelection = selection.value.filter((item) => deleted.indexOf(item) === -1);\r\n      selection.value = newSelection;\r\n      instance.emit(\"selection-change\", newSelection.slice());\r\n    }\r\n  };\r\n  const toggleRowSelection = (row, selected = void 0, emitChange = true) => {\r\n    const changed = toggleRowStatus(selection.value, row, selected);\r\n    if (changed) {\r\n      const newSelection = (selection.value || []).slice();\r\n      if (emitChange) {\r\n        instance.emit(\"select\", newSelection, row);\r\n      }\r\n      instance.emit(\"selection-change\", newSelection);\r\n    }\r\n  };\r\n  const _toggleAllSelection = () => {\r\n    var _a, _b;\r\n    const value = selectOnIndeterminate.value ? !isAllSelected.value : !(isAllSelected.value || selection.value.length);\r\n    isAllSelected.value = value;\r\n    let selectionChanged = false;\r\n    let childrenCount = 0;\r\n    const rowKey2 = (_b = (_a = instance == null ? void 0 : instance.store) == null ? void 0 : _a.states) == null ? void 0 : _b.rowKey.value;\r\n    data.value.forEach((row, index) => {\r\n      const rowIndex = index + childrenCount;\r\n      if (selectable.value) {\r\n        if (selectable.value.call(null, row, rowIndex) && toggleRowStatus(selection.value, row, value)) {\r\n          selectionChanged = true;\r\n        }\r\n      } else {\r\n        if (toggleRowStatus(selection.value, row, value)) {\r\n          selectionChanged = true;\r\n        }\r\n      }\r\n      childrenCount += getChildrenCount(getRowIdentity(row, rowKey2));\r\n    });\r\n    if (selectionChanged) {\r\n      instance.emit(\"selection-change\", selection.value ? selection.value.slice() : []);\r\n    }\r\n    instance.emit(\"select-all\", selection.value);\r\n  };\r\n  const updateSelectionByRowKey = () => {\r\n    const selectedMap = getKeysMap(selection.value, rowKey.value);\r\n    data.value.forEach((row) => {\r\n      const rowId = getRowIdentity(row, rowKey.value);\r\n      const rowInfo = selectedMap[rowId];\r\n      if (rowInfo) {\r\n        selection.value[rowInfo.index] = row;\r\n      }\r\n    });\r\n  };\r\n  const updateAllSelected = () => {\r\n    var _a, _b, _c;\r\n    if (((_a = data.value) == null ? void 0 : _a.length) === 0) {\r\n      isAllSelected.value = false;\r\n      return;\r\n    }\r\n    let selectedMap;\r\n    if (rowKey.value) {\r\n      selectedMap = getKeysMap(selection.value, rowKey.value);\r\n    }\r\n    const isSelected2 = function(row) {\r\n      if (selectedMap) {\r\n        return !!selectedMap[getRowIdentity(row, rowKey.value)];\r\n      } else {\r\n        return selection.value.indexOf(row) !== -1;\r\n      }\r\n    };\r\n    let isAllSelected_ = true;\r\n    let selectedCount = 0;\r\n    let childrenCount = 0;\r\n    for (let i = 0, j = (data.value || []).length; i < j; i++) {\r\n      const keyProp = (_c = (_b = instance == null ? void 0 : instance.store) == null ? void 0 : _b.states) == null ? void 0 : _c.rowKey.value;\r\n      const rowIndex = i + childrenCount;\r\n      const item = data.value[i];\r\n      const isRowSelectable = selectable.value && selectable.value.call(null, item, rowIndex);\r\n      if (!isSelected2(item)) {\r\n        if (!selectable.value || isRowSelectable) {\r\n          isAllSelected_ = false;\r\n          break;\r\n        }\r\n      } else {\r\n        selectedCount++;\r\n      }\r\n      childrenCount += getChildrenCount(getRowIdentity(item, keyProp));\r\n    }\r\n    if (selectedCount === 0)\r\n      isAllSelected_ = false;\r\n    isAllSelected.value = isAllSelected_;\r\n  };\r\n  const getChildrenCount = (rowKey2) => {\r\n    var _a;\r\n    if (!instance || !instance.store)\r\n      return 0;\r\n    const {\r\n      treeData\r\n    } = instance.store.states;\r\n    let count = 0;\r\n    const children = (_a = treeData.value[rowKey2]) == null ? void 0 : _a.children;\r\n    if (children) {\r\n      count += children.length;\r\n      children.forEach((childKey) => {\r\n        count += getChildrenCount(childKey);\r\n      });\r\n    }\r\n    return count;\r\n  };\r\n  const updateFilters = (columns2, values) => {\r\n    if (!Array.isArray(columns2)) {\r\n      columns2 = [columns2];\r\n    }\r\n    const filters_ = {};\r\n    columns2.forEach((col) => {\r\n      filters.value[col.id] = values;\r\n      filters_[col.columnKey || col.id] = values;\r\n    });\r\n    return filters_;\r\n  };\r\n  const updateSort = (column, prop, order) => {\r\n    if (sortingColumn.value && sortingColumn.value !== column) {\r\n      sortingColumn.value.order = null;\r\n    }\r\n    sortingColumn.value = column;\r\n    sortProp.value = prop;\r\n    sortOrder.value = order;\r\n  };\r\n  const execFilter = () => {\r\n    let sourceData = vue.unref(_data);\r\n    Object.keys(filters.value).forEach((columnId) => {\r\n      const values = filters.value[columnId];\r\n      if (!values || values.length === 0)\r\n        return;\r\n      const column = getColumnById({\r\n        columns: columns.value\r\n      }, columnId);\r\n      if (column && column.filterMethod) {\r\n        sourceData = sourceData.filter((row) => {\r\n          return values.some((value) => column.filterMethod.call(null, value, row, column));\r\n        });\r\n      }\r\n    });\r\n    filteredData.value = sourceData;\r\n  };\r\n  const execSort = () => {\r\n    data.value = sortData(filteredData.value, {\r\n      sortingColumn: sortingColumn.value,\r\n      sortProp: sortProp.value,\r\n      sortOrder: sortOrder.value\r\n    });\r\n  };\r\n  const execQuery = (ignore = void 0) => {\r\n    if (!(ignore && ignore.filter)) {\r\n      execFilter();\r\n    }\r\n    execSort();\r\n  };\r\n  const clearFilter = (columnKeys) => {\r\n    const {\r\n      tableHeader,\r\n      fixedTableHeader,\r\n      rightFixedTableHeader\r\n    } = instance.refs;\r\n    let panels = {};\r\n    if (tableHeader)\r\n      panels = Object.assign(panels, tableHeader.filterPanels);\r\n    if (fixedTableHeader)\r\n      panels = Object.assign(panels, fixedTableHeader.filterPanels);\r\n    if (rightFixedTableHeader)\r\n      panels = Object.assign(panels, rightFixedTableHeader.filterPanels);\r\n    const keys = Object.keys(panels);\r\n    if (!keys.length)\r\n      return;\r\n    if (typeof columnKeys === \"string\") {\r\n      columnKeys = [columnKeys];\r\n    }\r\n    if (Array.isArray(columnKeys)) {\r\n      const columns_ = columnKeys.map((key) => getColumnByKey({\r\n        columns: columns.value\r\n      }, key));\r\n      keys.forEach((key) => {\r\n        const column = columns_.find((col) => col.id === key);\r\n        if (column) {\r\n          column.filteredValue = [];\r\n        }\r\n      });\r\n      instance.store.commit(\"filterChange\", {\r\n        column: columns_,\r\n        values: [],\r\n        silent: true,\r\n        multi: true\r\n      });\r\n    } else {\r\n      keys.forEach((key) => {\r\n        const column = columns.value.find((col) => col.id === key);\r\n        if (column) {\r\n          column.filteredValue = [];\r\n        }\r\n      });\r\n      filters.value = {};\r\n      instance.store.commit(\"filterChange\", {\r\n        column: {},\r\n        values: [],\r\n        silent: true\r\n      });\r\n    }\r\n  };\r\n  const clearSort = () => {\r\n    if (!sortingColumn.value)\r\n      return;\r\n    updateSort(null, null, null);\r\n    instance.store.commit(\"changeSortCondition\", {\r\n      silent: true\r\n    });\r\n  };\r\n  const {\r\n    setExpandRowKeys,\r\n    toggleRowExpansion,\r\n    updateExpandRows,\r\n    states: expandStates,\r\n    isRowExpanded\r\n  } = useExpand({\r\n    data,\r\n    rowKey\r\n  });\r\n  const {\r\n    updateTreeExpandKeys,\r\n    toggleTreeExpansion,\r\n    loadOrToggle,\r\n    states: treeStates\r\n  } = useTree({\r\n    data,\r\n    rowKey\r\n  });\r\n  const {\r\n    updateCurrentRowData,\r\n    updateCurrentRow,\r\n    setCurrentRowKey,\r\n    states: currentData\r\n  } = useCurrent({\r\n    data,\r\n    rowKey\r\n  });\r\n  const setExpandRowKeysAdapter = (val) => {\r\n    setExpandRowKeys(val);\r\n    updateTreeExpandKeys(val);\r\n  };\r\n  const toggleRowExpansionAdapter = (row, expanded) => {\r\n    const hasExpandColumn = columns.value.some(({ type }) => type === \"expand\");\r\n    if (hasExpandColumn) {\r\n      toggleRowExpansion(row, expanded);\r\n    } else {\r\n      toggleTreeExpansion(row, expanded);\r\n    }\r\n  };\r\n  return {\r\n    assertRowKey,\r\n    updateColumns,\r\n    scheduleLayout,\r\n    isSelected,\r\n    clearSelection,\r\n    cleanSelection,\r\n    toggleRowSelection,\r\n    _toggleAllSelection,\r\n    toggleAllSelection: null,\r\n    updateSelectionByRowKey,\r\n    updateAllSelected,\r\n    updateFilters,\r\n    updateCurrentRow,\r\n    updateSort,\r\n    execFilter,\r\n    execSort,\r\n    execQuery,\r\n    clearFilter,\r\n    clearSort,\r\n    toggleRowExpansion,\r\n    setExpandRowKeysAdapter,\r\n    setCurrentRowKey,\r\n    toggleRowExpansionAdapter,\r\n    isRowExpanded,\r\n    updateExpandRows,\r\n    updateCurrentRowData,\r\n    loadOrToggle,\r\n    states: __spreadValues$2(__spreadValues$2(__spreadValues$2({\r\n      rowKey,\r\n      data,\r\n      _data,\r\n      isComplex,\r\n      _columns,\r\n      originColumns,\r\n      columns,\r\n      fixedColumns,\r\n      rightFixedColumns,\r\n      leafColumns,\r\n      fixedLeafColumns,\r\n      rightFixedLeafColumns,\r\n      leafColumnsLength,\r\n      fixedLeafColumnsLength,\r\n      rightFixedLeafColumnsLength,\r\n      isAllSelected,\r\n      selection,\r\n      reserveSelection,\r\n      selectOnIndeterminate,\r\n      selectable,\r\n      filters,\r\n      filteredData,\r\n      sortingColumn,\r\n      sortProp,\r\n      sortOrder,\r\n      hoverRow\r\n    }, expandStates), treeStates), currentData)\r\n  };\r\n}\r\n\r\nvar __defProp$3 = Object.defineProperty;\r\nvar __defProps = Object.defineProperties;\r\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\r\nvar __getOwnPropSymbols$3 = Object.getOwnPropertySymbols;\r\nvar __hasOwnProp$3 = Object.prototype.hasOwnProperty;\r\nvar __propIsEnum$3 = Object.prototype.propertyIsEnumerable;\r\nvar __defNormalProp$3 = (obj, key, value) => key in obj ? __defProp$3(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\r\nvar __spreadValues$3 = (a, b) => {\r\n  for (var prop in b || (b = {}))\r\n    if (__hasOwnProp$3.call(b, prop))\r\n      __defNormalProp$3(a, prop, b[prop]);\r\n  if (__getOwnPropSymbols$3)\r\n    for (var prop of __getOwnPropSymbols$3(b)) {\r\n      if (__propIsEnum$3.call(b, prop))\r\n        __defNormalProp$3(a, prop, b[prop]);\r\n    }\r\n  return a;\r\n};\r\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\r\nfunction replaceColumn(array, column) {\r\n  return array.map((item) => {\r\n    var _a;\r\n    if (item.id === column.id) {\r\n      return column;\r\n    } else if ((_a = item.children) == null ? void 0 : _a.length) {\r\n      item.children = replaceColumn(item.children, column);\r\n    }\r\n    return item;\r\n  });\r\n}\r\nfunction sortColumn(array) {\r\n  array.forEach((item) => {\r\n    var _a, _b;\r\n    item.no = (_a = item.getColumnIndex) == null ? void 0 : _a.call(item);\r\n    if ((_b = item.children) == null ? void 0 : _b.length) {\r\n      sortColumn(item.children);\r\n    }\r\n  });\r\n  array.sort((cur, pre) => cur.no - pre.no);\r\n}\r\nfunction useStore() {\r\n  const instance = vue.getCurrentInstance();\r\n  const watcher = useWatcher();\r\n  const mutations = {\r\n    setData(states, data) {\r\n      const dataInstanceChanged = vue.unref(states.data) !== data;\r\n      states.data.value = data;\r\n      states._data.value = data;\r\n      instance.store.execQuery();\r\n      instance.store.updateCurrentRowData();\r\n      instance.store.updateExpandRows();\r\n      if (vue.unref(states.reserveSelection)) {\r\n        instance.store.assertRowKey();\r\n        instance.store.updateSelectionByRowKey();\r\n      } else {\r\n        if (dataInstanceChanged) {\r\n          instance.store.clearSelection();\r\n        } else {\r\n          instance.store.cleanSelection();\r\n        }\r\n      }\r\n      instance.store.updateAllSelected();\r\n      if (instance.$ready) {\r\n        instance.store.scheduleLayout();\r\n      }\r\n    },\r\n    insertColumn(states, column, parent) {\r\n      const array = vue.unref(states._columns);\r\n      let newColumns = [];\r\n      if (!parent) {\r\n        array.push(column);\r\n        newColumns = array;\r\n      } else {\r\n        if (parent && !parent.children) {\r\n          parent.children = [];\r\n        }\r\n        parent.children.push(column);\r\n        newColumns = replaceColumn(array, parent);\r\n      }\r\n      sortColumn(newColumns);\r\n      states._columns.value = newColumns;\r\n      if (column.type === \"selection\") {\r\n        states.selectable.value = column.selectable;\r\n        states.reserveSelection.value = column.reserveSelection;\r\n      }\r\n      if (instance.$ready) {\r\n        instance.store.updateColumns();\r\n        instance.store.scheduleLayout();\r\n      }\r\n    },\r\n    removeColumn(states, column, parent) {\r\n      const array = vue.unref(states._columns) || [];\r\n      if (parent) {\r\n        parent.children.splice(parent.children.findIndex((item) => item.id === column.id), 1);\r\n        if (parent.children.length === 0) {\r\n          delete parent.children;\r\n        }\r\n        states._columns.value = replaceColumn(array, parent);\r\n      } else {\r\n        const index = array.indexOf(column);\r\n        if (index > -1) {\r\n          array.splice(index, 1);\r\n          states._columns.value = array;\r\n        }\r\n      }\r\n      if (instance.$ready) {\r\n        instance.store.updateColumns();\r\n        instance.store.scheduleLayout();\r\n      }\r\n    },\r\n    sort(states, options) {\r\n      const { prop, order, init } = options;\r\n      if (prop) {\r\n        const column = util.arrayFind(vue.unref(states.columns), (column2) => column2.property === prop);\r\n        if (column) {\r\n          column.order = order;\r\n          instance.store.updateSort(column, prop, order);\r\n          instance.store.commit(\"changeSortCondition\", { init });\r\n        }\r\n      }\r\n    },\r\n    changeSortCondition(states, options) {\r\n      const { sortingColumn: column, sortProp: prop, sortOrder: order } = states;\r\n      if (vue.unref(order) === null) {\r\n        states.sortingColumn.value = null;\r\n        states.sortProp.value = null;\r\n      }\r\n      const ingore = { filter: true };\r\n      instance.store.execQuery(ingore);\r\n      if (!options || !(options.silent || options.init)) {\r\n        instance.emit(\"sort-change\", {\r\n          column: vue.unref(column),\r\n          prop: vue.unref(prop),\r\n          order: vue.unref(order)\r\n        });\r\n      }\r\n      instance.store.updateTableScrollY();\r\n    },\r\n    filterChange(_states, options) {\r\n      const { column, values, silent } = options;\r\n      const newFilters = instance.store.updateFilters(column, values);\r\n      instance.store.execQuery();\r\n      if (!silent) {\r\n        instance.emit(\"filter-change\", newFilters);\r\n      }\r\n      instance.store.updateTableScrollY();\r\n    },\r\n    toggleAllSelection() {\r\n      instance.store.toggleAllSelection();\r\n    },\r\n    rowSelectedChanged(_states, row) {\r\n      instance.store.toggleRowSelection(row);\r\n      instance.store.updateAllSelected();\r\n    },\r\n    setHoverRow(states, row) {\r\n      states.hoverRow.value = row;\r\n    },\r\n    setCurrentRow(_states, row) {\r\n      instance.store.updateCurrentRow(row);\r\n    }\r\n  };\r\n  const commit = function(name, ...args) {\r\n    const mutations2 = instance.store.mutations;\r\n    if (mutations2[name]) {\r\n      mutations2[name].apply(instance, [instance.store.states].concat(args));\r\n    } else {\r\n      throw new Error(`Action not found: ${name}`);\r\n    }\r\n  };\r\n  const updateTableScrollY = function() {\r\n    vue.nextTick(() => instance.layout.updateScrollY.apply(instance.layout));\r\n  };\r\n  return __spreadProps(__spreadValues$3({}, watcher), {\r\n    mutations,\r\n    commit,\r\n    updateTableScrollY\r\n  });\r\n}\r\n\r\nconst InitialStateMap = {\r\n  rowKey: \"rowKey\",\r\n  defaultExpandAll: \"defaultExpandAll\",\r\n  selectOnIndeterminate: \"selectOnIndeterminate\",\r\n  indent: \"indent\",\r\n  lazy: \"lazy\",\r\n  data: \"data\",\r\n  [\"treeProps.hasChildren\"]: {\r\n    key: \"lazyColumnIdentifier\",\r\n    default: \"hasChildren\"\r\n  },\r\n  [\"treeProps.children\"]: {\r\n    key: \"childrenColumnName\",\r\n    default: \"children\"\r\n  }\r\n};\r\nfunction createStore(table, props) {\r\n  if (!table) {\r\n    throw new Error(\"Table is required.\");\r\n  }\r\n  const store = useStore();\r\n  store.toggleAllSelection = debounce__default['default'](store._toggleAllSelection, 10);\r\n  Object.keys(InitialStateMap).forEach((key) => {\r\n    handleValue(getArrKeysValue(props, key), key, store);\r\n  });\r\n  proxyTableProps(store, props);\r\n  return store;\r\n}\r\nfunction proxyTableProps(store, props) {\r\n  Object.keys(InitialStateMap).forEach((key) => {\r\n    vue.watch(() => getArrKeysValue(props, key), (value) => {\r\n      handleValue(value, key, store);\r\n    });\r\n  });\r\n}\r\nfunction handleValue(value, propsKey, store) {\r\n  let newVal = value;\r\n  let storeKey = InitialStateMap[propsKey];\r\n  if (typeof InitialStateMap[propsKey] === \"object\") {\r\n    storeKey = storeKey.key;\r\n    newVal = newVal || InitialStateMap[propsKey].default;\r\n  }\r\n  store.states[storeKey].value = newVal;\r\n}\r\nfunction getArrKeysValue(props, keys) {\r\n  if (keys.includes(\".\")) {\r\n    const keyList = keys.split(\".\");\r\n    let value = props;\r\n    keyList.forEach((key) => {\r\n      value = value[key];\r\n    });\r\n    return value;\r\n  } else {\r\n    return props[keys];\r\n  }\r\n}\r\n\r\nclass TableLayout {\r\n  constructor(options) {\r\n    this.observers = [];\r\n    this.table = null;\r\n    this.store = null;\r\n    this.columns = [];\r\n    this.fit = true;\r\n    this.showHeader = true;\r\n    this.height = vue.ref(null);\r\n    this.scrollX = vue.ref(false);\r\n    this.scrollY = vue.ref(false);\r\n    this.bodyWidth = vue.ref(null);\r\n    this.fixedWidth = vue.ref(null);\r\n    this.rightFixedWidth = vue.ref(null);\r\n    this.tableHeight = vue.ref(null);\r\n    this.headerHeight = vue.ref(44);\r\n    this.appendHeight = vue.ref(0);\r\n    this.footerHeight = vue.ref(44);\r\n    this.viewportHeight = vue.ref(null);\r\n    this.bodyHeight = vue.ref(null);\r\n    this.fixedBodyHeight = vue.ref(null);\r\n    this.gutterWidth = scrollbarWidth__default['default']();\r\n    for (const name in options) {\r\n      if (hasOwn(options, name)) {\r\n        if (vue.isRef(this[name])) {\r\n          this[name].value = options[name];\r\n        } else {\r\n          this[name] = options[name];\r\n        }\r\n      }\r\n    }\r\n    if (!this.table) {\r\n      throw new Error(\"table is required for Table Layout\");\r\n    }\r\n    if (!this.store) {\r\n      throw new Error(\"store is required for Table Layout\");\r\n    }\r\n  }\r\n  updateScrollY() {\r\n    const height = this.height.value;\r\n    if (height === null)\r\n      return false;\r\n    const bodyWrapper = this.table.refs.bodyWrapper;\r\n    if (this.table.vnode.el && bodyWrapper) {\r\n      let scrollY = true;\r\n      const prevScrollY = this.scrollY.value;\r\n      if (this.bodyHeight.value === null) {\r\n        scrollY = false;\r\n      } else {\r\n        const body = bodyWrapper.querySelector(\".el-table__body\");\r\n        scrollY = body.offsetHeight > this.bodyHeight.value;\r\n      }\r\n      this.scrollY.value = scrollY;\r\n      return prevScrollY !== scrollY;\r\n    }\r\n    return false;\r\n  }\r\n  setHeight(value, prop = \"height\") {\r\n    if (isServer__default['default'])\r\n      return;\r\n    const el = this.table.vnode.el;\r\n    value = parseHeight(value);\r\n    this.height.value = Number(value);\r\n    if (!el && (value || value === 0))\r\n      return vue.nextTick(() => this.setHeight(value, prop));\r\n    if (typeof value === \"number\") {\r\n      el.style[prop] = value + \"px\";\r\n      this.updateElsHeight();\r\n    } else if (typeof value === \"string\") {\r\n      el.style[prop] = value;\r\n      this.updateElsHeight();\r\n    }\r\n  }\r\n  setMaxHeight(value) {\r\n    this.setHeight(value, \"max-height\");\r\n  }\r\n  getFlattenColumns() {\r\n    const flattenColumns = [];\r\n    const columns = this.table.store.states.columns.value;\r\n    columns.forEach((column) => {\r\n      if (column.isColumnGroup) {\r\n        flattenColumns.push.apply(flattenColumns, column.columns);\r\n      } else {\r\n        flattenColumns.push(column);\r\n      }\r\n    });\r\n    return flattenColumns;\r\n  }\r\n  updateElsHeight() {\r\n    if (!this.table.$ready)\r\n      return vue.nextTick(() => this.updateElsHeight());\r\n    const { headerWrapper, appendWrapper, footerWrapper } = this.table.refs;\r\n    this.appendHeight.value = appendWrapper ? appendWrapper.offsetHeight : 0;\r\n    if (this.showHeader && !headerWrapper)\r\n      return;\r\n    const headerTrElm = headerWrapper ? headerWrapper.querySelector(\".el-table__header tr\") : null;\r\n    const noneHeader = this.headerDisplayNone(headerTrElm);\r\n    const headerHeight = this.headerHeight.value = !this.showHeader ? 0 : headerWrapper.offsetHeight;\r\n    if (this.showHeader && !noneHeader && headerWrapper.offsetWidth > 0 && (this.table.store.states.columns.value || []).length > 0 && headerHeight < 2) {\r\n      return vue.nextTick(() => this.updateElsHeight());\r\n    }\r\n    const tableHeight = this.tableHeight.value = this.table.vnode.el.clientHeight;\r\n    const footerHeight = this.footerHeight.value = footerWrapper ? footerWrapper.offsetHeight : 0;\r\n    if (this.height.value !== null) {\r\n      this.bodyHeight.value = tableHeight - headerHeight - footerHeight + (footerWrapper ? 1 : 0);\r\n    }\r\n    this.fixedBodyHeight.value = this.scrollX.value ? this.bodyHeight.value - this.gutterWidth : this.bodyHeight.value;\r\n    this.viewportHeight.value = this.scrollX.value ? tableHeight - this.gutterWidth : tableHeight;\r\n    this.updateScrollY();\r\n    this.notifyObservers(\"scrollable\");\r\n  }\r\n  headerDisplayNone(elm) {\r\n    if (!elm)\r\n      return true;\r\n    let headerChild = elm;\r\n    while (headerChild.tagName !== \"DIV\") {\r\n      if (getComputedStyle(headerChild).display === \"none\") {\r\n        return true;\r\n      }\r\n      headerChild = headerChild.parentElement;\r\n    }\r\n    return false;\r\n  }\r\n  updateColumnsWidth() {\r\n    if (isServer__default['default'])\r\n      return;\r\n    const fit = this.fit;\r\n    const bodyWidth = this.table.vnode.el.clientWidth;\r\n    let bodyMinWidth = 0;\r\n    const flattenColumns = this.getFlattenColumns();\r\n    const flexColumns = flattenColumns.filter((column) => typeof column.width !== \"number\");\r\n    flattenColumns.forEach((column) => {\r\n      if (typeof column.width === \"number\" && column.realWidth)\r\n        column.realWidth = null;\r\n    });\r\n    if (flexColumns.length > 0 && fit) {\r\n      flattenColumns.forEach((column) => {\r\n        bodyMinWidth += Number(column.width || column.minWidth || 80);\r\n      });\r\n      const scrollYWidth = this.scrollY.value ? this.gutterWidth : 0;\r\n      if (bodyMinWidth <= bodyWidth - scrollYWidth) {\r\n        this.scrollX.value = false;\r\n        const totalFlexWidth = bodyWidth - scrollYWidth - bodyMinWidth;\r\n        if (flexColumns.length === 1) {\r\n          flexColumns[0].realWidth = Number(flexColumns[0].minWidth || 80) + totalFlexWidth;\r\n        } else {\r\n          const allColumnsWidth = flexColumns.reduce((prev, column) => prev + Number(column.minWidth || 80), 0);\r\n          const flexWidthPerPixel = totalFlexWidth / allColumnsWidth;\r\n          let noneFirstWidth = 0;\r\n          flexColumns.forEach((column, index) => {\r\n            if (index === 0)\r\n              return;\r\n            const flexWidth = Math.floor(Number(column.minWidth || 80) * flexWidthPerPixel);\r\n            noneFirstWidth += flexWidth;\r\n            column.realWidth = Number(column.minWidth || 80) + flexWidth;\r\n          });\r\n          flexColumns[0].realWidth = Number(flexColumns[0].minWidth || 80) + totalFlexWidth - noneFirstWidth;\r\n        }\r\n      } else {\r\n        this.scrollX.value = true;\r\n        flexColumns.forEach(function(column) {\r\n          column.realWidth = Number(column.minWidth);\r\n        });\r\n      }\r\n      this.bodyWidth.value = Math.max(bodyMinWidth, bodyWidth);\r\n      this.table.state.resizeState.value.width = this.bodyWidth.value;\r\n    } else {\r\n      flattenColumns.forEach((column) => {\r\n        if (!column.width && !column.minWidth) {\r\n          column.realWidth = 80;\r\n        } else {\r\n          column.realWidth = Number(column.width || column.minWidth);\r\n        }\r\n        bodyMinWidth += column.realWidth;\r\n      });\r\n      this.scrollX.value = bodyMinWidth > bodyWidth;\r\n      this.bodyWidth.value = bodyMinWidth;\r\n    }\r\n    const fixedColumns = this.store.states.fixedColumns.value;\r\n    if (fixedColumns.length > 0) {\r\n      let fixedWidth = 0;\r\n      fixedColumns.forEach(function(column) {\r\n        fixedWidth += Number(column.realWidth || column.width);\r\n      });\r\n      this.fixedWidth.value = fixedWidth;\r\n    }\r\n    const rightFixedColumns = this.store.states.rightFixedColumns.value;\r\n    if (rightFixedColumns.length > 0) {\r\n      let rightFixedWidth = 0;\r\n      rightFixedColumns.forEach(function(column) {\r\n        rightFixedWidth += Number(column.realWidth || column.width);\r\n      });\r\n      this.rightFixedWidth.value = rightFixedWidth;\r\n    }\r\n    this.notifyObservers(\"columns\");\r\n  }\r\n  addObserver(observer) {\r\n    this.observers.push(observer);\r\n  }\r\n  removeObserver(observer) {\r\n    const index = this.observers.indexOf(observer);\r\n    if (index !== -1) {\r\n      this.observers.splice(index, 1);\r\n    }\r\n  }\r\n  notifyObservers(event) {\r\n    const observers = this.observers;\r\n    observers.forEach((observer) => {\r\n      var _a, _b;\r\n      switch (event) {\r\n        case \"columns\":\r\n          (_a = observer.state) == null ? void 0 : _a.onColumnsChange(this);\r\n          break;\r\n        case \"scrollable\":\r\n          (_b = observer.state) == null ? void 0 : _b.onScrollableChange(this);\r\n          break;\r\n        default:\r\n          throw new Error(`Table Layout don't have event ${event}.`);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nvar script = vue.defineComponent({\r\n  name: \"ElTableFilterPanel\",\r\n  components: {\r\n    ElCheckbox: ElCheckbox__default['default'],\r\n    ElCheckboxGroup: ElCheckboxGroup__default['default'],\r\n    ElScrollbar: ElScrollbar__default['default'],\r\n    ElPopper: ElPopper__default['default']\r\n  },\r\n  directives: { ClickOutside: directives.ClickOutside },\r\n  props: {\r\n    placement: {\r\n      type: String,\r\n      default: \"bottom-start\"\r\n    },\r\n    store: {\r\n      type: Object\r\n    },\r\n    column: {\r\n      type: Object\r\n    },\r\n    upDataColumn: {\r\n      type: Function\r\n    }\r\n  },\r\n  setup(props) {\r\n    const instance = vue.getCurrentInstance();\r\n    const parent = instance.parent;\r\n    if (!parent.filterPanels.value[props.column.id]) {\r\n      parent.filterPanels.value[props.column.id] = instance;\r\n    }\r\n    const tooltipVisible = vue.ref(false);\r\n    const tooltip = vue.ref(null);\r\n    const filters = vue.computed(() => {\r\n      return props.column && props.column.filters;\r\n    });\r\n    const filterValue = vue.computed({\r\n      get: () => (props.column.filteredValue || [])[0],\r\n      set: (value) => {\r\n        if (filteredValue.value) {\r\n          if (typeof value !== \"undefined\" && value !== null) {\r\n            filteredValue.value.splice(0, 1, value);\r\n          } else {\r\n            filteredValue.value.splice(0, 1);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    const filteredValue = vue.computed({\r\n      get() {\r\n        if (props.column) {\r\n          return props.column.filteredValue || [];\r\n        }\r\n        return [];\r\n      },\r\n      set(value) {\r\n        if (props.column) {\r\n          props.upDataColumn(\"filteredValue\", value);\r\n        }\r\n      }\r\n    });\r\n    const multiple = vue.computed(() => {\r\n      if (props.column) {\r\n        return props.column.filterMultiple;\r\n      }\r\n      return true;\r\n    });\r\n    const isActive = (filter) => {\r\n      return filter.value === filterValue.value;\r\n    };\r\n    const hidden = () => {\r\n      tooltipVisible.value = false;\r\n    };\r\n    const showFilterPanel = (e) => {\r\n      e.stopPropagation();\r\n      tooltipVisible.value = !tooltipVisible.value;\r\n    };\r\n    const hideFilterPanel = () => {\r\n      tooltipVisible.value = false;\r\n    };\r\n    const handleConfirm = () => {\r\n      confirmFilter(filteredValue.value);\r\n      hidden();\r\n    };\r\n    const handleReset = () => {\r\n      filteredValue.value = [];\r\n      confirmFilter(filteredValue.value);\r\n      hidden();\r\n    };\r\n    const handleSelect = (_filterValue) => {\r\n      filterValue.value = _filterValue;\r\n      if (typeof _filterValue !== \"undefined\" && _filterValue !== null) {\r\n        confirmFilter(filteredValue.value);\r\n      } else {\r\n        confirmFilter([]);\r\n      }\r\n      hidden();\r\n    };\r\n    const confirmFilter = (filteredValue2) => {\r\n      props.store.commit(\"filterChange\", {\r\n        column: props.column,\r\n        values: filteredValue2\r\n      });\r\n      props.store.updateAllSelected();\r\n    };\r\n    vue.watch(tooltipVisible, (value) => {\r\n      if (props.column) {\r\n        props.upDataColumn(\"filterOpened\", value);\r\n      }\r\n    }, {\r\n      immediate: true\r\n    });\r\n    const popperPaneRef = vue.computed(() => {\r\n      var _a;\r\n      return (_a = tooltip.value) == null ? void 0 : _a.popperRef;\r\n    });\r\n    return {\r\n      tooltipVisible,\r\n      multiple,\r\n      filteredValue,\r\n      filterValue,\r\n      filters,\r\n      handleConfirm,\r\n      handleReset,\r\n      handleSelect,\r\n      isActive,\r\n      t: locale.t,\r\n      showFilterPanel,\r\n      hideFilterPanel,\r\n      popperPaneRef,\r\n      tooltip\r\n    };\r\n  }\r\n});\r\n\r\nconst _hoisted_1 = { key: 0 };\r\nconst _hoisted_2 = { class: \"el-table-filter__content\" };\r\nconst _hoisted_3 = { class: \"el-table-filter__bottom\" };\r\nconst _hoisted_4 = {\r\n  key: 1,\r\n  class: \"el-table-filter__list\"\r\n};\r\nfunction render(_ctx, _cache, $props, $setup, $data, $options) {\r\n  const _component_el_checkbox = vue.resolveComponent(\"el-checkbox\");\r\n  const _component_el_checkbox_group = vue.resolveComponent(\"el-checkbox-group\");\r\n  const _component_el_scrollbar = vue.resolveComponent(\"el-scrollbar\");\r\n  const _component_el_popper = vue.resolveComponent(\"el-popper\");\r\n  const _directive_click_outside = vue.resolveDirective(\"click-outside\");\r\n  return vue.openBlock(), vue.createBlock(_component_el_popper, {\r\n    ref: \"tooltip\",\r\n    visible: _ctx.tooltipVisible,\r\n    \"onUpdate:visible\": _cache[6] || (_cache[6] = ($event) => _ctx.tooltipVisible = $event),\r\n    offset: 0,\r\n    placement: _ctx.placement,\r\n    \"show-arrow\": false,\r\n    \"stop-popper-mouse-event\": false,\r\n    effect: \"light\",\r\n    pure: \"\",\r\n    \"manual-mode\": \"\",\r\n    \"popper-class\": \"el-table-filter\",\r\n    \"append-to-body\": \"\"\r\n  }, {\r\n    default: vue.withCtx(() => [\r\n      _ctx.multiple ? (vue.openBlock(), vue.createBlock(\"div\", _hoisted_1, [\r\n        vue.createVNode(\"div\", _hoisted_2, [\r\n          vue.createVNode(_component_el_scrollbar, { \"wrap-class\": \"el-table-filter__wrap\" }, {\r\n            default: vue.withCtx(() => [\r\n              vue.createVNode(_component_el_checkbox_group, {\r\n                modelValue: _ctx.filteredValue,\r\n                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => _ctx.filteredValue = $event),\r\n                class: \"el-table-filter__checkbox-group\"\r\n              }, {\r\n                default: vue.withCtx(() => [\r\n                  (vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.filters, (filter) => {\r\n                    return vue.openBlock(), vue.createBlock(_component_el_checkbox, {\r\n                      key: filter.value,\r\n                      label: filter.value\r\n                    }, {\r\n                      default: vue.withCtx(() => [\r\n                        vue.createTextVNode(vue.toDisplayString(filter.text), 1)\r\n                      ]),\r\n                      _: 2\r\n                    }, 1032, [\"label\"]);\r\n                  }), 128))\r\n                ]),\r\n                _: 1\r\n              }, 8, [\"modelValue\"])\r\n            ]),\r\n            _: 1\r\n          })\r\n        ]),\r\n        vue.createVNode(\"div\", _hoisted_3, [\r\n          vue.createVNode(\"button\", {\r\n            class: { \"is-disabled\": _ctx.filteredValue.length === 0 },\r\n            disabled: _ctx.filteredValue.length === 0,\r\n            type: \"\",\r\n            onClick: _cache[2] || (_cache[2] = (...args) => _ctx.handleConfirm && _ctx.handleConfirm(...args))\r\n          }, vue.toDisplayString(_ctx.t(\"el.table.confirmFilter\")), 11, [\"disabled\"]),\r\n          vue.createVNode(\"button\", {\r\n            type: \"\",\r\n            onClick: _cache[3] || (_cache[3] = (...args) => _ctx.handleReset && _ctx.handleReset(...args))\r\n          }, vue.toDisplayString(_ctx.t(\"el.table.resetFilter\")), 1)\r\n        ])\r\n      ])) : (vue.openBlock(), vue.createBlock(\"ul\", _hoisted_4, [\r\n        vue.createVNode(\"li\", {\r\n          class: [{\r\n            \"is-active\": _ctx.filterValue === void 0 || _ctx.filterValue === null\r\n          }, \"el-table-filter__list-item\"],\r\n          onClick: _cache[4] || (_cache[4] = ($event) => _ctx.handleSelect(null))\r\n        }, vue.toDisplayString(_ctx.t(\"el.table.clearFilter\")), 3),\r\n        (vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.filters, (filter) => {\r\n          return vue.openBlock(), vue.createBlock(\"li\", {\r\n            key: filter.value,\r\n            class: [{ \"is-active\": _ctx.isActive(filter) }, \"el-table-filter__list-item\"],\r\n            label: filter.value,\r\n            onClick: ($event) => _ctx.handleSelect(filter.value)\r\n          }, vue.toDisplayString(filter.text), 11, [\"label\", \"onClick\"]);\r\n        }), 128))\r\n      ]))\r\n    ]),\r\n    trigger: vue.withCtx(() => [\r\n      vue.withDirectives(vue.createVNode(\"span\", {\r\n        class: \"el-table__column-filter-trigger el-none-outline\",\r\n        onClick: _cache[5] || (_cache[5] = (...args) => _ctx.showFilterPanel && _ctx.showFilterPanel(...args))\r\n      }, [\r\n        vue.createVNode(\"i\", {\r\n          class: [\r\n            \"el-icon-arrow-down\",\r\n            _ctx.column.filterOpened ? \"el-icon-arrow-up\" : \"\"\r\n          ]\r\n        }, null, 2)\r\n      ], 512), [\r\n        [_directive_click_outside, _ctx.hideFilterPanel, _ctx.popperPaneRef]\r\n      ])\r\n    ]),\r\n    _: 1\r\n  }, 8, [\"visible\", \"placement\"]);\r\n}\r\n\r\nscript.render = render;\r\nscript.__file = \"packages/table/src/filter-panel.vue\";\r\n\r\nfunction useLayoutObserver(root) {\r\n  const instance = vue.getCurrentInstance();\r\n  vue.onBeforeMount(() => {\r\n    tableLayout.value.addObserver(instance);\r\n  });\r\n  vue.onMounted(() => {\r\n    onColumnsChange(tableLayout.value);\r\n    onScrollableChange(tableLayout.value);\r\n  });\r\n  vue.onUpdated(() => {\r\n    onColumnsChange(tableLayout.value);\r\n    onScrollableChange(tableLayout.value);\r\n  });\r\n  vue.onUnmounted(() => {\r\n    tableLayout.value.removeObserver(instance);\r\n  });\r\n  const tableLayout = vue.computed(() => {\r\n    const layout = root.layout;\r\n    if (!layout) {\r\n      throw new Error(\"Can not find table layout.\");\r\n    }\r\n    return layout;\r\n  });\r\n  const onColumnsChange = (layout) => {\r\n    var _a;\r\n    const cols = ((_a = root.vnode.el) == null ? void 0 : _a.querySelectorAll(\"colgroup > col\")) || [];\r\n    if (!cols.length)\r\n      return;\r\n    const flattenColumns = layout.getFlattenColumns();\r\n    const columnsMap = {};\r\n    flattenColumns.forEach((column) => {\r\n      columnsMap[column.id] = column;\r\n    });\r\n    for (let i = 0, j = cols.length; i < j; i++) {\r\n      const col = cols[i];\r\n      const name = col.getAttribute(\"name\");\r\n      const column = columnsMap[name];\r\n      if (column) {\r\n        col.setAttribute(\"width\", column.realWidth || column.width);\r\n      }\r\n    }\r\n  };\r\n  const onScrollableChange = (layout) => {\r\n    const cols = root.vnode.el.querySelectorAll(\"colgroup > col[name=gutter]\");\r\n    for (let i = 0, j = cols.length; i < j; i++) {\r\n      const col = cols[i];\r\n      col.setAttribute(\"width\", layout.scrollY.value ? layout.gutterWidth : \"0\");\r\n    }\r\n    const ths = root.vnode.el.querySelectorAll(\"th.gutter\");\r\n    for (let i = 0, j = ths.length; i < j; i++) {\r\n      const th = ths[i];\r\n      th.style.width = layout.scrollY.value ? layout.gutterWidth + \"px\" : \"0\";\r\n      th.style.display = layout.scrollY.value ? \"\" : \"none\";\r\n    }\r\n  };\r\n  return {\r\n    tableLayout: tableLayout.value,\r\n    onColumnsChange,\r\n    onScrollableChange\r\n  };\r\n}\r\n\r\nfunction useEvent(props, emit) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const handleFilterClick = (event) => {\r\n    event.stopPropagation();\r\n    return;\r\n  };\r\n  const handleHeaderClick = (event, column) => {\r\n    if (!column.filters && column.sortable) {\r\n      handleSortClick(event, column, false);\r\n    } else if (column.filterable && !column.sortable) {\r\n      handleFilterClick(event);\r\n    }\r\n    parent.emit(\"header-click\", column, event);\r\n  };\r\n  const handleHeaderContextMenu = (event, column) => {\r\n    parent.emit(\"header-contextmenu\", column, event);\r\n  };\r\n  const draggingColumn = vue.ref(null);\r\n  const dragging = vue.ref(false);\r\n  const dragState = vue.ref({});\r\n  const handleMouseDown = (event, column) => {\r\n    if (isServer__default['default'])\r\n      return;\r\n    if (column.children && column.children.length > 0)\r\n      return;\r\n    if (draggingColumn.value && props.border) {\r\n      dragging.value = true;\r\n      const table = parent;\r\n      emit(\"set-drag-visible\", true);\r\n      const tableEl = table.vnode.el;\r\n      const tableLeft = tableEl.getBoundingClientRect().left;\r\n      const columnEl = instance.vnode.el.querySelector(`th.${column.id}`);\r\n      const columnRect = columnEl.getBoundingClientRect();\r\n      const minLeft = columnRect.left - tableLeft + 30;\r\n      dom.addClass(columnEl, \"noclick\");\r\n      dragState.value = {\r\n        startMouseLeft: event.clientX,\r\n        startLeft: columnRect.right - tableLeft,\r\n        startColumnLeft: columnRect.left - tableLeft,\r\n        tableLeft\r\n      };\r\n      const resizeProxy = table.refs.resizeProxy;\r\n      resizeProxy.style.left = dragState.value.startLeft + \"px\";\r\n      document.onselectstart = function() {\r\n        return false;\r\n      };\r\n      document.ondragstart = function() {\r\n        return false;\r\n      };\r\n      const handleMouseMove2 = (event2) => {\r\n        const deltaLeft = event2.clientX - dragState.value.startMouseLeft;\r\n        const proxyLeft = dragState.value.startLeft + deltaLeft;\r\n        resizeProxy.style.left = Math.max(minLeft, proxyLeft) + \"px\";\r\n      };\r\n      const handleMouseUp = () => {\r\n        if (dragging.value) {\r\n          const { startColumnLeft, startLeft } = dragState.value;\r\n          const finalLeft = parseInt(resizeProxy.style.left, 10);\r\n          const columnWidth = finalLeft - startColumnLeft;\r\n          column.width = column.realWidth = columnWidth;\r\n          table.emit(\"header-dragend\", column.width, startLeft - startColumnLeft, column, event);\r\n          props.store.scheduleLayout(false, true);\r\n          document.body.style.cursor = \"\";\r\n          dragging.value = false;\r\n          draggingColumn.value = null;\r\n          dragState.value = {};\r\n          emit(\"set-drag-visible\", false);\r\n        }\r\n        document.removeEventListener(\"mousemove\", handleMouseMove2);\r\n        document.removeEventListener(\"mouseup\", handleMouseUp);\r\n        document.onselectstart = null;\r\n        document.ondragstart = null;\r\n        setTimeout(function() {\r\n          dom.removeClass(columnEl, \"noclick\");\r\n        }, 0);\r\n      };\r\n      document.addEventListener(\"mousemove\", handleMouseMove2);\r\n      document.addEventListener(\"mouseup\", handleMouseUp);\r\n    }\r\n  };\r\n  const handleMouseMove = (event, column) => {\r\n    if (column.children && column.children.length > 0)\r\n      return;\r\n    let target = event.target;\r\n    while (target && target.tagName !== \"TH\") {\r\n      target = target.parentNode;\r\n    }\r\n    if (!column || !column.resizable)\r\n      return;\r\n    if (!dragging.value && props.border) {\r\n      const rect = target.getBoundingClientRect();\r\n      const bodyStyle = document.body.style;\r\n      if (rect.width > 12 && rect.right - event.pageX < 8) {\r\n        bodyStyle.cursor = \"col-resize\";\r\n        if (dom.hasClass(target, \"is-sortable\")) {\r\n          target.style.cursor = \"col-resize\";\r\n        }\r\n        draggingColumn.value = column;\r\n      } else if (!dragging.value) {\r\n        bodyStyle.cursor = \"\";\r\n        if (dom.hasClass(target, \"is-sortable\")) {\r\n          target.style.cursor = \"pointer\";\r\n        }\r\n        draggingColumn.value = null;\r\n      }\r\n    }\r\n  };\r\n  const handleMouseOut = () => {\r\n    if (isServer__default['default'])\r\n      return;\r\n    document.body.style.cursor = \"\";\r\n  };\r\n  const toggleOrder = ({ order, sortOrders }) => {\r\n    if (order === \"\")\r\n      return sortOrders[0];\r\n    const index = sortOrders.indexOf(order || null);\r\n    return sortOrders[index > sortOrders.length - 2 ? 0 : index + 1];\r\n  };\r\n  const handleSortClick = (event, column, givenOrder) => {\r\n    event.stopPropagation();\r\n    const order = column.order === givenOrder ? null : givenOrder || toggleOrder(column);\r\n    let target = event.target;\r\n    while (target && target.tagName !== \"TH\") {\r\n      target = target.parentNode;\r\n    }\r\n    if (target && target.tagName === \"TH\") {\r\n      if (dom.hasClass(target, \"noclick\")) {\r\n        dom.removeClass(target, \"noclick\");\r\n        return;\r\n      }\r\n    }\r\n    if (!column.sortable)\r\n      return;\r\n    const states = props.store.states;\r\n    let sortProp = states.sortProp.value;\r\n    let sortOrder;\r\n    const sortingColumn = states.sortingColumn.value;\r\n    if (sortingColumn !== column || sortingColumn === column && sortingColumn.order === null) {\r\n      if (sortingColumn) {\r\n        sortingColumn.order = null;\r\n      }\r\n      states.sortingColumn.value = column;\r\n      sortProp = column.property;\r\n    }\r\n    if (!order) {\r\n      sortOrder = column.order = null;\r\n    } else {\r\n      sortOrder = column.order = order;\r\n    }\r\n    states.sortProp.value = sortProp;\r\n    states.sortOrder.value = sortOrder;\r\n    parent.store.commit(\"changeSortCondition\");\r\n  };\r\n  return {\r\n    handleHeaderClick,\r\n    handleHeaderContextMenu,\r\n    handleMouseDown,\r\n    handleMouseMove,\r\n    handleMouseOut,\r\n    handleSortClick,\r\n    handleFilterClick\r\n  };\r\n}\r\n\r\nfunction useStyle(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const storeData = parent.store.states;\r\n  const isCellHidden = (index, columns) => {\r\n    let start = 0;\r\n    for (let i = 0; i < index; i++) {\r\n      start += columns[i].colSpan;\r\n    }\r\n    const after = start + columns[index].colSpan - 1;\r\n    if (props.fixed === \"left\") {\r\n      return after >= storeData.fixedLeafColumnsLength.value;\r\n    } else if (props.fixed === \"right\") {\r\n      return start < storeData.columns.value.length - storeData.rightFixedLeafColumnsLength.value;\r\n    } else {\r\n      return after < storeData.fixedLeafColumnsLength.value || start >= storeData.columns.value.length - storeData.rightFixedLeafColumnsLength.value;\r\n    }\r\n  };\r\n  const getHeaderRowStyle = (rowIndex) => {\r\n    const headerRowStyle = parent.props.headerRowStyle;\r\n    if (typeof headerRowStyle === \"function\") {\r\n      return headerRowStyle.call(null, { rowIndex });\r\n    }\r\n    return headerRowStyle;\r\n  };\r\n  const getHeaderRowClass = (rowIndex) => {\r\n    const classes = [];\r\n    const headerRowClassName = parent.props.headerRowClassName;\r\n    if (typeof headerRowClassName === \"string\") {\r\n      classes.push(headerRowClassName);\r\n    } else if (typeof headerRowClassName === \"function\") {\r\n      classes.push(headerRowClassName.call(null, { rowIndex }));\r\n    }\r\n    return classes.join(\" \");\r\n  };\r\n  const getHeaderCellStyle = (rowIndex, columnIndex, row, column) => {\r\n    const headerCellStyle = parent.props.headerCellStyle;\r\n    if (typeof headerCellStyle === \"function\") {\r\n      return headerCellStyle.call(null, {\r\n        rowIndex,\r\n        columnIndex,\r\n        row,\r\n        column\r\n      });\r\n    }\r\n    return headerCellStyle;\r\n  };\r\n  const getHeaderCellClass = (rowIndex, columnIndex, row, column) => {\r\n    const classes = [\r\n      column.id,\r\n      column.order,\r\n      column.headerAlign,\r\n      column.className,\r\n      column.labelClassName\r\n    ];\r\n    if (rowIndex === 0 && isCellHidden(columnIndex, row)) {\r\n      classes.push(\"is-hidden\");\r\n    }\r\n    if (!column.children) {\r\n      classes.push(\"is-leaf\");\r\n    }\r\n    if (column.sortable) {\r\n      classes.push(\"is-sortable\");\r\n    }\r\n    const headerCellClassName = parent.props.headerCellClassName;\r\n    if (typeof headerCellClassName === \"string\") {\r\n      classes.push(headerCellClassName);\r\n    } else if (typeof headerCellClassName === \"function\") {\r\n      classes.push(headerCellClassName.call(null, {\r\n        rowIndex,\r\n        columnIndex,\r\n        row,\r\n        column\r\n      }));\r\n    }\r\n    return classes.join(\" \");\r\n  };\r\n  return {\r\n    getHeaderRowStyle,\r\n    getHeaderRowClass,\r\n    getHeaderCellStyle,\r\n    getHeaderCellClass\r\n  };\r\n}\r\n\r\nconst getAllColumns = (columns) => {\r\n  const result = [];\r\n  columns.forEach((column) => {\r\n    if (column.children) {\r\n      result.push(column);\r\n      result.push.apply(result, getAllColumns(column.children));\r\n    } else {\r\n      result.push(column);\r\n    }\r\n  });\r\n  return result;\r\n};\r\nconst convertToRows = (originColumns) => {\r\n  let maxLevel = 1;\r\n  const traverse = (column, parent) => {\r\n    if (parent) {\r\n      column.level = parent.level + 1;\r\n      if (maxLevel < column.level) {\r\n        maxLevel = column.level;\r\n      }\r\n    }\r\n    if (column.children) {\r\n      let colSpan = 0;\r\n      column.children.forEach((subColumn) => {\r\n        traverse(subColumn, column);\r\n        colSpan += subColumn.colSpan;\r\n      });\r\n      column.colSpan = colSpan;\r\n    } else {\r\n      column.colSpan = 1;\r\n    }\r\n  };\r\n  originColumns.forEach((column) => {\r\n    column.level = 1;\r\n    traverse(column, void 0);\r\n  });\r\n  const rows = [];\r\n  for (let i = 0; i < maxLevel; i++) {\r\n    rows.push([]);\r\n  }\r\n  const allColumns = getAllColumns(originColumns);\r\n  allColumns.forEach((column) => {\r\n    if (!column.children) {\r\n      column.rowSpan = maxLevel - column.level + 1;\r\n    } else {\r\n      column.rowSpan = 1;\r\n    }\r\n    rows[column.level - 1].push(column);\r\n  });\r\n  return rows;\r\n};\r\nfunction useUtils(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const columnRows = vue.computed(() => {\r\n    return convertToRows(props.store.states.originColumns.value);\r\n  });\r\n  const isGroup = vue.computed(() => {\r\n    const result = columnRows.value.length > 1;\r\n    if (result)\r\n      parent.state.isGroup.value = true;\r\n    return result;\r\n  });\r\n  const toggleAllSelection = (event) => {\r\n    event.stopPropagation();\r\n    parent.store.commit(\"toggleAllSelection\");\r\n  };\r\n  return {\r\n    isGroup,\r\n    toggleAllSelection,\r\n    columnRows\r\n  };\r\n}\r\n\r\nfunction hGutter() {\r\n  return vue.h(\"col\", {\r\n    name: \"gutter\"\r\n  });\r\n}\r\nfunction hColgroup(columns, hasGutter = false) {\r\n  return vue.h(\"colgroup\", {}, [\r\n    ...columns.map((column) => vue.h(\"col\", {\r\n      name: column.id,\r\n      key: column.id\r\n    })),\r\n    hasGutter && hGutter()\r\n  ]);\r\n}\r\n\r\nvar TableHeader = vue.defineComponent({\r\n  name: \"ElTableHeader\",\r\n  components: {\r\n    ElCheckbox: ElCheckbox__default['default']\r\n  },\r\n  props: {\r\n    fixed: {\r\n      type: String,\r\n      default: \"\"\r\n    },\r\n    store: {\r\n      required: true,\r\n      type: Object\r\n    },\r\n    border: Boolean,\r\n    defaultSort: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          prop: \"\",\r\n          order: \"\"\r\n        };\r\n      }\r\n    }\r\n  },\r\n  setup(props, { emit }) {\r\n    const instance = vue.getCurrentInstance();\r\n    const parent = instance.parent;\r\n    const storeData = parent.store.states;\r\n    const filterPanels = vue.ref({});\r\n    const {\r\n      tableLayout,\r\n      onColumnsChange,\r\n      onScrollableChange\r\n    } = useLayoutObserver(parent);\r\n    const hasGutter = vue.computed(() => {\r\n      return !props.fixed && tableLayout.gutterWidth;\r\n    });\r\n    vue.onMounted(() => {\r\n      vue.nextTick(() => {\r\n        const { prop, order } = props.defaultSort;\r\n        const init = true;\r\n        parent.store.commit(\"sort\", { prop, order, init });\r\n      });\r\n    });\r\n    const {\r\n      handleHeaderClick,\r\n      handleHeaderContextMenu,\r\n      handleMouseDown,\r\n      handleMouseMove,\r\n      handleMouseOut,\r\n      handleSortClick,\r\n      handleFilterClick\r\n    } = useEvent(props, emit);\r\n    const {\r\n      getHeaderRowStyle,\r\n      getHeaderRowClass,\r\n      getHeaderCellStyle,\r\n      getHeaderCellClass\r\n    } = useStyle(props);\r\n    const { isGroup, toggleAllSelection, columnRows } = useUtils(props);\r\n    instance.state = {\r\n      onColumnsChange,\r\n      onScrollableChange\r\n    };\r\n    instance.filterPanels = filterPanels;\r\n    return {\r\n      columns: storeData.columns,\r\n      filterPanels,\r\n      hasGutter,\r\n      onColumnsChange,\r\n      onScrollableChange,\r\n      columnRows,\r\n      getHeaderRowClass,\r\n      getHeaderRowStyle,\r\n      getHeaderCellClass,\r\n      getHeaderCellStyle,\r\n      handleHeaderClick,\r\n      handleHeaderContextMenu,\r\n      handleMouseDown,\r\n      handleMouseMove,\r\n      handleMouseOut,\r\n      handleSortClick,\r\n      handleFilterClick,\r\n      isGroup,\r\n      toggleAllSelection\r\n    };\r\n  },\r\n  render() {\r\n    return vue.h(\"table\", {\r\n      border: \"0\",\r\n      cellpadding: \"0\",\r\n      cellspacing: \"0\",\r\n      class: \"el-table__header\"\r\n    }, [\r\n      hColgroup(this.columns, this.hasGutter),\r\n      vue.h(\"thead\", {\r\n        class: { \"is-group\": this.isGroup, \"has-gutter\": this.hasGutter }\r\n      }, this.columnRows.map((subColumns, rowIndex) => vue.h(\"tr\", {\r\n        class: this.getHeaderRowClass(rowIndex),\r\n        key: rowIndex,\r\n        style: this.getHeaderRowStyle(rowIndex)\r\n      }, subColumns.map((column, cellIndex) => vue.h(\"th\", {\r\n        class: this.getHeaderCellClass(rowIndex, cellIndex, subColumns, column),\r\n        colspan: column.colSpan,\r\n        key: `${column.id}-thead`,\r\n        rowSpan: column.rowSpan,\r\n        style: this.getHeaderCellStyle(rowIndex, cellIndex, subColumns, column),\r\n        onClick: ($event) => this.handleHeaderClick($event, column),\r\n        onContextmenu: ($event) => this.handleHeaderContextMenu($event, column),\r\n        onMousedown: ($event) => this.handleMouseDown($event, column),\r\n        onMousemove: ($event) => this.handleMouseMove($event, column),\r\n        onMouseout: this.handleMouseOut\r\n      }, [\r\n        vue.h(\"div\", {\r\n          class: [\r\n            \"cell\",\r\n            column.filteredValue && column.filteredValue.length > 0 ? \"highlight\" : \"\",\r\n            column.labelClassName\r\n          ]\r\n        }, [\r\n          column.renderHeader ? column.renderHeader({\r\n            column,\r\n            $index: cellIndex,\r\n            store: this.store,\r\n            _self: this.$parent\r\n          }) : column.label,\r\n          column.sortable && vue.h(\"span\", {\r\n            onClick: ($event) => this.handleSortClick($event, column),\r\n            class: \"caret-wrapper\"\r\n          }, [\r\n            vue.h(\"i\", {\r\n              onClick: ($event) => this.handleSortClick($event, column, \"ascending\"),\r\n              class: \"sort-caret ascending\"\r\n            }),\r\n            vue.h(\"i\", {\r\n              onClick: ($event) => this.handleSortClick($event, column, \"descending\"),\r\n              class: \"sort-caret descending\"\r\n            })\r\n          ]),\r\n          column.filterable && vue.h(script, {\r\n            store: this.$parent.store,\r\n            placement: column.filterPlacement || \"bottom-start\",\r\n            column,\r\n            upDataColumn: (key, value) => {\r\n              column[key] = value;\r\n            }\r\n          })\r\n        ])\r\n      ])))))\r\n    ]);\r\n  }\r\n});\r\n\r\nfunction useEvents(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const tooltipContent = vue.ref(\"\");\r\n  const tooltipTrigger = vue.ref(vue.h(\"div\"));\r\n  const handleEvent = (event, row, name) => {\r\n    const table = parent;\r\n    const cell = getCell(event);\r\n    let column;\r\n    if (cell) {\r\n      column = getColumnByCell({\r\n        columns: props.store.states.columns.value\r\n      }, cell);\r\n      if (column) {\r\n        table.emit(`cell-${name}`, row, column, cell, event);\r\n      }\r\n    }\r\n    table.emit(`row-${name}`, row, column, event);\r\n  };\r\n  const handleDoubleClick = (event, row) => {\r\n    handleEvent(event, row, \"dblclick\");\r\n  };\r\n  const handleClick = (event, row) => {\r\n    props.store.commit(\"setCurrentRow\", row);\r\n    handleEvent(event, row, \"click\");\r\n  };\r\n  const handleContextMenu = (event, row) => {\r\n    handleEvent(event, row, \"contextmenu\");\r\n  };\r\n  const handleMouseEnter = debounce__default['default'](function(index) {\r\n    props.store.commit(\"setHoverRow\", index);\r\n  }, 30);\r\n  const handleMouseLeave = debounce__default['default'](function() {\r\n    props.store.commit(\"setHoverRow\", null);\r\n  }, 30);\r\n  const handleCellMouseEnter = (event, row) => {\r\n    const table = parent;\r\n    const cell = getCell(event);\r\n    if (cell) {\r\n      const column = getColumnByCell({\r\n        columns: props.store.states.columns.value\r\n      }, cell);\r\n      const hoverState = table.hoverState = { cell, column, row };\r\n      table.emit(\"cell-mouse-enter\", hoverState.row, hoverState.column, hoverState.cell, event);\r\n    }\r\n    const cellChild = event.target.querySelector(\".cell\");\r\n    if (!(dom.hasClass(cellChild, \"el-tooltip\") && cellChild.childNodes.length)) {\r\n      return;\r\n    }\r\n    const range = document.createRange();\r\n    range.setStart(cellChild, 0);\r\n    range.setEnd(cellChild, cellChild.childNodes.length);\r\n    const rangeWidth = range.getBoundingClientRect().width;\r\n    const padding = (parseInt(dom.getStyle(cellChild, \"paddingLeft\"), 10) || 0) + (parseInt(dom.getStyle(cellChild, \"paddingRight\"), 10) || 0);\r\n    if (rangeWidth + padding > cellChild.offsetWidth || cellChild.scrollWidth > cellChild.offsetWidth) {\r\n      createTablePopper(cell, cell.innerText || cell.textContent, {\r\n        placement: \"top\",\r\n        strategy: \"fixed\"\r\n      }, row.tooltipEffect);\r\n    }\r\n  };\r\n  const handleCellMouseLeave = (event) => {\r\n    const cell = getCell(event);\r\n    if (!cell)\r\n      return;\r\n    const oldHoverState = parent.hoverState;\r\n    parent.emit(\"cell-mouse-leave\", oldHoverState == null ? void 0 : oldHoverState.row, oldHoverState == null ? void 0 : oldHoverState.column, oldHoverState == null ? void 0 : oldHoverState.cell, event);\r\n  };\r\n  return {\r\n    handleDoubleClick,\r\n    handleClick,\r\n    handleContextMenu,\r\n    handleMouseEnter,\r\n    handleMouseLeave,\r\n    handleCellMouseEnter,\r\n    handleCellMouseLeave,\r\n    tooltipContent,\r\n    tooltipTrigger\r\n  };\r\n}\r\n\r\nfunction useStyles(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const isColumnHidden = (index) => {\r\n    if (props.fixed === \"left\") {\r\n      return index >= props.store.states.fixedLeafColumnsLength.value;\r\n    } else if (props.fixed === \"right\") {\r\n      return index < props.store.states.columns.value.length - props.store.states.rightFixedLeafColumnsLength.value;\r\n    } else {\r\n      return index < props.store.states.fixedLeafColumnsLength.value || index >= props.store.states.columns.value.length - props.store.states.rightFixedLeafColumnsLength.value;\r\n    }\r\n  };\r\n  const getRowStyle = (row, rowIndex) => {\r\n    const rowStyle = parent.props.rowStyle;\r\n    if (typeof rowStyle === \"function\") {\r\n      return rowStyle.call(null, {\r\n        row,\r\n        rowIndex\r\n      });\r\n    }\r\n    return rowStyle || null;\r\n  };\r\n  const getRowClass = (row, rowIndex) => {\r\n    const classes = [\"el-table__row\"];\r\n    if (parent.props.highlightCurrentRow && row === props.store.states.currentRow.value) {\r\n      classes.push(\"current-row\");\r\n    }\r\n    if (props.stripe && rowIndex % 2 === 1) {\r\n      classes.push(\"el-table__row--striped\");\r\n    }\r\n    const rowClassName = parent.props.rowClassName;\r\n    if (typeof rowClassName === \"string\") {\r\n      classes.push(rowClassName);\r\n    } else if (typeof rowClassName === \"function\") {\r\n      classes.push(rowClassName.call(null, {\r\n        row,\r\n        rowIndex\r\n      }));\r\n    }\r\n    if (props.store.states.expandRows.value.indexOf(row) > -1) {\r\n      classes.push(\"expanded\");\r\n    }\r\n    return classes;\r\n  };\r\n  const getCellStyle = (rowIndex, columnIndex, row, column) => {\r\n    const cellStyle = parent.props.cellStyle;\r\n    if (typeof cellStyle === \"function\") {\r\n      return cellStyle.call(null, {\r\n        rowIndex,\r\n        columnIndex,\r\n        row,\r\n        column\r\n      });\r\n    }\r\n    return cellStyle;\r\n  };\r\n  const getCellClass = (rowIndex, columnIndex, row, column) => {\r\n    const classes = [column.id, column.align, column.className];\r\n    if (isColumnHidden(columnIndex)) {\r\n      classes.push(\"is-hidden\");\r\n    }\r\n    const cellClassName = parent.props.cellClassName;\r\n    if (typeof cellClassName === \"string\") {\r\n      classes.push(cellClassName);\r\n    } else if (typeof cellClassName === \"function\") {\r\n      classes.push(cellClassName.call(null, {\r\n        rowIndex,\r\n        columnIndex,\r\n        row,\r\n        column\r\n      }));\r\n    }\r\n    return classes.join(\" \");\r\n  };\r\n  const getSpan = (row, column, rowIndex, columnIndex) => {\r\n    let rowspan = 1;\r\n    let colspan = 1;\r\n    const fn = parent.props.spanMethod;\r\n    if (typeof fn === \"function\") {\r\n      const result = fn({\r\n        row,\r\n        column,\r\n        rowIndex,\r\n        columnIndex\r\n      });\r\n      if (Array.isArray(result)) {\r\n        rowspan = result[0];\r\n        colspan = result[1];\r\n      } else if (typeof result === \"object\") {\r\n        rowspan = result.rowspan;\r\n        colspan = result.colspan;\r\n      }\r\n    }\r\n    return { rowspan, colspan };\r\n  };\r\n  const getColspanRealWidth = (columns, colspan, index) => {\r\n    if (colspan < 1) {\r\n      return columns[index].realWidth;\r\n    }\r\n    const widthArr = columns.map(({ realWidth, width }) => realWidth || width).slice(index, index + colspan);\r\n    return Number(widthArr.reduce((acc, width) => Number(acc) + Number(width), -1));\r\n  };\r\n  return {\r\n    getRowStyle,\r\n    getRowClass,\r\n    getCellStyle,\r\n    getCellClass,\r\n    getSpan,\r\n    getColspanRealWidth,\r\n    isColumnHidden\r\n  };\r\n}\r\n\r\nvar __defProp$4 = Object.defineProperty;\r\nvar __defProps$1 = Object.defineProperties;\r\nvar __getOwnPropDescs$1 = Object.getOwnPropertyDescriptors;\r\nvar __getOwnPropSymbols$4 = Object.getOwnPropertySymbols;\r\nvar __hasOwnProp$4 = Object.prototype.hasOwnProperty;\r\nvar __propIsEnum$4 = Object.prototype.propertyIsEnumerable;\r\nvar __defNormalProp$4 = (obj, key, value) => key in obj ? __defProp$4(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\r\nvar __spreadValues$4 = (a, b) => {\r\n  for (var prop in b || (b = {}))\r\n    if (__hasOwnProp$4.call(b, prop))\r\n      __defNormalProp$4(a, prop, b[prop]);\r\n  if (__getOwnPropSymbols$4)\r\n    for (var prop of __getOwnPropSymbols$4(b)) {\r\n      if (__propIsEnum$4.call(b, prop))\r\n        __defNormalProp$4(a, prop, b[prop]);\r\n    }\r\n  return a;\r\n};\r\nvar __spreadProps$1 = (a, b) => __defProps$1(a, __getOwnPropDescs$1(b));\r\nfunction useRender(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const parent = instance.parent;\r\n  const {\r\n    handleDoubleClick,\r\n    handleClick,\r\n    handleContextMenu,\r\n    handleMouseEnter,\r\n    handleMouseLeave,\r\n    handleCellMouseEnter,\r\n    handleCellMouseLeave,\r\n    tooltipContent,\r\n    tooltipTrigger\r\n  } = useEvents(props);\r\n  const {\r\n    getRowStyle,\r\n    getRowClass,\r\n    getCellStyle,\r\n    getCellClass,\r\n    getSpan,\r\n    getColspanRealWidth\r\n  } = useStyles(props);\r\n  const firstDefaultColumnIndex = vue.computed(() => {\r\n    return util.arrayFindIndex(props.store.states.columns.value, ({ type }) => type === \"default\");\r\n  });\r\n  const getKeyOfRow = (row, index) => {\r\n    const rowKey = parent.props.rowKey;\r\n    if (rowKey) {\r\n      return getRowIdentity(row, rowKey);\r\n    }\r\n    return index;\r\n  };\r\n  const rowRender = (row, $index, treeRowData) => {\r\n    const { tooltipEffect, store } = props;\r\n    const { indent, columns } = store.states;\r\n    const rowClasses = getRowClass(row, $index);\r\n    let display = true;\r\n    if (treeRowData) {\r\n      rowClasses.push(\"el-table__row--level-\" + treeRowData.level);\r\n      display = treeRowData.display;\r\n    }\r\n    const displayStyle = display ? null : {\r\n      display: \"none\"\r\n    };\r\n    return vue.h(\"tr\", {\r\n      style: [displayStyle, getRowStyle(row, $index)],\r\n      class: rowClasses,\r\n      key: getKeyOfRow(row, $index),\r\n      onDblclick: ($event) => handleDoubleClick($event, row),\r\n      onClick: ($event) => handleClick($event, row),\r\n      onContextmenu: ($event) => handleContextMenu($event, row),\r\n      onMouseenter: () => handleMouseEnter($index),\r\n      onMouseleave: handleMouseLeave\r\n    }, columns.value.map((column, cellIndex) => {\r\n      const { rowspan, colspan } = getSpan(row, column, $index, cellIndex);\r\n      if (!rowspan || !colspan) {\r\n        return null;\r\n      }\r\n      const columnData = __spreadValues$4({}, column);\r\n      columnData.realWidth = getColspanRealWidth(columns.value, colspan, cellIndex);\r\n      const data = {\r\n        store: props.store,\r\n        _self: props.context || parent,\r\n        column: columnData,\r\n        row,\r\n        $index\r\n      };\r\n      if (cellIndex === firstDefaultColumnIndex.value && treeRowData) {\r\n        data.treeNode = {\r\n          indent: treeRowData.level * indent.value,\r\n          level: treeRowData.level\r\n        };\r\n        if (typeof treeRowData.expanded === \"boolean\") {\r\n          data.treeNode.expanded = treeRowData.expanded;\r\n          if (\"loading\" in treeRowData) {\r\n            data.treeNode.loading = treeRowData.loading;\r\n          }\r\n          if (\"noLazyChildren\" in treeRowData) {\r\n            data.treeNode.noLazyChildren = treeRowData.noLazyChildren;\r\n          }\r\n        }\r\n      }\r\n      const baseKey = `${$index},${cellIndex}`;\r\n      const patchKey = columnData.columnKey || columnData.rawColumnKey || \"\";\r\n      return vue.h(\"td\", {\r\n        style: getCellStyle($index, cellIndex, row, column),\r\n        class: getCellClass($index, cellIndex, row, column),\r\n        key: `${patchKey}${baseKey}`,\r\n        rowspan,\r\n        colspan,\r\n        onMouseenter: ($event) => handleCellMouseEnter($event, __spreadProps$1(__spreadValues$4({}, row), { tooltipEffect })),\r\n        onMouseleave: handleCellMouseLeave\r\n      }, [column.renderCell(data)]);\r\n    }));\r\n  };\r\n  const wrappedRowRender = (row, $index) => {\r\n    const store = props.store;\r\n    const { isRowExpanded, assertRowKey } = store;\r\n    const {\r\n      treeData,\r\n      lazyTreeNodeMap,\r\n      childrenColumnName,\r\n      rowKey\r\n    } = store.states;\r\n    const hasExpandColumn = store.states.columns.value.some(({ type }) => type === \"expand\");\r\n    if (hasExpandColumn && isRowExpanded(row)) {\r\n      const renderExpanded = parent.renderExpanded;\r\n      const tr = rowRender(row, $index, void 0);\r\n      if (!renderExpanded) {\r\n        console.error(\"[Element Error]renderExpanded is required.\");\r\n        return tr;\r\n      }\r\n      return [[\r\n        tr,\r\n        vue.h(\"tr\", {\r\n          key: \"expanded-row__\" + tr.key\r\n        }, [\r\n          vue.h(\"td\", {\r\n            colspan: store.states.columns.value.length,\r\n            class: \"el-table__expanded-cell\"\r\n          }, [renderExpanded({ row, $index, store })])\r\n        ])\r\n      ]];\r\n    } else if (Object.keys(treeData.value).length) {\r\n      assertRowKey();\r\n      const key = getRowIdentity(row, rowKey.value);\r\n      let cur = treeData.value[key];\r\n      let treeRowData = null;\r\n      if (cur) {\r\n        treeRowData = {\r\n          expanded: cur.expanded,\r\n          level: cur.level,\r\n          display: true\r\n        };\r\n        if (typeof cur.lazy === \"boolean\") {\r\n          if (typeof cur.loaded === \"boolean\" && cur.loaded) {\r\n            treeRowData.noLazyChildren = !(cur.children && cur.children.length);\r\n          }\r\n          treeRowData.loading = cur.loading;\r\n        }\r\n      }\r\n      const tmp = [rowRender(row, $index, treeRowData)];\r\n      if (cur) {\r\n        let i = 0;\r\n        const traverse = (children, parent2) => {\r\n          if (!(children && children.length && parent2))\r\n            return;\r\n          children.forEach((node) => {\r\n            const innerTreeRowData = {\r\n              display: parent2.display && parent2.expanded,\r\n              level: parent2.level + 1,\r\n              expanded: false,\r\n              noLazyChildren: false,\r\n              loading: false\r\n            };\r\n            const childKey = getRowIdentity(node, rowKey.value);\r\n            if (childKey === void 0 || childKey === null) {\r\n              throw new Error(\"for nested data item, row-key is required.\");\r\n            }\r\n            cur = __spreadValues$4({}, treeData.value[childKey]);\r\n            if (cur) {\r\n              innerTreeRowData.expanded = cur.expanded;\r\n              cur.level = cur.level || innerTreeRowData.level;\r\n              cur.display = !!(cur.expanded && innerTreeRowData.display);\r\n              if (typeof cur.lazy === \"boolean\") {\r\n                if (typeof cur.loaded === \"boolean\" && cur.loaded) {\r\n                  innerTreeRowData.noLazyChildren = !(cur.children && cur.children.length);\r\n                }\r\n                innerTreeRowData.loading = cur.loading;\r\n              }\r\n            }\r\n            i++;\r\n            tmp.push(rowRender(node, $index + i, innerTreeRowData));\r\n            if (cur) {\r\n              const nodes2 = lazyTreeNodeMap.value[childKey] || node[childrenColumnName.value];\r\n              traverse(nodes2, cur);\r\n            }\r\n          });\r\n        };\r\n        cur.display = true;\r\n        const nodes = lazyTreeNodeMap.value[key] || row[childrenColumnName.value];\r\n        traverse(nodes, cur);\r\n      }\r\n      return tmp;\r\n    } else {\r\n      return rowRender(row, $index, void 0);\r\n    }\r\n  };\r\n  return {\r\n    wrappedRowRender,\r\n    tooltipContent,\r\n    tooltipTrigger\r\n  };\r\n}\r\n\r\nconst defaultProps = {\r\n  store: {\r\n    required: true,\r\n    type: Object\r\n  },\r\n  stripe: Boolean,\r\n  tooltipEffect: String,\r\n  context: {\r\n    default: () => ({}),\r\n    type: Object\r\n  },\r\n  rowClassName: [String, Function],\r\n  rowStyle: [Object, Function],\r\n  fixed: {\r\n    type: String,\r\n    default: \"\"\r\n  },\r\n  highlight: Boolean\r\n};\r\n\r\nvar TableBody = vue.defineComponent({\r\n  name: \"ElTableBody\",\r\n  props: defaultProps,\r\n  setup(props) {\r\n    const instance = vue.getCurrentInstance();\r\n    const parent = instance.parent;\r\n    const { wrappedRowRender, tooltipContent, tooltipTrigger } = useRender(props);\r\n    const { onColumnsChange, onScrollableChange } = useLayoutObserver(parent);\r\n    vue.watch(props.store.states.hoverRow, (newVal, oldVal) => {\r\n      if (!props.store.states.isComplex.value || isServer__default['default'])\r\n        return;\r\n      let raf = window.requestAnimationFrame;\r\n      if (!raf) {\r\n        raf = (fn) => window.setTimeout(fn, 16);\r\n      }\r\n      raf(() => {\r\n        const rows = instance.vnode.el.querySelectorAll(\".el-table__row\");\r\n        const oldRow = rows[oldVal];\r\n        const newRow = rows[newVal];\r\n        if (oldRow) {\r\n          dom.removeClass(oldRow, \"hover-row\");\r\n        }\r\n        if (newRow) {\r\n          dom.addClass(newRow, \"hover-row\");\r\n        }\r\n      });\r\n    });\r\n    vue.onUnmounted(() => {\r\n      var _a;\r\n      (_a = removePopper) == null ? void 0 : _a();\r\n    });\r\n    vue.onUpdated(() => {\r\n      var _a;\r\n      (_a = removePopper) == null ? void 0 : _a();\r\n    });\r\n    return {\r\n      onColumnsChange,\r\n      onScrollableChange,\r\n      wrappedRowRender,\r\n      tooltipContent,\r\n      tooltipTrigger\r\n    };\r\n  },\r\n  render() {\r\n    const data = this.store.states.data.value || [];\r\n    return vue.h(\"table\", {\r\n      class: \"el-table__body\",\r\n      cellspacing: \"0\",\r\n      cellpadding: \"0\",\r\n      border: \"0\"\r\n    }, [\r\n      hColgroup(this.store.states.columns.value),\r\n      vue.h(\"tbody\", {}, [\r\n        data.reduce((acc, row) => {\r\n          return acc.concat(this.wrappedRowRender(row, acc.length));\r\n        }, [])\r\n      ])\r\n    ]);\r\n  }\r\n});\r\n\r\nfunction useMapState() {\r\n  const instance = vue.getCurrentInstance();\r\n  const table = instance.parent;\r\n  const store = table.store;\r\n  const leftFixedLeafCount = vue.computed(() => {\r\n    return store.states.fixedLeafColumnsLength.value;\r\n  });\r\n  const rightFixedLeafCount = vue.computed(() => {\r\n    return store.states.rightFixedColumns.value.length;\r\n  });\r\n  const columnsCount = vue.computed(() => {\r\n    return store.states.columns.value.length;\r\n  });\r\n  const leftFixedCount = vue.computed(() => {\r\n    return store.states.fixedColumns.value.length;\r\n  });\r\n  const rightFixedCount = vue.computed(() => {\r\n    return store.states.rightFixedColumns.value.length;\r\n  });\r\n  return {\r\n    leftFixedLeafCount,\r\n    rightFixedLeafCount,\r\n    columnsCount,\r\n    leftFixedCount,\r\n    rightFixedCount,\r\n    columns: store.states.columns\r\n  };\r\n}\r\n\r\nfunction useStyle$1(props) {\r\n  const instance = vue.getCurrentInstance();\r\n  const table = instance.parent;\r\n  const store = table.store;\r\n  const {\r\n    leftFixedLeafCount,\r\n    rightFixedLeafCount,\r\n    columnsCount,\r\n    leftFixedCount,\r\n    rightFixedCount,\r\n    columns\r\n  } = useMapState();\r\n  const hasGutter = vue.computed(() => {\r\n    return !props.fixed && table.layout.gutterWidth;\r\n  });\r\n  const isCellHidden = (index, columns2, column) => {\r\n    if (props.fixed || props.fixed === \"left\") {\r\n      return index >= leftFixedLeafCount.value;\r\n    } else if (props.fixed === \"right\") {\r\n      let before = 0;\r\n      for (let i = 0; i < index; i++) {\r\n        before += columns2[i].colSpan;\r\n      }\r\n      return before < columnsCount.value - rightFixedLeafCount.value;\r\n    } else if (!props.fixed && column.fixed) {\r\n      return true;\r\n    } else {\r\n      return index < leftFixedCount.value || index >= columnsCount.value - rightFixedCount.value;\r\n    }\r\n  };\r\n  const getRowClasses = (column, cellIndex) => {\r\n    const classes = [column.id, column.align, column.labelClassName];\r\n    if (column.className) {\r\n      classes.push(column.className);\r\n    }\r\n    if (isCellHidden(cellIndex, store.states.columns.value, column)) {\r\n      classes.push(\"is-hidden\");\r\n    }\r\n    if (!column.children) {\r\n      classes.push(\"is-leaf\");\r\n    }\r\n    return classes;\r\n  };\r\n  return {\r\n    hasGutter,\r\n    getRowClasses,\r\n    columns\r\n  };\r\n}\r\n\r\nvar TableFooter = vue.defineComponent({\r\n  name: \"ElTableFooter\",\r\n  props: {\r\n    fixed: {\r\n      type: String,\r\n      default: \"\"\r\n    },\r\n    store: {\r\n      required: true,\r\n      type: Object\r\n    },\r\n    summaryMethod: Function,\r\n    sumText: String,\r\n    border: Boolean,\r\n    defaultSort: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          prop: \"\",\r\n          order: \"\"\r\n        };\r\n      }\r\n    }\r\n  },\r\n  setup(props) {\r\n    const { hasGutter, getRowClasses, columns } = useStyle$1(props);\r\n    return {\r\n      getRowClasses,\r\n      hasGutter,\r\n      columns\r\n    };\r\n  },\r\n  render() {\r\n    let sums = [];\r\n    if (this.summaryMethod) {\r\n      sums = this.summaryMethod({\r\n        columns: this.columns,\r\n        data: this.store.states.data.value\r\n      });\r\n    } else {\r\n      this.columns.forEach((column, index) => {\r\n        if (index === 0) {\r\n          sums[index] = this.sumText;\r\n          return;\r\n        }\r\n        const values = this.store.states.data.value.map((item) => Number(item[column.property]));\r\n        const precisions = [];\r\n        let notNumber = true;\r\n        values.forEach((value) => {\r\n          if (!isNaN(value)) {\r\n            notNumber = false;\r\n            const decimal = (\"\" + value).split(\".\")[1];\r\n            precisions.push(decimal ? decimal.length : 0);\r\n          }\r\n        });\r\n        const precision = Math.max.apply(null, precisions);\r\n        if (!notNumber) {\r\n          sums[index] = values.reduce((prev, curr) => {\r\n            const value = Number(curr);\r\n            if (!isNaN(value)) {\r\n              return parseFloat((prev + curr).toFixed(Math.min(precision, 20)));\r\n            } else {\r\n              return prev;\r\n            }\r\n          }, 0);\r\n        } else {\r\n          sums[index] = \"\";\r\n        }\r\n      });\r\n    }\r\n    return vue.h(\"table\", {\r\n      class: \"el-table__footer\",\r\n      cellspacing: \"0\",\r\n      cellpadding: \"0\",\r\n      border: \"0\"\r\n    }, [\r\n      hColgroup(this.columns, this.hasGutter),\r\n      vue.h(\"tbody\", {\r\n        class: [{ \"has-gutter\": this.hasGutter }]\r\n      }, [\r\n        vue.h(\"tr\", {}, [\r\n          ...this.columns.map((column, cellIndex) => vue.h(\"td\", {\r\n            key: cellIndex,\r\n            colspan: column.colSpan,\r\n            rowspan: column.rowSpan,\r\n            class: this.getRowClasses(column, cellIndex)\r\n          }, [\r\n            vue.h(\"div\", {\r\n              class: [\"cell\", column.labelClassName]\r\n            }, [sums[cellIndex]])\r\n          ])),\r\n          this.hasGutter && hGutter()\r\n        ])\r\n      ])\r\n    ]);\r\n  }\r\n});\r\n\r\nfunction useUtils$1(store) {\r\n  const setCurrentRow = (row) => {\r\n    store.commit(\"setCurrentRow\", row);\r\n  };\r\n  const toggleRowSelection = (row, selected) => {\r\n    store.toggleRowSelection(row, selected, false);\r\n    store.updateAllSelected();\r\n  };\r\n  const clearSelection = () => {\r\n    store.clearSelection();\r\n  };\r\n  const clearFilter = (columnKeys) => {\r\n    store.clearFilter(columnKeys);\r\n  };\r\n  const toggleAllSelection = () => {\r\n    store.commit(\"toggleAllSelection\");\r\n  };\r\n  const toggleRowExpansion = (row, expanded) => {\r\n    store.toggleRowExpansionAdapter(row, expanded);\r\n  };\r\n  const clearSort = () => {\r\n    store.clearSort();\r\n  };\r\n  const sort = (prop, order) => {\r\n    store.commit(\"sort\", { prop, order });\r\n  };\r\n  return {\r\n    setCurrentRow,\r\n    toggleRowSelection,\r\n    clearSelection,\r\n    clearFilter,\r\n    toggleAllSelection,\r\n    toggleRowExpansion,\r\n    clearSort,\r\n    sort\r\n  };\r\n}\r\n\r\nfunction useStyle$2(props, layout, store, table) {\r\n  const $ELEMENT = util.useGlobalConfig();\r\n  const isHidden = vue.ref(false);\r\n  const renderExpanded = vue.ref(null);\r\n  const resizeProxyVisible = vue.ref(false);\r\n  const setDragVisible = (visible) => {\r\n    resizeProxyVisible.value = visible;\r\n  };\r\n  const resizeState = vue.ref({\r\n    width: null,\r\n    height: null\r\n  });\r\n  const isGroup = vue.ref(false);\r\n  vue.watchEffect(() => {\r\n    layout.setHeight(props.height);\r\n  });\r\n  vue.watchEffect(() => {\r\n    layout.setMaxHeight(props.maxHeight);\r\n  });\r\n  vue.watch(() => [props.currentRowKey, store.states.rowKey], ([currentRowKey, rowKey]) => {\r\n    if (!vue.unref(rowKey))\r\n      return;\r\n    store.setCurrentRowKey(currentRowKey + \"\");\r\n  }, {\r\n    immediate: true\r\n  });\r\n  vue.watch(() => props.data, (data) => {\r\n    table.store.commit(\"setData\", data);\r\n  }, {\r\n    immediate: true,\r\n    deep: true\r\n  });\r\n  vue.watchEffect(() => {\r\n    if (props.expandRowKeys) {\r\n      store.setExpandRowKeysAdapter(props.expandRowKeys);\r\n    }\r\n  });\r\n  const handleMouseLeave = () => {\r\n    table.store.commit(\"setHoverRow\", null);\r\n    if (table.hoverState)\r\n      table.hoverState = null;\r\n  };\r\n  const handleHeaderFooterMousewheel = (event, data) => {\r\n    const { pixelX, pixelY } = data;\r\n    if (Math.abs(pixelX) >= Math.abs(pixelY)) {\r\n      table.refs.bodyWrapper.scrollLeft += data.pixelX / 5;\r\n    }\r\n  };\r\n  const shouldUpdateHeight = vue.computed(() => {\r\n    return props.height || props.maxHeight || store.states.fixedColumns.value.length > 0 || store.states.rightFixedColumns.value.length > 0;\r\n  });\r\n  const doLayout = () => {\r\n    if (shouldUpdateHeight.value) {\r\n      layout.updateElsHeight();\r\n    }\r\n    layout.updateColumnsWidth();\r\n    syncPostion();\r\n  };\r\n  vue.onMounted(() => {\r\n    setScrollClass(\"is-scrolling-left\");\r\n    bindEvents();\r\n    store.updateColumns();\r\n    doLayout();\r\n    resizeState.value = {\r\n      width: table.vnode.el.offsetWidth,\r\n      height: table.vnode.el.offsetHeight\r\n    };\r\n    store.states.columns.value.forEach((column) => {\r\n      if (column.filteredValue && column.filteredValue.length) {\r\n        table.store.commit(\"filterChange\", {\r\n          column,\r\n          values: column.filteredValue,\r\n          silent: true\r\n        });\r\n      }\r\n    });\r\n    table.$ready = true;\r\n  });\r\n  const setScrollClassByEl = (el, className) => {\r\n    if (!el)\r\n      return;\r\n    const classList = Array.from(el.classList).filter((item) => !item.startsWith(\"is-scrolling-\"));\r\n    classList.push(layout.scrollX.value ? className : \"is-scrolling-none\");\r\n    el.className = classList.join(\" \");\r\n  };\r\n  const setScrollClass = (className) => {\r\n    const { bodyWrapper } = table.refs;\r\n    setScrollClassByEl(bodyWrapper, className);\r\n  };\r\n  const syncPostion = throttle__default['default'](function() {\r\n    if (!table.refs.bodyWrapper)\r\n      return;\r\n    const {\r\n      scrollLeft,\r\n      scrollTop,\r\n      offsetWidth,\r\n      scrollWidth\r\n    } = table.refs.bodyWrapper;\r\n    const {\r\n      headerWrapper,\r\n      footerWrapper,\r\n      fixedBodyWrapper,\r\n      rightFixedBodyWrapper\r\n    } = table.refs;\r\n    if (headerWrapper)\r\n      headerWrapper.scrollLeft = scrollLeft;\r\n    if (footerWrapper)\r\n      footerWrapper.scrollLeft = scrollLeft;\r\n    if (fixedBodyWrapper)\r\n      fixedBodyWrapper.scrollTop = scrollTop;\r\n    if (rightFixedBodyWrapper)\r\n      rightFixedBodyWrapper.scrollTop = scrollTop;\r\n    const maxScrollLeftPosition = scrollWidth - offsetWidth - 1;\r\n    if (scrollLeft >= maxScrollLeftPosition) {\r\n      setScrollClass(\"is-scrolling-right\");\r\n    } else if (scrollLeft === 0) {\r\n      setScrollClass(\"is-scrolling-left\");\r\n    } else {\r\n      setScrollClass(\"is-scrolling-middle\");\r\n    }\r\n  }, 10);\r\n  const bindEvents = () => {\r\n    window.addEventListener(\"resize\", doLayout);\r\n    table.refs.bodyWrapper.addEventListener(\"scroll\", syncPostion, {\r\n      passive: true\r\n    });\r\n    if (props.fit) {\r\n      resizeEvent.addResizeListener(table.vnode.el, resizeListener);\r\n    }\r\n  };\r\n  vue.onUnmounted(() => {\r\n    unbindEvents();\r\n  });\r\n  const unbindEvents = () => {\r\n    var _a;\r\n    (_a = table.refs.bodyWrapper) == null ? void 0 : _a.removeEventListener(\"scroll\", syncPostion, true);\r\n    window.removeEventListener(\"resize\", doLayout);\r\n    if (props.fit) {\r\n      resizeEvent.removeResizeListener(table.vnode.el, resizeListener);\r\n    }\r\n  };\r\n  const resizeListener = () => {\r\n    if (!table.$ready)\r\n      return;\r\n    let shouldUpdateLayout = false;\r\n    const el = table.vnode.el;\r\n    const { width: oldWidth, height: oldHeight } = resizeState.value;\r\n    const width = el.offsetWidth;\r\n    if (oldWidth !== width) {\r\n      shouldUpdateLayout = true;\r\n    }\r\n    const height = el.offsetHeight;\r\n    if ((props.height || shouldUpdateHeight.value) && oldHeight !== height) {\r\n      shouldUpdateLayout = true;\r\n    }\r\n    if (shouldUpdateLayout) {\r\n      resizeState.value = {\r\n        width,\r\n        height\r\n      };\r\n      doLayout();\r\n    }\r\n  };\r\n  const tableSize = vue.computed(() => {\r\n    return props.size || $ELEMENT.size;\r\n  });\r\n  const bodyWidth = vue.computed(() => {\r\n    const { bodyWidth: bodyWidth_, scrollY, gutterWidth } = layout;\r\n    return bodyWidth_.value ? bodyWidth_.value - (scrollY.value ? gutterWidth : 0) + \"px\" : \"\";\r\n  });\r\n  const bodyHeight = vue.computed(() => {\r\n    const headerHeight = layout.headerHeight.value || 0;\r\n    const bodyHeight2 = layout.bodyHeight.value;\r\n    const footerHeight = layout.footerHeight.value || 0;\r\n    if (props.height) {\r\n      return {\r\n        height: bodyHeight2 ? bodyHeight2 + \"px\" : \"\"\r\n      };\r\n    } else if (props.maxHeight) {\r\n      const maxHeight = parseHeight(props.maxHeight);\r\n      if (typeof maxHeight === \"number\") {\r\n        return {\r\n          \"max-height\": maxHeight - footerHeight - (props.showHeader ? headerHeight : 0) + \"px\"\r\n        };\r\n      }\r\n    }\r\n    return {};\r\n  });\r\n  const emptyBlockStyle = vue.computed(() => {\r\n    if (props.data && props.data.length)\r\n      return null;\r\n    let height = \"100%\";\r\n    if (layout.appendHeight.value) {\r\n      height = `calc(100% - ${layout.appendHeight.value}px)`;\r\n    }\r\n    return {\r\n      width: bodyWidth.value,\r\n      height\r\n    };\r\n  });\r\n  const handleFixedMousewheel = (event, data) => {\r\n    const bodyWrapper = table.refs.bodyWrapper;\r\n    if (Math.abs(data.spinY) > 0) {\r\n      const currentScrollTop = bodyWrapper.scrollTop;\r\n      if (data.pixelY < 0 && currentScrollTop !== 0) {\r\n        event.preventDefault();\r\n      }\r\n      if (data.pixelY > 0 && bodyWrapper.scrollHeight - bodyWrapper.clientHeight > currentScrollTop) {\r\n        event.preventDefault();\r\n      }\r\n      bodyWrapper.scrollTop += Math.ceil(data.pixelY / 5);\r\n    } else {\r\n      bodyWrapper.scrollLeft += Math.ceil(data.pixelX / 5);\r\n    }\r\n  };\r\n  const fixedHeight = vue.computed(() => {\r\n    if (props.maxHeight) {\r\n      if (props.showSummary) {\r\n        return {\r\n          bottom: 0\r\n        };\r\n      }\r\n      return {\r\n        bottom: layout.scrollX.value && props.data.length ? layout.gutterWidth + \"px\" : \"\"\r\n      };\r\n    } else {\r\n      if (props.showSummary) {\r\n        return {\r\n          height: layout.tableHeight.value ? layout.tableHeight.value + \"px\" : \"\"\r\n        };\r\n      }\r\n      return {\r\n        height: layout.viewportHeight.value ? layout.viewportHeight.value + \"px\" : \"\"\r\n      };\r\n    }\r\n  });\r\n  const fixedBodyHeight = vue.computed(() => {\r\n    if (props.height) {\r\n      return {\r\n        height: layout.fixedBodyHeight.value ? layout.fixedBodyHeight.value + \"px\" : \"\"\r\n      };\r\n    } else if (props.maxHeight) {\r\n      let maxHeight = parseHeight(props.maxHeight);\r\n      if (typeof maxHeight === \"number\") {\r\n        maxHeight = layout.scrollX.value ? maxHeight - layout.gutterWidth : maxHeight;\r\n        if (props.showHeader) {\r\n          maxHeight -= layout.headerHeight.value;\r\n        }\r\n        maxHeight -= layout.footerHeight.value;\r\n        return {\r\n          \"max-height\": maxHeight + \"px\"\r\n        };\r\n      }\r\n    }\r\n    return {};\r\n  });\r\n  return {\r\n    isHidden,\r\n    renderExpanded,\r\n    setDragVisible,\r\n    isGroup,\r\n    handleMouseLeave,\r\n    handleHeaderFooterMousewheel,\r\n    tableSize,\r\n    bodyHeight,\r\n    emptyBlockStyle,\r\n    handleFixedMousewheel,\r\n    fixedHeight,\r\n    fixedBodyHeight,\r\n    resizeProxyVisible,\r\n    bodyWidth,\r\n    resizeState,\r\n    doLayout\r\n  };\r\n}\r\n\r\nvar defaultProps$1 = {\r\n  data: {\r\n    type: Array,\r\n    default: () => {\r\n      return [];\r\n    }\r\n  },\r\n  size: String,\r\n  width: [String, Number],\r\n  height: [String, Number],\r\n  maxHeight: [String, Number],\r\n  fit: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  stripe: Boolean,\r\n  border: Boolean,\r\n  rowKey: [String, Function],\r\n  showHeader: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  showSummary: Boolean,\r\n  sumText: String,\r\n  summaryMethod: Function,\r\n  rowClassName: [String, Function],\r\n  rowStyle: [Object, Function],\r\n  cellClassName: [String, Function],\r\n  cellStyle: [Object, Function],\r\n  headerRowClassName: [String, Function],\r\n  headerRowStyle: [Object, Function],\r\n  headerCellClassName: [String, Function],\r\n  headerCellStyle: [Object, Function],\r\n  highlightCurrentRow: Boolean,\r\n  currentRowKey: [String, Number],\r\n  emptyText: String,\r\n  expandRowKeys: Array,\r\n  defaultExpandAll: Boolean,\r\n  defaultSort: Object,\r\n  tooltipEffect: String,\r\n  spanMethod: Function,\r\n  selectOnIndeterminate: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  indent: {\r\n    type: Number,\r\n    default: 16\r\n  },\r\n  treeProps: {\r\n    type: Object,\r\n    default: () => {\r\n      return {\r\n        hasChildren: \"hasChildren\",\r\n        children: \"children\"\r\n      };\r\n    }\r\n  },\r\n  lazy: Boolean,\r\n  load: Function,\r\n  style: {\r\n    type: Object,\r\n    default: () => ({})\r\n  },\r\n  className: {\r\n    type: String,\r\n    default: \"\"\r\n  }\r\n};\r\n\r\nlet tableIdSeed = 1;\r\nvar script$1 = vue.defineComponent({\r\n  name: \"ElTable\",\r\n  directives: {\r\n    Mousewheel: directives.Mousewheel\r\n  },\r\n  components: {\r\n    TableHeader,\r\n    TableBody,\r\n    TableFooter\r\n  },\r\n  props: defaultProps$1,\r\n  emits: [\r\n    \"select\",\r\n    \"select-all\",\r\n    \"selection-change\",\r\n    \"cell-mouse-enter\",\r\n    \"cell-mouse-leave\",\r\n    \"cell-contextmenu\",\r\n    \"cell-click\",\r\n    \"cell-dblclick\",\r\n    \"row-click\",\r\n    \"row-contextmenu\",\r\n    \"row-dblclick\",\r\n    \"header-click\",\r\n    \"header-contextmenu\",\r\n    \"sort-change\",\r\n    \"filter-change\",\r\n    \"current-change\",\r\n    \"header-dragend\",\r\n    \"expand-change\"\r\n  ],\r\n  setup(props) {\r\n    let table = vue.getCurrentInstance();\r\n    const store = createStore(table, props);\r\n    table.store = store;\r\n    const layout = new TableLayout({\r\n      store: table.store,\r\n      table,\r\n      fit: props.fit,\r\n      showHeader: props.showHeader\r\n    });\r\n    table.layout = layout;\r\n    const isEmpty = vue.computed(() => (store.states.data.value || []).length === 0);\r\n    const {\r\n      setCurrentRow,\r\n      toggleRowSelection,\r\n      clearSelection,\r\n      clearFilter,\r\n      toggleAllSelection,\r\n      toggleRowExpansion,\r\n      clearSort,\r\n      sort\r\n    } = useUtils$1(store);\r\n    const {\r\n      isHidden,\r\n      renderExpanded,\r\n      setDragVisible,\r\n      isGroup,\r\n      handleMouseLeave,\r\n      handleHeaderFooterMousewheel,\r\n      tableSize,\r\n      bodyHeight,\r\n      emptyBlockStyle,\r\n      handleFixedMousewheel,\r\n      fixedHeight,\r\n      fixedBodyHeight,\r\n      resizeProxyVisible,\r\n      bodyWidth,\r\n      resizeState,\r\n      doLayout\r\n    } = useStyle$2(props, layout, store, table);\r\n    const debouncedUpdateLayout = debounce__default['default'](doLayout, 50);\r\n    const tableId = \"el-table_\" + tableIdSeed++;\r\n    table.tableId = tableId;\r\n    table.state = {\r\n      isGroup,\r\n      resizeState,\r\n      doLayout,\r\n      debouncedUpdateLayout\r\n    };\r\n    return {\r\n      layout,\r\n      store,\r\n      handleHeaderFooterMousewheel,\r\n      handleMouseLeave,\r\n      tableId,\r\n      tableSize,\r\n      isHidden,\r\n      isEmpty,\r\n      renderExpanded,\r\n      resizeProxyVisible,\r\n      resizeState,\r\n      isGroup,\r\n      bodyWidth,\r\n      bodyHeight,\r\n      emptyBlockStyle,\r\n      debouncedUpdateLayout,\r\n      handleFixedMousewheel,\r\n      fixedHeight,\r\n      fixedBodyHeight,\r\n      setCurrentRow,\r\n      toggleRowSelection,\r\n      clearSelection,\r\n      clearFilter,\r\n      toggleAllSelection,\r\n      toggleRowExpansion,\r\n      clearSort,\r\n      doLayout,\r\n      sort,\r\n      t: locale.t,\r\n      setDragVisible,\r\n      context: table\r\n    };\r\n  }\r\n});\r\n\r\nconst _hoisted_1$1 = {\r\n  ref: \"hiddenColumns\",\r\n  class: \"hidden-columns\"\r\n};\r\nconst _hoisted_2$1 = {\r\n  key: 0,\r\n  ref: \"headerWrapper\",\r\n  class: \"el-table__header-wrapper\"\r\n};\r\nconst _hoisted_3$1 = { class: \"el-table__empty-text\" };\r\nconst _hoisted_4$1 = {\r\n  key: 1,\r\n  ref: \"appendWrapper\",\r\n  class: \"el-table__append-wrapper\"\r\n};\r\nconst _hoisted_5 = {\r\n  key: 1,\r\n  ref: \"footerWrapper\",\r\n  class: \"el-table__footer-wrapper\"\r\n};\r\nconst _hoisted_6 = {\r\n  key: 0,\r\n  ref: \"fixedHeaderWrapper\",\r\n  class: \"el-table__fixed-header-wrapper\"\r\n};\r\nconst _hoisted_7 = {\r\n  key: 1,\r\n  ref: \"fixedFooterWrapper\",\r\n  class: \"el-table__fixed-footer-wrapper\"\r\n};\r\nconst _hoisted_8 = {\r\n  key: 0,\r\n  ref: \"rightFixedHeaderWrapper\",\r\n  class: \"el-table__fixed-header-wrapper\"\r\n};\r\nconst _hoisted_9 = {\r\n  key: 1,\r\n  ref: \"rightFixedFooterWrapper\",\r\n  class: \"el-table__fixed-footer-wrapper\"\r\n};\r\nconst _hoisted_10 = {\r\n  ref: \"resizeProxy\",\r\n  class: \"el-table__column-resize-proxy\"\r\n};\r\nfunction render$1(_ctx, _cache, $props, $setup, $data, $options) {\r\n  const _component_table_header = vue.resolveComponent(\"table-header\");\r\n  const _component_table_body = vue.resolveComponent(\"table-body\");\r\n  const _component_table_footer = vue.resolveComponent(\"table-footer\");\r\n  const _directive_mousewheel = vue.resolveDirective(\"mousewheel\");\r\n  return vue.openBlock(), vue.createBlock(\"div\", {\r\n    class: [\r\n      {\r\n        \"el-table--fit\": _ctx.fit,\r\n        \"el-table--striped\": _ctx.stripe,\r\n        \"el-table--border\": _ctx.border || _ctx.isGroup,\r\n        \"el-table--hidden\": _ctx.isHidden,\r\n        \"el-table--group\": _ctx.isGroup,\r\n        \"el-table--fluid-height\": _ctx.maxHeight,\r\n        \"el-table--scrollable-x\": _ctx.layout.scrollX.value,\r\n        \"el-table--scrollable-y\": _ctx.layout.scrollY.value,\r\n        \"el-table--enable-row-hover\": !_ctx.store.states.isComplex.value,\r\n        \"el-table--enable-row-transition\": (_ctx.store.states.data.value || []).length !== 0 && (_ctx.store.states.data.value || []).length < 100\r\n      },\r\n      _ctx.tableSize ? `el-table--${_ctx.tableSize}` : \"\",\r\n      _ctx.className,\r\n      \"el-table\"\r\n    ],\r\n    style: _ctx.style,\r\n    onMouseleave: _cache[1] || (_cache[1] = ($event) => _ctx.handleMouseLeave())\r\n  }, [\r\n    vue.createVNode(\"div\", _hoisted_1$1, [\r\n      vue.renderSlot(_ctx.$slots, \"default\")\r\n    ], 512),\r\n    _ctx.showHeader ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", _hoisted_2$1, [\r\n      vue.createVNode(_component_table_header, {\r\n        ref: \"tableHeader\",\r\n        border: _ctx.border,\r\n        \"default-sort\": _ctx.defaultSort,\r\n        store: _ctx.store,\r\n        style: {\r\n          width: _ctx.layout.bodyWidth.value ? _ctx.layout.bodyWidth.value + \"px\" : \"\"\r\n        },\r\n        onSetDragVisible: _ctx.setDragVisible\r\n      }, null, 8, [\"border\", \"default-sort\", \"store\", \"style\", \"onSetDragVisible\"])\r\n    ], 512)), [\r\n      [_directive_mousewheel, _ctx.handleHeaderFooterMousewheel]\r\n    ]) : vue.createCommentVNode(\"v-if\", true),\r\n    vue.createVNode(\"div\", {\r\n      ref: \"bodyWrapper\",\r\n      style: [_ctx.bodyHeight],\r\n      class: \"el-table__body-wrapper\"\r\n    }, [\r\n      vue.createVNode(_component_table_body, {\r\n        context: _ctx.context,\r\n        highlight: _ctx.highlightCurrentRow,\r\n        \"row-class-name\": _ctx.rowClassName,\r\n        \"tooltip-effect\": _ctx.tooltipEffect,\r\n        \"row-style\": _ctx.rowStyle,\r\n        store: _ctx.store,\r\n        stripe: _ctx.stripe,\r\n        style: {\r\n          width: _ctx.bodyWidth\r\n        }\r\n      }, null, 8, [\"context\", \"highlight\", \"row-class-name\", \"tooltip-effect\", \"row-style\", \"store\", \"stripe\", \"style\"]),\r\n      _ctx.isEmpty ? (vue.openBlock(), vue.createBlock(\"div\", {\r\n        key: 0,\r\n        ref: \"emptyBlock\",\r\n        style: _ctx.emptyBlockStyle,\r\n        class: \"el-table__empty-block\"\r\n      }, [\r\n        vue.createVNode(\"span\", _hoisted_3$1, [\r\n          vue.renderSlot(_ctx.$slots, \"empty\", {}, () => [\r\n            vue.createTextVNode(vue.toDisplayString(_ctx.emptyText || _ctx.t(\"el.table.emptyText\")), 1)\r\n          ])\r\n        ])\r\n      ], 4)) : vue.createCommentVNode(\"v-if\", true),\r\n      _ctx.$slots.append ? (vue.openBlock(), vue.createBlock(\"div\", _hoisted_4$1, [\r\n        vue.renderSlot(_ctx.$slots, \"append\")\r\n      ], 512)) : vue.createCommentVNode(\"v-if\", true)\r\n    ], 4),\r\n    _ctx.showSummary ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", _hoisted_5, [\r\n      vue.createVNode(_component_table_footer, {\r\n        border: _ctx.border,\r\n        \"default-sort\": _ctx.defaultSort,\r\n        store: _ctx.store,\r\n        style: {\r\n          width: _ctx.layout.bodyWidth.value ? _ctx.layout.bodyWidth.value + \"px\" : \"\"\r\n        },\r\n        \"sum-text\": _ctx.sumText || _ctx.t(\"el.table.sumText\"),\r\n        \"summary-method\": _ctx.summaryMethod\r\n      }, null, 8, [\"border\", \"default-sort\", \"store\", \"style\", \"sum-text\", \"summary-method\"])\r\n    ], 512)), [\r\n      [vue.vShow, !_ctx.isEmpty],\r\n      [_directive_mousewheel, _ctx.handleHeaderFooterMousewheel]\r\n    ]) : vue.createCommentVNode(\"v-if\", true),\r\n    _ctx.store.states.fixedColumns.value.length > 0 ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", {\r\n      key: 2,\r\n      ref: \"fixedWrapper\",\r\n      style: [\r\n        {\r\n          width: _ctx.layout.fixedWidth.value ? _ctx.layout.fixedWidth.value + \"px\" : \"\"\r\n        },\r\n        _ctx.fixedHeight\r\n      ],\r\n      class: \"el-table__fixed\"\r\n    }, [\r\n      _ctx.showHeader ? (vue.openBlock(), vue.createBlock(\"div\", _hoisted_6, [\r\n        vue.createVNode(_component_table_header, {\r\n          ref: \"fixedTableHeader\",\r\n          border: _ctx.border,\r\n          store: _ctx.store,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          fixed: \"left\",\r\n          onSetDragVisible: _ctx.setDragVisible\r\n        }, null, 8, [\"border\", \"store\", \"style\", \"onSetDragVisible\"])\r\n      ], 512)) : vue.createCommentVNode(\"v-if\", true),\r\n      vue.createVNode(\"div\", {\r\n        ref: \"fixedBodyWrapper\",\r\n        style: [\r\n          {\r\n            top: _ctx.layout.headerHeight.value + \"px\"\r\n          },\r\n          _ctx.fixedBodyHeight\r\n        ],\r\n        class: \"el-table__fixed-body-wrapper\"\r\n      }, [\r\n        vue.createVNode(_component_table_body, {\r\n          highlight: _ctx.highlightCurrentRow,\r\n          \"row-class-name\": _ctx.rowClassName,\r\n          \"tooltip-effect\": _ctx.tooltipEffect,\r\n          \"row-style\": _ctx.rowStyle,\r\n          store: _ctx.store,\r\n          stripe: _ctx.stripe,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          fixed: \"left\"\r\n        }, null, 8, [\"highlight\", \"row-class-name\", \"tooltip-effect\", \"row-style\", \"store\", \"stripe\", \"style\"]),\r\n        _ctx.$slots.append ? (vue.openBlock(), vue.createBlock(\"div\", {\r\n          key: 0,\r\n          style: { height: _ctx.layout.appendHeight.value + \"px\" },\r\n          class: \"el-table__append-gutter\"\r\n        }, null, 4)) : vue.createCommentVNode(\"v-if\", true)\r\n      ], 4),\r\n      _ctx.showSummary ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", _hoisted_7, [\r\n        vue.createVNode(_component_table_footer, {\r\n          border: _ctx.border,\r\n          store: _ctx.store,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          \"sum-text\": _ctx.sumText || _ctx.t(\"el.table.sumText\"),\r\n          \"summary-method\": _ctx.summaryMethod,\r\n          fixed: \"left\"\r\n        }, null, 8, [\"border\", \"store\", \"style\", \"sum-text\", \"summary-method\"])\r\n      ], 512)), [\r\n        [vue.vShow, !_ctx.isEmpty]\r\n      ]) : vue.createCommentVNode(\"v-if\", true)\r\n    ], 4)), [\r\n      [_directive_mousewheel, _ctx.handleFixedMousewheel]\r\n    ]) : vue.createCommentVNode(\"v-if\", true),\r\n    _ctx.store.states.rightFixedColumns.value.length > 0 ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", {\r\n      key: 3,\r\n      ref: \"rightFixedWrapper\",\r\n      style: [\r\n        {\r\n          width: _ctx.layout.rightFixedWidth.value ? _ctx.layout.rightFixedWidth.value + \"px\" : \"\",\r\n          right: _ctx.layout.scrollY.value ? (_ctx.border ? _ctx.layout.gutterWidth : _ctx.layout.gutterWidth || 0) + \"px\" : \"\"\r\n        },\r\n        _ctx.fixedHeight\r\n      ],\r\n      class: \"el-table__fixed-right\"\r\n    }, [\r\n      _ctx.showHeader ? (vue.openBlock(), vue.createBlock(\"div\", _hoisted_8, [\r\n        vue.createVNode(_component_table_header, {\r\n          ref: \"rightFixedTableHeader\",\r\n          border: _ctx.border,\r\n          store: _ctx.store,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          fixed: \"right\",\r\n          onSetDragVisible: _ctx.setDragVisible\r\n        }, null, 8, [\"border\", \"store\", \"style\", \"onSetDragVisible\"])\r\n      ], 512)) : vue.createCommentVNode(\"v-if\", true),\r\n      vue.createVNode(\"div\", {\r\n        ref: \"rightFixedBodyWrapper\",\r\n        style: [{ top: _ctx.layout.headerHeight.value + \"px\" }, _ctx.fixedBodyHeight],\r\n        class: \"el-table__fixed-body-wrapper\"\r\n      }, [\r\n        vue.createVNode(_component_table_body, {\r\n          highlight: _ctx.highlightCurrentRow,\r\n          \"row-class-name\": _ctx.rowClassName,\r\n          \"tooltip-effect\": _ctx.tooltipEffect,\r\n          \"row-style\": _ctx.rowStyle,\r\n          store: _ctx.store,\r\n          stripe: _ctx.stripe,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          fixed: \"right\"\r\n        }, null, 8, [\"highlight\", \"row-class-name\", \"tooltip-effect\", \"row-style\", \"store\", \"stripe\", \"style\"]),\r\n        _ctx.$slots.append ? (vue.openBlock(), vue.createBlock(\"div\", {\r\n          key: 0,\r\n          style: { height: _ctx.layout.appendHeight.value + \"px\" },\r\n          class: \"el-table__append-gutter\"\r\n        }, null, 4)) : vue.createCommentVNode(\"v-if\", true)\r\n      ], 4),\r\n      _ctx.showSummary ? vue.withDirectives((vue.openBlock(), vue.createBlock(\"div\", _hoisted_9, [\r\n        vue.createVNode(_component_table_footer, {\r\n          border: _ctx.border,\r\n          store: _ctx.store,\r\n          style: {\r\n            width: _ctx.bodyWidth\r\n          },\r\n          \"sum-text\": _ctx.sumText || _ctx.t(\"el.table.sumText\"),\r\n          \"summary-method\": _ctx.summaryMethod,\r\n          fixed: \"right\"\r\n        }, null, 8, [\"border\", \"store\", \"style\", \"sum-text\", \"summary-method\"])\r\n      ], 512)), [\r\n        [vue.vShow, !_ctx.isEmpty]\r\n      ]) : vue.createCommentVNode(\"v-if\", true)\r\n    ], 4)), [\r\n      [_directive_mousewheel, _ctx.handleFixedMousewheel]\r\n    ]) : vue.createCommentVNode(\"v-if\", true),\r\n    _ctx.store.states.rightFixedColumns.value.length > 0 ? (vue.openBlock(), vue.createBlock(\"div\", {\r\n      key: 4,\r\n      ref: \"rightFixedPatch\",\r\n      style: {\r\n        width: _ctx.layout.scrollY.value ? _ctx.layout.gutterWidth + \"px\" : \"0\",\r\n        height: _ctx.layout.headerHeight.value + \"px\"\r\n      },\r\n      class: \"el-table__fixed-right-patch\"\r\n    }, null, 4)) : vue.createCommentVNode(\"v-if\", true),\r\n    vue.withDirectives(vue.createVNode(\"div\", _hoisted_10, null, 512), [\r\n      [vue.vShow, _ctx.resizeProxyVisible]\r\n    ])\r\n  ], 38);\r\n}\r\n\r\nscript$1.render = render$1;\r\nscript$1.__file = \"packages/table/src/table.vue\";\r\n\r\nscript$1.install = (app) => {\r\n  app.component(script$1.name, script$1);\r\n};\r\nconst _Table = script$1;\r\n\r\nexports.default = _Table;\r\n"]}]}